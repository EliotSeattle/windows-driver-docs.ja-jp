---
title: 同期および非同期のコーデック コマンド
description: 同期および非同期のコーデック コマンド
ms.assetid: c37cc94d-37eb-4a3e-b7ae-63fed8827d21
keywords:
- TransferCodecVerbs
- コーデックコマンドの WDK オーディオ
- HD オーディオ、コーデックコマンド
- High Definition Audio (HD audio)、コーデックコマンド
- 同期コーデックコマンド (WDK audio)
- 非同期コーデックコマンド WDK オーディオ
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 38d6d87722d4b914b00821e9a2723e48462c1af9
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72830099"
---
# <a name="synchronous-and-asynchronous-codec-commands"></a>同期および非同期のコーデック コマンド


[**TransferCodecVerbs**](https://docs.microsoft.com/windows-hardware/drivers/ddi/hdaudio/nc-hdaudio-ptransfer_codec_verbs)ルーチンを使用すると、HD オーディオコントローラーに接続されているオーディオおよびモデムコーデックに、関数ドライバーがコマンドを送信できるようになります。 コーデックコマンドは、同期または非同期のどちらかを実行できます。

-   [**TransferCodecVerbs**](https://docs.microsoft.com/windows-hardware/drivers/ddi/hdaudio/nc-hdaudio-ptransfer_codec_verbs)の呼び出しが同期的に処理されるコマンドのリストを送信する場合、このルーチンはコーデックまたはコーデックによってすべてのコマンドが処理された後にのみを返します。

-   [**TransferCodecVerbs**](https://docs.microsoft.com/windows-hardware/drivers/ddi/hdaudio/nc-hdaudio-ptransfer_codec_verbs)の呼び出しで非同期に処理されるコマンドのリストが送信されると、そのルーチンは、コーデックまたはコーデックがコマンドを処理するのを待たずに、HD オーディオバスドライバーによって内部コマンドキューにコマンドが追加されるとすぐに戻ります。 コーデックによってコマンドが処理された後、バスドライバーは、コールバックルーチンを呼び出すことによって関数ドライバーに通知します。

関数ドライバーは、送信するコーデックコマンドの性質に応じて、次の技法の1つ以上を使用して、コーデックから応答を取得します。

-   関数ドライバーは、追加の処理を実行する前にコーデックからの応答を必要とする場合、同期モードを使用します。

-   関数ドライバーがコーデックコマンドの完了を待機する必要がない場合、コーデックの応答を確認し、コマンドが完了したことを確認するには、非同期モードを使用し、コールバックルーチンを無視します (コーデックコマンドのストレージを解放する場合を除く)。、、は、コーデックコマンドへの応答を破棄または無視します。

-   コーデックコマンドが完了したことを関数ドライバーが認識する必要があるが、応答を確認する必要がない場合は、非同期モードを使用し、通知のためにコールバックルーチンに依存します。 ただし、コーデックコマンドに対する応答を破棄または無視します。 コールバックルーチンは、[カーネルストリーミング (KS) イベント](https://docs.microsoft.com/windows-hardware/drivers/stream/ks-events)を使用して、ドライバーのメイン部分に通知を送信する場合があります。

-   コーデックコマンドの完了時と応答の状態の両方を関数ドライバーが認識する必要があるが、コマンドの完了を待たずに直ちに処理を再開する必要がある場合は、非同期モードを使用し、応答の読み取りを回避します。コールバックルーチンを受信します。 コールバックルーチンまたはドライバーのメイン部分は、応答を検査できます。

[*TransferCodecVerbs*](https://docs.microsoft.com/windows-hardware/drivers/ddi/hdaudio/nc-hdaudio-ptransfer_codec_verbs)は、バスドライバーの内部コマンドキューにコマンドの一覧を追加して成功した場合に、STATUS\_SUCCESS を返します。 呼び出しが成功しても、応答は無効になる可能性があります。 関数ドライバーは、コーデック応答のステータスビットを調べて、それらが有効かどうかを判断する必要があります。 このルールは、同期モードと非同期モードの両方に適用されます。

無効な応答の原因は、次のいずれかの可能性があります。

-   コマンドがコーデックに接続されませんでした。

-   コーデックは応答しましたが、RIRB で先入れ先出し (FIFO) のオーバーランが発生したときに、応答が失われました。

後者の問題は、RIRB FIFO のサイズが不十分であることを示しています。

各コーデック応答には、応答が有効かどうかを示す**IsValid**フラグと、RIRB FIFO オーバーランが発生したかどうかを示す**HasFifoOverrun**フラグが含まれています。 **IsValid** = 0 の場合、応答が無効であることを示します。 **HasFifoOverrun**フラグは、エラーの原因を特定するのに役立ちます。

-   **HasFifoOverrun** = 0 の場合、コーデックは必要な時間間隔内に応答できませんでした。 原因として、コマンドがコーデックに到達していないことが考えられます。

-   **HasFifoOverrun** = 1 の場合、コマンドはコーデックに到達した可能性がありますが、FIFO オーバーランにより応答が失われました。

*TransferCodecCommands*の呼び出し中に、呼び出し元は、 [**HDAUDIO\_コーデック\_転送**](https://docs.microsoft.com/windows-hardware/drivers/ddi/hdaudio/ns-hdaudio-_hdaudio_codec_transfer)構造体の配列へのポインターを提供します。 各構造体には、コマンドが含まれ、応答のための領域が提供されます。 バスドライバーは、応答をトリガーしたコマンドを含む構造体に常に各応答を書き込みます。

*TransferCodecCommands*を呼び出すたびに、コマンドが処理される順序は、配列内のコマンドの順序によって決まります。 配列内の最初のコマンドを処理する前に、2番目のコマンドの処理が開始される前に完了します。

さらに、クライアントが*TransferCodecCommands*への非同期呼び出しを行った後、最初の呼び出しからのコールバックルーチンを待機せずに*TransferCodecCommands*を2回呼び出します。このとき、2つのコマンドグループの相対順序2つの呼び出しの処理は、クライアントがコマンドの2つのグループを送信した順序によって定義されます。 したがって、バスドライバーは、2回目の呼び出しからコマンドの処理を開始する前に、最初の呼び出しからのすべてのコマンドを処理します。

ただし、2つの異なる関数ドライバーインスタンスによって送信されるコマンドの相対順序は定義されていません。 (各インスタンスには、独自の物理デバイスオブジェクトがあります)。たとえば、インスタンス1が*TransferCodecCommands*を呼び出して、コマンド A、b、および c を注文 a-b-c に送信し、インスタンス2が*TransferCodecCommands*を呼び出して x-y-z のコマンドを送信した場合、バスドライバーは次のコマンドを実行する可能性があります。-X-Y-B-Z-C の順序を付けます。

個別の関数ドライバースレッドが同じハードウェアリソースセットへのアクセスを共有する場合は、異なるドライバースレッドからのコマンドの相対的な順序が重要になることがあります。 その場合、関数ドライバーは、リソースの共有をスレッド間で同期します。

たとえば、コーデックにデータバイトのシーケンスを書き込むためのハードウェアインターフェイスは、インデックスレジスタと8ビットデータレジスタで構成される場合があります。 まず、関数ドライバーは、開始インデックスをインデックスレジスタに読み込むコーデックコマンドを送信します。 次に、ドライバーはデータの最初のバイトをデータレジスタに書き込むコマンドを送信します。 インデックスレジスタは、転送が完了するまで、データレジスタへの連続した書き込みの後に増加します。 ただし、2つのドライバースレッドがインデックスとデータレジスタのアクセスを適切に同期できない場合、2つのスレッドによる個々のレジスタアクセスの相対順序は定義されず、結果として、データの破損や無効なハードウェアが発生する可能性があります。configuration.

[*TransferCodecVerbs*](https://docs.microsoft.com/windows-hardware/drivers/ddi/hdaudio/nc-hdaudio-ptransfer_codec_verbs)ルーチンは、HD audio DDI の両方のバージョンで使用できます。

 

 




