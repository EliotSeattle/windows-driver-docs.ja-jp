---
title: 動的なトポロジの管理
description: 動的なトポロジの管理
ms.assetid: 324c372b-c8d6-4eed-b4ea-071b3d5412b1
keywords:
- 動的トポロジ WDK オーディオ
- ジャック-プレゼンス検出 WDK オーディオ
- 登録 (サブデバイスを)
- 動的サブデバイス WDK オーディオ
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 3c6976ab141914b645a7f68dbe0426f7283925e6
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72830389"
---
# <a name="managing-dynamic-topologies"></a>動的なトポロジの管理


オーディオアダプターには、ユーザーがアダプターのフロントパネルまたはバックパネルオーディオジャックに接続する外部オーディオデバイス (スピーカーやマイクなど) を処理するための少数のサブデバイスが含まれています。 各サブデバイスは、特定のオーディオジャックまたはジャックのグループをサービスします。

オーディオドライバーは、基本的に、サブデバイス内の内部接続と処理要素のマップであるトポロジを提示することで、各サブデバイスについて説明します。 システムによって提供される Windows API モジュールおよびベンダーが提供するコントロールパネルアプリケーションでは、トポロジ情報を使用して、サブデバイスの機能を決定し、その内部の制御ポイントを識別します。 詳細については、「[フィルタートポロジの公開](exposing-filter-topology.md)」を参照してください。

[Iunregistersubdevice](https://docs.microsoft.com/windows-hardware/drivers/ddi/portcls/nn-portcls-iunregistersubdevice)および[Iunregistersubdevice](https://docs.microsoft.com/windows-hardware/drivers/ddi/portcls/nn-portcls-iunregisterphysicalconnection)インターフェイスが使用できるようになる前に作成された WDM オーディオドライバーは、ほとんどの静的トポロジになっています。 これらのドライバーでは、アダプタードライバーがサブデバイスを管理するミニポートドライバーオブジェクトを作成した後、そのオブジェクトとそれに関連付けられているサブデバイスは、アダプタードライバーオブジェクトの有効期間にわたって保持されます。

ただし、動的に構成可能なオーディオアダプターでは、アダプタードライバーは、ユーザーが外部デバイスをオーディオジャックに接続して削除したときに、ハードウェア構成の変更を反映するために、実行時にサブデバイスの作成と削除を行うことができます。 この動作により、サブデバイスは論理的に独立したハードウェア機能として動作します。 つまり、各サブデバイスの電源を入れ、構成し、他のサブデバイスと切り離してシャットダウンできます。

各サブデバイスには、次の要素で構成される内部トポロジがあります。

-   サブデバイスを介したデータパス。

-   データパスに沿ってフローするデータストリームを処理するトポロジノード (ボリュームコントロールなど)。

-   同じアダプター内の他のサブデバイスへのサブデバイスの物理的な接続。

アダプタードライバーは、サブデバイスを動的に削除するときに、サブデバイスの内部トポロジにバインドされているハードウェアリソースを解放します。 アダプタードライバーは、これらのリソースを使用して、異なるトポロジを持つ新しいサブデバイスを作成することができます。

新しいオーディオサブデバイスを構成すると、アダプタードライバーによって、サブデバイスのドライバーインターフェイスが1つまたは複数の[デバイスインターフェイスクラス](https://docs.microsoft.com/windows-hardware/drivers/install/device-interface-classes)のインスタンスとして登録されます。また、i/o マネージャーによって、インターフェイスクラスとインターフェイスインスタンス。 ユーザーモードのクライアントは、サブデバイスにアクセスするために、レジストリからシンボリックリンクを取得し、それを呼び出しパラメーターとして[**CreateFile**](https://docs.microsoft.com/windows/desktop/api/fileapi/nf-fileapi-createfilea)関数に渡します。 通常、クライアントは、Dsound や Wdmaud などの Windows API モジュール、またはベンダーが提供するコントロールパネルまたはオーディオユーティリティプログラムです。 **CreateFile**の詳細については、Microsoft Windows SDK のドキュメントを参照してください。

ミニポートドライバーが[**Iunregistersubdevice:: unregistersubdevice**](https://docs.microsoft.com/windows-hardware/drivers/ddi/portcls/nf-portcls-iunregistersubdevice-unregistersubdevice)メソッドを呼び出してサブデバイスを削除すると、PortCls システムドライバー (PortCls) は、関連付けられているデバイスインターフェイスのシンボリックリンクを登録. デバイスインターフェイス削除イベントに登録されているコンポーネントは、インターフェイスが削除されたときに通知を受け取ります。

オーディオアダプターには、プラグがオーディオジャックに挿入または削除されたときにミニポートドライバーに通知するためのジャックプレゼンス回路を含めることができます。 ユーザーがオーディオジャックにプラグインを挿入すると、アダプタードライバーによって、関連付けられたサブデバイスのデバイスインターフェイスがレジストリに追加されます。 ユーザーがオーディオジャックからプラグを削除すると、アダプタードライバーによって、対応するデバイスインターフェイスがレジストリから削除されます。

動的トポロジをサポートするオーディオアダプターには、次の利点があります。

-   ユーザーフレンドリ

    デスクトップスピーカー、ヘッドホン、およびその他の外部オーディオデバイスが実際にオーディオアダプターの前面または背面パネルにあるオーディオジャックに接続されていない限り、これらのデバイスは使用可能なオーディオアプリケーションには表示されません。

-   電力効率

    ユーザーがオーディオジャックからプラグを削除すると、ドライバーは、そのジャックをサービスしているアダプター回路の一部の電源を切ることができます。

-   構成可能

    サブデバイスを削除した後、ドライバーは、サブデバイスの内部トポロジにバインドされたハードウェアリソースを使用して、異なるトポロジを持つ新しいサブデバイスを作成できます。

 

 




