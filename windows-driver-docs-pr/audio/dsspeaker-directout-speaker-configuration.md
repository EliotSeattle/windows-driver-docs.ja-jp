---
title: DSSPEAKER_DIRECTOUT スピーカー構成
description: DSSPEAKER_DIRECTOUT スピーカー構成
ms.assetid: a4198fb7-157f-40e3-8cca-5a9e392087d2
keywords:
- DSSPEAKER_DIRECTOUT スピーカー構成 WDK オーディオ
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 4c43f4bfa8f6213b9293433bb71b67f2e5d8ffe2
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72833420"
---
# <a name="dsspeaker_directout-speaker-configuration"></a>DSSPEAKER\_DIRECTOUT スピーカーの構成


## <span id="dsspeaker_directout_speaker_configuration"></span><span id="DSSPEAKER_DIRECTOUT_SPEAKER_CONFIGURATION"></span>


この情報は、Windows XP およびそれ以前のオペレーティングシステムに適用**さ  ます**。 Windows Vista 以降では、 **Idirectsound:: GetSpeakerConfig**と**Idirectsound:: SetSpeakerConfig**は非推奨とされました。

 

アプリケーションプログラムでは、スピーカー構成パラメーターを DSSPEAKER\_DIRECTOUT に設定して**Idirectsound:: SetSpeakerConfig**メソッドを呼び出すことにより、DirectSound スピーカー構成を direct out モードに変更できます (Microsoft Windows SDK のドキュメントを参照してください)。 これにより、speakerless 構成が指定されます。この構成では、アプリケーションからの再生ストリーム内のチャネルは、スピーカーの位置として解釈されることなくオーディオアダプターに直接出力されます。 ただし、入力ストリームは、チャネルへのスピーカーの割り当てに関する想定を必要としない、サンプルレート変換、減衰、フィルター処理、およびその他の種類の処理によって変更できます。

これが有効になると、DSSPEAKER\_DIRECTOUT スピーカー構成設定がグローバルになり、オーディオデバイス全体に影響します。 その後に実行されるすべてのオーディオアプリケーションは、DirectSound によって設定が再度変更されるまで、新しい設定の対象になります。

ダイレクトアウトモードでは、オーディオデバイスは、デバイス上の最初の出力コネクタへの最初のチャネル、デバイス上の2番目の出力への2番目のチャネルなどをレンダリングします。 これにより、オーディオ作成アプリケーションは、マルチチャネルデータを外部ミキサーやオーディオストレージデバイス (ハードディスク、ADAT など) に直接出力することができます。 たとえば、次の表に示すように、48チャネルストリームのチャネルが割り当てられている可能性があります。

チャネル番号のコンテンツ0

ボーカル

1

ドラム

2

弾く

3

低音

...

47

ピアノ

 

この種の未加工オーディオデータでは、スピーカーの位置は無意味であり、入力ストリームまたは出力ストリームにスピーカーの位置を割り当てると、望ましくない副作用が発生する可能性があります。 たとえば、KMixer などのコンポーネントは、3D 仮想化や Dolby サラウンド Pro ロジックエンコードなどのスピーカー固有の効果をストリームに適用することで、不適切な介入を行う可能性があります。 生データチャネルの数は、チャネルマスクのビット数によって制限されないことに注意してください。

特にオーディオ編集専用に設計されていないデバイスでも、通常は[**Ksk プロパティ\_使用し、オーディオ\_チャネル\_構成**](https://docs.microsoft.com/windows-hardware/drivers/audio/ksproperty-audio-channel-config)セットプロパティの要求を受け取ります。これにより、スピーカーの構成を ksk AUDIO\_スピーカー\_directout に変更できます。 一般に、デバイスは、その出力がスピーカーに接続されていることを何らかの方法で確認できない限り、要求が失敗するのを防ぐ必要があります。また、外部ミキサーへの入力として、他の目的で外部に使用することはできません。

ダイレクトアウトモードを使用するアプリケーションは、通常、特定のハードウェアデバイス用に作成されます。 これにより、アプリケーションは、チャネルの数やチャネル内のデータをどのように解釈するかなど、デバイスでサポートされている直接のデータ形式を事前に知ることができます。 この情報が必要なのは、direct out モードで構成されているデバイスでアプリケーションが**Idirectsound:: GetSpeakerConfig**を呼び出したときに、デバイスがこのモードであることを確認するだけであるためです。これは、direct out モードでサポートされているストリーム形式のチャネル数に関する追加情報を提供しません。 (ただし、この情報が得られる可能性があります。この情報は、 [ **\_レベル\_CAPS プロパティ**](https://docs.microsoft.com/windows-hardware/drivers/audio/ksproperty-audio-mix-level-caps)の取得要求をデバイスのミキサーピンのスーパーミキサーノードにミックス\_ミックスプロパティを\_しています。「 [DirectSound ノード順序の要件](directsound-node-ordering-requirements.md)」を参照してください)。

ダイレクトアウトストリームの wave 形式を指定する場合、アプリケーションでは、 [**WAVEFORMATEXTENSIBLE**](https://docs.microsoft.com/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-waveformatextensible)構造体の**dwchannelmask**メンバーを、値 ksaudio\_スピーカ\_directout (0) に設定する必要があります。 チャネルマスクが0の場合は、スピーカーの位置が定義されていないことを示します。 常に、ストリーム内のチャネルの数は、 **. nChannels**メンバーという形式で指定されます。

ハードウェアベンダーは、デバイスがダイレクトアウトモードで構成されている場合に、DirectSound ハードウェアアクセラレータをサポートするオプションを備えています。 DirectSound アプリケーションでは、デバイスのミキシングピンの1つを使用して、ダイレクトバックストリームを再生できます (使用可能な場合)。 使用可能なすべてのハードウェア pin インスタンスが使い果たされると、新しいストリームは KMixer 経由で渡されます。

Direct out モードで構成されているデバイスのストリームを混合する場合、KMixer は、アプリケーションからの入力ストリームのチャネルと、デバイスに出力するミックスストリームのチャネルの間に1対1のマッピングを適用します。 つまり、アプリケーションが同じ数のチャネルを持つ複数の direct out ストリームを生成する場合、たとえば、出力ミックスの各チャネル N は、KMixer に入るすべてのストリームの N チャネルの合計になります。

含まれているチャネルの数が異なる複数の direct out ストリームを混在させる場合、KMixer の混合アルゴリズムは少し複雑になります。 この場合、ミックスの各チャネル N は、チャネル n を持つすべての入力ストリームの N チャネルの合計になります。たとえば、KMixer がクワッドとステレオの入力ストリームを混合してクワッド出力ミックスを形成する場合、チャネル0と出力ミックスの1つは、入力ステレオとクワッドストリームのチャネルの合計をゼロに、1つずつです。 ただし、ステレオ入力ストリームでは、2 ~ 3 つのミックスのチャネルには何も関与しません。これは、クワッド入力ストリームの最後の2つのチャネルからのみ取得されます。

次のいずれかを実行しようとするアプリケーションは、予期しない動作です。

-   ダイレクトアウトモードで構成されているデバイスを使用して、ダイレクトアウト形式ではないストリームを再生します。

-   ダイレクトアウトモードで構成されていないデバイスを使用して、ダイレクトアウトストリームを再生します。

これらのいずれかのケースに直面した場合、KMixer は単にストリームを開けないように回避します。 代わりに、前述の一対一のマッピングアルゴリズムを使用して、明らかな非互換性を処理しようとします。 結果がユーザーに表示されるか、満たされない可能性があります。 他のオーディオコンポーネントでは、これらのケースを KMixer と同じように処理することはできません。 たとえば、direct out モードで構成されているデバイスのドライバーは、direct out 形式ではない出力ストリームのハードウェアバッファーを開こうとすると失敗します。その逆も同様です。

オーディオ作成アプリケーションでは、その出力ストリームの最初のいくつかのチャネルに混合したデータをユーザーがリッスンすることが必要になる場合がありますが、ストリームの残りのチャネルにまだ含まれている生データは無視されます。 KMixer の動作により、これが簡単になります。 たとえば、24チャネル再生ストリームにチャネル0とチャネル1のステレオミックスが含まれており、チャネル 2 ~ 23 の生データが含まれている場合、アプリケーションは次の処理を実行します。

-   DSSPEAKER\_ステレオで**SetSpeakerConfig**を呼び出すことによって、ステレオモードでターゲットオーディオデバイスを構成します (これは必ずしもアプリケーションがストリームを編集するために使用するデバイスではありません)。

-   再生ストリームの[**WAVEFORMATEXTENSIBLE**](https://docs.microsoft.com/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-waveformatextensible)構造体の**DWCHANNELMASK**を ksk オーディオ\_スピーカー\_ステレオに変更**しますが、形式はありません。 n チャネル**は、ストリーム内のチャネルの合計数である24に設定されます。

KMixer は、チャネルマスクで記述されている再生ストリームのステレオチャネルのみをミックスし、生データを含む残りの22チャネルを破棄します。 DirectSound スピーカー構成設定に加えられた変更は、現在の DirectSound オブジェクトが破棄されて別のものが作成されるまで有効にならないことに注意してください (「[スピーカー構成設定の適用](applying-speaker-configuration-settings.md)」を参照してください)。

 

 




