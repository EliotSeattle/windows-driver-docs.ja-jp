---
title: WavePci デバイスのハードウェア要件
description: WavePci デバイスのハードウェア要件
ms.assetid: 58a73ac1-baba-42df-a590-e7282f902157
keywords:
- WavePci ハードウェア要件の WDK オーディオ
- バス マスター WDK オーディオ
- WDK のオーディオを任意の配置
- メモリの WDK オーディオ
- キャッシュの WDK オーディオ
- データ コピーの WDK オーディオ
- オーディオ データのコピー
- バッファーの WDK オーディオ
- plit バッファー フレーム WDK オーディオ
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: baa8d00a03d00f98f5224047aa6cf52cb10a656f
ms.sourcegitcommit: fb7d95c7a5d47860918cd3602efdd33b69dcf2da
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/25/2019
ms.locfileid: "67360024"
---
# <a name="hardware-requirements-for-wavepci-devices"></a>WavePci デバイスのハードウェア要件


## <span id="hardware_requirements_for_wavepci_devices"></span><span id="HARDWARE_REQUIREMENTS_FOR_WAVEPCI_DEVICES"></span>


新しいハードウェアの設計の機能を選択するときにベンダーはこれらの原則に従う必要があります。

-   単にすべての処理をハードウェアに移動しようとすると、代わりにベンダーのパフォーマンスにに対するその影響は、各機能のコストについて検討する必要があります。

-   ハードウェアの機能の潜在的な値を検討するとき、仕入先は、オーディオなどの特定のサブシステムに狭義に注目するのではなく、システム全体に与える影響の観点からは、その機能を評価してください。

-   ハードウェアの高速化する機能を慎重に選択すると、ベンダーが CPU 負荷を軽減し、それによって、システムのリソースの他のタスクで使用できるメモリ使用量を改善できます。

従来、これらの原則を次のすべてのオーディオ ハードウェア設計が成功しました。

オーディオの再生時にコンテンツまたは複数のストリーム、WDM オーディオ ドライバーの混在を不必要には、大量の CPU 時間とバスの帯域幅を消費します。 このような欠陥は、通常、設計の欠陥のあるハードウェアとドライバーを非効率的な実装の結果です。 ハードウェア設計の欠陥は、オーディオ ドライバーが特定のウェーブ フォーマットを処理するを防ぐまたはソフトウェアの介入を必要とする回避策が必要になるもできます。

WaveCyclic デバイス モデルの目的は、以前のオーディオ デバイスのハードウェアの制限に対応するためにです。 新しいハードウェアの設計を WavePci 完全準拠にする必要があります。

True のスキャッター/ギャザー DMA を実行できる WavePci デバイス、cpu バッファー間でコピー オーディオ データを時間を費やす必要はありません。 WaveCyclic とは異なり WavePci 不要になった固有データのコピーに multistream またはハードウェア アクセラレータを使用したオーディオ デバイス用の優先ミニポート ドライバーになります。 適切に設計された WavePci デバイス必要があります 3-D 処理との混合のハードウェアに多数の (64 以上) のオーディオ ストリームを送信することの CPU リソースが消費ほとんどありません。

WavePci デバイスでは、スキャッター/ギャザー DMA の転送をサポートしているバス マスター DMA コント ローラーが必要です。 ハードウェア設計では、任意の制限は DMA コント ローラーが処理できるデータ転送の種類を配置する必要があります。 WavePci デバイスは、次の要件を満たす必要があります。

-   **デバイスは、バス マスターである必要があります。**

    自律的にしなくても、オペレーティング システムと DMA のシステム リソースを使用しない場合、システム メモリにアクセスできる必要があります。

-   **デバイスは、任意の長さのデータ転送を処理できる必要があります。**

    マッピングを処理する必要があります (を参照してください[ **IPortWavePciStream::GetMapping**](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/portcls/nf-portcls-iportwavepcistream-getmapping)) メモリ ページより大きい。 4 キロバイト単位の転送の制限を使用したデバイスの WavePci の要件はすべて適合などしません。 Microsoft Windows をサポートする 64 ビット Cpu でページ サイズは 8 キロバイト、これにより、一部のマッピングをサイズの 4 キロバイトを超えるされる可能性が高いです。 マッピングは 1 つの 32 キロバイトを超えるデータ転送は、物理メモリの断片化によって、理論的に可能です。 その一方で、1 バイトのマップのサイズが可能です。

-   **デバイスは、システム メモリ内の任意の場所の間のデータ転送を処理する必要があります。**

    32 キロバイト以上 2 のべき乗の境界にまたがるデータ転送は、可能性もあります。 コンピューターがここで 4 ギガバイトを超える RAM を含めることができ、それらのシステムでは、マッピングに配置できます以上 4 ギガバイトよりも 64 ビット CPU または物理の x86 の場合、物理メモリ内アドレス拡張 (PAE)。 これらのマシン上の最適なパフォーマンスを実現するためにベンダーは、64 ビットのアドレス指定をサポートするデバイスを作成する必要があります。 それ以外の場合、データのソフトウェアのコピーが必要です。 データのコピーは従来 24 ビットの 16 メガバイト以上の RAM のシステムでアドレス指定を持つデバイスに必要でした。 デバイスからの読み取りまたは物理メモリの任意の場所に書き込むことはできません、WavePci ではなく WaveCyclic を使用する必要があります。 ドライバーは、デバイスのスタートアップ時にこの判断を行うことができます (を参照してください[ **IRP\_MN\_開始\_デバイス**](https://docs.microsoft.com/windows-hardware/drivers/kernel/irp-mn-start-device)) のアドレスに到達するかどうかを判断する機会を得た後は、システムのメモリ バスの完全なアドレス範囲にアクセスするだけで十分です。

-   **デバイスで任意の配置のデータ転送を処理する必要があります。**

    マッピングでは、開始でき、メモリ内の任意のバイト境界で終了することができます。 オーディオ データのフレームは、最初のマッピングの最後に最初のいくつかのチャネルのサンプルと、残りのチャネルで 2 つ目のマッピングのサンプルのマッピングの間で分割できます。 例については、次を参照してください。 [Wave フィルター](wave-filters.md)します。 いくつかのサンプル サイズの間のマッピングでサンプルのコンテナーでもを分割できます。 デバイスでは、キャッシュ ラインの境界上で転送必要があることが必要な場合、またはデバイスは、転送が (たとえば、4 つステレオの 16 ビットの場合に転送サイズが均等に分割されますと仮定した場合)、オーディオ フレームの境界線に厳密に合わせて配置される必要がある場合このデバイスは WavePci に完全に準拠に適していません。 データの範囲またはドライバーを公開します (たとえば、特定のビット深度のみまたは特定のチャネル構成のみ) の形式を制限することによって、WavePci デバイスとして、非準拠のハードウェアを公開することができますに注意してください。

上記の最後のポイントに関する WavePci デバイスのスキャッター/ギャザーの DMA エンジンがメモリ ページの境界をまたがるバッファーを処理する必要があります。 たとえば、10 ミリ秒間分の 48 kHz、5.1 チャンネルのウェーブ ストリームの 16 ビットの PCM オーディオ サンプルを含むバッファーでは、次のサイズがあります。

(6 サンプル フレーム)\*(2 バイト サンプル)\*(48 K フレーム/秒)\*(10 ミリ秒) = 5,760 バイト

バッファーにメモリ内の配置方法に応じて、1 つまたは 2 つのいずれかのページ境界が含まれていることを意味するメモリのページ サイズ (4,096 バイト) を超えています。 バッファーにはオーディオ データは、フレームの整数値 (480) が含まれていますが、1 つまたは 2 つのこれらのフレームがページ境界にまたがる可能性があります。

このため、メモリ内に物理的に連続していない 2 つのページ間で分割されます (次の図にフレーム 197) などのオーディオのフレームを処理するために WavePci デバイスのスキャッター/ギャザー DMA ハードウェアを設計する必要があります。

![ページの先頭からのオフセットでオーディオのバッファーを示す図](images/framealign.png)

上記の図の上部にある、2 つのページ間の境界をまたぐ 5760 バイト バッファーです。 この例では、バッファーはメモリ 64 バイト境界にバッファーの先頭の配置の最初のページの先頭から 1728 バイト オフセットで開始されます。 各オーディオ フレームが 12 バイトを占有し、6 つのチャネルを含んでいると仮定します。 最初のページには、すべてのフレーム 197 の最初の 4 バイトのみが 196 を介してフレーム 0 が含まれています。

図の下部にある、0 および 1 チャンネル用のサンプルのみが最初のページ内に入ることを示す 197、オーディオのフレームの詳細なビューです。 チャネルの 2 ~ 5 のサンプルは、2 番目のページに格納されます。

図の上部にある、互いの横にある 2 つのページが表示されますは、実際には、カーネルの仮想メモリ内のみで連続しています。 バッファーを含むページが物理メモリ内で連続していないため、物理アドレスを使用してスキャッター/ギャザー DMA コント ローラーは、転送キューで別の 2 つのエントリとしてバッファーの 2 つの部分を指定する必要があります。 WavePci ポート ドライバーは、ページの境界で 2 つの独立した物理マッピングにバッファーを自動的に分割します。

前の例を最初のページの開始にバッファーに合わせて変更する場合でも、フレームの分割問題は消えません。 次の図は、この点を示しています。 ここでは、フレーム 341 分断サンプル 0 および 1 チャンネルを使用したページ境界にもう一度が最初のページとチャンネルのサンプル内で 2 ~ 5 が 2 番目のページにあります。

![ページの先頭に配置されたオーディオのバッファーを示す図](images/framealign2.png)

スキャッター/ギャザー DMA コント ローラーが分割オーディオ フレームを正しく処理しない WavePci デバイスは、ソフトウェアの回避策は、いくつかのハードウェア設計の欠陥を軽減できる可能性がありますが、処理できるオーディオ データ形式の種類に制限されます。 詳細については、次を参照してください。 [WavePci 待機時間](wavepci-latency.md)します。

 

 




