---
title: データ交差
description: データ交差
ms.assetid: a1588ce0-a091-4bfd-98a9-4d78e2fc847f
keywords:
- に関するデータの積集合、交差部分のデータ ハンドラーの WDK オーディオ
- データの交差部分を WDK オーディオ
- 交差部分を WDK オーディオ
- データ範囲の交差部分を WDK オーディオ
- シンク ピン WDK オーディオ
- ソース ピン WDK オーディオ
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 4857f3cbb07d73ce8764517dd7cb7b961206c510
ms.sourcegitcommit: fb7d95c7a5d47860918cd3602efdd33b69dcf2da
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/25/2019
ms.locfileid: "67359095"
---
# <a name="data-intersection"></a>データ交差


## <span id="data_intersection"></span><span id="DATA_INTERSECTION"></span>


オーディオ フィルター グラフでオーディオ ストリームできます 1 つのフィルターのソースの pin からに別のフィルターのシンクのピン留めする 2 つの pin、ストリームの一般的な形式をサポートする場合にのみフロー。 同様に、クライアントは、フィルターでシンク pin にオーディオ ストリームを送信または一般的なストリームの形式をサポートしているクライアントとピン留めする場合にのみ、フィルターでソース pin からオーディオ ストリームを受信します。 オーディオ フィルターは、一般的なは、2 つの pin、またはクライアントと pin であるストリームの形式を識別するために、データの交差部分 (短縮形のデータ範囲の交差部分) と呼ばれる手法を使用します。

などの Windows Server 2003、Windows XP、Windows 2000、および Windows Me/98 に、 [SysAudio システム ドライバー](kernel-mode-wdm-audio-components.md#sysaudio_system_driver)データ積集合の手法を使用して、サポートするフィルターのピンのペアを接続することで、オーディオ フィルター グラフを作成するには互換性のあるオーディオ データ形式。

A [pin ファクトリ](pin-factories.md)型の構造体の各データ範囲が、データの範囲の配列として各暗証番号 (pin) をサポートしている形式のセットを示す[ **KSDATARANGE\_オーディオ**](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/ksmedia/ns-ksmedia-ksdatarange_audio). データ範囲は、一般的な形式の種類を指定する[ **KSDATAFORMAT\_WAVEFORMATEX** ](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/ksmedia/ns-ksmedia-ksdataformat_waveformatex)または[ **KSDATAFORMAT\_DSOUND**](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/ksmedia/ns-ksmedia-ksdataformat_dsound). さらに、データの範囲は、次のパラメーターの各値の範囲を指定します。

-   サンプルあたりのビット数

-   頻度のサンプル

-   チャネルの数

KSDATARANGE\_オーディオ構造体は、サンプル ビット数と頻度のサンプルの範囲の最小値と最大の両方の値がチャンネル数の範囲の最大値のみを指定します。 チャネルの最小数は、暗黙的に 1 つです。

ネゴシエートの 2 つの pin の一般的なデータ形式のジョブは、2 つのデータ範囲 - 各暗証番号 (pin)--から互いに交差する検索で構成されます。 2 つのデータ範囲の交差する場合。

-   同じ一般的な wave 形式のサポート (KSDATAFORMAT\_WAVEFORMATEX または KSDATAFORMAT\_DSOUND)。

-   それぞれのサンプルごとのビットの範囲が重複します。

-   それぞれのサンプル周波数の範囲が重複します。

先ほど、KSDATAFORMAT\_オーディオ構造体を pin でサポートされているチャネルの最小数は常に 1 つのハードウェア モデルを意味します。 、このモデルに応じたピンが 2 つチャンネル数範囲が両方のピンを少なくとも 1 つのチャネルをサポートするため、常に重複する必要があります。 当然ながら、チャネルの 2 つ以上の最小数のハードウェア アダプターが、このモデルに準拠していませんが、アダプターのドライバーは、この種の問題を処理する独自のデータの積集合のハンドラーを含めることができます (例を参照してください[専用。Data-Intersection ハンドラー](proprietary-data-intersection-handlers.md))。

2 つの pin の交差するデータ範囲のペアが見つかると、ハンドラー一般的なデータ形式から選択積集合のリージョンとしては、次のようにします。

-   サンプルごとのビット数は、サンプルごとのビット数が 2 つの範囲が重複してリージョンから選択されます。

-   頻度のサンプルは、2 つのサンプル周波数範囲が重複してリージョンから選択されます。

-   チャネルの数は、2 つのチャンネル数の範囲が重複してリージョンから選択されます。

たとえば、ポートのオーディオ ドライバーのシンクの暗証番号 (pin) と別のフィルターのソースの pin の一般的な形式をネゴシエートするときに (通常、 [KMixer システム ドライバー](kernel-mode-wdm-audio-components.md#kmixer_system_driver))、SysAudio が最初にソース ピンのデータ範囲の配列を取得します。 SysAudio を送信し、 [ **KSPROPERTY\_PIN\_DATAINTERSECTION** ](https://docs.microsoft.com/windows-hardware/drivers/stream/ksproperty-pin-dataintersection)シンク pin を要求し、この要求でソース ピンのデータ範囲の配列を埋め込みます。 カーネル ストリーミング レイヤーが要求をインターセプトして、ソース ピンのデータ範囲の配列、ハンドラーが検索に成功するまでは、最初の要素では、以降の連続する各要素に対して 1 回、ポート ドライバーの交差部分のデータ ハンドラーを呼び出す、データの積集合。

まず、ハンドラーは SysAudio はポート ドライバーの交差部分のデータ ハンドラーを呼び出すごとに、ミニポート ドライバーからシンク ピンのデータ範囲の配列を取得します。 以降では、最初の要素はシンク pin データ範囲と、現在のソース-pin のデータ範囲の交差部分の検索に成功するまで、配列を反復処理します。 ハンドラーでは、一般的な形式の積集合内にあるし、出力、呼び出し元には、この形式を選択します。

イテレーションの各ステップは、ポート ドライバーは、2 つのデータ範囲 - 2 つの pin ごとに 1 つと、ミニポート ドライバーの独自のデータの積集合のハンドラーを呼び出します。 いずれかの手順で、独自のハンドラー拒否した場合、2 つのデータ範囲間の交差部分のデータのチェックを処理するために、ポート ドライバーの交差部分のデータ ハンドラーが代わりに、チェックを実行します。

要約すると、ソース pin データ範囲とシンク pin データ範囲の交差、部分の検索は反復プロセスです。

-   外側のループでは、カーネル ストリーミング レイヤーはソース ピンのデータ範囲の配列、配列の最初の要素で始まる一連の要素を反復処理します。

-   内側のループでは、ポート ドライバーはシンク ピンのデータ範囲の配列、配列の最初の要素で始まる一連の要素を反復処理します。

最初のデータの交点の検出時に、検索を停止します。 このプロセスは、各ピンのデータ範囲の配列の先頭に向かって要素のどちらを優先する傾向があります。 Pin のデータ範囲の配列を指定するときにアダプターのドライバーの配列の先頭に向かって優先形式のデータ範囲を配置することで配列要素の並べ替えする必要があります。

 

 




