---
title: 記録中に、Stream の待機時間
description: 記録中に、Stream の待機時間
ms.assetid: b9391b34-acd8-4434-b00c-48bbbc0b6647
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 36f1f5f4987e239ea0c05949b580bf1e7c2b81b5
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56549143"
---
# <a name="stream-latency-during-recording"></a>記録中に、Stream の待機時間


実行状態では、レコードのオーディオ ストリームが、WaveRT ポート ドライバーのロールは最小限です。 記録中に、次の図に示すように、オーディオ デバイスはオーディオ データをキャプチャし、循環バッファーに書き込みます。 オーディオ エンジンは、バッファーから、このデータを読み取ります。 このアクティビティには、ポート、ドライバーの介入は不要です。 つまり、オーディオ データは、カーネル モード ソフトウェア コンポーネントで処理されることがなくオーディオ ハードウェアとユーザー モード アプリケーション間で直接フローします。

次の図に、レコードと、読み取り位置継続的に進行状況の左から右に、ストリームを通過バッファーとして。 レコードまたは読み取り位置が、バッファーの末尾に達すると、バッファーの先頭にラップします。

![記録のストリームの待機時間を示す図](images/wavert-record.png)

前の図の識別、*レコード位置*オーディオ デバイスが現在 (アナログ/デジタル変換、または ADC でマイクからキャプチャする) を記録するサンプルのバッファーの場所として。 レコードの位置はオーディオ デバイスが FIFO を通過した後、サンプルを書き込む先将来バッファーの位置であることに注意してください。 *読み取り位置*オーディオ エンジンが次のサンプルを読み取るバッファー位置です。

クライアントによって読み取られるまで、オーディオ デバイスが ADC でオーディオのサンプルをキャプチャする時間の待機時間は、レコードと読み取り位置の間の分離だけです。 この分離は、次のソースの待機時間の合計 (A としてマークされていると、図の B)。

**待機時間、**:ADC からデータをキャプチャした後、循環バッファーにデータを書き込むことになるまで、オーディオ デバイスはハードウェア FIFO で、データを格納します。

**待機時間 B**:オーディオ デバイスは、データを循環バッファーに書き込む後、データは、クライアントがデータを読み取るまで、バッファー内に存在します。

クライアントに制御する、ハードウェアに完全に依存する待機時間がありません。 一般的な FIFO では、約 64 サンプル、ADC からを格納します。 ただし、クライアントはコントロール待機時間 B. B の待機時間が大きすぎるためのシステムに不必要な遅延が導入されていますが、小さすぎるのリスク データを読み取るので、早すぎるオーディオ デバイスがバッファーに書き込みます。

クライアントは、そのバッファーを読み取るスレッドを定期的にアクティブ化するタイマーを設定できますが、このメソッドは、最小の待機時間を達成できません。 待機時間をさらに減らすためには、クライアントは、バッファーにキャプチャ データの新しいブロックを書き込んで終了するたびに、デバイスのハードウェア通知を生成するオーディオ デバイスを構成できます。 この場合、タイマーによっての代わりにハードウェアの通知がクライアント スレッドをアクティブにします。

オーディオ エンジンを定期的に通知するオーディオ デバイスを持つクライアントことで、待機時間が実際よりも小さい。

クライアント (通常はオーディオ エンジン) に送信することによって、オーディオ デバイスがストリームの待機時間に貢献する遅延の概要を取得できる、 [ **KSPROPERTY\_RTAUDIO\_HWLATENCY** ](https://msdn.microsoft.com/library/windows/hardware/ff537378)WaveRT ポート ドライバーに要求します。

クライアントは、レコードと読み取りの位置の間で維持するために分離の量を判断、クライアントは、レコードの量、読み取り位置を後退させる必要がありますを決定する位置の変更を監視します。 Windows Server 2008 および以降のオペレーティング システムでは、クライアントの送信[ **KSPROPERTY\_オーディオ\_位置**](https://msdn.microsoft.com/library/windows/hardware/ff537297)または[ **KSPROPERTY\_RTAUDIO\_POSITIONREGISTER** ](https://msdn.microsoft.com/library/windows/hardware/ff537381)プロパティ要求レコードの位置を決定します。 後者の要求メソッドは、クライアントは、レコードの位置については、カーネル モードのルーチンへの移行せずに直接を読み取るために効率的です。

 

 




