---
title: クロックの同期
description: クロックの同期
ms.assetid: dc0071b0-a22c-4bb5-90ea-a69e5dcdba6f
keywords:
- シンセサイザー WDK オーディオ、時計の同期
- WDK のオーディオ、同期をクロックします。
- WDK オーディオ、時計の待機時間
- 時間の WDK オーディオ
- 参照クロック WDK オーディオ
- サンプルのクロックの WDK オーディオ
- wave シンク WDK オーディオ、時計の同期
- WDK のオーディオを時間をオフセットします。
- マスターのクロック WDK のオーディオ、同期
- ループのフェーズ ロック WDK オーディオ
- 同期の WDK オーディオ
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 6fdbc238053392478af94f198a3faa36d6162ea1
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56528764"
---
# <a name="clock-synchronization"></a>クロックの同期


## <span id="clock_synchronization"></span><span id="CLOCK_SYNCHRONIZATION"></span>


行う wave シンクの重要なタスクは、参照クロックとサンプル クロックの結晶間の時間のずれを解決するのにです。 これは、ソフトウェアと等価のフェーズがロックされているループの実行。

Wave シンクは、[次へ] への書き込みをバッファーには、どのようなサンプル数の追跡を保持します。 その場合でも、上にあることを知っていることなどサンプル 20、wave シンク必要がありますの参照の時刻を取得するマスターの時計を確認します。 20 ミリ秒ごとに約アクティブになり、現在の時刻のマスターのクロックを要求するスレッドがあります。 マスターのクロック可能性があります報告は、420 をたとえば現在の時刻 (ミリ秒単位)。

Wave シンクには、マスターのクロックに準じた現在時刻と、サンプリング時間の間のオフセットを示しています、待機時間の時計も保持されます。 この情報を使用して、予想されるマスター クロック時間を計算し、2 つのクロックを離れている超過したかどうかに表示する実際のマスター クロック読み取りを比較します。

Wave シンクでは、フェーズがロックされているループを使用して、サンプルの時間を調整します。 誤差を確認するときに 読み取り値には、いくつかのジッターが含まれているため、全体の量によって wave シンクは調整されません。 代わりに、未満であるマスター クロックに向かっての距離によってサンプル クロックを移動します。 これにより、波はほぼ同期させたまま中にジッター エラー平滑化をシンクします。この時間がかかるし、マスターのクロックに対して相対的な待機時間の時刻に変換します。 これは、機能は、アプリケーションは、任意の時点のシンセサイザーのレンダリング位置を知る必要がありますので重要です。

待機時間の時計は、アプリケーションを再生する新しいメモをスケジュールできる最も早い時刻を示します。 待機時間のクロック時間はマスターのクロック時間をシンセサイザーの待機時間を表すオフセットです。 この待機時間は、アプリケーションがシンセサイザーが実際にメモを再生する時間を再生する新しいメモを送信する時間から最小遅延時間を表します。 任意の時点で、アプリケーションはできますで再生または--より後がより--現在の待機時間のクロック時間をメモしてをスケジュールできます。

たとえば、時 420 に現在のマスターのクロックは、アプリケーションが、できるだけ早く遊ぶが、注意、待機時間の時計ように指示されますメモを再生可能な最も早い時刻。 シンセサイザーのソフトウェアに 100 ミリ秒の待機時間がある場合は、次回のメモを再生できるは、同時 520 されます。

参照時 520 を再生するイベントがマークされているとします。 シンセサイザー ノートの表示中にサンプルとサンプル時間でそのすべての計算を実行するでは。 そのために 520 の参照時ではこれをサンプル時間で変換を把握する必要があります。 ユーザー モードでは、wave シンクは、シンセサイザーで使用される 2 つの関数を提供します。

[**IDirectMusicSynthSink::SampleToRefTime**](https://msdn.microsoft.com/library/windows/hardware/ff536526)

[**IDirectMusicSynthSink::RefTimeToSample**](https://msdn.microsoft.com/library/windows/hardware/ff536525)

変換を実行する、ここで、シンセサイザー呼び出し**IDirectMusicSynthSink::RefTimeToSample** wave シンク上でします。

Wave シンクに戻るサンプル時間 (600 など)。 問題のメモは取得サンプル時間 600 にレンダリングされます。 その場合、シンセサイザー [ **IDirectMusicSynth::Render** ](https://msdn.microsoft.com/library/windows/hardware/ff536541)メソッドを取得します (たとえば、サンプル時間 600 ~ 800) からストリームの次の部分を表示するために、wave シンク、メモが表示されます、サンプル時 600 バッファー。

**注**  サンプル時間はロール オーバーを回避するために 64 ビットの数値として保持されます。 (DWORD 値をロール オーバーをします 27 時間。)

 

サンプル時間で、シンセサイザーはその内部の数値演算をまとめると、および wave シンクはサンプルの時刻の参照時刻から、またはその逆に変換します。 また、wave シンクは、マスターのクロックとの同期を管理し、待機時間情報を提供します。 Wave シンクでこの機能を非表示では、簡単シンセサイザーを記述します。

 

 




