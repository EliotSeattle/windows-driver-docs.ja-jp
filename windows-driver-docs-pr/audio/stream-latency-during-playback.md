---
title: 再生時のストリームの待機時間
description: 再生時のストリームの待機時間
ms.assetid: 70b41245-f463-4225-b79c-0ee65d8a0132
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: cde863bb7a035f4f5c4ec043dd09240f9e2bdf96
ms.sourcegitcommit: 0cc5051945559a242d941a6f2799d161d8eba2a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "63328628"
---
# <a name="stream-latency-during-playback"></a>再生時のストリームの待機時間


実行の状態では、オーディオ再生のストリームが、WaveRT ポート ドライバーのロールは最小限です。 次の図に示すように、再生中に WaveRT ポート ドライバーのクライアントのデータ書き込み循環バッファー、オーディオ デバイスは、バッファーからこのデータを読み取ります。 このアクティビティには、ポート、ドライバーの介入は不要です。 つまり、オーディオ データは、カーネル モード ソフトウェア コンポーネントで処理されることがなくユーザー モード アプリケーションとオーディオ ハードウェア間で直接フローします。

ダイアグラムで、書き込みとプレイの位置継続的に進行状況の左から右にオーディオ データ ストリームの通過循環バッファーとして。 バッファーは、再生位置または書き込み位置に自動的に、バッファーの先頭に戻って、バッファーの末尾に達するために、循環として記述されます。

再生中に、Stream の待機時間が a の次の図で指定されている 2 つの主要なソース。

![再生のストリームの待機時間を示す図](images/wavert-playback.png)

前の図で、*書き込み位置*は、クライアントが、バッファーに書き込まれた最後のサンプルの直後の場所です。 *再生位置*オーディオ デバイスは、現在のスピーカーから再生されているサンプルに示します。

オーディオ デバイスが再生されるまで、クライアントが、バッファーにオーディオのサンプルを書き込む時点から、待機時間は、書き込みとプレイの位置の間の分離だけです。 この分離は、次の 2 つのソースの待機時間の合計 (A としてマークされていると、図の B)。

**待機時間、**:ハードウェアの"最初に、最初の出力"にデータが存在するオーディオ デバイスは、バッファーからデータを読み取り後、まで、オーディオ デバイス アナログ デジタル コンバーター (DAC) を使用してデータのクロック (法 FIFO) のバッファー。

**待機時間 B**:クライアントは、循環バッファーにデータを書き込む後、データは、オーディオ デバイスは、データを読み取るまで、バッファーに存在します。

クライアントに制御する、ハードウェアに完全に依存する待機時間がありません。 一般的な FIFO の DAC サンプル クロックのティックを約 64 をフィードするための十分なサンプルを格納します。 ただし、クライアントはコントロール待機時間 B が大きすぎて b. 待機時間がシステムに不必要な遅延を導入するただし、そのにオーディオ デバイスを奪う小さすぎるのリスクを行います。

クライアントは、そのバッファー書き込みスレッドを定期的にアクティブ化するタイマーを設定できますが、このメソッドは、最小の待機時間を達成できません。 待機時間をさらに減らすためには、クライアントは、バッファーから再生データの新しいブロックの読み取りが完了するたびに、デバイスのハードウェア通知を生成するデバイスを構成できます。 この場合、タイマーによっての代わりにハードウェアの通知がクライアント スレッドをアクティブにします。

クライアント バッファーからのデータのブロックの読み込みが完了するたびに通知するオーディオ デバイスを持つクライアントことで、待機時間が実際よりも小さい。

クライアントに送信することによって、ストリームの待機時間に影響する遅延の概要を取得できる、 [ **KSPROPERTY\_RTAUDIO\_HWLATENCY** ](https://msdn.microsoft.com/library/windows/hardware/ff537378) WaveRT ポート ドライバーに要求します。

クライアントは、書き込みの間で維持し、位置を再生するために分離の量を決定後、クライアントは、書き込み位置を進めるまでにする方法を決定する再生位置の変更を監視します。 Windows Server 2008 および以降のオペレーティング システムでは、クライアントの送信[ **KSPROPERTY\_RTAUDIO\_POSITIONREGISTER** ](https://msdn.microsoft.com/library/windows/hardware/ff537381)再生位置を決定するプロパティの要求。 この機能のサポートは、PortCls システム ドライバーの機能強化によって提供されます。

オーディオ デバイス上の図で示すように登録された位置にある場合、プロパティの要求は、ユーザー モードのクライアントにアクセスできる仮想メモリ アドレスにレジスタをマップします。 位置、レジスタがマップされた後、クライアントは現在を決定するメモリ アドレスの内容の再生位置を読み取ることができます。

 

 




