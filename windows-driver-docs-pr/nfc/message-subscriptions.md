---
title: NFP メッセージのサブスクリプション
description: NFP メッセージのサブスクリプション
ms.assetid: ECE9C495-978F-4BD7-95BC-B68432F9B81E
keywords:
- NFC
- 通信の近く
- proximity
- フィールドの近接近く
- NFP
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: a9ae0834d88925b73d13a7da1a910c9573c071e4
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56560819"
---
# <a name="nfp-message-subscriptions"></a>NFP メッセージのサブスクリプション


サブスクリプションは、ドライバー内で一意のオープン ハンドルとして表されます。 サブスクリプションがアクティブになりますに識別するハンドルを開くことで、"Sub\\"デバイスの名前空間。 次のすべてのものにする、サブスクリプションの種類が定義されている、"Sub\\"プレフィックス。

メッセージの受信にコールバックを指定を通じて、完了した[ **IOCTL\_NFP\_取得\_次\_サブスクライブ済み\_メッセージ**](https://msdn.microsoft.com/library/windows/hardware/jj853319)します。

使用して、サブスクリプションを一時的に無効にできます、 [ **IOCTL\_NFP\_を無効にする**](https://msdn.microsoft.com/library/windows/hardware/jj853315)します。

サブスクリプションを使用して再度有効にすることができます、 [ **IOCTL\_NFP\_を有効にする**](https://msdn.microsoft.com/library/windows/hardware/jj853316)します。

## <a name="handles"></a>ハンドル数


メッセージの種類をサブスクライブする必要があるクライアントはまず、ドライバーへの新しいハンドルを開きます。 以前のパブリケーション、サブスクリプション、およびからのハンドルを再利用することはできません。 必要がなくなったらは、適切に動作するクライアントによって閉じられます。

ハンドルを開くときに、クライアントは、メッセージのサブスクリプションの種類を設定します。 発行を使用したのと同じメカニズムは、型プレフィックスが付きますが、これは"サブ\\"の代わりに"Pubs\\"。

型を読み取るための機能はありません。

### <a name="required-actions"></a>必要な操作

-   ドライバーは、プロトコルのコンポーネントを解析する必要があります (1 つ目の前に '.')。 状態が認識されない任意のプロトコルを完了する必要があります\_オブジェクト\_パス\_いない\_が見つかりました
-   ドライバーがステータスの IOCTL を完了する必要があります、文字列が NULL で終わるバッファーの長さでない場合、\_無効な\_パラメーター。
-   ドライバーがステータスの IOCTL を完了する必要があります、プロトコルがサブタイプを必要とし、文字列バッファーのサブタイプのコンポーネントが 1 未満です (1) 文字または 250 文字より長くする場合\_無効な\_パラメーター。
-   文字列バッファーのプロトコルのコンポーネントが 250 文字より長い場合は、ドライバーがステータスの IOCTL を完了する必要があります\_無効な\_パラメーター。
-   ドライバーは、文字列の末尾として最初に NULL を解釈する必要があります。
-   ドライバーは、サブスクリプションの"ペアリング: Bluetooth"型を認識できます。
-   ドライバーは、"WindowsUri"の種類を認識する必要があります。
-   ドライバーでは、サブスクリプションだけ"DeviceArrived"の種類を認識する必要があります。
-   ドライバーでは、サブスクリプションだけ"DeviceDeparted"の種類を認識する必要があります。
-   ドライバーでは、サブスクリプションだけ"WindowsMime"の種類を認識する必要があります。
-   ドライバーは"WindowsMime"を認識する必要があります。 入力します。
-   かどうかは、プロトコルは、サブスクリプションの場合のみ認識される必要があり、IOCTL を指定します"Pubs\\"、ドライバーは、IOCTL 状態を完了する必要があります\_オブジェクト\_パス\_いない\_が見つかりました。
-   かどうかは、プロトコルは、パブリケーションの場合のみ認識される必要があり、IOCTL を指定します"サブ\\"、ドライバーは、IOCTL 状態を完了する必要があります\_オブジェクト\_パス\_いない\_が見つかりました。
-   一部のプロトコル (名前空間) は予約されています。 このドキュメントで明示的に指定しない限り、MUST NOT ドライバーがで始まるすべてのプロトコルを認識します。
    -   "Windows"
    -   「デバイス」
    -   「ペアリング」
    -   "NDEF"
-   同じ型に 2 つの開いているハンドルは、2 つの個別のエンティティを表す必要があります。
-   場合*CreateFile*成功すると、ハンドルが他の種類のハンドルに「サブスクリプションのハンドル」とする必要がありますいないを変更するようになりました。
-   このサブスクリプションの種類に一致する近接テクノロジを使用してメッセージを受信するたびに、ハンドルが閉じられる前に、この IOCTL が成功すると、そのメッセージのデータは、クライアントに配信するため、ファイル ハンドルにアタッチする必要があります。

## <a name="unsubscribe"></a>サブスクリプションの解除します。


クライアントはメッセージの受信を停止するには、サブスクリプション ハンドルを閉じます。 クライアント プロセスが終了した場合、システムは、クライアントに代わってすべての開いているファイル ハンドルを閉じます。

### <a name="required-actions"></a>必要な操作

ハンドルが閉じられたときに、ドライバーは、サブスクリプションで使用されるすべてのメモリを解放する必要があります。

-   ドライバーは、型の文字列データを回収する必要があります。
-   受信したキューは削除され再利用する必要があります。
-   ステータスの IOCTL を完了する必要がありますすべて保留\_キャンセルします。

## <a name="malicious-peers"></a>悪意のあるピア


悪意のあるピア デバイスは、拒否の近接通信テクノロジを使用してサービス (DOS) 攻撃を試みると場合、は、クライアントが、ドライバーによって過剰なメモリの使用を防ぐために十分な速さ「受信」のキューをドレインするまでにできない可能性があります。

### <a name="required-actions"></a>必要な操作

ドライバーは、キューまたは 50 のメッセージが (最新のメッセージは破棄されます)、「受信」キューにいるときにそのメッセージを受信した場合、クライアントに特定のメッセージを配信する必要がありますできません。

## <a name="unresponsive-or-misbehaving-clients"></a>クライアントが応答していないか、不適切な動作


クライアントが、必要な送信に失敗したことで「受信」キューのドレインを停止する[ **IOCTL\_NFP\_取得\_次\_サブスクライブ済み\_メッセージ**](https://msdn.microsoft.com/library/windows/hardware/jj853319)間隔を 10 に 20 秒の要求\[10 ~ 20 秒\]ドライバーが、クライアントがなくなったことを想定してください。 通常の状況では、クライアントは、1 秒の範囲内での要求を更新する必要があります\[1 s\]します。 このような場合、ドライバーは"CompleteEventImmediately"カウンターを 0 に設定する必要があり、クライアントがウェイク アップし、必要な IRP を送信するまで、カウンターをインクリメントしない必要があります。

### <a name="required-actions"></a>必要な操作

ドライバーは、"CompleteEventImmediately"をカウンターを 0 に設定する必要があり、クライアントが、置換を送信していない場合は、カウンターをインクリメントする必要がありますいない[ **IOCTL\_NFP\_取得\_次\_サブスクライブ\_メッセージ**](https://msdn.microsoft.com/library/windows/hardware/jj853319)以前 IOCTL 完了の 10 ~ 20 秒以内です。

## <a name="malformed-messages"></a>メッセージの形式が正しくありません。


クライアントを削除するか、すべてのエラーを無視する可能性があります (状態を除く\_バッファー\_OVERFLOW) から返された[ **IOCTL\_NFP\_取得\_次\_サブスクライブ\_メッセージ**](https://msdn.microsoft.com/library/windows/hardware/jj853319)します。 そのため、ドライバーべきではないために、完了これらのエラー状態とだけで形式が正しくないメッセージを受信しました。

### <a name="required-actions"></a>必要な操作

-   MUST NOT ドライバーでは、クライアントに許可されているメッセージの最大サイズよりも大きいメッセージを配信します。
-   クライアントへのドライバーが提供、長さ 0 のメッセージ。
-   MUST NOT ドライバーでは、サブスクライバーに部分的なメッセージを配信します。
-   MUST NOT ドライバーでは、強力な CRC に失敗したクライアントにメッセージを配信します。

    **注**  NFP の NFC が有効なプロバイダーのこの NFC フォーラム証明を保証します。

     

-   ドライバーは、厳密に信頼性の高いトランスポートを使用や、強力な CRC に失敗したメッセージの再送を試行する必要があります。

    **注**  NFP の NFC が有効なプロバイダーのこの NFC フォーラム証明を保証します。

     

## <a name="duplicate-subscriptions"></a>サブスクリプションが重複しています


ドライバーでは、クライアントは、2 回のメッセージの種類をサブスクライブする場合がある、クライアントがメッセージを受信したときに 2 回にメッセージを受信するため、想定してください。

### <a name="required-actions"></a>必要な操作

ドライバーは、そのまま使用し、同じクライアントでサブスクライブしている場合でも、重複するサブスクリプションをレポートする必要があります。

 

 
## <a name="related-topics"></a>関連トピック
[NFC のデバイス ドライバー インターフェイス (DDI) の概要](https://msdn.microsoft.com/library/windows/hardware/mt715815)  
[フィールドの近接 DDI 参照の近く](https://msdn.microsoft.com/library/windows/hardware/jj866056)  

