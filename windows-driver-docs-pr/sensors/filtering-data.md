---
title: データのフィルター処理
description: データ スループットを最適化するためにセンサー デバイスは必要なときにのみ発生できるように、データ更新イベントをフィルター条件を適用する必要があります。
ms.assetid: 1895EC5C-08C1-4976-83F2-CD5A2B55338D
keywords:
- 感度を変更します。
- センサーの感度の変更
- CS
- 現在のレポート間隔
- センサーの現在のレポート期間
- CRI
- データ更新イベント
- センサーのイベント
- センサー イベント
- データのフィルター処理
- データのフィルター処理
ms.date: 07/20/2018
ms.localizationpriority: medium
ms.openlocfilehash: b96b1bbdda31d970127dc4ee1c1ddf763cba7a14
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56531390"
---
# <a name="filtering-data"></a>データのフィルター処理


データ スループットを最適化するためにセンサー デバイスは必要なときにのみ発生できるように、データ更新イベントをフィルター条件を適用する必要があります。 このフィルター処理の結果 (削減センサー スループット) のための下位の CPU 使用率と少ない電力消費 (センサーと CPU の両方)。

2 つの値 (またはプロパティ) があるセンサー デバイスのフィルター条件をサポートします。 現在のレポート期間 (CRI) 1 つ目は、2 番目の感度 (CS) の変更。 センサーのアプリケーションでは、これらのプロパティの両方を設定できます。

現在のレポート間隔は、最低限の期間、クライアントに意味のある変更が発生したときに表示されることを希望するデータ更新の間隔 (ミリ秒) です。 感度の変更は、意味のある変更を指定するために値 (またはパーセント) です。

そのため、気象観測計のアプリケーションは 60,000 の温度センサーの現在のレポート期間 (CRI) を指定できます (または 1 分)。 また、温度センサー (パーセント) ではなく変更秘密度値が必要になります。 たとえば場合この温度センサーは摂氏を返し、変更の秘密度値温度が 2.0、この特定のセンサーがのみイベントを発生させるデータ更新を増やすか、減少、2.0 摂氏経由で温度と、(この例では、1 分間) で要求されたレポートの間隔。

環境光センサー (ALS) は、割合として指定するには、変更の区別を必要とする、センサーの例を示します。 たとえば、ルクスの変更の秘密度値が 2.0 の場合は、このセンサーは割合として値を解釈し、LUX 値が削除された、または 2% ずつ増加するときに、データ更新イベントを発生させるだけです。

次の表に、6 つの一般的なセンサーごとに、関連付けられたデータと、対応する秘密度を変更します。

| センサー             | Datafield              | 感度値を変更します。           |
|--------------------|------------------------|------------------------------------|
| 光センサー       | LUX                    | lux で % の変更                    |
| Accelerometer      | X の高速化         | 高速化 g               |
|                    | Y の高速化         | 高速化 g               |
|                    | Z の高速化         | 高速化 g               |
| 3D ジャイロ メーター       | Angular 速度 X        | Angular の速度 (1 秒あたりの角度) |
|                    | Angular 速度 Y        | Angular の速度 (1 秒あたりの角度) |
|                    | Angular 速度 Z        | Angular の速度 (1 秒あたりの角度) |
| Compass            | 方位は磁北見出し | 度                            |
|                    | 北見出し true     | 度                            |
| Inclinometer       | Yaw                    | 度                            |
|                    | Pitch                  | 度                            |
|                    | Roll                   | 度                            |
| デバイスの向き | Quaternion             | 度の移動                   |
|                    | 回転行列        | 度の移動                   |

 

次の表は、現在レポート間隔 (CRI) の既定の推奨設定を一覧表示します。

| センサーの種類   | 推奨される既定のレポート期間 |
|---------------|-------------------------------------|
| アンビエント ライト | 5000                                |
| Accelerometer | 100                                 |
| Gyrometer     | 100                                 |
| Compass       | 100                                 |
| Inclinometer  | 50                                  |
| Orientation   | 50                                  |

 

次の表では、推奨される変更と小文字の区別 (CS) の既定値を示します。

|  センサーの種類  | 既定の感度の変更をお勧めします。 |
|---------------|----------------------------------------|
| アンビエント ライト | 50                                     |
| Accelerometer | 0.02                                   |
| Gyrometer     | 0.50                                   |
| Compass       | 0.20                                   |
| Inclinometer  | 0.50                                   |
| Orientation   | 0.50                                   |


## <a name="change-sensitivity-cs-for-the-inclinometer-and-orientation-sensors"></a>感度 (CS) を傾斜計センサーと方位センサーの変更します。


傾斜計と方向センサーの感度の変更は、2 つの四元数の間の角度として計算する必要があります。 数学的に、これで表されます。

2\*cos⁻¹ (ドット積 (q1、q2))

この計算は、tablet (またはデバイス) のさまざまな向きの間で一貫性を確保します。

## <a name="effective-current-report-interval-cri-and-change-sensitivity-cs"></a>現在のレポートの期間 (CRI) が有効なと感度 (CS) の変更


複数のアプリケーションには、現在のレポート間隔 (CRI) と特定のセンサーの変更と小文字の区別 (CS) のプロパティの両方を設定できます。 要求されたプロパティの適用を判断する、ドライバーの役目です。 ドライバーによって設定されるプロパティは、有効な現在のレポートの期間 (E CRI) と効果的な変更の区別 (E CS) と呼ばれます。

## <a name="setting-the-e-cri-and-e-cs-for-client-applications"></a>クライアント アプリケーション E CRI と E CS の設定


クライアント アプリケーションでは、センサーへの接続を確立するたびに、ドライバーは E CRI と E CS 値を設定する必要があります。 これらの値は、クライアントのコンテナーと呼ばれますが何に格納されます。 次の表は、センサー ドライバーでサポートされる 6 つのメソッドの一覧し、クライアントのコンテナーと E CRI と E CS プロパティには、ドライバーが行う必要がありますを指定します。

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td>関心のあるイベント</td>
<td>イベント ハンドラーのアクティビティ</td>
</tr>
<tr class="even">
<td>ISensorDriver::OnClientConnect</td>
<td><p>コンテナーのクライアントにクライアントの項目を追加します。</p>
<p>CRI と CS の値として適切な既定値の読み取りは、クライアントのコンテナーに保存</p></td>
</tr>
<tr class="odd">
<td>ISensorDriver::OnClientDisconnect</td>
<td><p>コンテナーのクライアントからクライアントを削除し、E CRI と設定 E CS に応じて残りのクライアントに基づく</p></td>
</tr>
<tr class="even">
<td>ISensorDriver::OnClientSubscribeToEvents</td>
<td><p>フィールドの「イベントにサブスクライブしている」– 更新 (true に設定)、センサーの問題。 イベントは、センサーから報告を有効にします。</p></td>
</tr>
<tr class="odd">
<td>ISensorDriver::OnClientUnSubscribeToEvents</td>
<td><p>更新プログラム「イベントにサブスクライブしている」フィールド – (false に設定)、センサーの問題です。 サブスクライバーが残っていない場合は、イベントは、デバイスから報告をオフにします。</p></td>
</tr>
<tr class="even">
<td>ISensorDriver::OnSetProperties</td>
<td><p>CS または CRI のプロパティが設定されている場合は、コンテナーのフィールドを適切なクライアントを更新します。</p></td>
</tr>
<tr class="odd">
<td>IFileCallbackCleanup::OnCleanupFile</td>
<td><p>クライアントがクラッシュまたは応答を停止します。 クライアントは、クライアントのコンテナーから削除する必要があります。</p></td>
</tr>
</tbody>
</table>

 

次の表では、4 つの接続のクライアント アプリケーションで 3 D 加速度計のクライアントのコンテナーを表します。 (2 番目と 4 番目の行に対応する) これらのクライアント アプリの 2 つは、イベントにサブスクライブしています。

| クライアントのファイル ハンドル | イベントにサブスクライブしています。 | CRI | CS (X) | CX (Y) | CS (Z) |
|--------------------|----------------------|-----|--------|--------|--------|
| FF80A267           | FALSE                | 50  | .001   | .001   | .001   |
| FF802489           | TRUE                 | 70  | .02    | .02    | .02    |
| FF80D345           | FALSE                | 15  | NULL   | NULL   | NULL   |
| FF803287           | TRUE                 | 100 | .005   | .005   | .005   |

 

ドライバーに接続されているクライアントのこのセットが評価された後、E CRI と E CS の次の値を選択しました。

-   E CRI:70ms
-   E CS 値: (最小しきい値を使用して 1 つの値に折りたたむでした)
    -   X:.005
    -   Y:.005
    -   Z:.005

これらのクライアントにイベントをフィルター処理は適用されませんので、イベント シンクがないクライアントが (最初と 3 番目の行) を設定しているこの例では無視されます。

## <a name="filtering-data-update-events-by-evaluating-the-effective-cri-and-cs-values-e-cri-e-cs"></a>有効な CRI と CS 値 (E の CRI を E CS) を評価することによってデータ更新イベントをフィルター処理


現在 E CRI と E CS 値が決定され、センサーの接続状態の変化に応じて更新されます、センサー、デバイスは接続されているクライアント アプリケーションに発生するイベントをフィルター処理するのにこれらの値を使用します。 これらの値は、「現在」のデータ値と前のデータ値の差と比較されます。 E CS 値を超えた、E CRI 以上の期間、およびその後、データ イベントを発生させる必要があります。 場合、 唯一の例外では、クライアントは、適切な通知を受信できるように、既定値が適用されるときに、センサー デバイスのスタートアップです。

次の図は、データ イベントが発生する時期を決定するために生のセンサー データのフィルター処理時間の評価方法を示しています。

![時間フィルターのセンサー データ](images/cri-cs.png)

前の図では、図の下の部分に赤のデータは、生のセンサー データを表します。 緑色の行 (この動作を実装するさまざまな方法の 1 つ) データと、"X"の値のポーリングを行うクライアントに返されるデータを表すデータ イベントが発生したときに表す。 青色の線は、(E CS データ イベントの最後の値を基準) +/-E CS 境界のしきい値です。

このイベントを実装することでフィルター処理のロジック、データの更新イベントは、非常に小さくことができます、数、およびアプリケーションできますも通知を受け取るセンサー データの意味のある変更が発生した場合。

## <a name="device-runtime-optimizations-for-data-filtering"></a>データのフィルター処理のランタイム最適化のデバイス


このセクションでは、センサー ドライバーを開発するときに考慮する必要があります、いくつかのランタイム最適化について説明します。

### <a name="support-interrupts"></a>割り込みをサポートします。

ドライバーは、割り込みの代わりに、デバイスのポーリングに依存しないでください。 パフォーマンスと電源管理の機能強化これが発生します。 これらの機能強化は、次に示します。

1.  デバイスは、現在の変更と小文字の区別とレポートの間隔に基づく低電力状態を入力できます。
2.  割り込みを使用して、センサーのファームウェアとドライバーの両方で不要なコードの実行が減少します。
3.  割り込みを使用すると、バスのアクティビティが減少します。

**注**  割り込み、ドライバーは、ドライバーで現在のレポート間隔、感度の変更のロジックが存在する場合は、ドライバーは非常に多くのデータの更新プログラムの間の割り込みを受け取る可能性のあります。 その結果、ドライバーは、現在のレポート間隔が経過するまで、割り込みを無効にする (またはマスク) 必要があります。

 

### <a name="move-change-sensitivity-support-to-the-device"></a>感度の変更のサポートをデバイスに移動します。

センサーのハードウェアまたはファームウェア、しきい値の検出をサポートしている場合は、感度の変更をサポートするためにこの機能を使用する必要があります。 デバイスに、サポートを移動し、対応する割り込みに応答し、処理は、ドライバーのオーバーヘッドを小さくします。

### <a name="move-report-interval-support-to-the-devices"></a>レポート間隔のサポートをデバイスに移動します。

センサーのハードウェアまたはファームウェアのレポート期間の概念をサポートしている場合は、この機能を使用する必要があります。

センサーがネイティブのレポート期間のサポートを提供していない場合は、現在のレポート間隔のサブセットの割り込みを無効にすることを検討します。 次に、この時間の経過後は、最新のデバイス データを取得します。

## <a name="related-topics"></a>関連トピック
[センサー地理位置情報ドライバー サンプル](https://docs.microsoft.com/windows-hardware/drivers/gnss/sensors-geolocation-driver-sample)



