---
title: データのフィルター処理
description: データのスループット、およびバッテリの寿命を最適化するためにセンサー デバイスは必要なときにのみ発生できるように、データ更新イベントにフィルター条件を適用する必要があります。
ms.assetid: EDABA09D-2C46-4546-9429-CF6DEFBF69C4
keywords:
- 感度を変更します。
- センサーの感度の変更
- しきい値
- センサーのしきい値
- CS
- 現在のレポート間隔
- センサーの現在のレポート期間
- CRI
- データ更新イベント
- センサーのイベント
- センサー イベント
- データのフィルター処理
- データのフィルター処理
ms.date: 07/20/2018
ms.localizationpriority: medium
ms.openlocfilehash: a691901336418a7cc14645cddbae7fc810df1832
ms.sourcegitcommit: 0cc5051945559a242d941a6f2799d161d8eba2a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "63362291"
---
# <a name="filtering-data"></a>データのフィルター処理


データ スループットを最適化するためにセンサー デバイスは必要なときにのみ発生できるように、データ更新イベントをフィルター条件を適用する必要があります。 このフィルター処理の結果 (削減センサー スループット) のための下位の CPU 使用率と少ない電力消費 (センサーと CPU の両方)。

2 つの値 (またはプロパティ) があるセンサー デバイスのフィルター条件をサポートします。 現在のレポート期間 (CRI) 1 つ目は、2 番目の感度の変更 (CS、しきい値とも呼ばれます)。 センサーの Win32 アプリケーションでは、これらのプロパティの両方を設定できます。

現在のレポート間隔は、最低限の期間、クライアントに意味のある変更が発生したときに表示されることを希望するデータ更新の間隔 (ミリ秒) です。 感度の変更は、意味のある変更を指定するために値 (またはパーセント) です。

そのため、気象観測計のアプリケーションは 60,000 の温度センサーの現在のレポート期間 (CRI) を指定できます (または 1 分)。 また、温度センサー (パーセント) ではなく変更秘密度値が必要になります。 たとえば場合この温度センサーは摂氏を返し、変更の秘密度値温度が 2.0、この特定のセンサーがのみイベントを発生させるデータ更新を増やすか、減少、2.0 摂氏経由で温度と、(この例では、1 分間) で要求されたレポートの間隔。

環境光センサー (ALS) は、割合として指定するには、変更の区別を必要とする、センサーの例を示します。 たとえば、ルクスの変更の秘密度値が 2.0 の場合は、このセンサーは割合として値を解釈し、LUX 値が削除された、または 2% ずつ増加するときに、データ更新イベントを発生させるだけです。

## <a name="terminologies-related-to-filtering-criteria"></a>フィルター条件に関連する用語

| 用語 | 説明 |
|------|---------|
| 現在のレポート期間 (CRI) | 意味のある大きさの変化が発生しているときにクライアントがデータを受信する希望をミリ秒単位で期間 (頻度ではありません) が更新プログラムとして表されるレートです。<br><br>このフィールドは、(センサーの測定現象) で意味のある変更が発生した場合、イベント間の最低限の期間として表されます。 期間は異なりますが、これよりも短いにならない意味のある変更の発生に基づいて。<br><br>この値は、センサーごとです。|
| 感度 (CS) の変更 | 意味のある変更を測定の現象の変化です。 これは、線形の大きさ (たとえば、加速度計、読み取り用.05 G)、または、非線形の大きさ (5% は、環境光センサーの読み取り用) として表現できます。<br><br>この値は、1 つのセンサー データ フィールドです。|
| 有効な現在のレポート期間 (CRI E) | RI の値は、時間で特定の時点計算され、デバイス ドライバーによってデータ更新イベントの配信に基づくフィルターをかけるため。<ul><li>(ある場合) に、RI の値がクライアントによって設定します。</li><li>(既定の動作としてはドライバーによって実装される) とデバイスの既定の RI</li><li>要求された参照整合性を尊重するハードウェアの機能</li></ul><br>この値は、センサーごとです。|
| 有効な変更と小文字の区別 (CS E) | CS 値では、時間で特定の時点の計算し、デバイス ドライバーによってデータ更新イベントの配信に基づくフィルターをかけるため。<ul><li>(ある場合) に、CS 値がクライアントによって設定します。</li><li>(既定の動作としてはドライバーによって実装される) とデバイスの既定の CS</li><li>要求された CS を尊重するハードウェアの機能</li></ul><br>この値は、1 つのセンサー データ フィールドです。|

## <a name="change-sensitivity"></a>感度を変更します。
可能な限りの完全な一覧については、各センサーの秘密度値を変更する、[センサーしきい値](sensor-thresholds-v2.md)このドキュメントの「します。

## <a name="current-report-interval-recommended-defaults"></a>現在のレポート間隔の既定値をお勧めします。
次の表は、現在レポート間隔 (CRI) の既定の推奨設定を一覧表示します。

| センサーの種類               | 推奨される既定のレポート期間  |
|---------------------------|--------------------------------------|
| Accelerometer             | 100                                  |
| アクティビティの検出        | 5000                                 |
| 環境光センサー      | 1000                                 |
| 気圧計                 | 1000                                 |
| カスタム センサー             | なし                                  |
| 地磁気の方向   | 100                                  |
| 重力ベクター            | 100                                  |
| Gyrometer                 | 100                                  |
| 線形の加速度計      | 100                                  |
| 磁力計              | 100                                  |
| 方向               | 50                                   |
| 万歩計                 | 1000                                 |
| 近接通信                 | 100*                                 |
| 相対的な方向      | 100                                  |
| 単純なデバイスの向き | 200*                                 |

(*)近接センサーと方位センサーのシンプルなデバイスは、定期的にサンプルの測定値を報告する必要があります。 代わりに、読み取りが変更されたときに、これらのセンサーはデータをクラスの拡張に報告する必要があります。 これらのセンサーのレポート間隔の値では、センサーまで、サンプルの読み取りをレポートにかかる時間の最大量を表します。

## <a name="change-sensitivity-recommended-defaults"></a>既定値として推奨感度の変更
次の表では、推奨される変更と小文字の区別 (CS) の既定値を示します。

|  センサーの種類              | 既定の感度の変更をお勧めします。 |
|---------------------------|----------------------------------------|
| Accelerometer             | 0.02 G                                 |
| アクティビティの検出        | 0 (アクティビティがサブスクライブしている)             |
| 環境光センサー      | 25 %lux 変更                         |
| 気圧計                 | 0.001 バー                              |
| カスタム センサー             | なし                                    |
| 地磁気の方向   | 10.0 度                           |
| 重力ベクター            | 10.0 度                           |
| Gyrometer                 | 1 秒あたりの 0.50 度                |
| 線形の加速度計      | 0.02 G                                 |
| 磁力計              | 5.0 microtesla                         |
| 方向               | 10.0 度                           |
| 万歩計                 | 10000 手順                            |
| 近接通信                 | 近接の変更                    |
| 相対的な方向      | 10.0 度                           |
| 単純なデバイスの向き | 印刷の向きの変更                  |

## <a name="effective-current-report-interval-cri-and-change-sensitivity-cs"></a>現在のレポートの期間 (CRI) が有効なと感度 (CS) の変更

複数のアプリケーションには、現在のレポート間隔 (CRI) と特定のセンサーの変更と小文字の区別 (CS) のプロパティの両方を設定できます。 アプリケーションの構成 (2 つのアプリケーションの秘密度値を別の変更または別のレポート間隔を要求する) などの競合する場合は、ドライバーに送信する最も重要な CS および CRI センサー クラスの拡張機能を決定します。 センサー クラスの拡張機能に、ドライバーは、CS および CRI の値は、有効な現在のレポートの期間 (E CRI) と効果的な変更の区別 (E CS) と呼ばれます。

開始/停止、センサー、レポート、サンプルの読み取りまたは E CRI と E CS 設定センサー クラスの拡張機能によっては、次の関数が呼び出されます。

| 関心のあるイベント          | イベント ハンドラーのアクティビティ                                           |
|----------------------------|--------------------------------------------------------------------|
| EvtSensorStart             | センサーを開始します。                                                  |
| EvtSensorStop              | センサーを停止します。                                                   |
| EvtSensorSetDataInterval   | 現在のレポート間隔を設定します。                                    |
| EvtSensorGetDataInterval   | 現在のレポート間隔を取得します。                                    |
| EvtSensorSetDataThresholds | 現在の変更 (しきい値) と小文字の区別の値を設定します。              |
| EvtSensorGetDataThresholds | 現在の変更 (しきい値) と小文字の区別の値を取得します。              |
| SensorsCxSensorDataReady   | ドライバーの報告、センサー クラスの拡張を読み取るサンプル |

## <a name="filtering-data-update-events-by-evaluating-the-effective-cri-and-cs-values-e-cri-e-cs"></a>有効な CRI と CS 値 (E の CRI を E CS) を評価することによってデータ更新イベントをフィルター処理

現在 E CRI と E CS 値を設定すると、センサー、デバイスは接続されているクライアント アプリケーションに発生するイベントをフィルター処理するのにこれらの値を使用します。 これらの値は、「現在」のデータ値と前のデータ値の差と比較されます。 E CS 値を超えた、E CRI 以上の期間、およびその後、データ イベントを発生させる必要があります。 場合、 唯一の例外は、このドキュメントの以降のセクションで説明されている読み取り初期サンプルです。

発生するイベントのフィルター条件として、現在の E CRI と E CS の現在の値を使用してイベントをフィルター処理するための基本的な原則があります。 これらのフィルター値は、SensorsCxSensorDataReady を呼び出すことによってイベントが発生する時期を決定するために、現在のデータ値と前のデータ値の違いと比較されます。 強さのしきい値 (E CS) がある場合は、発生し、その後にデータ イベントが必要があります (E の CRI) は、時間のしきい値以上の期間を超えています。 クライアントは、適切な通知を受信できるように、初期値を取得されているときに、ドライバーの起動時にデータ イベントを発生させることをお勧めします。 さらにこの実装する必要がありますがウェイク アップしない CPU の電源を節約するために、要求されたレポートの間隔よりもより多くの場合、します。

次の図は、データ イベントが発生する時期を決定するために生のセンサー データのフィルター処理時間の評価方法を示しています。

![時間フィルターのセンサー データ](images/cri-cs.png)

前の図では、図の下の部分に赤のデータは、生のセンサー データを表します。 (この動作を実装するさまざまな方法の 1 つ) のデータのポーリングを行うクライアントに返されるデータを表す緑色の線と"<font color="red">__X__</font>"値を表すデータ イベントが発生したときにします。 青色の線は、(E CS データ イベントの最後の値を基準) +/-E CS 境界のしきい値です。

このイベントを実装することでフィルター処理のロジック、データの更新イベントは、非常に小さくことができます、数、およびアプリケーションできますも通知を受け取るセンサー データの意味のある変更が発生した場合。

## <a name="streaming"></a>Streaming

ストリーミングは、一定の間隔でレポート サンプルの測定値をセンサー ドライバーを許可するモードです。 このモードは、データの一定のフローを受信するアプリケーションで使用可能性があります。

### <a name="general-case"></a>一般的なケース

を除き、下記のセンサーのセンサーには、クラス拡張は 0 に、すべてのセンサーに CS 値を設定する場合は、すべて E CRI に読み取る 1 つのサンプルを報告する必要があります。

### <a name="exceptions"></a>例外

* PKEY_SensorData_SubscribedActivityStates が 0 に設定されている場合、アクティビティの検出のセンサーは任意のアクティビティの変更を報告しなければなりません。 代わりに、センサー クラスの拡張機能は PKEY_SensorData_ActivityStream を TRUE に設定をストリームにセンサーを必要とする場合。
* 近接センサーおよび単純なデバイスの向きにストリーミングをサポートする必要がありますされません。
* 近接センサーは読み取り近接検出の状態が変更されたときサンプルのみを報告する必要があります (間に検出され、認識されないまたはその逆) を除き、留意する必要がある最初のサンプルの読み取り。
* シンプルなデバイス方位センサーには、読み取り、デバイスの向きに留意する必要がある初期サンプル読み取り以外の作業領域が変更されたときサンプルのみを報告する必要があります。

## <a name="initial-sample-reading"></a>最初のサンプルの読み取り

センサー ドライバーが EvtSensorStart を呼び出すことによって開始されると、ドライバーは、センサー ハードウェアが有効なデータを送信する準備がすぐ SensorsCxSensorDataReady を呼び出すことによって、1 つのセンサー サンプルを報告する必要があります。 読み取り中の最初のサンプルでは、レポート期間に関係なく、クラスの拡張機能に送信する必要があります。 またはの秘密度設定を変更します。 アプリケーションでは、比較を読み取るサンプルの基礎として初期のサンプルを使用します。
このルールは、すべてのセンサーに適用されます。


## <a name="device-runtime-optimizations-for-data-filtering"></a>データのフィルター処理のランタイム最適化のデバイス

このセクションでは、センサー ドライバーを開発するときに考慮する必要があります、いくつかのランタイム最適化について説明します。

### <a name="support-interrupts"></a>割り込みをサポートします。

ドライバーは、割り込みの代わりに、デバイスのポーリングに依存しないでください。 パフォーマンスと電源管理の機能強化これが発生します。 これらの機能強化は、次に示します。

1.  デバイスは、現在の変更と小文字の区別とレポートの間隔に基づく低電力状態を入力できます。
2.  割り込みを使用して、センサーのファームウェアとドライバーの両方で不要なコードの実行が減少します。
3.  割り込みを使用すると、バスのアクティビティが減少します。

**注意**:ドライバーは、割り込みが現在のレポート間隔、感度の変更のロジックが、ドライバーが存在する場合は、ドライバーは非常に多くのデータの更新プログラムの間の割り込みを受け取る可能性のあります。 その結果、ドライバーは、現在のレポート間隔が経過するまで、割り込みを無効にする (またはマスク) 必要があります。


### <a name="move-change-sensitivity-support-to-the-device"></a>感度の変更のサポートをデバイスに移動します。

センサーのハードウェアまたはファームウェア、しきい値の検出をサポートしている場合は、感度の変更をサポートするためにこの機能を使用する必要があります。 デバイスに、サポートを移動し、対応する割り込みに応答し、処理は、ドライバーのオーバーヘッドを小さくします。

### <a name="move-report-interval-support-to-the-devices"></a>レポート間隔のサポートをデバイスに移動します。

センサーのハードウェアまたはファームウェアのレポート期間の概念をサポートしている場合は、この機能を使用する必要があります。

センサーがネイティブのレポート期間のサポートを提供していない場合は、現在のレポート間隔のサブセットの割り込みを無効にすることを検討します。 次に、この時間の経過後は、最新のデバイス データを取得します。

## <a name="related-topics"></a>関連トピック
[センサー地理位置情報ドライバー サンプル](https://docs.microsoft.com/windows-hardware/drivers/gnss/sensors-geolocation-driver-sample)

