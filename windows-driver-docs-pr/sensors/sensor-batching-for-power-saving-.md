---
title: 節電のためのセンサー データの一括処理
description: このトピックでは、センサー クラスの拡張機能と Windows 10 でセンサー データをバッチ処理を実装するために、センサー ドライバーの間に必要なインターフェイスについて説明します。
ms.assetid: E64B9CE0-2C76-430A-ABE0-717BD27BCA8A
ms.date: 07/20/2018
ms.localizationpriority: medium
ms.openlocfilehash: 6887e6081d6b29aed699cbf033ded20cc6a10620
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56578917"
---
# <a name="sensor-data-batching-for-power-savings"></a>節電のためのセンサー データの一括処理


このトピックでは、センサー クラスの拡張機能と Windows 10 でセンサー データをバッチ処理を実装するために、センサー ドライバーの間に必要なインターフェイスについて説明します。

## <a name="introduction"></a>概要


データのバッチ処理を実装するセンサー ドライバーでは、プロセッサを受信してセンサー データを頻繁に処理するために、電源を保存するアプリケーションのプロセッサが使用できます。 センサー ドライバーここでは、センサー データのバッファーのセンサー ハードウェアのサンプルし、転送にまとめてバッチでセンサー クラスの拡張機能にします。 バッチ処理をサポートするために UMDF 2.0 ユニバーサル センサー ドライバー、必要なインターフェイスを実装するを提供する必要があります。

**バッチの待機時間**

バッチの待機時間は、最大のセンサーを入れることができます、データ サンプル センサー クラスの拡張機能に配信する前に、収集された時間数として定義されます。 「スケジュール」バッチ処理、センサー データがセンサー イベントは、次の図に示すようにバッチの待機時間の値に基づいて、ドライバーによって配信されるとき開始されます。

![コレクションの表示と通常のデータの配信を使用して、n データ サンプルのシーケンスを送信する図します。](images/data-batching1.png)

データのバッチ処理を実装していないドライバーの場合、ドライバーは単に収集し、センサー データを送信できるようします。 たとえば、n 個のデータ サンプルを送信する、ドライバーをコレクションと、データのサンプルの送信開始が N 時間します。

![コレクションを表示して、送信バッチ処理されたデータの配信で 2 つのバッチを使用して、n データ サンプルのシーケンス図します。](images/data-batching2.png)

データのバッチ処理、データ収集および配信を実装するドライバーの場合シーケンスで行われますバッチ、直前の図のようにします。 バッチの待機時間の値は、センサー クラスの拡張機能によって指定されます。 したがってセンサー ハードウェアを収集し、n 個のデータ サンプルを転送する場合、たとえば、センサー ドライバーでしたプロセスに分割 2 つのバッチ。 最初の n 個のデータ サンプルの半分がバッチの待機時間に相当する時間間隔後に送信されます。 もう 1 つのバッチの待機時間時間間隔後に、2 つ目のデータ サンプルの半分が送信されますが N の転送を通常の配信メソッドで必要とする比較は合計 2 つの転送の。

## <a name="sensor-properties"></a>センサーのプロパティ


だけでなく、必要な一般的なセンサー プロパティと列挙型のプロパティ、データのバッチ処理をサポートするドライバーは、次のプロパティも報告する必要があります。

-   鍵\_センサー\_FifoReservedSize\_サンプル

-   鍵\_センサー\_FifoMaxSize\_サンプル

-   鍵\_センサー\_WakeCapable

詳細については、[センサーの共通プロパティ](common-sensor-properties.md)と[列挙プロパティ](enumeration-properties.md)を参照してください。

センサー ハードウェアのサブシステムがスリープ解除できる場合には、開始されるスリープ解除を早いバッファー オーバーランを回避するを確認、必要があります。

## <a name="optional-ddsi-functions-for-data-batching"></a>データのバッチ処理オプションの DDSI 関数


デバイス ドライバー ソフトウェア インターフェイス (DDSI) 関数は、ドライバーとクラスの拡張機能間のインターフェイスです。 データのバッチ処理をサポートするには、センサー クラスの拡張機能は、バッチの待機時間を設定できるように、ドライバーは次の DDSI 関数を実装する必要があります。

-   [EvtSensorSetBatchLatency](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/sensorscx/ns-sensorscx-_sensor_controller_config)これは、指定したセンサーのバッチの待機時間を設定するコールバック関数。 ドライバーに等しいまたはそれよりも小さい値をバッチの待機時間を設定する必要があります、 *BatchLatencyMs*バッファーの可用性に応じて、パラメーター。

ドライバーでは、必要なすべての DDSI 関数も実装する必要があります。 詳細については、[センサー DDSI 関数](sensor-ddsi-functions.md)を参照してください。

このコマンドは、バッチの待機時間を指定するセンサー クラスの拡張機能を省略できます。 すべてのセンサーの既定のバッチの待機時間は、サンプルがないバッチ処理はことを示すために使用されるゼロ (0) です。 センサーのサンプルは、クラスの拡張機能を呼び出す場合にのみ、バッチで配信される**EvtSensorSetBatchLatency**バッチ待機時間の値を設定します。 それ以外の場合、サンプルを正常に配信データの定期的な間隔のレートでされます。

センサー クラスの拡張機能を呼び出すことができます**EvtSensorSetBatchLatency**をいつでもバッチ待機時間の値を変更します。 具体的には、指定のセンサーが既にアクティブに実行すると、このイベントの損失は表示されません中には、この関数を呼び出すことができます。 収集し、すぐに (ベスト エフォート基準で) を最新バッチのサンプルの配信を開始するには、センサー ドライバーが必要です。 ドライバーでは、クラスの拡張機能によって指定されたバッチの待機時間を超えることはできません。

暗黙でセンサー データの配信方法とイベント データのバッチ処理による変更がないことに注意してください。 バッチの待機時間が経過すると、ドライバーは、一度に 1 つすべてバッファー内のデータのサンプルを配信するには、繰り返し SensorsCxSensorDataReady を呼び出します。 データ サンプルのタイムスタンプが付いて (関連付けられているその鍵に含まれている\_SensorData\_タイムスタンプ データ フィールド) サンプリングされた各が撮影されたときを示します。 鍵の詳細については\_SensorData\_タイムスタンプを参照してください[一般的なデータ フィールド](common-data-fields.md)します。

## <a name="batch-latency-and-data-rate-relationship"></a>バッチの待機時間とデータ リレーションシップを評価します。


バッチの待機時間とデータ速度として、次のように関連します。

![バッチの待機時間値はミリ秒単位の式。](images/batch-formula.png)

場所*SensorBatching\_MaxSize\_バイト*バッチ化されたセンサー データのバッファーの最大サイズです。 センサーが加速度計の場合は、お 250 個以上のサンプルを保持するために十分な大きさであるハードウェア バッファーを勧めします。 データ速度はミリ秒単位で表され、データ サンプルを 1 つの転送にかかる時間の長さは。 バッチにセンサー ハードウェアを格納する必要がありますサンプルの数は、データ レートに反比例します。 データ速度が小さいほど、特定のバッチの待機時間の値をバッチ処理のサンプルを格納するために必要なサイズが大きく、サンプル バッファー。 上記の式ではバッチの待機時間で表される*BatchLatencyMs*によって表されるデータ レートと*DataRateMs*します。 場合の組み合わせ*BatchLatencyMs*と*DataRateMs*バッファー サイズを超える*SensorBatching\_MaxSize\_バイト*、し**EvtSensorSetBatchLatency**と[EvtSensorSetDataInterval](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/sensorscx/ns-sensorscx-_sensor_controller_config)バッチ待機時間を前の式によって表示される値に設定されます。

呼び出し元が指定されている場合、 *BatchLatencyMs*値より小さい*DataRateMs*データはバッファリングせずに送信し、します。

## <a name="batching-with-data-thresholds"></a>データのしきい値をバッチ処理


データのバッチ処理を実装するセンサー ドライバーを使用して[EvtSensorSetDataThresholds](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/sensorscx/ns-sensorscx-_sensor_controller_config)ゼロ以外のデータしきい値を設定します。 この場合は、現在の測定値と最後の測定値の間のデータ値の差を使用して設定されたデータしきい値を超える場合**EvtSensorSetDataThresholds**、し、データのコレクション、バッチ処理および配信の処理呼び出されます。 データのしきい値と共にバッチ処理データを使用すると、さらに多くの電力を節約するセンサー ドライバーができます。

データのバッチ処理、と共に、センサー クラス拡張機能によってゼロ以外のデータのしきい値が設定されている場合、正確なタイムスタンプの付いたバッチ化されたサンプルを提供し、データのしきい値を優先するドライバーが必要です。 センサー ハードウェア自体がデータのしきい値を適用しながらの正確なタイムスタンプを保持するための対応がない場合は、データのしきい値を強制することがなくサンプルを収集できます。 ただし、このような場合はサンプル センサー クラスの拡張機能に配布する前に、現在のデータのしきい値設定を満たしていないドライバーがフィルター処理する必要があります。

## <a name="sequence-diagram-examples"></a>シーケンス図の例


次で説明した DDSI 関数をバッチ処理オプションのデータの使用状況を示すシーケンス図に示します[データ用の省略可能な DDSI 関数バッチ処理](#optional-ddsi-functions-for-data-batching)します。 必要に応じて、パートナーからのフィードバックに基づいてシナリオを明確にする多くのシーケンス図を追加することがあります。

**シナリオ 1**

このシナリオでは、センサー クラスの拡張機能は、センサーを開始する前にバッチの待機時間とデータの間隔を設定します。 1 回、センサーが開始提供バッチ定期的に、セットのプロパティを考慮しながらします。

![シーケンス図がシナリオを示すセンサーを開始する前に、クラスの拡張がバッチの待ち時間とデータの間隔を設定します。](images/batch-scenario1.png)

**シナリオ 2**

このシナリオでは、センサー クラスの拡張機能は、センサーを開始する前に、バッチの待機時間、データの間隔、およびデータのしきい値を設定します。 1 回、センサーが開始提供バッチ定期的に、セットのプロパティを考慮しながらします。 満たす、指定されたバッチの待機時間以内に送信する必要があるデータしきい値の値、サンプルがある場合を除きでバッチする必要があります、ドライバーによって配信することに注意してください。

![シナリオ、センサーを開始する前に、クラスの拡張機能が、バッチの待機時間、データの間隔、およびデータのしきい値を設定する場所を示すシーケンス図。](images/batch-scenario2.png)

**シナリオ 3**

このシナリオでは、センサー クラスの拡張機能は、センサーを開始する前に、バッチの待機時間とデータの間隔を設定します。 1 回、センサーが開始提供バッチ定期的に、プロパティの設定を考慮しながらします。 センサー クラスの拡張機能は、センサーを実行すると、実行中にサンプル データを失うことがなく、新しい値に従ってサンプルを提供するドライバーがすぐに開始中に、待ち時間とデータのバッチの間隔を変更します。

![シナリオ、センサーを開始する前に、クラスの拡張機能がバッチの待機時間、データの間隔を設定する場所を示すシーケンス図。 図では、データ転送の中に、設定の変更に応答する、センサーの継続も示しています。](images/batch-scenario3.png)

## <a name="data-batching-hardware-configurations"></a>データのバッチ処理のハードウェア構成


センサー ハードウェア、アプリケーションのプロセッサの関与なしでは、センサー データをバッチ処理する必要があります。 プロセッサの電源を節約するために、データのバッチ処理されているときにスリープ状態を行うことができます。 次の図は、可能なセンサー ハードウェア ベースのデータのバッチ処理の構成を示します。

-   **構成 1**:FIFO バッファーは、アプリケーションのプロセッサに直接接続されたセンサーのコンポーネントに実装されます。

-   **構成 2**:FIFO バッファーは、センサー コンポーネントが接続されている、低電力センサー ハードウェア core に実装されます。 この場合は、FIFO バッファーを複数のセンサー間で共有またはものセンサーの中核となる設計によって、センサー以外のコンポーネントと共有する可能性があります。 低電力センサーのコアがさらに、アプリケーションのプロセッサに接続されているし、SoC. に統合することがあります。 または、外部コンポーネントがある可能性があります。

-   **構成 3**:FIFO バッファーは、センサー コンポーネントに実装されます。 センサー コンポーネントは、アプリケーションのプロセッサに接続されている低電力センサーのコアに接続されます。 センサー コンポーネントは、SoC に統合することがあります。 または外部コンポーネントがある可能性があります。

-   **構成 4**:FIFO バッファーは、低電力センサーのコアとセンサーのコンポーネントに実装されます。 センサー コンポーネントは、さらに、アプリケーションのプロセッサに接続されている低電力センサーのコアに接続されます。 センサー コンポーネントは、SoC に統合することがあります。 または外部コンポーネントがある可能性があります。 簡易すぎるの FIFO を拡張するセンサー core を使用できることに注目に値します。

注意するべき重要な点は、FIFO センサーの中核となるハードウェアやセンサー ハードウェア、または両方で実装できることです。 ドライバーは、これをオペレーティング システムの抽象化し、DDSI 経由で統一インターフェイスを表示します。

次の図は、上記で説明されているさまざまな構成を示しています。

![バッチ化されたセンサー データをホストしている可能性のあるハードウェアの構成を示す図。](images/sensor-batch-hw.png)

**ハードウェアでのバッファーがいっぱいの動作**

通常の状況をすべての時間間隔を少なくとも 1 回、ハードウェアのバッファーを読み取ることは想定されて、ドライバーで等しい*BatchLatencyMs*なしのデータを削除するか失われることを確認するためです。 ハードウェアの FIFO バッファーがいっぱいになるとと、は、ラップがされ、古いイベントを上書きする循環バッファーと同様に動作する必要があります。

 

 




