---
title: ポーリングのコールバック
description: ポーリングのコールバック
ms.assetid: d86ed391-19c6-47e4-83df-cc2f2298846a
keywords:
- WDK ジョイスティックのポーリング
- WDK ジョイスティックのコールバック
- WDK の HID ジョイスティック、ポーリング
- WDK の HID 仮想ジョイスティック、ポーリング
- VJoyD WDK を非表示にポーリング
- ジョイスティックに WDK を非表示に位置
- WDK ジョイスティックの場所
- WDK ジョイスティックの位置
ms.localizationpriority: medium
ms.date: 10/17/2018
ms.openlocfilehash: eac6e5d7bfbb830358c84d970e7f684280db3bd9
ms.sourcegitcommit: 0cc5051945559a242d941a6f2799d161d8eba2a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "63365436"
---
# <a name="polling-callback"></a>ポーリングのコールバック





```cpp
int stdcall PollRoutine( int type, LPJOYOEMPOLLDATA pojd );
```

ポーリング ルーチンは、いずれかのダイレクトに応答する joyGetPos を呼び出すアプリケーションまたは joyGetPosEx、呼び出されます。 または joySetCapture が呼び出されて Windows 95/98/Me 定期的に呼び出すと joyGetPos アプリケーションです。 だけ、ミニドライバーは、最初のポーリング、コールバックの呼び出しを受信すると、特定のアプリケーションがそこからデータを必要とします。 16 の使用可能なジョイスティックの一覧にあるすべてのデバイスに対して、その他のすべてのコールバックが呼び出される任意のアプリケーションがデータを要求するかどうか。

戻り値は喜び\_OEMPOLLRC\_YOUPOLL、喜び\_OEMPOLLRC\_喜び、および失敗、および\_OEMPOLLRC\_ok をクリックします。 か JOYERR へボタン専用のポーリングを除く、戻り値の解釈\_NOERROR または JOYERR\_をアプリケーションに返される前に電源が入っていません。 ボタンのポーリングは常に成功すると見なされます。

JOY\_OEMPOLLRC\_FAIL が返されるは、ポーリングは、デバイスが応答しない場合、または VJoyD、ミニドライバーは処理できないポーリングを要求する場合。 前者の場合、アプリケーションのすべてを停止して、ユーザーがデバイスへの接続をチェックするよう要求する可能性が高いため実際に失敗した場合を除き、デバイスで失敗しないことを確認してください。 たとえば、最初のポーリングが失敗した場合、joySetCapture への呼び出しが失敗します。 マイナー デバイスの障害の原因になりませんエラー報告されるまで、ユーザーの介入が必要です。 または、デバイスが回復不能なエラーが検出されました。 たとえば、パケット ベースのプロトコルを使用して通信するデバイスは、1 つのパケットが有効でない場合、ポーリングが失敗する前に、再試行を試みる必要があります。

正規のデバイスの障害を認識し、エラーが返されます。 最終的にすることが重要それ以外の場合、アプリケーションでは、ユーザーの介入はまったく必要なかどうかを判断できません。 エラーからの回復が実行される、返されるデータの意味、許可、投票の数または最初のエラーからの許容時間を制限する必要が中にデータの古いまたは false が返された場合そのため、ドライバーは遅延しない時間の時間を要するの。 制御しないデバイスでのポーリングを実行するか、ポーリングの種類またはサブタイプにサービスを提供できませんを実行する、ミニドライバーが要求されると、エラーは常に適切な応答です。

喜びを使用する\_OEMPOLLRC\_YOUPOLL 場合は、標準のアナログのポーリングは、正しい結果を生成します。

喜びを返す必要があります\_OEMPOLLRC\_JOYINFOEX 構造は、要求されたデータでいっぱいになる通常のケースで [ok] です。

ポーリングを使用して、デバイスの初期化を実行する場合を処理する必要があります。 アプリケーションでは、リターン コードをチェックして、デバイスの可用性をチェックする初期のポーリングを実行できます。 エラー チェックなしでの後続のポーリングを行んだことができます。 これは、どのような joySetCapture は本質的に。 理想的には、すべての初期化と最初のポーリングを実行する必要があります。 ような場合は最大で 2 つ目のデバイスの継続を設定する必要な時間、デバイスが表示され、機能であることを確認し、最初のポーリングの模擬データを返すだけで十分です。

API とシステムのドライバーでは、アプリケーションによって行われた要求の検証を実行し、必要なデータを完了すると、アプリケーションの構造にコピーします。 ミニドライバーは、この機能をレプリケートする必要があります。 ただし、1 つのプロセスは、ポーリングの途中で引き続きもう 1 つは、デバイスのポーリングから何もなりません。 このイベントの結果は 2 つの軸をレポートの異なるサンプルほど悪くないです。 必要に応じて、ミニドライバーは、独自のプロセスの同期を実行できます。

戻り値に依存"type"パラメーターと、デバイスがサポートします。 常に、ボタンとボタンの数を返す必要があります。 ハット スイッチ ポーリングが必要である、ミニドライバーを指定する方法がないために、軸はすべてが要求される場合、この値を返す必要があります。 ハット スイッチの設定\_デバイスが 1 つをサポートしない場合は未定義です。 返される値の 1 つの軸のポーリング、 **dwX** JOYPOLLDATA 構造体のメンバー (、 [ **VJPOLLDATA** ](https://msdn.microsoft.com/library/windows/hardware/ff543573)構造 DirectX 5.0 以降)。 軸の数の要求が奇数で要求の複数の軸、**は\_他**のメンバー、 [ **JOYOEMPOLLDATA** ](https://msdn.microsoft.com/library/windows/hardware/ff542251)構造体を指定するかどうかまたは、次の軸の場所には、最後の軸が返されます。 3 つの軸のアンケートでは、たとえば、メンバーを指定するかどうか返される軸 X、Y、Z X, Y, r

型によってカテゴリ化されるその他の有効な戻り値の一覧を次に (追加のデータを入力できますが、軸の数が奇数のすべての投票をデコードする必要がありますに注意してください、**は\_他**返される内容を決定するにはメンバー)。

-   JOY\_OEMPOLL\_GETBUTTONS:何も追加します。

-   JOY\_OEMPOLL\_POLL1:指定された軸、**は\_他**でメンバーが返された、 **dwX**メンバー。

-   JOY\_OEMPOLL\_POLL2:X と Y 軸が返されます、 **dwX**と**dwY**メンバー。

-   JOY\_OEMPOLL\_POLL3:X と Y 軸が返されます、 **dwX**と**dwY**メンバー。

    場合、**は\_他**メンバーは、0 以外の場合は、R の軸がで返される、 **dwR**メンバー。 Z 軸がそれ以外の場合、返される、 **dwZ**メンバー。

-   JOY\_OEMPOLL\_POLL4:X、Y、Z、および R の軸が返されます、 **dwX**、 **dwY**、 **dwZ**、および**dwR**メンバーそれぞれします。

-   JOY\_OEMPOLL\_POLL5:X、Y、Z、および R の軸が返されます、 **dwX**、 **dwY**、 **dwZ**、および**dwR**メンバーそれぞれします。

    場合、**は\_他**V 軸はメンバーが 0 以外で返される、 **dwR**メンバー。 それ以外の場合、U 軸がで返される、 **dwZ**メンバー。

-   JOY\_OEMPOLL\_POLL6:X、Y、Z、R、するおよび V の軸が返されます、 **dwX**、 **dwY**、 **dwZ**、 **dwR**、 **dwU**、および**dwV**メンバーそれぞれします。

DirectX 3.0 には、喜びの非ポーリングの種類が追加されました。\_OEMPASSDRIVERDATA、を、**は\_他**メンバーには、アプリケーションは、DWORD が含まれています。 この dword 値を使用するには、すべてミニドライバー定義の関数のですが、カスタム セットアップ アプリケーションがデバイスに固有のコマンドと構成情報を送信するミニドライバーを完全に識別できるように具体的には、目的が。

喜びを返す必要があります、ミニドライバー\_OEMPOLLRC\_失敗するすべての種類はサポートされません。

標準のジョイスティック コントロール パネルの構成が唯一の構成メカニズムとして使用されている場合、ダブル ワードには、軸のデータが返されます、約 10 ビット値を軸の値の範囲を制限する必要があります。 ユーザーは、何が起こっているかを簡単に確認できません、ため、これは混乱を避けるために役立ちます。 既存のアプリケーションとの互換性を支援するためには、ミニドライバーによって返される軸後 (該当する場合)、アナログのジョイスティックで返されるものと同じである必要があります。 たとえば、X は最小限に抑えると、左側にある左から右に移動になります。

アクティブ化されたハット スイッチ hat の方向は、角度を度数、0 が転送、9000、18000 が逆の順序で左 27000 と 100 で乗算として表す必要があります。

ポーリング ルーチンを呼び出すため、デバイスが使用、共有リソースを使用して、通信ポートをする必要がありますの追跡が使用された最終時刻など、ミニドライバー中である、正の値のみを示す値です。 使用時間が大幅になると、デバイスのサンプルし、は別の目的のリソースを使用するようになりましたしようとして、ユーザーがデバイスの使用状況が完了した場合は、リソースを解放する、ミニドライバーを停止する必要があります。 デバイスが接続されていないことを示す値可能性がありますこれが、通信エラーの発生がある場合に特に重要です。

 

 




