---
title: HID コレクションにセキュリティで保護された読み取りを適用する
description: HID コレクションにセキュリティで保護された読み取りを適用する
ms.assetid: be3c7d1b-195c-4b7f-a404-070b3b265333
keywords:
- WDK を非表示にセキュリティで保護されたコレクションの読み取り
- HID コレクション WDK、セキュリティで保護されたを読み取ります
- セキュリティで保護された読み取りの WDK を非表示
- WDK を非表示に、信頼できるセキュリティで保護された読み取り
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: c5ea56c054f43955a4299ef6ee06b4f80228964b
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56571827"
---
# <a name="enforcing-a-secure-read-for-a-hid-collection"></a>HID コレクションにセキュリティで保護された読み取りを適用する





このセクションでは、ユーザー モード アプリケーションまたはカーネル モード ドライバーを適用できる方法について説明します、*セキュリティで保護された読み取り*トップレベルの[HID コレクション](hid-collections.md)します。

コレクションでセキュリティで保護された読み取りを有効にする場合 (SeTcbPrivilege 特権を持つもの)「信頼できる」クライアントのみが、開いているファイルのコレクションから入力を取得できます。 カーネル モード ドライバーは、既定では、SeTcbPrivilege 特権を持っているが、ユーザー モード アプリケーションはありません。 ユーザー モードでシステム特権を取得する方法については、Microsoft Windows SDK のドキュメントでの承認についての情報を参照してください。

このメカニズムでは、ユーザー モード システム コンポーネントには、重要なシステム操作中にコレクションから入力を取得する SeTcbPrivilege 特権のないユーザー モード アプリケーションができないようにすることができます「信頼」ように主に提供されています。 たとえば、「信頼できる」ユーザー モードのシステム コンポーネントでは、ユーザーがログオン操作中に提供する機密情報の取得から SeTcbPrivilege 特権なしのユーザー モード アプリケーションを防止できます。

クライアントの使用を「信頼できる」 [ **IOCTL\_HID\_を有効にする\_SECURE\_読み取り**](https://msdn.microsoft.com/library/windows/hardware/ff541081)と[ **IOCTL\_HID\_を無効にする\_SECURE\_読み取り**](https://msdn.microsoft.com/library/windows/hardware/ff541077)のコレクションを有効にし、セキュリティで保護を無効にする要求を読み取ります。 SeTcbPrivilege 特権なしのクライアントがこれらの要求を使用して、要求には、コレクションのセキュリティで保護された読み取り状態は変わりません。 および、HID クラス ドライバーは、状態のステータス値を返します場合\_特権\_いない\_保持します。

有効にして、セキュリティで保護を無効にする次のようにコレクションの動作を参照してください。

-   HID クラス ドライバーは、コレクションの開いている各ファイルのファイルに固有のセキュリティで保護された読み取り数を保持します。 HID クラス ドライバーには、これは、特定のファイルのセキュリティで保護された読み取りの数の合計と、コレクションのセキュリティで保護された読み取りの回数も保持されます。 セキュリティで保護された読み取り数、コレクションが初期化されるの 0 に、コレクションを作成すると、セキュリティで保護された読み取り数、ファイルの初期化を 0 にファイルを開きます。

-   HID クラス ドライバー ファイルを有効にする要求を受け取ると、1 つずつ、セキュリティで保護されたファイルの読み取り数 (およびコレクションのセキュリティで保護された読み取りの数を 1 増や)。

-   HID クラス ドライバーは、ファイルの無効化要求を受信すると。
    -   場合は、セキュリティで保護された読み取り、ファイルの数は 0、1 つのファイル (およびを 1 つのコレクションのセキュリティで保護された読み取りのカウントをデクリメント) の数を読み取り、セキュリティで保護されたドライバーをデクリメントを超えています。
    -   ファイルのセキュリティで保護された読み取りの数が 0 に等しい場合は、ドライバーは、セキュリティで保護された読み取りの数は変更されません。
-   コレクションのセキュリティで保護された読み取りの数が 0 より大きい場合は、HID クラス ドライバーは、コレクションのセキュリティで保護された読み取りを強制します。 それ以外の場合、ドライバーでは、コレクションのセキュリティで保護された読み取りは適用されません。

-   クライアントは、対応する有効にする要求の取り消しを無効にする要求を使用する必要があります。 ただし、クライアントはこれを実行しない場合、HID クラス ドライバー適切にデクリメント、セキュリティで保護された読み取りコレクションの数を処理するとき、 [ **IRP\_MJ\_閉じる**](https://msdn.microsoft.com/library/windows/hardware/ff550720)ファイルを要求します。 ドライバーは、終了の要求を処理するときに、デクリメント、セキュリティで保護された読み取りによって閉じられているファイルのセキュリティで保護された読み取りの数、コレクションの数。

 

 




