---
title: HID コレクションにセキュリティで保護された読み取りを適用する
description: HID コレクションにセキュリティで保護された読み取りを適用する
ms.assetid: be3c7d1b-195c-4b7f-a404-070b3b265333
keywords:
- コレクション WDK HID、セキュリティで保護された読み取り
- HID コレクション WDK、セキュア読み取り
- セキュア読み取り WDK HID
- セキュリティで保護された安全な読み取りの WDK HID
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 76c7731ef49d1606bd0f398f357b591a2ec56f8b
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72824840"
---
# <a name="enforcing-a-secure-read-for-a-hid-collection"></a>HID コレクションにセキュリティで保護された読み取りを適用する





このセクションでは、ユーザーモードのアプリケーションまたはカーネルモードドライバーで、最上位の[HID コレクション](hid-collections.md)に対して*セキュリティで保護された読み取り*を強制する方法について説明します。

コレクションに対して安全な読み取りが有効になっている場合、"信頼された" クライアント (SeTcbPrivilege 特権を持つクライアント) のみが、コレクションの開いているファイルから入力を取得できます。 カーネルモードドライバーには既定で SeTcbPrivilege 特権がありますが、ユーザーモードアプリケーションでは設定されません。 ユーザーモードでシステム特権を取得する方法の詳細については、Microsoft Windows SDK のドキュメントの承認に関する情報を参照してください。

このメカニズムは主に、"信頼された" ユーザーモードのシステムコンポーネントが、重大なシステム操作中に、SeTcbPrivilege 特権を持たないユーザーモードのアプリケーションがコレクションから入力を取得できないようにするために用意されています。 たとえば、"信頼された" ユーザーモードシステムコンポーネントを使用すると、SeTcbPrivilege 特権を持たないユーザーモードアプリケーションが、ログオン操作中にユーザーが指定した機密情報を取得できなくなります。

"信頼された" クライアントは、 [**ioctl\_hid\_** ](https://docs.microsoft.com/windows-hardware/drivers/ddi/hidclass/ni-hidclass-ioctl_hid_enable_secure_read)使用して\_セキュリティで保護された\_読み取りおよび[**IOCTL\_hid\_無効**](https://docs.microsoft.com/windows-hardware/drivers/ddi/hidclass/ni-hidclass-ioctl_hid_disable_secure_read)にする\_読み取り要求を有効にし、コレクションに対して安全な読み取りを無効にします。 SeTcbPrivilege 特権を持たないクライアントがこれらの要求を使用する場合、要求はコレクションの安全な読み取り状態を変更しません。また、HID クラスドライバーは状態の値を返します。状態\_特権\_保持さ\_れません。

コレクションの安全な読み取りを有効または無効にするには、次の方法があります。

-   HID クラスドライバーは、コレクションの開いているファイルごとに、ファイル固有のセキュリティで保護された読み取りカウントを保持します。 また、HID クラスドライバーは、コレクションの安全な読み取り数を保持します。これは、ファイル固有のセキュリティで保護された読み取り数の合計です。 コレクションのセキュリティで保護された読み取りカウントは、コレクションの作成時に0に初期化されます。また、ファイルを開いたときに、ファイルのセキュリティで保護された読み取りカウントはゼロに初期化されます。

-   HID クラスドライバーは、ファイルに対して enable 要求を受信すると、そのファイルに対してセキュリティで保護された読み取りカウントを1ずつ増やします (さらに、1つずつコレクションのセキュリティで保護された読み取りカウントを増やします)。

-   HID クラスドライバーがファイルに対して無効化要求を受け取ると、次のようになります。
    -   ファイルのセキュア読み取りカウントが0より大きい場合、ドライバーは、そのファイルに対して保護された読み取りカウントを1だけデクリメントします (また、コレクションのセキュリティで保護された読み取りカウントを1だけデクリメントします)。
    -   ファイルのセキュア読み取りカウントが0の場合、ドライバーはセキュリティで保護された読み取りカウントを変更しません。
-   コレクションのセキュア読み取りカウントが0より大きい場合は、HID クラスドライバーによって、コレクションに対してセキュリティで保護された読み取りが適用されます。 それ以外の場合、ドライバーは、コレクションに対して安全な読み取りを強制しません。

-   クライアントは、disable 要求を使用して、対応する enable 要求を取り消す必要があります。 ただし、クライアントがこれを行わない場合、HID クラスドライバーは、ファイルに対する[**IRP\_MJ\_CLOSE**](https://docs.microsoft.com/windows-hardware/drivers/kernel/irp-mj-close)要求を処理するときに、コレクションのセキュア読み取りカウントを適切にデクリメントします。 ドライバーは、終了要求を処理するときに、コレクションのセキュリティで保護された読み取りカウントを、閉じられているファイルのセキュリティで保護された読み取りカウントでデクリメントします。

 

 




