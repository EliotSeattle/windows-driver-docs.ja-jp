---
title: デバイス オブジェクトに対するセキュリティ記述子の摘要
description: デバイス オブジェクトに対するセキュリティ記述子の摘要
ms.assetid: c0697021-cf78-4b85-b959-342179da5621
keywords:
- セキュリティ記述子 WDK ファイルシステム、デバイスオブジェクトに適用
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: fe904f7476b4fb5063b725d772b9f652f58fe4d6
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72841495"
---
# <a name="applying-security-descriptors-on-the-device-object"></a>デバイス オブジェクトに対するセキュリティ記述子の摘要


## <span id="ddk_applying_security_descriptors_on_the_device_object_if"></span><span id="DDK_APPLYING_SECURITY_DESCRIPTORS_ON_THE_DEVICE_OBJECT_IF"></span>


ほとんどのドライバーは、デバイスオブジェクトに対して i/o マネージャーによって適用されたアクセス制御を使用して、不適切なアクセスから保護します。 ほとんどのドライバーの最も簡単な方法は、ドライバーのインストール時に明示的なセキュリティ記述子を適用することです。 INF ファイルでは、このようなセキュリティ記述子は、AddReg セクションの "Security" エントリによって記述されます。 セキュリティ記述子の記述に使用される完全な言語の詳細については、Microsoft Windows SDK のドキュメントの「セキュリティ記述子の定義言語」を参照してください。

セキュリティ記述子定義言語 (SDDL) を使用したセキュリティ記述子の基本形式には、標準セキュリティ記述子の次のような部分が含まれます。

-   所有者 SID。

-   グループ SID。

-   随意アクセス制御リスト (DACL)。

-   システムアクセス制御リスト (SACL)。

そのため、セキュリティ記述子の INF スクリプト内の説明は次のようになります。

```cpp
O:owner-sidG:group-sidD:dacl-flags(ace)(ace)S:sacl-flags(ace)(ace)
```

個々のアクセス制御エントリは、セキュリティ識別子または SID によって指定された特定のグループまたはユーザーに対して許可または拒否されるアクセスを記述します。 たとえば、INF ファイルには次のような行が含まれている場合があります。

```cpp
"D:P(A;CI;GR;;;BU)(A;CI;GR;;;PU)(A;CI;GA;;;BA)(A;CI;GA;;;SY)(A;CI;GA;;;NS)(A;CI;GA;;;LS)(A;CI;CCDCLCSWRPSDRC;;;S-1-5-32-556)"
```

上記の例は、NETTCPIP からのものです。Microsoft Windows XP Service Pack 1 (SP1) システムの INF ファイル。

このインスタンスでは、所有者またはグループが指定されていないため、既定値または既定値が既定値になります。 **D**は、これが DACL であることを示します。 **P**は、これが保護された ACL であり、親オブジェクトのセキュリティ記述子からの権限を継承していないことを示します。 保護された ACL により、親の継承が継承されるのを防ぐことができます。 かっこで囲まれた式は、単一のアクセス制御エントリ (ACE) を示します。 SDDL を使用するアクセス制御エントリは、セミコロンで区切られた複数のコンポーネントで構成されています。 順序は次のとおりです。

-   ACE の型インジケーター。 Dacl には4つの一意の型があり、Sacl には4種類あります。

-   子オブジェクトに対するこの ACE の継承、または Sacl の監査とアラームポリシーを説明するために使用される**フラグ**フィールド。

-   **権限**フィールドは、ACE によって許可または拒否される権限を示します。 このフィールドには、この ACE に適用される汎用、標準、および特定の権限を示す特定の数値を指定することも、一般的なアクセス権の文字列の説明を使用することもできます。

-   DACL がオブジェクト固有の ACE 構造体である場合は、オブジェクト GUID。

-   DACL がオブジェクト固有の ACE 構造体である場合は、継承されたオブジェクト GUID

-   この ACE が適用されるセキュリティエンティティを示す SID。

このため、サンプルのセキュリティ記述子を解釈すると、ACE の先頭の "A" は、これが "アクセス許可" エントリであることを示します。 別の方法としては、"アクセスが拒否されました" エントリがあります。このエントリは、使用頻度が低いため、先頭の "D" 文字で示されます。 **Flags**フィールドは、この ACE がサブオブジェクトによって継承されることを示す Container INHERIT (CI) を指定します。

**権限**フィールド値は、一般的な権限や標準権限を含む特定の権限をエンコードします。 たとえば、"GR" は "generic read" アクセスを示し、"GA" は "汎用的な権限" アクセスを示します。 多くの特別な権限は、これらの汎用的な権限に従います。 上記のサンプルでは、"CC" は、ファイルとディレクトリの権限に固有の [子アクセスの作成] を示しています。 上記のサンプルには、子アクセスの削除のための "DC" を含む "CC" 文字列の後にあるその他の標準の権限、リストの子アクセス用の "LC"、自己右アクセス用の "RP"、読み取りプロパティアクセス用の "SD"、読み取り制御アクセス用の "RC" が含まれています.

上記のサンプルの SID エントリ文字列には、パワーユーザー用の "PU"、組み込みユーザーの場合は "BU"、ローカルサービスアカウントの場合は "BA"、ローカルシステムの場合は "SY"、network service アカウントの場合は "NS" が含まれます。 このため、上の例では、ユーザーにはオブジェクトに対する汎用読み取りアクセス権が与えられています。 これに対して、組み込みの管理者、ローカルサービスアカウント、ローカルシステム、およびネットワークサービスには、汎用のすべてのアクセス (読み取り、書き込み、および実行) が与えられます。 使用可能なすべての権限と標準 SID 文字列の完全なセットについては、Windows SDK をご覧ください。

これらの Acl は、特定のドライバーによって作成されるすべてのデバイスオブジェクトに適用されます。 また、ドライバーは、名前付きデバイスオブジェクトを作成するときに、 [**Iocreateデバイス**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdmsec/nf-wdmsec-wdmlibiocreatedevicesecure)の新しい関数を使用して、特定のオブジェクトのセキュリティ設定を制御することもできます。 **Iocreateデバイス**の機能は、Windows XP Service Pack 1 および windows Server 2003 以降で使用できます。 **Iocreateデバイス**を使用すると、デバイスオブジェクトに適用されるセキュリティ記述子は、デバイスオブジェクトに適した完全なセキュリティ記述子定義言語のサブセットを使用して記述されます。

デバイスオブジェクトに特定のセキュリティ記述子を適用する目的は、アプリケーションがデバイス自体にアクセスしようとするたびに、適切なセキュリティチェックがデバイスに対して実行されるようにすることです。 名前構造 (ファイルシステムの名前空間など) を含むデバイスオブジェクトの場合、このデバイス名前空間へのアクセスの管理の詳細は、i/o マネージャーではなく、ドライバーに属しています。

このような場合の興味深い問題は、ドライバーデバイスオブジェクトとデバイスドライバーへのアクセスを確認する i/o マネージャー間の境界でセキュリティを処理する方法です。この場合、ドライバーに適したセキュリティポリシーがすべて実装されます。 従来、開いているオブジェクトがデバイス自体の名前である場合、i/o マネージャーは、そのセキュリティ記述子を使用して、デバイスオブジェクトに対して完全なアクセスチェックを直接実行します。 ただし、開いているオブジェクトがドライバー自体の内部のパスを示している場合、i/o マネージャーは、デバイスオブジェクトに対して走査アクセスが許可されているかどうかのみを確認します。 通常、この走査権限は、ほとんどのスレッドに**SeChangeNotifyPrivilege**が付与されているために付与されます。これは、ディレクトリへの走査権限の付与に対応します。 通常、名前の構造をサポートしていないデバイスは、i/o マネージャーが完全なセキュリティチェックを実行するように要求します。 これを行うには、[デバイスの特性] フィールドで [**ファイル\_デバイス\_安全\_オープン**ビット] を設定します。 このようなデバイスオブジェクトが混在するドライバーでは、名前の構造をサポートしていないデバイスに対して、この特性を設定する必要があります。 たとえば、ファイルシステムは、名前付きデバイスオブジェクト (名前付け構造体をサポートしていません) でこのオプションを設定しますが、名前のないデバイスオブジェクト (たとえば、ボリューム) では名前付け構造をサポートしているので、このオプションを設定しません。 このビットを正しく設定できないと、ドライバーに共通のバグが発生し、デバイスへの不適切なアクセスが許可される可能性があります。 添付ファイルインターフェイスを使用するドライバー ([**Ioattachdevicetodevicestacksafe**](https://docs.microsoft.com/windows-hardware/drivers/ddi/ntddk/nf-ntddk-ioattachdevicetodevicestacksafe)など) の場合、ドライバーをアタッチするデバイスでこのフィールドを設定すると、**ファイル\_デバイス\_セキュリティで保護された\_オープン**ビットが設定されます。 そのため、フィルタードライバーでは、セキュリティチェックの特定の側面について心配する必要はありません。

 

 




