---
title: データの改ざん
description: データの改ざん
ms.assetid: 277395b9-b770-45b4-8f4c-cad8b684ca44
keywords:
- 脅威のモデル データの改ざん、WDK のファイル システム
- セキュリティの脅威データの改ざん、WDK のファイル システムをモデル化します。
- データ改ざんの WDK ファイル システム
- WDK のファイル システムのデータの改ざん
- WDK のバッファーはファイル システム
- WDK の Ioctl ファイル システム
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 78164b0adb8e21f166845a785b84bfab444cd94a
ms.sourcegitcommit: fb7d95c7a5d47860918cd3602efdd33b69dcf2da
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/25/2019
ms.locfileid: "67371302"
---
# <a name="tampering-with-data"></a>データの改ざん


## <span id="ddk_tampering_with_data_if"></span><span id="DDK_TAMPERING_WITH_DATA_IF"></span>


ドライバーは、脅威が深刻な脅威のファイル システムおよびファイル システム フィルター ドライバーは、データの改ざん。 すべてのドライバーには、ユーザー モードおよびカーネル モード コンポーネント間で共有されるすべてのコントロール構造の修正が可能ユーザー モード コンポーネントによって使用中に、カーネル モード コンポーネントによって潜在的な脅威があります。 メソッドに厳密な依存しているために、ファイル システム フィルター ドライバーはこのクラスは、攻撃の脅威に晒さ\_どちらのデータ転送の種類直接的なアクセス、仮想アドレスからユーザー バッファー。 高速の I/O には、生のユーザー モード バッファーも間接的にアクセスします。 リスクは、ドライバーがありますを使用することデータ、アプリケーションがデータを変更するときにします。 通常、ドライバーは、データを検証することで、これに対する保護しようとします。 ただし、データ検証場合にのみ機能が検証された後、データを変更することはできません。

ファイル システムとファイル システム フィルター ドライバーは、ユーザー モード アプリケーションとさまざまなカーネル モード ドライバーの間で情報を転送に使用される多数の IOCTL と FSCTL の操作があります。 さらにプライベートの IOCTL と FSCTL 運用もサービスのユーザー モードとカーネル モード ドライバーの間の制御とデータの情報を転送するには、このようなドライバーの非常に一般的です。

前提事項のみ、ドライバーのサービスまたはアプリケーションはそのインターフェイスを活用で実行されますが、この設計モデルに固有の。 このような設計と実装は、次の理由で危険にさらされては。

-   悪意のあるアプリケーションは、ドライバーの有効なバッファーを送信し、プローブし、ドライバーの脆弱性を検索するために、その後、データを変更可能性があります。

-   コントロールにあるアプリケーション内の障害には、データ バッファーの内容をコントロールが無効になる可能性があります。 たとえば、スタック ベースの制御領域は、例外がスタック領域の再利用になり、制御フローを変更する場合は無効になります可能性があります。

このカテゴリの問題から保護するには、実装の観点から警戒する必要があります。 バッファーは、検証される前に、非揮発性メモリ (カーネル専用、または読み取り専用メモリ) である必要があります。 バッファーに他のバッファーまたは制御構造への参照が含まれている場合もある必要があります非揮発性メモリな検証前にします。

開発者がありますを使用してその IOCTL、 **FastIoDeviceControl**ディスパッチは生のユーザーのバッファーでデータを渡します。 したがって Ioctl の高速な I/O バージョンを実装するドライバーには、問題を回避する適切な手順を実行する必要があります。

単独でデータの検証するだけでは十分でないことに注意してください。 たとえば、[ **ProbeForWrite** ](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/wdm/nf-wdm-probeforwrite) の呼び出しが成功した場合、バッファーが有効である可能性がありますが、アプリケーションのアドレス空間を後で変更すると、その状態が変化する可能性があります。 たとえば、ドライバーが実際にバッファーを使用する前に、アプリケーションが終了する可能性があります。 そのため、ドライバーはアプリケーションのアドレス空間内のすべての変更から保護する必要があります。 通常これは、ユーザー バッファーアドレスに直接アクセスするコードの周りで  **\_\_try** と  **\_\_except** を使用する構造化例外処理を使用して行われます。

 

 




