---
title: データの改ざん
description: データの改ざん
ms.assetid: 277395b9-b770-45b4-8f4c-cad8b684ca44
keywords:
- 脅威モデル WDK ファイルシステム、データの改ざん
- セキュリティ上の脅威モデル WDK ファイルシステム、データの改ざん
- データ改ざん WDK ファイルシステム
- データの改ざん (WDK ファイルシステム)
- WDK ファイルシステムのバッファー
- Ioctl WDK ファイルシステム
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: f510b23dd9bd4316eaa0f17638e5795b09bb592e
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72840959"
---
# <a name="tampering-with-data"></a>データの改ざん


## <span id="ddk_tampering_with_data_if"></span><span id="DDK_TAMPERING_WITH_DATA_IF"></span>


データの改ざんはドライバーの脅威ですが、ファイルシステムおよびファイルシステムフィルタードライバーにとって深刻な脅威となります。 すべてのドライバーについて、ユーザーモードコンポーネントとカーネルモードコンポーネントの間で共有される制御構造は、カーネルモードコンポーネントによって使用されている間にユーザーモードコンポーネントによって変更される可能性があります。 ファイルシステムとフィルタードライバーは、このクラスの攻撃に対して特に脆弱です。これは、仮想アドレスを使用してユーザーバッファーに直接アクセスするデータ転送の種類\_、メソッドに強力に依存しているためです。 高速 i/o も、生のユーザーモードバッファーに直接アクセスします。 ここでのリスクは、アプリケーションがデータを変更するときに、ドライバーがこのデータを使用している可能性があることです。 通常、ドライバーはデータを検証することによって、このような保護を試みます。 ただし、データの検証は、検証後にデータを変更できない場合にのみ機能します。

ファイルシステムおよびファイルシステムフィルタードライバーの場合、ユーザーモードアプリケーションと各種カーネルモードドライバーの間で情報を転送するために使用される IOCTL および FSCTL 操作は多数あります。 さらに、このようなドライバーでは、ユーザーモードサービスとカーネルモードドライバーの間で制御とデータの情報を転送するプライベート IOCTL および FSCTL 操作が必要になることがよくあります。

この設計モデルに固有のものは、ドライバーのサービスまたはアプリケーションのみがインターフェイスを利用することを前提としています。 このような設計と実装は、次の理由により危険にさらされます。

-   悪意のあるアプリケーションがドライバーに有効なバッファーを送信し、その後、ドライバーの脆弱性を調査して検出するためにデータを変更します。

-   コントロールアプリケーション内でエラーが発生すると、コントロールバッファーのデータの内容が無効になる可能性があります。 たとえば、例外によって制御フローが変更され、スタック領域が再利用される場合、スタックベースの制御領域が無効になることがあります。

このカテゴリの問題に対して保護するには、実装に関して一定の警戒を行う必要があります。 バッファーは、検証する前に、非揮発性メモリ (カーネル専用または読み取り専用メモリ) に配置する必要があります。 バッファーに他のバッファーまたは制御構造への参照が含まれている場合は、それを検証する前に、非揮発性メモリ内に配置する必要があります。

また、開発者は、 **Fa生物 Odevicecontrol**ディスパッチを使用する IOCTL が生のユーザーバッファーにデータを渡すことにも注意する必要があります。 そのため、Ioctl の高速 i/o バージョンを実装するドライバーは、問題を防ぐために適切な手順を実行する必要があります。

データを単独で検証するだけでは十分ではないことに注意してください。 たとえば、 [**ProbeForWrite**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-probeforwrite)への呼び出しが成功した場合、バッファーが有効であることを示している可能性がありますが、それ以降にアプリケーションアドレス空間が変更されると、その状態が変更される可能性があります。 たとえば、ドライバーが実際に直接バッファーを使用する前に、アプリケーションを終了させることができます。 そのため、ドライバーは、アプリケーションのアドレス空間内の変更に対して保護する必要があります。 通常、これは **\_\_try**および **\_\_** を使用した構造化例外処理を使用して実行されます。ただし、ユーザーバッファーアドレスに直接アクセスするコードは除きます。

 

 




