---
title: ネットワークリダイレクターの基本アーキテクチャ
description: ネットワークリダイレクターの基本アーキテクチャ
ms.assetid: 60a7c79d-b89f-4c8b-9619-bd48c9e1efac
keywords:
- ネットワークリダイレクター WDK、アーキテクチャ
- リダイレクタードライバー WDK、アーキテクチャ
- TDI ドライバー WDK ファイルシステム
- WDK ファイルシステムの Transport Driver Interface
- Dll WDK ファイルシステム
- SYS WDK ファイルシステム
- カーネルモードファイルシステムドライバー WDK ファイルシステム
- ユーザーモード Dll WDK ファイルシステム
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 250bd3f64cd0196e8e25dd2cadae5fc98939c780
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72841491"
---
# <a name="basic-architecture-of-a-network-redirector"></a>ネットワークリダイレクターの基本アーキテクチャ


## <span id="ddk_basic_architecture_of_a_network_redirector_if"></span><span id="DDK_BASIC_ARCHITECTURE_OF_A_NETWORK_REDIRECTOR_IF"></span>


ネットワークリダイレクターの一部として、次の基本的なソフトウェアコンポーネントが必要です。

-   ネットワークリダイレクター機能を提供するカーネルモードのファイルシステムデバイスドライバー (SYS)。

-   ユーザーモードのダイナミックリンクライブラリ (DLL)。クライアントユーザーアプリケーションに対して、ファイル以外の操作のためのネットワークプロバイダーインターフェイスへのアクセスを提供し、ネットワークリダイレクター機能を提供するカーネルモードのファイルシステムドライバーとの通信を可能にします。

ネットワークリダイレクターのカーネルモードファイルシステムドライバーコンポーネントは、リモートファイルアクセスをオペレーティングシステムに統合するために、オブジェクトマネージャー、キャッシュマネージャー、メモリマネージャー、i/o システム、およびその他のカーネルシステムとやり取りします。 ドライバーは、リモートファイルアクセスのために、i/o マネージャーを介してクライアントアプリケーションから要求を受信し、必要な情報をネットワーク経由でリモートファイルサーバーに送信します。 また、ドライバーは、リモートファイルサーバーからの応答を受信し、i/o マネージャーを介してクライアントアプリケーションに情報を返します。 また、ネットワークリダイレクタードライバーは、リモートアクセスに使用するネットワークプロトコルを実装するか、このネットワークプロトコルまたは通信機構を実装する別のカーネルドライバー、ユーザーモードアプリケーション、またはサービスの呼び出しを提供する必要があります。 このネットワーク通信を実装する最も一般的な方法は、Transport Driver Interface (TDI) を使用して、既存のネットワークプロトコルスタック (TCP/IP など) を呼び出すことです。 ネットワークプロトコルスタックは、ネットワークドライバーインターフェイス仕様 (NDIS) とネットワークインターフェイスカードを使用して、最下層で通信します。 この通信機構には、アプリケーション固有のインターフェイスを使用することもできます。

ユーザーモード DLL は、ファイル操作ではないネットワークプロバイダーインターフェイスを使用して、クライアントからの特別な要求を受信します。 これらの要求を使用して、ネットワークプロバイダーの機能の決定、リモートネットワークリソースの列挙、リモートネットワークへのログオン、ネットワークパスワードの変更、リモートサーバーとの接続、リモートネットワーク共有またはリソースのマウントを行うことができます。リモート共有から切断しています。 ユーザーモード DLL は、リモートファイルシステムにアクセスするための WNet ユーザーモード Api と同等のものを実装しています。 次に、この DLL は、特殊な IOCTL 呼び出しを通じてカーネルモードのネットワークリダイレクタードライバーと通信し、これらのクライアント要求を満たします。 たとえば、この DLL は、ネットワークリソースの列挙 (ネットワークコンピューターの参照) またはリモートファイル共有とリソース (プリンター) への接続時に、エクスプローラーによって呼び出されます。 この DLL は、リモートリソース (**net view** \\\\*computername*) を表示し、リモートファイル共有 (**net use**) に接続または切断する net コマンドラインツールからも呼び出されます。 この DLL は、複数のプロバイダールーター (MPR) の公開された WNet Api を使用して、カスタムアプリケーションから呼び出すこともできます。

ネットワークリダイレクターには、他にもいくつかのコンポーネントが必要になる場合があります。

-   グローバルデータテーブルをユーザーモードの DLL に安全に格納する必要がある場合は、ユーザーモードの DLL とカーネルモードドライバーの仲介者として機能するためにサービスアプリケーションが必要になることがあります。 ユーザーモードの DLL は、クライアントアプリケーションのプロセス空間でインスタンス化されるため、すべてのクライアントアプリケーションでグローバルにする必要がある内部データテーブルをセキュリティで保護することはできません。 クライアントごとのデータは、ユーザーモードのネットワークプロバイダー DLL に接続するときに、各クライアントアプリケーションに対してプライベートにすることができますが、グローバルデータは含まれません。 サービスアプリケーション (.exe ファイル) は、ユーザーモードの DLL と、グローバルデータテーブルが格納されているカーネルドライバーとの間の仲介役として使用できます。 たとえば、Microsoft ネットワークでは、svchost.exe に組み込まれているワークステーションサービスを使用して、"net use" 接続のグローバルテーブルを格納し、カーネルモードドライバーの仲介役として機能します。 Microsoft ネットワークの場合、ユーザーモード DLL (ntlanman .dll) は svchost.exe でワークステーションサービスを呼び出します。これにより、ネットワークリダイレクター機能を提供するカーネルモードドライバー mrxsmb が呼び出されます。

-   システムにネットワークリダイレクターコンポーネントをインストールし、適切に登録するためのシステム。必要なレジストリエントリの作成が含まれている必要があります。 また、ソフトウェアが不要になった場合は、ネットワークリダイレクターをアンインストールする方法もあります。 Microsoft Systems Installer (MSI) または Windows INF のスクリプトファイルを使用して、このセットアップを実行できます。 このインストールとセットアップは、カスタムインストールプログラムを使用して行うこともできます。

-   ネットワークリダイレクターがオペレーティングシステムに含まれていないネットワークプロトコル (たとえば、Xerox Network Services) を使用している場合は、カスタムカーネルモードの TDI ドライバーをインストールする必要があります。 通信に使用するネットワークプロトコルを実装する新しい TDI ドライバーをインストールする必要があります。 カーネルモードのネットワークリダイレクタードライバーは、カスタム TDI ドライバーの上端に接続します。 カスタム TDI ドライバーは、NDIS ドライバーを使用して、より低いエッジで通信するようになります。

    ネットワークリダイレクターで TCP/IP プロトコルが使用されている場合、カスタムの TDI ドライバーは必要ありません。 この場合、ネットワークリダイレクターは、TCP/IP プロトコルの TDI ドライバーの上端に接続します。

-   特別な構成、診断、および管理のために、ユーザーモードからカーネルモードドライバーへのアクセスを提供するために、管理ツールが必要になることがあります。 このツールを使用すると、問題のトラブルシューティングのためにトレースとログ記録を有効または無効にすることもできます。 このツールは、さまざまなカスタムプライベート Ioctl を使用して、カーネルドライバーと通信します。 このツールを使用すると、サービスコントロールマネージャー (SCM) にアクセスして、グローバルデータがユーザーモードネットワークプロバイダー DLL 用に安全に格納されている中間サービスを管理することもできます。

Windows Vista 以降では、Microsoft Windows のバージョンでは TDI はサポートされませ**ん  。** 代わりに、 [Windows フィルタリングプラットフォーム](https://docs.microsoft.com/windows-hardware/drivers/network/windows-filtering-platform-callout-drivers2)または[Winsock カーネル](https://docs.microsoft.com/windows-hardware/drivers/ddi/_netvista/)を使用してください。

 

 

 




