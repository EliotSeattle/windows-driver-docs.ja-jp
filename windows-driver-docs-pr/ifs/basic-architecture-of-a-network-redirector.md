---
title: ネットワーク リダイレクターの基本的なアーキテクチャ
description: ネットワーク リダイレクターの基本的なアーキテクチャ
ms.assetid: 60a7c79d-b89f-4c8b-9619-bd48c9e1efac
keywords:
- ネットワーク リダイレクター WDK、アーキテクチャ
- リダイレクター ドライバー WDK、アーキテクチャ
- TDI ドライバー WDK ファイル システム
- ドライバー インターフェイスの WDK ファイル システムをトランスポートします。
- WDK の Dll ファイル システム
- SYS WDK ファイル システム
- ファイル システムのカーネル モード ファイル システム ドライバー WDK
- ユーザー モード Dll の WDK ファイル システム
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 7c599d4aac38bf74025f66e81be6187df9a51e38
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56536476"
---
# <a name="basic-architecture-of-a-network-redirector"></a>ネットワーク リダイレクターの基本的なアーキテクチャ


## <span id="ddk_basic_architecture_of_a_network_redirector_if"></span><span id="DDK_BASIC_ARCHITECTURE_OF_A_NETWORK_REDIRECTOR_IF"></span>


次の基本的なソフトウェア コンポーネントはネットワーク リダイレクターの一部として必要です。

-   カーネル モード ファイル システム デバイス ドライバー (SYS) ネットワーク リダイレクター機能を提供します。

-   ユーザー モードのダイナミック リンク ライブラリ (DLL) をファイル以外の操作をプロバイダーのネットワーク インターフェイスにクライアントのユーザーのアプリケーションへのアクセスを提供し、ネットワーク リダイレクター機能を提供する、カーネル モード ファイル システム ドライバーとの通信を可能になります。

ネットワーク リダイレクターのカーネル モードのファイル システム ドライバー コンポーネントは、リモート ファイルへのアクセスをオペレーティング システムに統合するために、オブジェクト マネージャー、キャッシュ マネージャー、メモリ マネージャー、I/O システム、およびその他のカーネルのシステムと対話します。 ドライバーは、リモート ファイル アクセスの I/O マネージャーを通じてクライアント アプリケーションからの要求を受信し、ネットワーク経由でリモート ファイル サーバーに必要な情報を送信します。 また、ドライバーは、リモート ファイル サーバーからの応答を受信し、I/O マネージャーを通じてクライアント アプリケーションに、情報を渡します。 ネットワーク リダイレクター ドライバーは、リモート アクセスに使用されるネットワーク プロトコルを実装するか、別のカーネル ドライバー、ユーザー モード アプリケーション、またはこのネットワーク プロトコルまたは通信メカニズムを実装するサービスへの呼び出しを提供する必要がありますも。 このネットワーク通信を実装する最も一般的な方法では、トランスポート Driver Interface (TDI) を使用して、既存のネットワーク プロトコル スタック (たとえば TCP/IP) を呼び出します。 ネットワーク プロトコル スタックは、Network Driver Interface Specification (NDIS) を使用して、ネットワーク インターフェイス カードの下部にある層で通信します。 この通信メカニズム用のアプリケーション固有のインターフェイスを使用することもできます。

ユーザー モード DLL は、ファイルの操作ではありませんが、ネットワーク プロバイダー インターフェイスを使用してクライアントから特別な要求を受信します。 プロバイダーの機能、ネットワーク、リモート ネットワークのリソースを列挙するリモート ネットワーク共有やリソース、マウント、リモート サーバーと接続するネットワーク パスワードの変更、リモート ネットワークにログオンを決定するため、これらの要求を使用でき、リモート共有から切断しています。 ユーザー モード DLL と同等のリモート ファイル システムにアクセスするための WNet ユーザー モード Api を実装します。 この DLL は、これらのクライアント要求を満たすために特別な IOCTL 呼び出しを通じて、カーネル モード ネットワーク リダイレクター ドライバーと通信します。 たとえば、この DLL は呼び出されます (ネットワーク コンピューター を参照)、ネットワーク リソースを列挙するときに、Windows エクスプ ローラーで、またはリモート ファイル共有リソース (プリンター) に接続するとき。 この DLL は、リモート リソースを表示する場合は、NET コマンド ライン ツールからも呼ばれます (**「net view** \\ \\ *computername*) と接続またはリモート ファイル共有 (を切断**net**)。 この DLL は、公開されている WNet Api の複数プロバイダーのルーター (MPR) を使用してカスタム アプリケーションで呼び出すこともできます。

ネットワーク リダイレクターは、他のいくつかのコンポーネントも必要があります。

-   サービス アプリケーションは、任意のグローバル データ テーブルは、ユーザー モード DLL に安全に保存する必要がある場合、ユーザー モード DLL とカーネル モード ドライバーの間の媒介として機能する必要な場合があります。 ユーザー モード DLL は、クライアント アプリケーションのプロセス空間内でインスタンス化するため、すべてのクライアント アプリケーション全体にする必要があるすべての内部データ テーブルをセキュリティで保護する方法はありません。 ユーザー モード ネットワーク プロバイダー DLL への接続時に、クライアント アプリケーションごとにプライベート クライアントごとのデータがないグローバル データを含めることは可能になります。 サービス アプリケーション (.exe ファイル) は、グローバル データのテーブルが格納されている、ユーザー モード DLL とカーネル ドライバーの仲介役として使用できます。 たとえば、Microsoft ネットワークは、svchost.exe に組み込まれているワークステーション サービスを使用して、"net use"接続のグローバルなテーブルを格納し、カーネル モード ドライバーの仲介役として機能します。 Microsoft ネットワーク、ユーザー モード DLL、ntlanman.dll svchost.exe でのワークステーション サービスの呼び出しの場合を呼び出し、mrxsmb.sys ネットワーク リダイレクター機能を提供する、カーネル モード ドライバーします。

-   システムをインストールすると、正しくネットワーク リダイレクターのコンポーネントを登録する、システムは、必要なレジストリ エントリを作成する必要があります。 ソフトウェアが不要になった場合は、ネットワーク リダイレクターをアンインストールする方法もあります。 Microsoft のシステムのインストーラー (MSI) または Windows INF スクリプト ファイルを使用して、このセットアップを実行することになります。 このインストールおよびセットアップすることもできますカスタム インストール プログラムを使用します。

-   TDI カスタム カーネル モード ドライバーをネットワーク リダイレクターが含まれていないネットワーク プロトコルを使用している場合にインストールする必要があります。 オペレーティング システム (Xerox ネットワーク サービスなど)。 新しい TDI ドライバーはインストールする必要の通信に使用するネットワーク プロトコルを実装します。 カーネル モードのネットワーク リダイレクター ドライバーは、カスタムの TDI ドライバーの上端に接続します。 下端 NDIS ドライバーとは通信にカスタム TDI ドライバーです。

    ネットワーク リダイレクターは、TCP/IP プロトコルを使用している場合、カスタムの TDI ドライバーが必要ないことに注意してください。 ネットワーク リダイレクターは、ここで TCP/IP プロトコル ドライバーに TDI の上端に接続します。

-   管理ツールが特別な構成、診断、および管理をユーザー モードからカーネル モード ドライバーへのアクセスを提供するために必要な場合があります。 このツールは、有効または無効のトレースと問題のトラブルシューティングのログ記録にも使用できます。 さまざまなカスタム プライベート Ioctl を使用して、ツールにカーネル ドライバーと通信します。 このツールは、グローバル データの保存場所に安全にユーザー モード ネットワーク プロバイダーの DLL の中間サービスを管理するサービス コントロール マネージャー (SCM) にアクセスも提供可能性があります。

**注**   Windows Vista の後に、TDI が Microsoft Windows のバージョンでサポートされません。 使用[Windows フィルタ リング プラットフォーム](https://msdn.microsoft.com/library/windows/hardware/ff571068)または[Winsock Kernel](https://msdn.microsoft.com/library/windows/hardware/ff571083)代わりにします。

 

 

 




