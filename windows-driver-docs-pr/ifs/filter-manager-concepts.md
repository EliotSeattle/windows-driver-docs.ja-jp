---
title: フィルター マネージャーの概念
description: フィルター マネージャーの概念
ms.assetid: 5b11671f-02fd-4d0e-8199-c345bbf2591c
keywords:
- フィルターマネージャー WDK ファイルシステムミニフィルター、フィルターマネージャーの概要
- 高度 WDK ファイルシステムミニフィルター
- フィルターマネージャー WDK ファイルシステムミニフィルター、アーキテクチャ
ms.date: 02/03/2020
ms.localizationpriority: medium
ms.openlocfilehash: 371bef8c01aab483425671ae10db7d6e492c1c02
ms.sourcegitcommit: 8c898615009705db7633649a51bef27a25d72b26
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/07/2020
ms.locfileid: "78910439"
---
# <a name="filter-manager-concepts"></a>フィルター マネージャーの概念

フィルターマネージャーは、従来のファイルシステムフィルターモデルに準拠するカーネルモードドライバーです。 ファイルシステムフィルタードライバーで一般的に必要とされる機能を実装し、公開します。 この機能を利用することで、サードパーティの開発者は、従来のファイルシステムフィルタードライバーよりも簡単に開発できるミニフィルタードライバーを作成できます。これにより、高品質で堅牢なドライバーを生成しながら、開発プロセスが短縮されます。

フィルターマネージャーは Windows と共にインストールされますが、ミニフィルタドライバーが読み込まれた場合にのみアクティブになります。 フィルターマネージャーは、ターゲットボリュームのファイルシステムスタックにアタッチします。 ミニフィルタードライバーはファイルシステムスタックに間接的にアタッチします。フィルタマネージャーに登録すると、ミニフィルタードライバーによってフィルター処理される i/o 操作が選択されます。

ミニフィルタードライバーは、特定の順序でアタッチされます。 添付ファイルの順序は、*高度*と呼ばれる一意の識別子によって決まります。 特定のボリューム上の特定の高度にミニフィルタードライバーを添付することを、ミニフィルタードライバーの*インスタンス*といいます。

ミニフィルタードライバーの高度を使用すると、ミニフィルタードライバーのインスタンスは、他のミニフィルタードライバーインスタンスとは関係なく、常に適切な場所に読み込まれます。また、フィルターマネージャーがミニフィルタードライバーを呼び出して、i/o を処理する順序を決定します。 階層は Microsoft によって割り当てられ、管理されます。

次の図は、フィルターマネージャーと3つのミニフィルタードライバーを使用した単純な i/o スタックを示しています。

![フィルターマネージャーと3つのミニフィルタードライバーを使用した単純な i/o スタックを示す図](images/filter-manager-architecture-1.gif)

ミニフィルタードライバーは、IRP ベースの i/o 操作だけでなく、高速 i/o およびファイルシステムフィルター (FSFilter) コールバック操作をフィルター処理できます。 フィルター処理の対象として選択された i/o 操作ごとに、ミニ[操作コールバックルーチン](writing-preoperation-and-postoperation-callback-routines.md)、postoperation コールバックルーチン、またはその両方を登録できます。 I/o 操作を処理する場合、フィルターマネージャーは、その操作に対して登録されているミニフィルタードライバーごとに適切なコールバックルーチンを呼び出します。 このコールバックルーチンが戻ると、フィルターマネージャーは、操作に対して登録された次のミニフィルタードライバーの適切なコールバックルーチンを呼び出します。

たとえば、上記の3つのすべてのミニフィルタードライバーが同じ i/o 操作に対して登録されている場合、フィルターマネージャーは、上位から下位 (A、B、C) の高度な順序で preoperation コールバックルーチンを呼び出し、その後の処理のために i/o 要求を次の下位のドライバーに転送します。 フィルターマネージャーは、完了のために i/o 要求を受信すると、各ミニフィルタードライバーの postoperation コールバックルーチンを逆順 (C、B、A) の逆の順序で呼び出します。

レガシフィルタードライバーとの相互運用性を確保するために、フィルターマネージャーは、複数の場所にあるファイルシステムの i/o スタックにフィルターデバイスオブジェクトをアタッチできます。 フィルターマネージャーの各デバイスオブジェクトは、*フレーム*と呼ばれます。 従来のフィルタードライバーの観点から見ると、各フィルターマネージャーフレームは、別のレガシフィルタードライバーにすぎません。

各フィルターマネージャーフレームは、高度な範囲を表します。 フィルターマネージャーでは、既存のフレームを調整したり、新しいフレームを作成して、ミニフィルタードライバーが適切な場所に接続されるようにすることができます。

フィルターマネージャーは、接続されている2つのレガシフィルターの間にフィルターマネージャーフレームが既に存在しない限り、ミニフィルターをアタッチできません。 ミニフィルターをレガシフィルターの上にアタッチすることを想定している場合は、2番目にアタッチされたレガシフィルターの存在に応じて、その下にアタッチできます。 レガシフィルターの下に接続するためのミニフィルターは、レガシフィルターよりも上にアタッチすることができます。

> [!IMPORTANT]
> レガシフィルターとミニフィルターの相互運用性を常に確認するか、レガシフィルターをミニフィルターに置き換えることを検討してください。 詳細については、「[レガシフィルタードライバーを移植するためのガイドライン](guidelines-for-porting-legacy-filter-drivers.md)」を参照してください。

ミニフィルタードライバーがアンロードされ、再読み込みされると、そのドライバーは、アンロードされた同じフレーム内の同じ高度に再読み込みされます。

次の図は、2つのフィルターマネージャーフレーム、ミニフィルタードライバーインスタンス、およびレガシフィルタードライバーを使用した単純な i/o スタックを示しています。

![2つのフィルターマネージャーフレーム、ミニフィルタードライバーインスタンス、およびレガシフィルタードライバーを使用した単純な i/o スタックを示す図](images/filter-manager-architecture-2.gif)
