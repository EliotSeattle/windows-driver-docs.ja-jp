---
title: フィルター マネージャーの概念
description: フィルター マネージャーの概念
ms.assetid: 5b11671f-02fd-4d0e-8199-c345bbf2591c
keywords:
- フィルター マネージャー WDK ファイル システム ミニフィルター、フィルター マネージャーについて
- ファイル システム ミニフィルターの高度 WDK
- フィルター マネージャー WDK ファイル システム ミニフィルター、アーキテクチャ
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 823a62f6203bc8b4713b9f478ff7dbde62d5f8b9
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56571819"
---
# <a name="filter-manager-concepts"></a>フィルター マネージャーの概念


## <span id="ddk_returning_status_from_a_minifilter_driverentry_routine_if"></span><span id="DDK_RETURNING_STATUS_FROM_A_MINIFILTER_DRIVERENTRY_ROUTINE_IF"></span>


フィルター マネージャーは、Windows と共にインストールされますが、アクティブ ミニフィルター ドライバーが読み込まれるときにのみになります。 フィルター マネージャーは、ターゲット ボリュームのファイル システム スタックにアタッチします。 ミニフィルター ドライバーにアタッチしないファイル システムのスタックを直接ミニフィルター ドライバーをフィルター処理することを選択する I/O 操作のフィルター マネージャーに登録するとします。

他のフィルター ドライバーを基準には、ファイル システム I/O スタック内のレガシ フィルター ドライバーの位置は、システムの起動時に、そのロード順序グループによって決まります。 たとえば、ウイルスを検出し、ファイルのリモート サーバーにレプリケートされる前にウイルスを駆除できますので、ウイルス対策フィルター ドライバーが、スタック内レプリケーション フィルター ドライバーを上回る必要があります。 そのため、ウイルス対策の FSFilter ロード順序グループのフィルター ドライバーは FSFilter レプリケーション グループのフィルター ドライバーの前に読み込まれます。 各ロード順序グループがシステム定義の対応するクラスとクラス GUID は、フィルター ドライバーの INF ファイルで使用します。

ミニフィルター ドライバーは、レガシ フィルター ドライバーのような特定の順序でアタッチします。 ただし、添付ファイルの順序と呼ばれる一意の識別子によって決定は、*高度*します。 特定のボリューム上の特定の高度でミニフィルター ドライバーの添付ファイルと呼ばれる、*インスタンス*ミニフィルター ドライバーの。

ミニフィルター ドライバーの高度によりミニフィルター ドライバーのインスタンスが常に他のミニフィルター ドライバーのインスタンスの基準とした適切な場所に読み込まれます、フィルター マネージャーがミニフィルター ドライバーを呼び出しで順序が決まりますI/O を処理します。 階層は Microsoft によって割り当てられ、管理されます。

次の図は、簡略化された I/O スタック フィルター マネージャーとミニフィルター ドライバーの 3 つを示します。

![フィルター マネージャーとミニフィルター ドライバーの 3 つの簡略化された i/o スタックを示す図](images/filter-manager-architecture-1.gif)

ミニフィルター ドライバーは IRP ベースの I/O 操作を高速な I/O とファイル システム フィルター (FSFilter) コールバック操作だけにフィルター処理できます。 ミニフィルター ドライバーをフィルター処理する I/O 操作のそれぞれについて、登録、 [preoperation コールバック ルーチン](writing-preoperation-and-postoperation-callback-routines.md)、postoperation コールバック ルーチンの場合、またはその両方です。 I/O 操作を処理するときに、フィルター マネージャーは、その操作に対して登録されている各ミニフィルター ドライバーの適切なコールバック ルーチンを呼び出します。 コールバック ルーチンから制御が戻るときに、フィルター マネージャーは、操作に登録されている次のミニフィルター ドライバーの適切なコールバック ルーチンを呼び出します。

たとえば、上の図と同じ I/O 操作に登録されているすべての 3 つのミニフィルター ドライバーと仮定すると、フィルター マネージャーとを最も低い (A、B、C)、高度の順序で高いものから、preoperation コールバック ルーチンを呼び出すし、I/O 要求を転送しますさらに処理するための次の下位ドライバー。 フィルター マネージャーは、完了の I/O 要求を受け取る、呼び出し各ミニフィルター ドライバーの postoperation コールバック ルーチン逆の順序で最も高い (C、B、A) にします。

レガシ フィルター ドライバーとの相互運用は、フィルター マネージャーは、1 つ以上の場所にファイル システム I/O スタックにデバイス オブジェクトをフィルターをアタッチできます。 フィルター マネージャーのデバイス オブジェクトをフィルターのそれぞれが呼び出されます、*フレーム*します。 レガシ フィルター ドライバーの観点からは、各フィルター マネージャーのフレームは、もう 1 つのレガシ フィルター ドライバーです。

各フィルター マネージャーのフレームでは、高度の範囲を表します。 フィルター マネージャーでは、既存のフレームを調整したり、正しい位置にアタッチするミニフィルター ドライバーを許可する新しいフレームを作成することができます。

フィルター マネージャーは、それらの間が既にフィルター マネージャーのフレームがない限り、接続されている 2 つのレガシ フィルター間ミニフィルターをアタッチできません。 ミニフィルター上レガシ フィルターをアタッチする場合はアタッチできます下にある、2 つ目の接続されているレガシ フィルターの有無に応じて。 ミニフィルターが以下のレガシ フィルターをアタッチするためのものは、レガシ フィルター上代わりに、接続されていることができます。

**重要な**  常にミニフィルターのレガシ フィルターの相互運用性を確認またはレガシ フィルターを置き換えてミニフィルターを検討してください。 詳細については、次を参照してください。[レガシ フィルター ドライバーを移植するためのガイドライン](guidelines-for-porting-legacy-filter-drivers.md)します。

 

ミニフィルター ドライバーをアンロードして再読み込みして場合、は、読み込み元のない同じフレームで同じ高度に再読み込みします。

次の図には、2 つのフィルター マネージャー フレーム、ミニフィルター ドライバー インスタンスでは、レガシ フィルター ドライバーと簡略化された I/O スタックが表示されます。

![2 つのフィルター マネージャー フレーム、ミニフィルター ドライバー インスタンスでは、レガシ フィルター ドライバーと簡略化された i/o スタックを示す図](images/filter-manager-architecture-2.gif)

 

 




