---
title: システム起動時のファイル システムの状態
description: システム起動時のファイル システムの状態
ms.assetid: f6ed556a-2353-4a0d-8db1-1fb5eac3c1ef
keywords:
- フィルタードライバー WDK ファイルシステム、ブートプロセス
- ファイルシステムフィルタードライバー WDK、ブートプロセス
- ファイルシステムドライバー WDK、ブートプロセス
- ファイルシステムレコグナイザー WDK
- FsRec WDK
- フィルタードライバー WDK ファイルシステム、ドライバーの読み込み
- ファイルシステムフィルタードライバー WDK、ドライバーの読み込み
- WDK ファイルシステムの読み込み中のドライバー
- ドライバー WDK ファイルシステムを読み込んでいます
- 読み込み順序グループ WDK ファイルシステム
- 再初期化ルーチン WDK ファイルシステム
- ブートドライバー WDK ファイルシステム
- ブート開始ドライバー WDK ファイルシステム
- グローバルファイルシステムキュー WDK ファイルシステム
- ファイルシステムキュー WDK
- WDK ファイルシステムをキューに置いてください
- FsRec
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 2a957b8de3f8dfcf1db484b41aeea47c9a591218
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72840934"
---
# <a name="what-happens-to-file-systems-during-system-boot"></a>システム起動時のファイル システムの状態


## <span id="ddk_what_happens_to_file_systems_during_system_boot_if"></span><span id="DDK_WHAT_HAPPENS_TO_FILE_SYSTEMS_DURING_SYSTEM_BOOT_IF"></span>


ファイルシステムは、システムの起動プロセス中に初期化されます。具体的には、i/o システムの初期化中に発生します。 I/o マネージャーは、グローバルファイルシステムキューを作成し、オペレーティングシステム (OS) ローダーおよび PnP マネージャーによって読み込まれたファイルシステムとフィルタードライバーを初期化します。

次に、ファイルシステムとフィルタードライバーの開発者にとって重要な、システムブートプロセスの選択部分の概要を示します。

1.  システムの起動時に、ローダーが制御をカーネルに転送する前に、OS ローダーによって、ブートファイルシステム、RAW ファイルシステム、および型のサービス\_ブート\_のすべてのドライバーが読み込まれます。 これらのドライバーは、カーネルが制御を取得するときにメモリ内にあります。

    ドライバーは、割り当てられている読み込み順序グループの順に読み込まれます。 ファイルシステムフィルターでは、新しいファイルシステムフィルタードライバーの読み込み順序グループのいずれかに割り当てられているものは、他のすべてのフィルタードライバーの前に読み込まれます。 これらの負荷順序グループの詳細については、「[ファイルシステムフィルタードライバーの読み込み順序グループ](load-order-groups-for-file-system-filter-drivers.md)」を参照してください。

    次に、"フィルター" 読み込み順序グループ内のすべてのドライバーが読み込まれます。 "フィルター" グループには、記憶域フィルタードライバーとファイルシステムフィルタードライバーが含まれており、サードパーティと組み込みのフィルタードライバーが含まれています。

2.  I/o マネージャーは、4つのセグメントを持つグローバルファイルシステムキューを作成します。1つは、CD-ROM、ディスク、テープデバイス、およびネットワークファイルシステム用です。 その後、各ファイルシステムが登録されると、そのコントロールデバイスオブジェクトが、このキューの適切なセグメントに追加されます。 ただし、この時点では、まだ登録されていないファイルシステムは存在しないため、キューは空です。

3.  PnP マネージャーは、RAW ファイルシステムの[**Driverentry**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-driver_initialize)ルーチンと、すべてのサービス\_ブート\_起動ドライバーを呼び出します。

    サービス\_ブート\_起動ドライバーが他のドライバーに依存している場合は、それらのドライバーも読み込まれて起動されます。

    PnP マネージャーは、ブートデバイスドライバーの[**AddDevice**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-driver_add_device)ルーチンを呼び出すことによって、ブートデバイスを起動します。 ブートデバイスに子デバイスがある場合は、それらのデバイスが列挙されます。 子デバイスは、ドライバーがブート開始ドライバーである場合にも構成され、開始されます。 デバイスのドライバーがすべてのブート開始ドライバーでない場合は、PnP マネージャーによってデバイスの devnode が作成されますが、デバイスは起動されません。

    この時点で、すべてのブートドライバーが読み込まれ、ブートデバイスが起動されます。

4.  PnP マネージャーは、PnP デバイスツリーを走査し、各 devnode に関連付けられているがまだ実行されていないドライバーを探して読み込みます。

    (PnP デバイスツリーの詳細については、「[デバイスツリー](https://docs.microsoft.com/windows-hardware/drivers/kernel/device-tree)」を参照してください)。各 PnP デバイスが起動すると、PnP マネージャーはデバイスの子を列挙します (存在する場合)。 PnP マネージャーは、子デバイスを構成し、デバイスドライバーを読み込んで、デバイスを起動します。

    PnP マネージャーは、ドライバーの**Starttype**、 **loadordergroup**、または**Dependencies**の値に*関係なく*、各デバイスのドライバーを読み込みます。

    このステップでは、pnp 管理者は、PnP で列挙可能なデバイスのみを構成して起動します。 デバイスが PnP で列挙可能でない場合、PnP マネージャーはデバイスを無視し、子デバイスが PnP で列挙可能であっても、そのデバイスの子を列挙しません。

5.  PnP マネージャは、まだ読み込まれていない種類の SERVICE\_SYSTEM\_START のドライバを読み込んで初期化します。

    ファイルシステムレコグナイザー (FsRec) は、現時点で読み込まれています。 これは、"ブートファイルシステム" の読み込み順序グループに含まれていますが、FsRec はブートファイルシステムではないことに注意してください。 実際のブートファイルシステム (ブートボリュームをマウントしたファイルシステム) は、ブートプロセスの開始時に読み込まれます。

    サービス\_システム\_開始フェーズでは、"ファイルシステム" の読み込み順序グループに含まれるファイルシステムが読み込まれます。 これには、名前付きパイプファイルシステム (NPFS) とメールスロットファイルシステム (MSFS) が含まれます。 これには、NTFS、FAT、CDFS、UDF などのメディアベースのファイルシステムは含まれません。

    "ネットワーク" 読み込み順序グループに含まれるネットワークファイルシステムも、このフェーズで読み込まれます。

6.  ブート時に読み込まれるすべてのドライバーが初期化されると、i/o マネージャーは、ドライバーを含むすべてのドライバーの再初期化ルーチンを呼び出します。 再*初期化ルーチン*は、ブートプロセスのこの時点で追加の処理時間を指定する必要があるブートドライバーによって登録されるコールバックルーチンです。 再初期化ルーチンは、 [**IoRegisterBootDriverReinitialization**](https://docs.microsoft.com/windows-hardware/drivers/ddi/ntddk/nf-ntddk-ioregisterbootdriverreinitialization)または[**IoRegisterDriverReinitialization**](https://docs.microsoft.com/windows-hardware/drivers/ddi/ntddk/nf-ntddk-ioregisterdriverreinitialization)を呼び出すことによって登録されます。

7.  サービスコントロールマネージャーが、まだ読み込まれていない種類のサービス\_自動\_開始のドライバーを読み込みます。

### <a name="span-idddk_file_system_recognizer_ifspanspan-idddk_file_system_recognizer_ifspanfile-system-recognizer"></a><span id="ddk_file_system_recognizer_if"></span><span id="DDK_FILE_SYSTEM_RECOGNIZER_IF"></span>ファイルシステムレコグナイザー

システムの起動後、システムに接続されているすべてのボリュームの記憶装置ドライバーが読み込まれ、起動されます。 ただし、すべての組み込みファイルシステムが読み込まれるわけではありません。すべてのファイルシステムボリュームがマウントされるわけではありません。 ファイルシステムレコグナイザー (FsRec) は、必要に応じてこれらのタスクを実行して、 [**IRP\_MJ\_CREATE**](https://docs.microsoft.com/windows-hardware/drivers/ifs/irp-mj-create)要求を処理します。

システムの起動時に、システム\_開始フェーズで\_FsRec が読み込まれます。 これは、"ブートファイルシステム" の読み込み順序グループに含まれていますが、FsRec はブートファイルシステムではないことに注意してください。 実際のブートファイルシステム (ブートボリュームをマウントしたファイルシステム) は、ブートプロセスの開始時に読み込まれます。

 

 




