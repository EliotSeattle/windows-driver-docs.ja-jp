---
title: ボリュームのマウントの例
description: ボリュームのマウントの例
ms.assetid: d6645d05-a945-4454-ac7c-122219bbdc50
keywords:
- フィルタードライバー WDK ファイルシステム、ボリュームマウントプロセス
- ファイルシステムフィルタードライバー WDK、ボリュームマウントプロセス
- ボリュームのマウント (WDK ファイルシステム)
- ボリューム WDK ファイルシステム、マウント
ms.date: 10/16/2019
ms.localizationpriority: medium
ms.openlocfilehash: 9d66e976134eb96690ef3db760dd7534ac1352c8
ms.sourcegitcommit: 8c898615009705db7633649a51bef27a25d72b26
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/07/2020
ms.locfileid: "78910448"
---
# <a name="volume-mount-example"></a>ボリュームのマウントの例

> [!NOTE]
> 最適な信頼性とパフォーマンスを得るには、従来のファイルシステムフィルタードライバーではなく、フィルターマネージャーをサポートする[ファイルシステムミニフィルタードライバー](https://docs.microsoft.com/windows-hardware/drivers/ifs/filter-manager-concepts)を使用します。 レガシドライバーをミニフィルタードライバーに移植する方法については、「[レガシフィルタードライバーを移植するためのガイドライン](guidelines-for-porting-legacy-filter-drivers.md)」を参照してください。

次の図は、ボリュームをマウントする前に、CDFS がどのように見えるかを示しています。 この例では、2つのフィルターが CDF コントロールデバイスオブジェクトに関連付けられています。 (注: CDFS コントロールデバイスオブジェクトを含むグローバルファイルシステムキューは表示されません)。

![ボリュームをマウントする前の cdfs を示す図](images/cdfsunmounted.png)

次の図は、まだ CDFS ボリュームとしてマウントされていない CD-ROM 記憶装置の一般的なドライバースタックを示しています。

![ボリュームをマウントする前の cd-rom 記憶装置スタックを示す図](images/cdromstack.png)

次の図は、CDFS ファイルシステムによって CD-ROM デバイスにボリュームがマウントされた後のファイルシステムドライバースタック、ボリュームスタック、および CD-ROM 記憶装置スタックの外観を示しています。

![マウントされた cdf ボリュームを示す図](images/cdfsmountedstacks.png)

前の図に関する注意事項を次に示します。

- CDFS コントロールデバイスオブジェクトは、ファイルシステムドライバースタックのベースを形成します。 ストレージデバイスにマウントされていないこのスタックは、Irp を直接受信できます。また、ファイルシステムフィルターデバイスオブジェクトを含めることもできます。 フィルターは、ボリュームのマウント ([**IRP_MJ_FILE_SYSTEM_CONTROL**](https://docs.microsoft.com/windows-hardware/drivers/ifs/irp-mj-file-system-control)、IRP_MN_MOUNT_VOLUME) 要求を監視するために、ファイルシステムコントロールのデバイスオブジェクトにアタッチします。 ファイルシステムコントロールデバイスオブジェクトには名前を付ける必要があります。 これにより、という名前ではないファイルシステムボリュームデバイスオブジェクトと区別されます。

- 図に示すように、CDFS ボリュームがマウントされた後で、CD-ROM 記憶装置スタックの一番上に2番目の記憶域フィルターをアタッチすることもできますが、このフィルターはファイルシステムスタックからストレージ d に渡される Irp を受信しません。e スタック。 ただし、ストレージデバイススタックに直接送信される任意の Irp を受信します。

- ファイルシステムによってボリュームがマウントされた後も、記憶装置スタックが Irp を直接受信できることに注意してください。 具体的には、電源 Irp (IRP_MJ_POWER) は、常にストレージデバイススタックに直接送信され、ファイルシステムスタックには送信されません。 (したがって、たとえば、ファイルシステムフィルタードライバーは、 **Driverentry**ルーチンで IRP_MJ_POWER のディスパッチルーチンを登録してはなりません)。

  ただし、PnP Irp ([**IRP_MJ_PNP**](https://docs.microsoft.com/windows-hardware/drivers/ifs/irp-mj-pnp)) はどちらのスタックにも送信できます。 ファイルシステムボリュームの上にチェーンされているフィルタードライバーは、既定では、これらの Irp を次の下位のドライバーに渡す必要があります。これは、ファイルシステムのボリュームデバイスが Irp を記憶装置スタックに渡すことができるようにするためです。
