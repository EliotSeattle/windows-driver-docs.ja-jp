---
title: ボリュームのマウント方法
description: ボリュームのマウント方法
ms.assetid: e8f39b06-9904-40e8-af52-eae310d11fa7
keywords:
- フィルタードライバー WDK ファイルシステム、ボリュームマウントプロセス
- ファイルシステムフィルタードライバー WDK、ボリュームマウントプロセス
- ボリュームのマウント (WDK ファイルシステム)
- ボリューム WDK ファイルシステム、マウント
ms.date: 10/16/2019
ms.localizationpriority: medium
ms.openlocfilehash: c0cfddf9d0de893b2bc37a30fa6276de95d1937d
ms.sourcegitcommit: 2a1c24db881ed843498001493c3ce202c9aa03f1
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/16/2019
ms.locfileid: "74128494"
---
# <a name="how-the-volume-is-mounted"></a>ボリュームのマウント方法

> [!NOTE]
> 最適な信頼性とパフォーマンスを得るには、従来のファイルシステムフィルタードライバーではなく、[ファイルシステムミニフィルタードライバー](filter-manager-and-minifilter-driver-architecture.md)を使用します。 レガシドライバーをミニフィルタードライバーに移植する方法については、「[レガシフィルタードライバーを移植するためのガイドライン](guidelines-for-porting-legacy-filter-drivers.md)」を参照してください。

ボリュームが[認識され](how-the-volume-is-recognized.md)た後、ボリュームがマウントされる方法は、ファイルシステムと、以前にボリュームがマウントされているかどうかによって異なります。

ファイルシステムは、新しいボリュームのボリュームマウント要求を受信すると、ボリュームのボリュームデバイスオブジェクト (VDO) を作成します。 VDO は、DEVICE_OBJECT と、オプションのファイルシステムで定義されたデバイス拡張機能で構成されます。 新しく作成された VDO は、新しい (または再マウントされた) ボリュームのファイルシステムボリュームスタックのベースを形成します。

ファイルシステムは、対応する記憶装置オブジェクトの VDO をボリュームパラメーターブロック (VPB) に関連付けて、ボリュームをマウントし、VPB に VPB_MOUNTED フラグを設定します。

ファイルシステムによってボリュームがマウントされると、ファイルシステムフィルタードライバーを新しいファイルシステムボリュームスタックの一番上にアタッチできます。 ファイルシステムに送信された i/o 要求は、最初にボリュームスタックの一番上のファイルシステムフィルターデバイスオブジェクトに自動的に送信されます。 ただし、ファイルシステムフィルターはボリュームスタックからデタッチするだけで済みます。 i/o マネージャーが高速 i/o デタッチ要求を送信すると、ボリュームが削除されようとしていることをボリュームスタック上に通知します。

例については、[ボリュームマウントの例](volume-mount-example.md)を参照してください。

> [!NOTE]
> ボリュームの記憶装置オブジェクトは記憶装置スタックに存在しますが、必ずしもスタック内の最上位のデバイスオブジェクトであるとは限りません。 さらに、ボリュームがマウントされた後でも、記憶域フィルタードライバーは記憶域スタックの一番上に接続できます。 ドライバーの作成者は、ファイルシステムが VDO からストレージデバイススタックに IRP を送信するときに、スタック内の最上位のデバイスオブジェクトではなく、ボリュームのストレージデバイスオブジェクトにその IRP を送信することに注意してください。 (ただし、i/o マネージャーが IRP を直接ストレージスタックに送信し、ファイルシステムをバイパスした場合、その IRP はスタック内の最上位のデバイスオブジェクトに送信されます)。
