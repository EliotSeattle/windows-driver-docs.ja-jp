---
title: レガシ ファイル システム フィルター ドライバーのブロック
description: Windows 10 バージョン1607以降では、管理者とドライバー開発者はレジストリ設定を使用して、レガシファイルシステムフィルタードライバーをブロックできます。
ms.assetid: 90A562FB-D616-4D38-8D4F-7EFCDF9E617F
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: ff3df20bcec1b04ecf7159ef6a1c020a9e326174
ms.sourcegitcommit: 677a9aeb3fb0c29fd8984f271fd803f15182fdb2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/24/2020
ms.locfileid: "80226524"
---
# <a name="blocking-legacy-file-system-filter-drivers"></a>レガシ ファイル システム フィルター ドライバーのブロック

Windows 10 バージョン1607以降では、管理者とドライバー開発者はレジストリ設定を使用して、レガシファイルシステムフィルタードライバーをブロックできます。 *レガシファイルシステムフィルタードライバー*は、ファイルシステムスタックに直接アタッチされるドライバーであり、フィルターマネージャーは使用しません。 このトピックでは、レガシファイルシステムフィルタードライバーをブロックおよびブロック解除するためのレジストリ設定について説明します。 また、レガシファイルシステムフィルターがブロックされたときにシステムイベントログに入力されたイベントについて説明し、OS でレガシファイルシステムドライバーが実行されているかどうかを確認する方法についても説明します。

> [!NOTE]
> 最適な信頼性とパフォーマンスを得るには、従来のファイルシステムフィルタードライバーではなく、フィルターマネージャーをサポートする[ファイルシステムミニフィルタードライバー](https://docs.microsoft.com/windows-hardware/drivers/ifs/filter-manager-concepts)を使用します。 レガシドライバーをミニフィルタードライバーに移植する方法については、「[レガシフィルタードライバーを移植するためのガイドライン](guidelines-for-porting-legacy-filter-drivers.md)」を参照してください。

## <a name="how-to-block-legacy-drivers"></a>レガシドライバーをブロックする方法

**IoBlockLegacyFsFilters**レジストリキーを使用して、システムがレガシファイルシステムフィルタードライバーをブロックするかどうかを指定します。 ブロックされると、すべてのレガシファイルシステムフィルタードライバーの読み込みがブロックされます。 レジストリの変更を有効にするには、システムの再起動を実行します。

レジストリキーは、次のレジストリパスの下に作成する必要があります。

``` syntax
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\I/O System
```

**IoBlockLegacyFsFilters**キーの有効な DWORD 値は次のとおりです。

| **IoBlockLegacyFsFilters**値 | 説明                                                                                       |
|----------------------------------|---------------------------------------------------------------------------------------------------|
| **1**                            | レガシファイルシステムフィルタードライバーは、記憶域ボリュームへの読み込みまたはアタッチがブロックされています。       |
| **0**                            | レガシファイルシステムフィルタードライバーはブロックされません。 このリリースでは、これが既定の動作です。 |

レジストリエディターでは、次のようなキーが表示されます。

![ioblocklegacyfsfilters レジストリキーを編集しています。](images/ioblockregkey.png)

## <a name="example-when-a-legacy-driver-is-blocked-from-loading"></a>例: レガシドライバーの読み込みがブロックされている場合

次に示すように、レガシファイルシステムフィルタードライバーの読み込みがブロックされると、**エラー**イベントがシステムイベントログに記録されます。

| イベントプロパティ | 説明 |
| -------------- | ----------- |
| ログの名前       | System      |
| Source         | Microsoft-Windows-カーネル-IO |
| 日付           | 12/29/2015 2:55:05 PM |
| イベント ID       | 1205         |
| タスク カテゴリ  | なし         |
| レベル          | エラー        |
| キーワード       |              |
| ユーザー           | CONTOSO\user |
| コンピューター       | user.domain.corp.contoso.com |
| 説明    | Windows は、レガシファイルシステムフィルターをブロックするように構成されています。 フィルター名: \Driver\sfilter |

## <a name="how-to-check-if-legacy-drivers-are-running"></a>レガシドライバーが実行されているかどうかを確認する方法

どのフィルターがレガシファイルシステムフィルタードライバーであるかがわからない場合、または実行されていないことを確認するには、次の操作を実行します。

1. **Cmd.exe**アイコンを右クリックし、 **[管理者として実行]** をクリックして、管理者特権でのコマンドプロンプトを開きます。
2. 型: `fltmc filters`
3. レガシドライバーを検索します。これは、**フレーム**値が **&lt;レガシ&gt;** のものです。

この例では、AVLegacy および EncryptionLegacy という名前のレガシファイルシステムフィルタードライバーは、 **&lt;従来の&gt;** フレーム値でマークされています。 AVMiniFilter という名前のファイルシステムドライバーには、ミニフィルタードライバー (ファイルシステムスタックに直接アタッチされず、フィルターマネージャーを使用) であるため、 **&lt;レガシ&gt;** フレーム値がありません。

``` syntax
C:\Windows\system32>fltmc filters

Filter Name                     Num Instances    Altitude    Frame
------------------------------  -------------  ------------  -----
AVLegacy                                        389998.99   <Legacy>
EncryptionLegacy                                149998.99   <Legacy>
AVMiniFilter                           3        328000         0
```

レガシドライバーが実行中であることがわかっている場合は、従来のファイルシステムフィルタードライバーをブロックした後で、 **IoBlockLegacyFsFilters**レジストリキーを設定した後にシステムを再起動してください。 この設定は、再起動後に有効になります。

システムでレガシファイルシステムフィルタードライバーが使用されている場合は、それぞれの Isv と連携して、ファイルシステムドライバーのミニフィルターバージョンを取得します。 フィルターマネージャーモデルを使用するミニフィルタードライバーに従来のファイルシステムフィルタードライバーを移植する方法の詳細については、「[レガシフィルタードライバーを移植するためのガイドライン](guidelines-for-porting-legacy-filter-drivers.md)」を参照してください。
