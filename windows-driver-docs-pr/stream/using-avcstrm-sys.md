---
title: Avcstrm.sys の使用
description: Avcstrm.sys の使用
ms.assetid: 53430526-ee24-4081-b220-4089d60aec94
keywords:
- フィルター ドライバー WDK AV/C のストリーミング
- AV/C WDK、Stream フィルター ドライバー
- フィルター ドライバー WDK AV/C を Stream
- Avcstrm.sys Avcstrm.sys ストリーミング フィルター ドライバーの詳細については、フィルター ドライバー WDK、ストリーミング
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: d74ef3d5f708d514fa2e8c8e575c9c15fc91f52a
ms.sourcegitcommit: 0cc5051945559a242d941a6f2799d161d8eba2a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "63323258"
---
# <a name="using-avcstrmsys"></a>Avcstrm.sys の使用





AV/C ストリーミング フィルター ドライバー、 *Avcstrm.sys*、そのクライアントのサブユニット ドライバーは、データ ストリームを作成した後にサービスを提供します。 3 つの関数を実行するデータ ストリームを分類することができます。 データのストリーミング、クロック プロバイダー、および取得およびストリーム プロパティまたはイベントの設定。 これら 3 つの関数は、相互に関連して、ストリームの状態 (停止、一時停止、または実行) は、データ ストリームの動作を制御します。

サブユニット ドライバーを最初に要求を*Avcstrm.sys*特定のデータ形式のストリームを作成します。 このデータ形式には、IEC 61883 - で使用される信号の形式の定義が含まれています。*x*プロトコルの仕様。 データ形式には、SDDV または MPEG2TS のいずれかを指定できます。 61883 プロトコルでは、1394 バス上のデータを送信する方法を定義します。 AV/C ストリーミング フィルター ドライバーは、検証しデータ形式は、キャッシュ化し、プラグインの情報など、ターゲット デバイスから使用可能なアイソクロナス リソースをクエリ要求のストリーミング データをキューに必要なリソースを割り当てます。

**注**  :Windows XP Service Pack 2 (SP2)、前に*Avcstrm.sys*接続を確立するために、ターゲット デバイスの最初の (インデックス 0) アイソクロナス プラグ ハンドルしか使用できませんでした。 この制限は同時に複数のストリームをサポートしているから AV/C デバイス (とその結果、ドライバー) は、複数のサブユニットで制限されています。 Windows XP SP2 以降では、ただし、 *Avcstrm.sys*が自動的に最小のインデックスから始まる AV C/デバイスのアイソクロナス プラグ ハンドルを選択し、セットアップに、1 つ以上のストリームをサポートするためにデバイスを有効に変更されました同時にします。
接続を確立して、AV/C 単位のサブユニット プラグの内部接続を最小のインデックスからアイソクロナスためプラグは、同じ順序に従う必要があります。 1 つだけのサブユニット AV/C デバイスまたは 1 つだけのアイソクロナス プラグを持つデバイスには影響しません。

 

ストリームが正常に作成、ストリームのコンテキストが返されます。 このコンテキストでは、データの形式やストリームの状態など、現在のストリームに関する情報を含む非透過構造体へのポインターです。

ストリームが作成された後、サブユニット ドライバーは、ダウン ストリームのデータ要求を送信を開始できます。 この要求はキューに登録し、個別の IRP を割り当てられに送信されます*61883.sys*データまたはデータ転送を受信するためです。 データ要求の完了したら、完了ルーチンが呼び出されます。 データ転送が、ストリームの状態とデータの可用性によって制御されるため、この要求は非同期です。

ストリーム データの要求が到着したとき、ストリームは一時停止中または実行のいずれかの状態にできます。 ストリームの一時停止状態アイソクロナス接続が行われます。 *Avcstrm.sys*要求*61883.sys*を必要な場合は、帯域幅とアイソクロナスのチャネルを割り当てたり、ストリームの実行状態に遷移します。

停止状態に遷移するときに、データ ストリームを停止します。 AV/C ストリーミング フィルター ドライバーはデータ バッファーをデタッチする 61883 を要求することによってデータ バッファーの所有権を解放します。 これらのデータ バッファーは状態で完了しましたが\_キャンセルします。

ストリームは、IOCTL ディスパッチ スレッドが終了した場合、突然デバイスの取り外しまたはデータ IRP キャンセルなどのイベント中に中止される必要があります。 停止状態に遷移すると、AV/C ストリーミング フィルター ドライバーは isochronous データ転送は停止しますが、ストリームの状態は変更されません。

フィルター ドライバーとして*Avcstrm.sys*をフィルター処理し、のみ、I/O 要求パケット (IRP) を処理し、 **MajorFunction** IRP の\_MJ\_内部\_デバイス\_コントロールと I/O 制御 (IOCTL) コードの IOCTL\_AVCSTRM\_クラス、および下位のスタックに他の Irp を通過します。 によって、要求は、AV/C ストリーミング フィルター ドライバーは、そのクライアントから IRP の処理され、61883 または AV/C プロトコル ドライバーのいずれかの下位のスタックからサービスを要求するための 1 つまたは複数のローカルに割り当てられた Irp が作成されます。 IRP のサブユニット ドライバーからは、下位のスタックに要求を送信することができます、にもかかわらずクラス ドライバーは IRP の所有権を要求する場合は、さまざまな IRP を作成することができます。

AV/C ストリーミング フィルター ドライバーは、61883 および AV/C stack でカーネル ストリーミング インターフェイスを使用する設計されています。 サブユニット ドライバーには AVStream または Stream のいずれかのクラス インターフェイスを使用できます。

次のセクションでは、各 AV/C ストリーミング機能のコマンドは、について説明しました (コード サンプルを使用して一部)。 コード サンプルは、Stream クラス ベースのサブユニット ドライバーです。

 

 




