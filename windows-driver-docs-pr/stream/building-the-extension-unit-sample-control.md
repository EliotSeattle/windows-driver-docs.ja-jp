---
title: 単位の拡張機能サンプル コントロールを作成
description: 単位の拡張機能サンプル コントロールを作成
ms.assetid: 57dd0bc3-2aab-42a2-b0c5-7f6ecaefd300
keywords:
- WDK USB ビデオ クラスを制御する拡張ユニット
- コントロールの WDK USB ビデオ クラス
ms.date: 01/30/2019
ms.localizationpriority: medium
ms.openlocfilehash: 522a9e5a433ec8c079212207954c9e45454f52ce
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56553562"
---
# <a name="building-the-extension-unit-sample-control"></a>単位の拡張機能サンプル コントロールを作成

UVC 拡張ユニット サンプル コントロールを作成するには、このセクションのコードをコンパイルすることができます。 このプロジェクトをビルドするときに取得し、拡張機能単位にプロパティを設定する、対応するアプリケーションで使用できる Microsoft ActiveX コントロールを作成します。

コントロールを使用するには、特定の拡張単位機能を実装するハードウェアが必要です。 または、USB エミュレーターを使用することができます。

コントロールをビルドするのにには、次の手順を使用します。

1. 次のパッケージをインストールします。

    - Microsoft Windows Server 2003 Service Pack 1 (SP1) の Driver Development Kit (DDK)
    - Microsoft DirectX 9.0 SDK の更新 (2005 年 2 月)
    - Microsoft DirectX 9.0 SDK Extras の 2005 年 2 月

2. 個々 のファイルに、次のトピックからのサンプル コードをコピーします。

    [UVC 拡張機能のユニットのインターフェイスのサンプル](sample-interface-for-uvc-extension-units.md)

    [サンプル拡張ユニット プラグイン DLL](sample-extension-unit-plug-in-dll.md)

    [UVC 拡張機能のユニットのレジストリ エントリの例](sample-registry-entry-for-uvc-extension-units.md)

    [UVC 拡張機能の単位用のサンプル アプリケーション](sample-application-for-uvc-extension-units.md)

    [拡張機能単位にイベントを自動更新をサポートしています。](supporting-autoupdate-events-with-extension-units.md)

    [UVC INF ファイルを提供します。](providing-a-uvc-inf-file.md)

3. 作成、*ソース*ファイルの次のようにします。

    ```cpp
    TARGETNAME= uvcxuplgn
    TARGETTYPE= DYNLINK
    TARGETPATH= obj
    TARGETEXT=  ax

    DLLENTRY=_DllMainCRTStartup
    DLLBASE=0x10080000
    USE_MSVCRT=1

    USE_STATIC_ATL=1

    USER_INCLUDES= $(O)

    INCLUDES=

    SOURCES= interface.idl \
     uvcxuplgn.cpp \
             stdafx.cpp    \
             interface_i.c \
             vidcap_i.c    \
             xuproxy.cpp

    TARGETLIBS= \
            $(SDK_LIB_PATH)\kernel32.lib          \
            $(SDK_LIB_PATH)\user32.lib            \
            $(SDK_LIB_PATH)\gdi32.lib             \
            $(SDK_LIB_PATH)\advapi32.lib          \
            $(SDK_LIB_PATH)\comdlg32.lib          \
            $(SDK_LIB_PATH)\ole32.lib             \
            $(SDK_LIB_PATH)\oleaut32.lib          \
            $(SDK_LIB_PATH)\uuid.lib              \
            $(SDK_LIB_PATH)\comctl32.lib
    ```

4. 作成、*メイクファイル*ファイルの次のようにします。

    ```cpp
    #############################################################################
    #
    #       Copyright (C) Microsoft Corporation 1995
    #       All Rights Reserved.
    #
    #       MAKEFILE for WDM device driver kit
    #
    #############################################################################

    #
    # DO NOT EDIT THIS FILE!!!  Edit .\sources. if you want to add a new source
    # file to this component.  This file merely indirects to the real make file
    # that is shared by all the driver components of the Windows NT DDK
    #

    !if "$(WIN2K_DDKBUILD)" == ""
    !INCLUDE $(NTMAKEENV)\makefile.def
    !endif
    ```

5. 使用して、 *Guidgen.exe* (Microsoft Windows SDK に含まれる) ツールの 3 つの Guid を作成します。

    - 拡張機能は、単位のプロパティ セットの ID として最初の GUID を使用します。 新しい GUID を GUID の x ベースのプレース ホルダーを置き換えます*Xuproxy.h、Xusample.rgs,Xuplgin.inf、* とハードウェア レベルで、拡張機能単位の記述子。
    - 拡張機能は、単位の IID として 2 つ目の GUID を使用します。 新しい GUID を GUID の y に基づくプレース ホルダーを置き換えます*Interface.idl*と*Xuplgin.inf*します。
    - クラス GUID (clsid) として 3 つ目の GUID を使用して、拡張機能は、単位の。 新しい GUID を GUID の z ベース プレース ホルダーを置き換えます*Xuplgin.inf、Xuproxy.h*、および*Xusample.rgs します。*

6. コピー *Extend.def* WIA からサンプルを拡張し、編集します。 *Uvcxuplugn.def*含める必要があります。

    ```cpp
    LIBRARY uvcxuplgn

    EXPORTS
        DllGetClassObject   PRIVATE
        DllCanUnloadNow     PRIVATE
        DllRegisterServer   PRIVATE
        DllUnregisterServer PRIVATE
    ```

7. 作成*Uvcxuplgn.cpp*次のようにします。

    ```cpp
    #include "stdafx.h"
    CComModule _Module;
    #include <initguid.h>
    #include "interface.h"
    #include "xuproxy.h"
    BEGIN_OBJECT_MAP(ObjectMap)
    OBJECT_ENTRY(CLSID_ExtensionUnit, CExtension)
    END_OBJECT_MAP()

    STDAPI DllRegisterServer(void)
    {
        return _Module.RegisterServer(FALSE, NULL);
    }

    STDAPI DllUnregisterServer(void)
    {
        return _Module.UnregisterServer();
    }

    EXTERN_C
    BOOL
    DllMain(
        HINSTANCE   hinst,
        DWORD       dwReason,
        LPVOID      lpReserved)
    {
        switch (dwReason) {
            case DLL_PROCESS_ATTACH:

                _Module.Init (ObjectMap, hinst);
                break;

            case DLL_PROCESS_DETACH:
                _Module.Term();
                break;
        }
        return TRUE;
    }

    extern "C" STDMETHODIMP DllCanUnloadNow(void)
    {
        return _Module.GetLockCount()==0 ? S_OK : S_FALSE;
    }

    extern "C" STDAPI DllGetClassObject(
        REFCLSID    rclsid,
        REFIID      riid,
        LPVOID      *ppv)
    {
        return _Module.GetClassObject(rclsid, riid, ppv);
    }
    ```

8. 作成*Stdafx.h*次のようにします。

    ```cpp
    // stdafx.h : include file for standard system include files,
    //      or project specific include files that are used frequently,
    //      but are changed infrequently

    #if !defined(AFX_STDAFX_H__722DC775_FE6F_42FB_BED5_E1E299976D17__INCLUDED_)
    #define AFX_STDAFX_H__722DC775_FE6F_42FB_BED5_E1E299976D17__INCLUDED_

    #if _MSC_VER > 1000
    #pragma once
    #endif // _MSC_VER > 1000

    #define STRICT
    #ifndef _WIN32_WINNT
    #define _WIN32_WINNT 0x0400
    #endif
    #define _ATL_APARTMENT_THREADED

    #include <atlbase.h>
    //You may derive a class from CComModule and use it if you want to override
    //something, but do not change the name of _Module
    extern CComModule _Module;
    #include <atlcom.h>
    #include <atlctl.h>

    //{{AFX_INSERT_LOCATION}}
    // Microsoft Visual C++ will insert additional declarations immediately before the previous line.

    #endif // !defined(AFX_STDAFX_H__722DC775_FE6F_42FB_BED5_E1E299976D17__INCLUDED)
    ```

9. 作成*Stdafx.cpp*次のようにします。

    ```cpp
    // stdafx.cpp : source file that includes just the standard includes
    //  stdafx.pch will be the pre-compiled header
    //  stdafx.obj will contain the pre-compiled type information

    #include "stdafx.h"

    #ifdef _ATL_STATIC_REGISTRY
    #include <statreg.h>
    #include <statreg.cpp>
    #endif

    #include <atlimpl.cpp>
    ```

10. ビルド - cZg WDK ビルド環境でを呼び出すことによって、サンプルをビルドします。
