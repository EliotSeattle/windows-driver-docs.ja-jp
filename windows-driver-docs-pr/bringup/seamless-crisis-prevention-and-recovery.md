---
title: シームレスな危機防止と回復
description: ファームウェアの更新に失敗した場合、結果は元に計り知れません。
ms.assetid: F002100E-2505-4CCB-B048-27D9CA1C8F3E
ms.date: 08/06/2018
ms.localizationpriority: medium
ms.openlocfilehash: 16834207ba494d9d5e68b3ecfbdbc7881ac9538d
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56530305"
---
# <a name="seamless-crisis-prevention-and-recovery"></a>シームレスな危機防止と回復


ファームウェアの更新に失敗した場合、結果は元に計り知れません。 せいぜい、更新プログラムは失敗しますが、システムが回復力のある、対応になるエンドユーザーせず回復します。 最悪の場合、エンドユーザー、販売店または製造元が修復のために、システムに戻す必要とする、完全に使用できないシステムに障害が発生したファームウェアの更新プログラムのことができます。 後者の場合は、いわゆる、*危機*します。

危機は、失敗したファームウェアの更新プログラム、またはファームウェアを Windows またはシステムの他の側面と互換性がないために結果します。 このセクションでは、回避し、結果のファームウェアの更新プログラムの失敗した危機から回復する機能について説明します。 ファームウェア更新プログラムのテスト カバレッジ、ファームウェアの作成者が危機に互換性のないファームウェアの結果の大部分を禁止する予想しています。

エンドユーザー向けの優れたエクスペリエンスを提供するためには、ファームウェア ドライバー パッケージの更新メカニズムの危機防止と回復の要件は、次を満たす必要があります。 これらの要件は、追加の危機の防止または復旧のソリューションを妨害しません。

## <a name="pre-installation-criteria"></a>インストール前の条件


システム ファームウェアを実行するときに、一連の事前インストール チェックを実行する必要がありますが、実際の更新プログラムがあります。 システム ファームウェア更新を完了するには、十分な能力があることを確認するには、このチェックを実行する必要があります。 複数のファームウェアの更新プログラムがある場合、更新プログラムが適用される前に、チェックを更新プログラムの各行われることをお勧めします。 確認および検証する項目の一覧を以下に示します。 該当する場合は、すべてのチェックを実行する必要があります。 テストの実行に特定の順序はありません。

<table>
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead>
<tr class="header">
<th>チェックの種類</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Power</td>
<td><ul>
<li>システムは 25% 以上が必要バッテリの残量。</li>
<li>テザリングされた電源 (電源の USB ケーブルを使用して) または AC 電源は必要ありません。</li>
</ul>
<div class="alert">
<strong>注</strong>  テスト/ラボではバッテリ存在まだも power テザリングされた場合に限り、ファームウェアの更新プログラムを許可がない環境が提供されます。 ただし、差別化は、配信不能/未充電バッテリおよびバッテリが存在ない間で行う必要があります。
</div>
<div>
 
</div></td>
</tr>
<tr class="even">
<td>セキュリティ</td>
<td><ul>
<li>更新プログラムを検証 capsule ペイロードを適切に署名します。</li>
<li>ペイロード内の PE ベースの EFI ファイルは、適切な EFI 証明書を持つ適切に署名を検証します。</li>
</ul></td>
</tr>
<tr class="odd">
<td>整合性</td>
<td><p>ファームウェアの更新プログラムのペイロードの整合性チェックを実行します。</p></td>
</tr>
<tr class="even">
<td>バージョン</td>
<td><p>LowestSupportedFirmwareVersion 値を上回る、インストールされている最新のファームウェアが適用されているファームウェアにダウン グレードできないことを確認します。</p></td>
</tr>
<tr class="odd">
<td>ストレージ</td>
<td><p>次のチェックが必要に応じて、システムのハードウェアによって実行されます。</p>
<ul>
<li>最新のファームウェアが置き換えられるのバックアップのための十分な余裕があります。</li>
<li>新しいファームウェアが対応するために、デバイスに十分なスペースがあります。</li>
</ul></td>
</tr>
</tbody>
</table>

 

前回の試行の状態の適切なエラー コード、エラーをすべて必要があります。 詳細については、の前回の試行の状態エラー コード情報を参照してください。 [ESRT テーブル定義](esrt-table-definition.md)と[ファームウェアの更新状態](firmware-update-status.md)します。

複数の更新プログラムを適用していると、インストール前のチェックに合格いくつかそうでないの場合、プラットフォーム ファームウェアはインストール前のチェックに合格するリソースのファームウェアの更新を続行できます。 ただし、インストール前のチェックに合格しなかったすべてのリソースは更新されませんする必要があります。

## <a name="post-installation-criteria"></a>インストール後の条件

(デバイスまたはシステム) のファームウェアがインストールされた後は、新しい更新されたファームウェア イメージでは、意図した動作ことを検証するチェックする必要があります。 これは、実際の更新プロセス (たとえば、という具合を更新中に、バス上の雑音、フラッシュの ROM に sticky ビット) の中に導入された、破損のリスクを軽減します。

更新プロセスでは、最新のファームウェアが整合性チェックに合格するを検証する必要があります。 失敗した場合は、ファームウェアの最後の既知の正常なバージョンにロールバックして回復する必要があります。

前回の試行の状態の適切なエラー コード、エラーをすべて必要があります。 詳細については、の前回の試行の状態エラー コード情報を参照してください。 [ESRT テーブル定義](esrt-table-definition.md)と[ファームウェアの更新状態](firmware-update-status.md)します。

## <a name="recovering-from-install-and-boot-failures"></a>インストールと起動の障害から回復します。

システムがブート不可能な状態に達することを防ぐためには、ファームウェアの更新メカニズムをインストールするファームウェアの更新プログラムが失敗した場合、またはシステムが、正常な起動失敗した場合は、次の要件を満たす必要があります。

> [!NOTE]
> 次のセクションでは、「コミット」という用語を使用して、ファームウェアを記述します。 「コミット」とファームウェア、ファームウェアは完全にインストールされているし、は自動的にロールバックされません起動時の障害などが原因のファームウェアによって処理されます。「コミットされていない」ファームウェア部分的に更新したファームウェアをについて説明し、ことができます可能性のあるロールバック以前のバージョンにファームウェアの更新を完了できませんやファームウェアを更新してエラーが検出される場合は (無効な CRC のチェックインなど、更新プログラム)。 ファームウェアがコミットされるかどうかは、ファームウェアが内部的には、追跡する必要があり、、ESRT の一部としてキャプチャされません。

### <a name="firmware-update-unsuccessful"></a>ファームウェア更新に失敗しました

などの最初の 3 つ (3) 試行、合計まで、更新プログラムが再試行される場合は、個々 のシステムまたはデバイスのファームウェアを使用するか、インストールすることはできませんが正しくインストールされていません (例: なんらかの破損、または更新プログラムのインストール中に停電) ため、しようとしました。 追加の再試行回数は、ファームウェアによって実行される場合、試行のいずれかの間での Windows にシステムが起動しない必要があります。 すべての試行が失敗した場合、更新のファームウェアは、更新プログラムを破棄しなければなりません。 部分的に更新プログラムが適用されている場合、ファームウェアを以前のバージョンにロールバックする必要があります。 ファームウェアをユーザーが介入せず、以前のバージョンにロールバックする必要があります。 更新の失敗では他の保留中の更新プログラム; 影響しません保留中のファームウェア更新を試行する必要があります。

すべての更新が処理された後、Windows のブート UEFI が再開されます。 UEFI ファームウェアは、(UEFI が部分的に書き込まれたファームウェア ブート Windows を試みる必要があることはありません)、停電による問題を軽減するには任意、コミットされていないファームウェアの更新プログラムが正しくインストールされていることを確認する必要があります。

インストール エラーの考えられる原因などが、これらに限定されません。

-   リソース不足
-   電力喪失が発生
-   ハードウェア障害

### <a name="firmware-update-succeeds-but-windows-fails-to-boot"></a>ファームウェアの更新は成功しますが、Windows が起動に失敗します。

UEFI ファームウェアは、コミットされた後にファームウェアの更新をロールバックするための責任ではありません。 Windows で既存のフェールオーバーのロジックが起動試行の 2 つの失敗した後、Windows 回復環境 (WinRE) をエンドユーザーに転送します。 WinRE は、正常に起動しない可能性があります。 エンドユーザーは、システムを回復する手動で回復の手順を実行する必要があります。 または販売店または製造元に自分のデバイスを返す必要があります。

このクラスは、エラーの考えられる原因などが、これらに限定されません。

-   ファームウェアの OS のドライバーと互換性がありません。
-   ファームウェアの OS コンポーネントと互換性がありません。

ハードウェア ベンダーは、Windows が正常に起動したかどうかを判断する追加のロジックの実装を決定したら、許容されることです。 前述のように、ファームウェア更新プログラムのテスト カバレッジ、ファームウェアの作成者が危機に互換性のないファームウェアの結果の大部分を禁止することを期待です。

## <a name="related-topics"></a>関連トピック
[ESRT テーブルの定義](esrt-table-definition.md)  
[プラグ アンド プレイ デバイス](plug-and-play-device.md)  
[更新プログラムのドライバー パッケージの作成](authoring-an-update-driver-package.md)  
[更新プログラムの処理](processing-updates.md)  
[UEFI 環境からデバイス I/O](device-i-o-from-the-uefi-environment.md)  
[ファームウェアの更新状態](firmware-update-status.md)  
