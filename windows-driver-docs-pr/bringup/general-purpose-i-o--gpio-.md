---
title: 汎用入出力 (GPIO)
description: チップ (SoC) 統合の回線でのシステムには、汎用の I/O (GPIO) ピンの広範な使用が確認されます。
ms.assetid: 9EB4EFC3-B94E-42C9-9FC7-12DF4AD01622
ms.date: 07/09/2018
ms.localizationpriority: medium
ms.openlocfilehash: b5f8da517665d4a0cc897ea82f8e2ccc69efa94f
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56558846"
---
# <a name="general-purpose-io-gpio"></a>汎用入出力 (GPIO)


チップ (SoC) 統合の回線でのシステムには、汎用の I/O (GPIO) ピンの広範な使用が確認されます。 SoC ベースのプラットフォームでは、Windows は、GPIO ハードウェアには、一般的な抽象化を定義し、この抽象化には、Advanced Configuration and Power Interface (ACPI) 名前空間からのサポートが必要です。

GPIO 抽象化ではサポートされて、 [ACPI 5.0 仕様](https://www.uefi.org/specifications)この記事に記載されている定義。

GPIO コント ローラーがすべての Windows プラットフォームの要件を満たしていることを確認するを参照してください。 [GPIO コント ローラーの要件のチェックリスト](gpio-controller-requirements-checklist.md)します。

## <a name="gpio-controller-devices"></a>GPIO コント ローラー デバイス


Windows には、GPIO コント ローラーがサポートされています。 GPIO コント ローラーは、周辺機器など割り込み、関数のさまざまな入力シグナル型、および出力シグナル通知を提供します。 GPIO 機能は、名前空間に GPIO コント ローラー デバイスとしてモデル化されます。 [GPIO フレームワーク拡張](https://docs.microsoft.com/windows-hardware/drivers/gpio/gpio-driver-support-overview)(GpioClx) として、いくつかのピンの銀行にパーティション分割されている、GPIO コント ローラーのデバイスをモデル化します。 各ピン bank には、64 個以下の構成可能なピンがあります。 GPIO コント ローラーで銀行は、コント ローラーの相対 GPIO ピンの領域内の自分の pin の位置を基準に並べ替えられています。 たとえば、銀行 0、コント ローラー 0 ~ 31 のピンが含まれています、銀行 1 では、ピン 32 ~ 63、具合が含まれています。 すべての銀行では、少ない可能性がある最後の銀行を除く、同じ数の pin があります。 銀行、ACPI ファームウェアの重要なファームウェアの銀行にシステムの割り込みリソースのマッピングを報告する必要がありますのでで説明したとおり**GPIO 名前空間オブジェクト**以下のセクション。

銀行では、各ピンには、pin の構成方法について説明するパラメーター (たとえば、出力、レベルに依存した割り込み、バウンス解除の入力およびなど) のセットがあります。

**GPIO コント ローラーと ActiveBoth 割り込み**

一部の GPIO コント ローラーの機能は、信号 (増大、または ActiveHigh エッジ、および以下にある、または ActiveLow エッジ) の両方の端の割り込みを生成する機能です。 これは、ボタンのインターフェイスの両方のボタン押下イベント (1 つの辺) を含む、アプリケーションのさまざまなで便利で、ボタン リリース イベント (反対側の端) は、意味のあります。 この機能は、"ActiveBoth"と呼ばれます。

論理的には、ActiveBoth 信号がある、アサートと unasserted 状態の両方が瞬間的なアサーション (たとえば、プッシュ ボタン)、またはアサーション (たとえば、ヘッドホンによる立体音響ジャックの挿入) を無限に長いかどうか。 ActiveBoth 割り込みの境界の検出では、GPIO コント ローラー ハードウェア (ハードウェア ActiveBoth) で実装される可能性や、GPIO ドライバー ソフトウェア (エミュレートされた ActiveBoth) でエミュレートします。 Windows では、エミュレートされた ActiveBoth が ActiveBoth を実装する GPIO コント ローラーを使用する必要があります。 これは、すべてのシナリオの長短割り込み堅牢に処理できるようにするために必要です。 ActiveBoth のエミュレーションをサポートするために、次のハードウェア要件が適用されます。

1.  ActiveBoth 割り込みをサポートする GPIO コント ローラーは、サポート レベル モードの割り込みをする必要があり、再実行時に動的に割り込みの極性のプログラミングをサポートする必要があります。
2.  I/O エラーのリスクを最小限に抑えるには、Windows は、GPIO コント ローラー SPB 接続 GPIO コント ローラーではなくメモリ マップの使用を優先します。 実際には、ボタン配列の Windows デバイス (PNP0C40) の場合は必要な GPIO、メモリ マップト コント ローラーと SPB 接続の 1 つがこのデバイスの ActiveBoth GPIO 割り込みに接続します。 ボタンの割り込みを判断する必要があります ActiveBoth を参照してください、**ボタン デバイス**sectionin、[名前空間オブジェクトの他の ACPI](other-acpi-namespace-objects.md)トピック。
3.  ActiveBoth 割り込みシグナルを確定的な初期状態を確立するために、Windows の GPIO デバイス スタックことが保証されます最初の割り込みシグナルの状態のドライバーでの割り込みの接続は必ず後に生成します。 さらに、スタックでは、ActiveBoth 割り込みのすべての行の状態が論理レベルである低 (ActiveLow edge) 既定では前提としています。 これはお使いのプラットフォームのケースではない場合、は、GPIO コント ローラー デバイス固有のメソッドを含めることで、既定値を上書きできます (\_DSM)、コント ローラーの名前空間。 この方法の詳細については、[GPIO コント ローラー デバイスに固有のメソッド (\_DSM)](gpio-controller-device-specific-method---dsm-.md)を参照してください。

> [!NOTE]
> 上記の 3 番目の要件は ActiveBoth を使用するデバイスのドライバーがあります (への接続) を初期化した直後に、割り込みを受信することを意味 GPIO ピン信号がアサートされている状態にある場合にその時点では、割り込みです。 これは可能であり、一部のデバイス (たとえば、ヘッドホン) も可能性がありますし、ドライバーでサポートする必要があります。

 

GPIO コント ローラーのドライバーをエミュレート ActiveBoth をサポートする ActiveBoth (「オプトインする」) を有効にする必要がありますエミュレーションを実装することによって、 [*クライアント\_ReconfigureInterrupt* ](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/gpioclx/nc-gpioclx-gpio_client_reconfigure_interrupt)コールバック関数、および設定、 **EmulateActiveBoth**フラグで基本的な情報が構造体をドライバーの[*クライアント\_QueryControllerBasicInformation* ](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/gpioclx/nc-gpioclx-gpio_client_query_controller_basic_information)にコールバック関数を提供する**GpioClx**します。 詳細については、[汎用入出力 (GPIO) ドライバー](https://docs.microsoft.com/windows-hardware/drivers/gpio)を参照してください。

## <a name="gpio-namespace-objects"></a>GPIO 名前空間のオブジェクト


GPIO コント ローラー、および、それらに接続するための周辺機器は、ACPI に列挙されます。 GPIO 接続リソースの記述子を使用して、それらの間の接続を説明します。 詳細については、ACPI 5.0 仕様のセクション 6.4.3.8、「接続記述子」を参照してください。

**デバイス id と構成オブジェクト**

GPIO コント ローラー デバイスの ACPI 名前空間には、次の項目が含まれます。

-   ベンダーが割り当てた ACPI に準拠したハードウェア ID (\_HID) オブジェクト。
-   消費されたリソースのセット (\_CRS) オブジェクト。
-   一意の ID (\_UID) オブジェクト、名前空間 (つまり、2 つ以上名前空間ノードを同じデバイスの id オブジェクトを持つ) に GPIO コント ローラーの 1 つ以上のインスタンスがある場合。

GPIO コント ローラーの\_CRS には、すべての GPIO コント ローラーで銀行で使用されるリソース (レジスタやシステムの割り込みのアドレス空間) のすべてが含まれています。 割り込みのリソースの銀行にマッピングがで割り込みリソースが表示される順序で表される、 \_CRS-は、表示されている最初の割り込みが 0 の銀行に割り当てられている、1、銀行に表示されている次の 1 つが割り当てられます。 銀行では、する場合は、割り込みが銀行の順序でそれに接続されている各銀行の 1 回が表示されており、共有として構成されている、割り込みリソースを共有できます。

**GPIO 接続リソース記述子**

周辺機器と GPIO ピンが接続されている間のリレーションシップは、オペレーティング システムに GPIO 接続リソース記述子によって記述されます。 これらのリソースの記述子には、GPIO 接続の 2 つの種類を定義できます。GPIO は、GPIO I/O 接続からの接続を中断します。 周辺機器に GPIO 接続記述子を含む、 \_GPIO I/O および割り込みのピンをすべての CR が接続されています。 接続されている割り込みがスリープ解除できる場合 (低電力アイドル状態からシステムをスリープ解除できる、ExclusiveAndWake または SharedAndWake として構成する必要があります。 詳細については、[デバイスの電源管理](device-power-management.md)を参照してください。

6.4.3.8.1、「GPIO 接続記述子」仕様のセクションで、ACPI 5.0、記述子が定義されます。 これらの記述子の ASL リソース テンプレートのマクロは 19.5.53、"GpioInt (GPIO 割り込み接続リソース記述子マクロ)"仕様のセクションで、ACPI 5.0 について説明します。

**GPIO シグナル ACPI イベント**

ACPI は、ハードウェアのイベントをシグナル状態にし、ACPI ドライバーに伝達し、プラットフォームに有効にするプラットフォーム イベント モデルを定義します。 Windows では、プラットフォームのイベントのデバイス ドライバーへの通信を行うための通知サービスを提供します。 いくつかの受信トレイのドライバーは、コントロール メソッドの電源ボタンなどの ACPI 定義されているデバイス、カバー デバイス、コントロール メソッド バッテリ、熱のゾーンのサポートを提供するには、このサービスに依存します。 通知の詳細については、ACPI 仕様のセクション 5.6.5、「GPIO-Signaled ACPI イベント」を参照してください。

SoC のプラットフォームでは、GPIO 割り込みは、プラットフォームのイベントを通知に使用されます。 ASL 通知演算子を使用して、そのドライバーにイベントを通知する名前空間デバイス (「ACPI イベント ソース」デバイス) では、次の項目が必要です。

-   ACPI イベントのシグナルが接続されている、GPIO コント ローラーの名前空間ノードは、ACPI イベント情報でその pin の GpioInt リソースを含める必要があります (\_AEI) オブジェクト (2.4.2.3.1 を参照してください"ACPI イベント情報 (\_AEI) オブジェクト", below) します。 GpioInt リソースは、非共有 (排他) として構成する必要があります。
-   コント ローラーのノードでは、エッジを含める必要がありますも (\_Exx)、レベル (\_Lxx) またはイベント (\_EVT) で表示されている各ピンの方法を制御、 \_AEI オブジェクト。

ACPI ドライバーでは、表示されている GPIO 割り込みを処理し、そのエッジ、レベル、またはイベントの制御メソッドを評価します。 コントロールのメソッドの休止ハードウェア イベント、必要に応じて、イベント ソース デバイスの名前空間ノードに必要な通知演算子を実行します。 次に、Windows は、デバイスのドライバーに通知を送信します。 イベントの制御メソッドは、どのイベントが発生したかを判断するためのハードウェアを照会できる場合、同じ GpioInt リソースに対して複数のイベントを信号通知できます。 メソッドは、通知の正しいコードを正しいデバイスを通知する必要があります。

*ACPI イベント情報 (\_AEI) オブジェクト*

前述のように、GPIO コント ローラーの名前空間を含める必要があります、 \_ACPI イベントをサポートするために AEI オブジェクト。 \_AEI オブジェクト (ACPI 5.0 仕様の 5.6.5.2」セクションを参照) は、ACPI イベントに関してこの GPIO コント ローラーを使用して、シグナルを GpioInt 記述子だけを含むリソース テンプレート バッファーを返します。 各記述子では、ACPI イベント ソースの 1 つのデバイスに対応し、(デバイス間で共有されません)、そのデバイスには専用します。

**GeneralPurposeIO 操作リージョン (OpRegions)**

GPIO コント ローラーは、任意の数の電源とのクロックの制御や、デバイスのモードを設定するなどのプラットフォーム ハードウェア機能をサポートするために多くの場合、プラットフォーム ファームウェアによって使用されます。 ASL 制御メソッドから GPIO I/O の使用をサポートするためには、ACPI 5.0 は、次のように新しい OpRegion 型"GeneralPurposeIO"を定義します。

GeneralPurposeIO OpRegions は、ドライバーは、I/O を処理する GPIO コント ローラー デバイスの名前空間のスコープ内で宣言されます (ACPI 5.0 仕様の 5.5.2.4.4」セクションを参照してください)。 GeneralPurposeIO フィールドの宣言では、GeneralPurposeIO OpRegion 内でアクセスされる GPIO ピンに名前を割り当てる (ACPI 5.0 仕様の 5.5.2.4.4.1」セクションを参照してください)。 GpioIO 接続リソースが (ACPI 5.0 仕様の 19.5.53」セクションを参照してください) は、特定のフィールド参照の構成と pin 番号を指定するフィールドの宣言内で使用されます。 次の接続の記述子フィールドの名前付きビットの合計数は、記述子で表示されている pin の数に等しくなければなりません。

OpRegion 内のフィールドは、名前空間で任意の場所に宣言し、名前空間内の任意のメソッドからアクセスできます。 GeneralPurposeIO OpRegion へのアクセスの方向では、最初のアクセス (読み取りまたは書き込み) が続くし、変更できません。

> [!NOTE]
> OpRegion アクセスは、GPIO コント ローラー デバイス ドライバー (「OpRegion ハンドラー」) によって提供される、ため、ドライバーが利用可能になるまで、OpRegion へのアクセスしないようにメソッドしてくださいする必要があります。 ASL コードは、領域を含めることによって、OpRegion ハンドラーの状態を追跡できます (\_REG)、GPIO コント ローラー デバイス (ACPI 5.0 仕様のセクション 6.5.4 参照) の下のメソッド。 さらに、OpRegion 依存関係 (\_DEP) を必要な場合は、GPIO OpRegion のフィールドへのアクセス メソッドを持つ任意のデバイスで使用できるオブジェクト (ACPI 5.0 仕様の 6.5.8」セクションを参照してください)。 参照してください、**デバイスの依存関係**セクション、[デバイス管理の名前空間オブジェクト](device-management-namespace-objects.md)を使用する場合の詳細についてはトピック\_DEP. ドライバーが割り当てられている GeneralPurposeIO OpRegions GPIO I/O リソースを割り当てられていないことが重要です。 Opregions は ASL 制御メソッドを排他的に使用します。

 
