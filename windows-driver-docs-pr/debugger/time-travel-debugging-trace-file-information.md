---
title: タイムトラベルデバッグ-トレースファイルの操作
description: このセクションでは、タイムトラベルトレースファイルを操作する方法について説明します。
ms.date: 04/15/2019
ms.localizationpriority: medium
ms.openlocfilehash: 10c88a2e945b41de34e8a524ea8a52278c844815
ms.sourcegitcommit: 8e8aa927cf4ab56d0af652fa5e988a8ed6967904
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/25/2019
ms.locfileid: "72916147"
---
# <a name="time-travel-debugging---working-with-trace-files"></a>タイムトラベルデバッグ-トレースファイルの操作

![時計を示す短いタイムトラベルロゴ](images/ttd-time-travel-debugging-logo.png) 

このセクションでは、タイムトラベルデバッグによって作成および使用されるファイルを操作する方法について説明します。

## <a name="trace-file-overview"></a>トレースファイルの概要

タイムトラベルデバッグでは、次のファイルを使用してコードの実行をデバッグします。

- トレースファイルには、コード実行の記録とが含まれています。実行拡張機能。

- インデックスファイルを使用すると、トレースファイル内の情報にすばやくアクセスし、を持つことができます。IDX 拡張。

- エラーの記録とその他の記録出力は、デバッガーのログファイルに書き込まれます。


## <a name="trace-run-files"></a>トレース.ファイルの実行  

トレース.実行ファイルは、**ファイル** > 使用して記録された後に開くことができます。**デバッグを開始** > **トレースファイルを開き**ます。

![開いているトレースオプションが強調表示されているファイルオープンオプション](images/ttd-start-debugging-options.png) 

既定では、すべてのトレース出力ファイルが users ドキュメントフォルダーに格納されます。 たとえば、User1 の場合、TTD ファイルは次の場所に格納されます。

```console
C:\Users\User1\Documents
```
記録を開始するときに、トレースファイルの場所を変更できます。 詳細については、「[タイムトラベルのデバッグ-記録](time-travel-debugging-record.md)」を参照してください。

最近使用したファイルの一覧では、以前に使用したターゲット構成ファイルにすばやくアクセスできます。 最近使用したトレースファイルまたはダンプファイルも一覧表示されます。 

![ファイルが開かれているの一覧です。最近使用した5つのトレースファイルを示すトレースファイルを実行します](images/ttd-recent-trace-files.png) 


## <a name="index-idx-files"></a>化.IDX ファイル  

インデックス。関連するトレースに対して IDX ファイルが作成されます。WinDbg プレビューでトレースファイルを開くときに、自動的にファイルを実行します。 インデックスファイルを手動で作成するには、! index コマンドを使用します。 インデックスを使用すると、トレース情報にすばやくアクセスできます。 

IDX ファイルは、通常、のサイズの2倍になることもあります。ファイルを実行します。  

## <a name="recreating-the-idx-file"></a>を再作成します。IDX ファイル
を再作成することができます。の IDX ファイル。`!index` コマンドを使用して、ファイルを実行します。 詳細については、「[タイムトラベルデバッグ-! インデックス (タイムトラベル)](time-travel-debugging-extension-index.md)」を参照してください。

```dbgcmd
0:0:001> !index
Indexed 3/3 keyframes
Successfully created the index in 49ms.
```

## <a name="sharing-ttd-trace-run-files"></a>TTD トレースを共有しています。ファイルの実行

TTD はローカルのみであり、別のコンピューターにリモート接続することはできません。

TTD トレースファイルは、をコピーすることで他のユーザーと共有できます。ファイルを実行します。 これは、同僚が問題を解明するのに役立つ場合があります。 クラッシュしたアプリをインストールしたり、他の関連するセットアップを実行して問題を再現したりする必要はありません。 トレースファイルを読み込んで、アプリが PC にインストールされているかのようにデバッグできます。

TTD トレースを再生するコンピューターは、レコードコンピューターで使用されたすべての命令 (AVX 命令など) をサポートする必要があります。

ファイルの名前を変更して、日付やバグ番号などの追加情報を含めることができます。

、.IDX ファイルは、前述のように! index コマンドを使用して再作成できるため、コピーする必要はありません。

> [!TIP]
> 他のユーザーと共同作業する場合は、問題に関連する関連するトレースの位置を手動で渡します。 コラボレーターは、`!tt x:y` コマンドを使用して、コードの実行の正確な時点に移動できます。 時間位置の範囲をバグの説明に含めて、発生する可能性のある問題を追跡することができます。
>


## <a name="error---log-file"></a>エラー-ログファイル

エラーの記録とその他の記録出力は、デバッガーのログファイルに書き込まれます。 ログファイルを表示するには、[ > **ログ**の**表示**] を選択します。 

この例では、C:\Windows ディレクトリにない Foo .exe という名前の実行可能ファイルを起動して記録しようとしたときのエラーログテキストを示しています。

```console
2017-09-21:17:18:10:320 : Information : DbgXUI.dll : TTD: Output: 
Microsoft (R) TTD 1.01.02
Release: 10.0.16366.1000
Copyright (C) Microsoft Corporation. All rights reserved.
Launching C:\Windows\Foo.exe
2017-09-21:17:18:10:320 : Error : DbgXUI.dll : TTD: Errors: 
Error: Trace of C:\Windows\Foo.exe PID:0 did not complete successfully: status:27
Error: Could not open 'Foo.exe'; file not found.
Error: Corrupted trace dumped to C:\Users\User1\Documents\Foo01.run.err.
```



## <a name="trace-file-size"></a>トレースファイルのサイズ

TTD トレースファイルは非常に大きくなる可能性があるため、十分な空きディスク領域があることを確認することが重要です。  わずか数分でアプリまたはプロセスを記録する場合、トレースファイルのサイズが数ギガバイトになることがあります。  トレースファイルのサイズは、以下で説明するさまざまな要因に依存します。  

TTD では、実行時間の長い複雑なシナリオに対応できるように、トレースファイルの最大サイズを設定しません。 問題をすばやく再作成すると、トレースファイルのサイズはできるだけ小さくなります。
 
### <a name="trace-file-size-factors"></a>トレースファイルサイズの要因

トレースファイルのサイズを正確に推定することはできませんが、TTD ファイルのサイズを理解するのに役立ついくつかの経験則があります。

トレースファイルのサイズに影響する可能性がある要因は次のとおりです。

- 実行中のアプリまたはプロセスを記録するときに、すべてのスレッドで実行されたコード命令の数
- アプリまたはプロセスが記録された時間の長さ (記録されたコード命令の数に影響する場合のみ)
- アプリまたはプロセスによって使用されるメモリデータのサイズ
 
実行および記録された命令の数は、トレースファイルのサイズに影響する最大の要因になります。  通常、トレースでは、命令の実行ごとに1ビットと1バイトが必要です。  記録されたプログラムが少数の個別の関数を実行し、より小さなデータセットを操作する場合、トレースはその範囲の下限になる可能性が高くなります。  記録されたプログラムが多数の個別の関数を実行したり、より大きなデータセットを操作したりする場合、トレースはその範囲の上限を超えている可能性があります。
 
### <a name="trace-file-size-rule-of-thumb"></a>Thumb のトレースファイルサイズルール

トレースファイルは、上で識別されたトレースファイルサイズの要因に応じて、アクティブなアプリまたはプロセスを記録するときに、約 5 MB から 50 MB に拡張されます。

記録されているアプリまたはプロセスがアイドル状態になっている場合 (入力を待機している場合など)、トレースファイルは拡張されません。

現在、トレースファイルの最大ファイルサイズの制限はありません。  WinDbg Preview では、サイズが数百 gb のトレースファイルを再生できます。
 
### <a name="index-file-size"></a>インデックスファイルのサイズ

インデックスファイルは、初めてトレースを開いたときに、WinDbg Preview によって自動的に作成されます。  これには、デバッガーがトレースを再生し、メモリに関する情報をより効率的に照会するのに役立つ情報が含まれています。  このサイズは、通常、トレースファイルのサイズの 1 ~ 2 倍の範囲です。  サイズに影響を与える要因は、トレースファイルのサイズに影響を与える要因に似ています。
 
まず、インデックスファイルのサイズは、トレースの長さに合わせてスケーリングされます。  記録された命令の数が多いトレースでは、通常、インデックスのサイズが大きくなります。
 
次に、インデックスのサイズは、メモリアクセスの幅を基準にしてスケーリングします。  記録されたプログラムに頻繁に異なるメモリ位置が頻繁にアクセスされた場合、通常は、記録されたプログラムがアクセスするメモリの場所が少ない場合や、メモリの場所へのアクセス頻度が低い場合に、インデックスが大きくなります。
 
これらの要因は、トレースファイルのサイズに影響する要因に似ているため、通常、インデックスファイルのサイズは、インデックスファイルのサイズに合わせてスケーリングされます (したがって、通常、トレースファイルのサイズの2倍になると推定されます)。
 
### <a name="what-if-i-run-out-of-disk-space"></a>ディスク領域が不足している場合はどうすればよいですか。

TTD トレースファイルとインデックスファイルの両方がディスクに書き込まれます。 現在、トレースファイルまたはインデックスファイルの最大ファイルサイズの制限はありません。 トレースファイルは、記録を停止するか、使用可能なディスク領域の量を超えない限り、サイズが大きくなります。
 
*記録中:* TTD は、トレースファイルに最後のページを書き込み、再び書き込むことができるようになるまで実際に待機します。 WinDbg では引き続き [記録] ダイアログが表示されますが、録画中にディスク領域が不足しても、エラーや警告メッセージは表示されません。  

記録中にディスク領域が不足すると、コード実行の記録が不完全なトレースファイルが生成されます。 不完全なトレースファイルは WinDbg Preview で開くことができますが、トレースファイルの書き込み時にディスク領域が不足した後にエラーが発生した場合は、実際の問題が含まれていない可能性があります。

回避策: エクスプローラーを開き、ディスク (C: ドライブ) の空き領域がゼロに近づいているかどうかを確認します。 または、トレース () を監視します。ファイルエクスプローラーでファイルを実行します (既定ではドキュメントフォルダーにあります)。サイズが定期的に拡張されていない場合は、記録を待機している可能性があります。 WinDbg の [停止とデバッグ] ボタンをクリックし、空き領域を解放するか、別のディスクに保存してから、もう一度記録を開始します。
 
*インデックス作成中:* デバッガーで無効なインデックスファイルが生成されたため、デバッガーで予期しない動作が発生したか、またはデバッガーエンジンホストがクラッシュする可能性があります。

回避策: デバッガーを終了し、トレースに存在する可能性のあるすべてのインデックスファイル (idx) を削除します。  十分なディスク領域を確保するか、十分な空き領域がある別のディスクにトレースファイルを移動してください。  デバッガーでもう一度トレースを開き、! index を実行して新しい正しいインデックスを作成します。  インデックスを作成しても元のトレースファイル (. run) は変更されないため、データは失われません。

## <a name="see-also"></a>参照

[タイムトラベルのデバッグ-概要](time-travel-debugging-overview.md)
