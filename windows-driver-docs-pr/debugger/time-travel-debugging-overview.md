---
title: Time Travel Debugging - 概要
description: ここでは、タイムトラベルのデバッグについて説明します。
ms.date: 01/17/2020
ms.localizationpriority: medium
ms.openlocfilehash: e4ad96885aa56f6d6a53c63f4a20c10ec4bfe64a
ms.sourcegitcommit: ee70846334ab6710ec0f9143e9f3a3754bc69f98
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/23/2020
ms.locfileid: "76706952"
---
# <a name="time-travel-debugging---overview"></a>Time Travel Debugging - 概要

![時計を示す短いタイムトラベルロゴ](images/ttd-time-travel-debugging-logo.png) 

## <a name="what-is-time-travel-debugging"></a>タイムトラベルのデバッグとは

タイムトラベルデバッグは、実行中のプロセスの実行を記録し、後で前後に再生できるツールです。 タイムトラベルデバッグ (TTD) を使用すると、バグが見つかるまで問題を再現するのではなく、デバッガーセッションを "巻き戻し" することで、問題を簡単にデバッグできます。 

TTD を使用すると、バグにつながる条件をより深く理解し、それを複数回再生して問題の解決に最適な方法を知ることができます。 

TTD には、クラッシュダンプファイルよりも利点があります。多くの場合、最終的な障害につながるコード実行が欠落しています。  

問題を自分で確認できない場合は、そのトレースを共同作業者と共有することができます。これにより、探しているものを正確に調べることができます。 これにより、ライブデバッグよりも簡単にコラボレーションできます。記録された指示は同じであり、アドレスの場所とコードの実行は Pc によって異なります。 また、特定の時点を共有して、同僚がどこから始めればよいかを判断することもできます。

TTD は効率的であり、トレースファイルでコードの実行をキャプチャするので、可能な限り少ないオーバーヘッドを追加します。  

TTD には、LINQ を使用してトレースに対してクエリを実行できるようにする一連のデバッガーデータモデルオブジェクトが含まれています。 たとえば、TTD オブジェクトを使用して、特定のコードモジュールが読み込まれた日時を検索したり、すべての例外を検索したりできます。

![タイムトラベルコマンドと3つのタイムラインを示す WinDbg プレビューのスクリーンショットの例](images/ttd-windbgx-screen-shot-example.png)

## <a name="comparison-of-debugging-tools"></a>デバッグツールの比較

次の表は、使用可能なさまざまなデバッグソリューションの長所と短所をまとめたものです。

|          アプローチ           |                                                      長所                                                       |                                                                                                               短所                                                                                                                |
|-----------------------------|-----------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|       ライブ デバッグ        |   対話型エクスペリエンスでは、実行フローが表示され、ターゲットの状態を変更できます。また、使い慣れた設定で使い慣れたツールを使用できます。   | ユーザーエクスペリエンスを中断すると、問題を繰り返し再現するために労力が必要になる場合があります。運用システムのオプションではなく、セキュリティに影響を与える可能性があります。  再現が困難な点から、原因を特定することが難しくなっています。 |
|            ダンプ            |                            トリガーに基づく先行する割り込み、低レベルのコーディングは不要です。                             |                                                          連続したスナップショットまたはライブダンプは、単純な "時間の経過" ビューを提供します。 使用しない場合、実質的にはオーバーヘッドがゼロになります。                                                           |
|      テレメトリ & ログ       |            軽量。多くの場合、ビジネスシナリオ/ユーザーアクション、機械学習のフレンドリに関連付けられています。             |                                                         予期しないコードパス (テレメトリなし) で問題が発生しています。 データの深さが不足しています。コードに静的にコンパイルされています。                                                         |
| タイムトラベルデバッグ (TTD) | 複雑なバグ、先行コーディング、オフラインの反復可能なデバッグ、分析のフレンドリー、すべてをキャプチャすることができます。 |                                                                 記録時に大きなオーバーヘッドが発生します。 では、必要なデータがさらに収集される場合があります。 データファイルが大きくなることがあります。                                                                 |

## <a name="ttd-availability"></a>TTD の可用性 

TTD は、ストアからの WinDbg Preview アプリのインストール後に、Windows 10 で使用できます。  WinDbg Preview は、最新のビジュアル、より高速なウィンドウ、高度なスクリプト操作、拡張可能なデバッガーデータモデルに対する組み込みのサポートを備えた、WinDbg の改良されたバージョンです。 ストアからの WinDbg Preview のダウンロードの詳細については、「 [Windbg Preview を使用したデバッグ](debugging-using-windbg-preview.md)」を参照してください。

## <a name="administrator-rights-required-to-use-ttd"></a>TTD を使用するために必要な管理者権限

TTD を使用するには、デバッガーを管理者特権で実行する必要があります。 管理者特権を持つアカウントを使用して WinDbg Preview をインストールし、そのアカウントをデバッガーで記録するときに使用します。 デバッガーを管理者特権で実行するには、[スタート] メニューの [WinDbg Preview] アイコンを右クリックし、[詳細] を選択して [管理者として実行] を選択 > ます。

## <a name="video-training"></a>ビデオ トレーニング

TTD の詳細については、次のビデオを参照してください。

[デフラグツール 185](https://channel9.msdn.com/Shows/Defrag-Tools/Defrag-Tools-185-Time-Travel-Debugging-Introduction) -Ivette と JamesP は、TTD の基礎と、WinDbg Preview のいくつかの機能のデモを行います。

[デフラグツール 186](https://channel9.msdn.com/Shows/Defrag-Tools/Defrag-Tools-186-Time-Travel-Debugging-Advanced) -JORDI と jcab デモでは、WinDbg Preview における TTD の優れた機能を紹介します。

[Cppcon (YouTube)](https://www.youtube.com/watch?v=l1YJTg_A914) -Jordi、Ken、および JamesM は、TTD の WinDbg Preview で、cppcon 2017 に記載されています。

## <a name="trace-file-basics"></a>トレースファイルの基本

### <a name="trace-file-size"></a>トレースファイルのサイズ

トレースファイルは大きくなる可能性があり、TTD のユーザーは、十分な空き領域があることを確認する必要があります。 プログラムを数分で記録する場合、トレースファイルのサイズが数ギガバイトになることがあります。 TTD では、実行時間の長い複雑なシナリオに対応できるように、トレースファイルの最大サイズを設定しません。 問題をすばやく再作成すると、トレースファイルのサイズはできるだけ小さくなります。

### <a name="trace-and-index-files"></a>トレースファイルとインデックスファイル

トレース (.RUN) 記録中にコードの実行を保存します。 

記録が停止したら、インデックス (.IDX) ファイルを作成して、トレース情報にすばやくアクセスできるようにします。 また、WinDbg Preview がトレースファイルを開いたときにも、インデックスファイルが自動的に作成されます。

インデックスファイルは、通常、トレースファイルのサイズが大きい場合もあります。  

! Tt. index コマンドを使用して、トレースファイルからインデックスファイルを再作成できます。

```dbgcmd
0:000> !tt.index
Successfully created the index in 10ms.
```

エラーとその他の記録出力は、WinDbg ログファイルに書き込まれます。

すべての出力ファイルは、ユーザーによって構成された場所に格納されます。 既定の場所は、users ドキュメントフォルダー内にあります。 たとえば、User1 の場合、TTD ファイルは次の場所に格納されます。

```console
C:\Users\User1\Documents
```

トレースファイルの操作の詳細については、「[タイムトラベルデバッグ-トレースファイルの操作](time-travel-debugging-trace-file-information.md)」を参照してください。

## <a name="things-to-look-out-for"></a>検索する項目

### <a name="anti-virus-incompatibilities"></a>ウイルス対策非互換性

TTD がプロセスにフックして記録する方法によって、非互換性が発生する可能性があります。 通常、ウイルス対策またはシステムメモリの呼び出しを追跡し、シャドウするシステムソフトウェアで問題が発生します。 不十分なアクセス許可のメッセージなど、記録に関する問題が発生した場合は、ウイルス対策ソフトウェアを一時的に無効にしてみてください。  

メモリアクセスをブロックするその他のユーティリティは、Microsoft Enhanced 軽減エクスペリエンスツールキットなど、問題になることもあります。 EMET の詳細については、「 [Enhanced 軽減エクスペリエンスツールキット](https://support.microsoft.com/help/2458544/the-enhanced-mitigation-experience-toolkit)」を参照してください。

TTD と競合する環境のもう1つの例は、電子アプリケーションフレームワークです。 この場合、トレースは記録されますが、記録されているプロセスのデッドロックまたはクラッシュが発生する可能性もあります。

### <a name="user-mode-only"></a>ユーザーモードのみ

TTD では現在、ユーザーモードの操作のみがサポートされているため、カーネルモードプロセスをトレースすることはできません。 

### <a name="read-only-playback"></a>読み取り専用の再生

時間をさかのぼって戻すことはできますが、履歴を変更することはできません。 メモリの読み取りコマンドは使用できますが、変更またはメモリに書き込むコマンドを使用することはできません。

### <a name="system-protected-processes"></a>システムで保護されたプロセス

保護されたプロセス (PPL) プロセスなど、一部の Windows システム保護プロセスは保護されているため、TTD はそれ自体を保護されたプロセスに挿入してコード実行の記録を許可することはできません。

### <a name="performance-impact-of-recording"></a>記録のパフォーマンスへの影響

アプリケーションやプロセスを記録することは、PC のパフォーマンスに影響します。 実際のパフォーマンスのオーバーヘッドは、記録中に実行されるコードの量と種類によって異なります。 一般的な記録シナリオでは、20倍のパフォーマンスの低下が発生することが予想されます。 場合によっては、パフォーマンスが著しく低下することはありませんが、リソースを集中的に使用する操作 (ファイルを開くダイアログなど) では、記録の影響を確認できます。

### <a name="trace-file-errors"></a>トレースファイルエラー

トレースファイルエラーが発生する可能性がある場合もあります。 詳細については、「[タイムトラベルデバッグ-トラブルシューティング](time-travel-debugging-troubleshooting.md)」を参照してください。

## <a name="advanced-features-of-time-travel-debugging"></a>タイムトラベルデバッグの高度な機能

最も注目すべき TTD 高度な機能の一部を次に示します。

### <a name="timelines"></a>所要時間

タイムラインは、実行中に発生するイベントを視覚的に表現したものです。 これらのイベントの場所は、ブレークポイント、メモリ読み取り/書き込み、関数呼び出しと戻り値、および例外です。 タイムラインの詳細については、「 [WinDbg Preview-タイムライン](windbg-timeline-preview.md)」を参照してください。

### <a name="debugger-data-model-support"></a>デバッガーデータモデルのサポート

- **組み込みのデータモデルのサポート**-TTD には、データモデルのサポートが含まれています。 LINQ クエリを使用してアプリケーションエラーを分析することは、強力なツールです。 WinDbg Preview の [データモデル] ウィンドウを使用すると、"dx" と "dx" の展開可能なバージョンと参照できるバージョンを操作できます。これにより、NatVis、JavaScript、および LINQ クエリを使用してテーブルを作成できます。

デバッガーデータモデルに関する一般的な情報については、「 [WinDbg プレビュー-データモデル](windbg-data-model-preview.md)」を参照してください。 TTD debugger オブジェクトモデルの操作の詳細については、「[タイムトラベルデバッグ-タイムトラベルデバッグオブジェクトの概要](time-travel-debugging-object-model.md)」を参照してください。

### <a name="scripting-support"></a>スクリプトのサポート  

- **スクリプトの自動化**-JavaScript と NatVis のスクリプトによるサポートにより、問題の調査を自動化できます。 詳細については、「[タイムトラベルデバッグ-JavaScript オートメーション](time-travel-debugging-javascript-automation.md)」を参照してください。

JavaScript と NatVis の操作に関する一般的な情報については、「 [WinDbg Preview-Scripting](windbg-scripting-preview.md)」を参照してください。

### <a name="managed-code-ttd-support"></a>マネージコード TTD のサポート

64ビットモードで実行されている SOS デバッガー拡張 (sos) を使用して、WinDbg Preview の TTD を使用してマネージコードをデバッグできます。 詳細については、「 [Windows デバッガーを使用したマネージコードのデバッグ](debugging-uwp-apps-using-the-windows-debugger.md)」を参照してください。

## <a name="span-idprovidingfeedbackspanproviding-feedback"></a><span id="providingfeedback"></span>フィードバックの提供

お客様のご意見をお寄せいただくと、今後の旅開発の優先度についてご案内します。

- 実現を希望される機能や問題の原因となっているバグなどのフィードバックがある場合は、フィードバック Hub をご利用ください。

![[新しいフィードバックの追加] ボタンを含むフィードバック オプションを示すフィードバック Hub のスクリーンショット](images/windbgx-feedback.png)


## <a name="getting-started-with-ttd"></a>TTD の概要

トレースファイルの記録と再生、およびトレースファイルとトラブルシューティングの操作の詳細については、これらのトピックを確認してください。

- [タイムトラベルデバッグ-トレースを記録する](time-travel-debugging-record.md)
- [タイムトラベルデバッグ-トレースを再生する](time-travel-debugging-replay.md)
- [タイムトラベルデバッグ-トレースファイルの操作](time-travel-debugging-trace-file-information.md)
- [タイムトラベルデバッグ-トラブルシューティング](time-travel-debugging-troubleshooting.md)
- [タイムトラベルデバッグ-サンプルアプリのチュートリアル](time-travel-debugging-walkthrough.md)

これらのトピックでは、タイムトラベルデバッグの追加の高度な機能について説明します。 

- [タイムトラベルデバッグ-タイムトラベルデバッグオブジェクトの概要](time-travel-debugging-object-model.md)
- [タイムトラベルデバッグ-JavaScript オートメーション](time-travel-debugging-javascript-automation.md)
