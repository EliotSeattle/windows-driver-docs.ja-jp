---
Description: このトピックには、最初は U1 および U2 の遷移を有効にするソフトウェアによって行われ、次のハードウェアでこれらの遷移が発生する方法を説明しますが、初期セットアップがについて説明します。
title: U1 および U2 の移行
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 3e8cc5f049fcc6da78c0fb140f81e7bcece05522
ms.sourcegitcommit: 0cc5051945559a242d941a6f2799d161d8eba2a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "63323836"
---
# <a name="u1-and-u2-transitions"></a>U1 および U2 の移行


このトピックには、最初は U1 および U2 の遷移を有効にするソフトウェアによって行われ、次のハードウェアでこれらの遷移が発生する方法を説明しますが、初期セットアップがについて説明します。

## <a name="initial-setup-by-software"></a>ソフトウェアによる初期のセットアップ


このトピックでは、ソフトウェアがデバイスを列挙する方法について説明します。

発生するか、U1 と U2 の切り替えには、ソフトウェアは、デバイスの列挙中に、次の手順を実行します。

1.  ソフトウェア交換 U1 または U2 では、列挙処理中に、デバイスと待機時間情報を終了します。 この交換の最初の部分として、デバイスに固有の待機時間がデバイス (USB 3.0 仕様のセクション 9.6.2.2 で定義されている) SuperSpeed USB デバイスの機能の bU1DevExitLat および wU2DevExitLat フィールドによって入力されます。 Exchange の 2 つ目の一部としてホストをデバイスに通知デバイスの全体的な終了の待機時間のセットを送信することによって\_USB 3.0 の仕様のセクション 9.4.12 に従って、SEL コントロール転送します。 待機時間情報には、アップ ストリームへのリンクとコント ローラーに関連付けられている待機時間が含まれています。
2.  DS ポート、デバイスが接続されているは、ソフトウェアは、2 つの値を構成します。ポート\_U1\_タイムアウトとポート\_U2\_タイムアウトします。 これらの値を決定するには、ソフトウェアを考慮に入れます (エンドポイントの種類) など、デバイスの特性と、U0 U1 または U2 から、デバイスの持ち込みに関連付けられている待機時間にバックアップします。 次の表では、タイムアウト値を示します。

    **表 1。ポート\_U1\_タイムアウトとポート\_U2\_タイムアウト値**

    | 値   | 説明                                                                                                                                                                                                                  |
    |---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | 01 H FEH | DS ポートは、一定の期間後に遷移を開始する必要があります。 正確な期間は、タイムアウト値から派生します。 ポートは、保留中のトラフィックがない限り、リンクのパートナーによって開始された遷移を受け入れる必要があります。 |
    | FFH     | DS ポートは、遷移を開始する必要がありますが、保留中のトラフィックがない限り、リンクのパートナーによって開始された遷移を受け入れる必要があります。                                                                                    |
    | 0       | DS ポートは、遷移を開始する必要がありますして、リンク パートナーによって開始された遷移は受け付けする必要があります。                                                                                                                |

     

3.  場合、ポート\_U2\_01 H FEH 間のタイムアウト値は、手順 2 の結果として、ハードウェアで発生する追加の手順があります。 DS ポートは、その値について、そのリンクのパートナーを通知します。 "直接の移行から U1 を U2"は、この手順の重要性を説明します。
4.  すべてのデバイスまたはハブを使用して、ソフトウェアは 2 つの値を構成します。U1\_の有効化と U2\_セットを送信することによって有効にする\_機能 (U1\_有効にする/U2\_を有効にする) 制御が移ります。 次の表では、これらの値について説明します。

    **表 2。U1\_の有効化と U2\_有効にする値**

    | 値    | 説明                                                                                                                       |
    |----------|-----------------------------------------------------------------------------------------------------------------------------------|
    | 有効  | 米国のポートでは、遷移を開始でき、デバイスのポリシーによって許可されている場合、リンクのパートナーによって開始された遷移をそのまま使用することができます。 |
    | Disabled | 米国のポートは、遷移を開始する必要がありますが、リンクのパートナーによって開始された遷移を受け入れることができます。                          |

     
## <a name="hardware-transitions"></a>ハードウェアの移行


このトピックでは、U1 と U2 にハードウェアの移行について説明します。

ハードウェアは、ソフトウェアによって、初期セットアップ後、ソフトウェアから U1 と u2 操作を行うことがなく自律的に移行します。

パケットがアクティブに転送している限り、動作状態 (U0) では、リンクです。 リンクは、パケットが送信されていないときにアイドル状態であると見なされます。 アイドル状態では、すべてのリンクのパートナーは U1 または U2 への移行を開始できます。 他のリンクのパートナーは、承認または拒否の移行を選択できます。 リンクのパートナーが、移行を受け入れる場合、リンクはその U 状態に移動します。 移行が拒否されることは、リンクは、U0 に残ります。

### <a name="ds-port-initiated-transitions"></a>DS ポートが開始した遷移


DS ポートは、ポートの非アクティブ状態を追跡するタイマー機構を実装します。 そのポートを送信またはパケットを受信するたびに、タイマーがリセットされます。 タイマーは、ソフトウェア プログラムの新しいタイムアウト値と使用リセット取得もできます。 DS ポートに、ソフトウェア プログラムにのみ、U1 または U2 の遷移を開始する DS ポートは、リンクが U0 に初めて入ったときに、タイマーを開始します。 タイマー値は、ソフトウェアによってプログラムされた U1 (または U2) のタイムアウト値に基づきます。 リンクが U0 の場合、タイマーの期限が切れると、DS ポートには U1 (または U2) の移行が開始します。

デバイスでは、移行できますパフォーマンスまたは待機時間の要件を満たすデバイスの機能には影響を把握している場合、切り替えを拒否する米国のポートのリンク先を選択できます。 たとえば場合、デバイスは ERDY 通知が送信され、ホストからの転送要求を指定してください、デバイス可能性がありますを拒否 U1 または U2 の状態遷移それまでは。

ソフトウェア プログラム U1 と U2 の両方の遷移を開始する DS ポートには、DS ポートは最初に (以前はこのセクションで説明されている) タイマーに基づく U1 遷移を開始します。 U1 から U2 への移行がこのトピックで説明されている**U1 から U2 への直接の移行**します。

U1 または U2 でリンクする場合は、DS ポートはポートに戻す U0 ポートに接続されたデバイスへのトラフィックを受け取るときにいつでも。

### <a name="device-us-port-initiated-transitions"></a>デバイス (米国のポート) の遷移を開始


ソフトウェアによって、機能が有効になっている限り、U0 から U1 またはに U2、U0 への移行を開始するデバイスを選択できます。 リンクが U2 の直接の (「直接の移行から U1 を U2」で説明 DS ポート U2 タイマー基づくに移行する場合は、デバイス U1 へのリンクを移行、します。 ただし、U2 タイマーが設定されていない場合、デバイスは直接からへの移行 U1 U2 自体を開始できません。 その場合は、デバイスは、U2 への移行を開始する前に、U0 に戻るリンクを表示する必要があります。

これらの遷移を開始するタイミングを決定するには、中に、デバイスは、終了の待機時間とパフォーマンスの要件を検討してください。 十分な情報に基づいて意思決定についての遷移を開始できるどの程度積極的にデバイスのため、ソフトウェアでは、「ソフトウェアで初期セットアップ」では、このドキュメントで前述したようにさまざまな終了の待機時間の値も提供します。

U1 または U2 でリンクする場合は、米国ポートはポートに戻す U0、いつでも。 通常は、米国のポートは、ホストにすべてのパケットを送信しようとして、こと、またはホストからのパケットを定める必要がかどうかがわかっているときに、U0 への移行を開始します。

### <a name="advantages-of-device-initiated-lpm"></a>デバイスによって開始された LPM の利点


DS ポート用のソフトウェアによって設定されているタイマー値は、一般的なヒューリスティックに基づいています。 これらのタイマー値を選択する際は、ソフトウェアは、デバイスのパフォーマンスに悪影響がないことによりします。 ソフトウェアは、デバイスのパフォーマンスを維持するためには小さすぎて値を選択できません。 DS ポートに遷移が開始されると、タイマーに基づいていますは対処できないアカウント、デバイスの正確な状態でこのメカニズムは、U1 または U2 の状態、デバイスに送信するすべての可能なビジネス チャンスを取得できません。

一方で、デバイスには、その特性と現在の状態に関する正確な知識があります。 そのため、次の転送が行われますかについて推測をこと。 その情報に基づいて、デバイスできます (とする必要があります) を選択積極的に大幅にパフォーマンスに影響せずにこれらの遷移を開始します。

たとえば、デバイスはそのエンドポイントのいずれかで NRDY 通知を送信し、ことはありませんトラフィックの間を知っています。 その場合は、デバイスは、U1 または U2 への移行をすぐに開始できます。 ERDY、通知を送信する前に、デバイスは、リンクをによりそのデータを送信するための準備として U0 に戻ります。 詳細については、このプロセスは、USB 3.0 仕様の C.3.1」セクションを参照してください。

## <a name="direct-transition-from-u1-to-u2"></a>U1 から U2 への直接の移行


U1 がリンクにある場合は、ことリンク直接に移行する U2 U0 を間に入力しなくても可能です。 パートナーが U1 への移行を開始するリンクに関係なく発生することができます。 ただし、リンクの DS ポートで U2 タイムアウトが 01 H FEH 間の値に設定されている場合にのみ、U2 移行 U1 が発生します。

「ソフトウェアの初期セットアップ"セクションでは、タイムアウト値は、そのリンクのパートナーと通信に DS ポートを許可する追加の手順について説明します。 リンクが U1 を入力すると、両方はパートナー開始のタイムアウト値を使用して、タイマーが DS ポートの U2 のタイムアウト値に基づいて設定をリンクします。 タイマーは、トラフィックのためにはリセットされず、有効期限が切れる、リンクの両方のパートナー サイレントに移行 U2 それらの間の任意の明示的な通信を行わない。

### <a name="transitions-from-u1-or-u2-to-u3"></a>U1 または U2 から U3 に遷移


U1 または U2 への遷移がハードウェアの自律的に開始されたが、U3 への移行は、ソフトウェアによって開始されます。 一定の期間後にのみ U3 遷移が開始されると、ために、U1 または U2 (なく U0) で、移行する前に、リンクされた可能性が非常に高いです。

USB 3.0 の仕様では、U3 に U1 または U2 から直接遷移は定義しません。 親ハブまたはコント ローラーは、U0 へのリンクを自動的に移行して、U3 に遷移することを担当します。

### <a name="u1-or-u2-transitions-for-hubs"></a>ハブの U1 または U2 の移行


USB 3.0 仕様は、その米国ポートの状態遷移を U を開始するときに特定のガイドラインをハブに対する、について提供します。 DS ポートがリンクではすべて状態 U1 またはそれ以下では、ハブは、ソフトウェアが、U1 遷移を開始するハブを有効になっていると仮定すると、米国ポートで U1 遷移を開始する必要があります。

同様に、すべての DS ポートがリンク状態 U2 または下にある場合は、ハブはソフトウェアが、U2 遷移を開始するハブを有効になっていると仮定すると、米国ポートで U2 の遷移を開始する必要があります。

**注**   DS ポートに接続されたデバイスがない場合は、ポートの状態が Rx.Detect、U2 よりも低くなっています。 ように接続されているデバイスがない場合は、ハブは、その、米国のポートを U2 に送信します。 また、U1 で以下に、すべての DS ポートが最初にされた U2 または下に移行する際も、ハブが移行で U2 U1 から米国ポートする必要があります。 その遷移は、U2 アクティビティ タイマーに基づいてありません、ため、ハブする必要があります、米国のポートを U0 し U2 に送信します。

 

## <a name="packet-deferring"></a>パケットを保留します。


USB 3.0 の仕様がパケットを保留すると呼ばれるメカニズムについて説明します (C.1.2.2 セクションを参照してください)。 LPM のバスの使用率への影響を最小限に抑えるメカニズムが使用されます。

ホストは、アップ ストリームのリンクを持つ U1 または U2 では、デバイスに転送要求を送信する場合、ホストしまいます bus 帯域幅が無駄 U0 に戻ってへのリンクと、デバイスが応答するを待機することで。 親ハブは、その待機を回避するために、ホストに遅延のパケット ヘッダーを送信することによってデバイスに代わって応答します。 ホストは NRDY と同様の方法で遅延のパケット ヘッダーを処理しは無料で他のエンドポイントでの転送を開始します。 並列でハブ リンク U0 遷移を開始しますし、遅延のパケットについて、デバイスに通知します。 次に、デバイスは、デバイスが今すぐ転送の準備完了であることを示すホストに ERDY を送信します。 ホストは、デバイスへの転送を再スケジュールしことができます。

デバイスの重要な責任は ERDY を送信した後、デバイスがある ERDY するまで、またはホストが応答を送信するまでは、U0 でリンクを維持する責任を負います、 **tERDYTimeout** (500 ミリ秒) の時間が経過するとします。 この期間中、デバイスは U1 または U2 の遷移を開始する必要があり、またリンク パートナーによって開始された任意の遷移を拒否する必要があります。

 

 
 

 

 




