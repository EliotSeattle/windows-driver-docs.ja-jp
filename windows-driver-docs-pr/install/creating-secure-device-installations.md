---
title: セキュリティで保護されたデバイスのインストールを作成します。
description: セキュリティで保護されたデバイスのインストールを作成します。
ms.assetid: e92488c4-1383-4493-b229-61c646546c82
keywords:
- デバイス セットアップ WDK デバイス インストールのセキュリティ
- WDK、セキュリティ デバイスのインストール
- デバイスのセキュリティ、WDK をインストールします。
- WDK デバイス インストールのセキュリティ
- セキュリティ記述子 WDK デバイスのインストール
- INF ファイル WDK デバイスのインストール
- WDK デバイス インストールのセキュリティ設定のテスト
- レジストリの WDK デバイスのインストール
- WMI セキュリティ WDK デバイスのインストール
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 7ec18f97b7e3e4f4a2a6f0985069702dc5e6375d
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56530899"
---
# <a name="creating-secure-device-installations"></a>セキュリティで保護されたデバイスのインストールを作成します。





作成するときに、[ドライバー パッケージ](driver-packages.md)デバイスのインストールが常に安全な方法で実行することを確認しておく必要があります。 セキュリティで保護されたデバイスのインストールは、1 つには、次は。

-   デバイスとそのデバイスのインターフェイス クラスへのアクセス制限

-   デバイスの作成されたドライバー サービスへのアクセスを制限

-   ドライバー ファイルを変更または削除から保護します。

-   デバイスのレジストリ エントリへのアクセス制限

-   デバイスの WMI クラスへのアクセス制限

-   正しく SetupAPI 関数を使用します。

デバイス インストールのセキュリティがによって制御される*セキュリティ記述子*します。 セキュリティ記述子を指定するため、プライマリのメディアは、INF ファイルです。 システム提供の既定のセキュリティ記述子と、ほとんどの状況ではこれらの記述子をオーバーライドする必要はありません。

### <a name="security-settings-for-devices-and-interfaces"></a>デバイスとインターフェイスのセキュリティ設定

システムは、すべての既定のセキュリティ記述子を提供[システム提供のデバイス セットアップ クラス](https://msdn.microsoft.com/library/windows/hardware/ff553419)します。 一般に、これらの記述子のシステム管理者のフル アクセスと読み取り/書き込み/実行アクセスのユーザーに対して許可します。 (デバイスへのアクセス制御もデバイスへのアクセスを制御するセキュリティ記述子[デバイス インターフェイス クラス](device-interface-classes.md)、存在する場合)。

WDM ドライバーの INF ファイルには、セキュリティ、クラスごとまたはデバイスごとのいずれかを上書きする設定、システムの既定の設定を指定できます。 新しいデバイス セットアップ クラスを作成するベンダーは、クラスのセキュリティ記述子を指定してください。 一般に、デバイス固有のセキュリティ記述子を指定する必要はありません。 同じクラスに属しているデバイスの種類によって大幅に異なる種類のユーザーがある場合、デバイス固有のセキュリティ記述子を指定すると便利な場合があります。

WDM のデバイス セットアップ クラスに属しているすべてのデバイスのセキュリティ記述子を指定するには、使用、 [ **INF AddReg ディレクティブ**](inf-addreg-directive.md)内、 [ **INF ClassInstall32 セクション**](inf-classinstall32-section.md)クラスのインストーラーの INF ファイルの。 **AddReg**ディレクティブを指す必要があります、*追加レジストリ セクション*の値を設定する**DeviceType**と**セキュリティ**レジストリ エントリ. これらのレジストリ値は、指定したデバイスの種類のすべてのデバイスのセキュリティ記述子を指定します。

WDM のデバイス セットアップ クラスに属している 1 つのデバイスのセキュリティ記述子を指定するには、使用、 [ **INF AddReg ディレクティブ**](inf-addreg-directive.md)内、 [ **INF DDInstall.HW セクション**](inf-ddinstall-hw-section.md)のデバイスの INF ファイル。 **AddReg**ディレクティブを指す必要があります、*追加レジストリ セクション*の値を設定する**DeviceType**と**セキュリティ**レジストリ エントリ. これらのレジストリ値と一致するすべてのデバイスのセキュリティ記述子の指定、[ハードウェア ID](hardware-ids.md)または[互換性 Id](compatible-ids.md)関連で指定された[**モデルの INF セクション**](inf-models-section.md).

既定では、セキュリティ記述子がデバイスを表すデバイス オブジェクトを開くための要求へのデバイスの設定が適用されます (たとえば、NT デバイス名を持つデバイスを開く要求*\\デバイス\\DeviceName*)。

ただし、システムは既定では適用されませんデバイスの設定、デバイスの名前空間でオブジェクトを開く要求にデバイスの名前空間に名前を持つフォームがあるすべてのオブジェクトが含まれているセキュリティ記述子*\\デバイス\\DeviceName\\ObjectName*します。 デバイスの名前空間でオブジェクトに対する要求を開くに同じセキュリティ設定が適用されることを確認するには、デバイスの FILE_DEVICE_SECURE_OPEN デバイス特性フラグを設定します。 セキュリティで保護されたデバイスへのアクセスの詳細については、[デバイス Namespace アクセスの制御 (Windows ドライバー)](https://msdn.microsoft.com/library/windows/hardware/ff542068)を参照してください。 FILE_DEVICE_SECURE_OPEN デバイスの特性のフラグを設定する方法については、[デバイスの特性を指定する (Windows ドライバー)](https://msdn.microsoft.com/library/windows/hardware/ff563818)を参照してください。

PnP マネージャーがドライバーを呼び出した後に、デバイス オブジェクトのセキュリティの値を設定[ **AddDevice** ](https://msdn.microsoft.com/library/windows/hardware/ff540521)ルーチン。 WDM ドライバーによっては呼び出すことによって、物理デバイス オブジェクト (PDO) を作成するときに、デバイス固有のセキュリティ記述子を指定できます[ **IoCreateDeviceSecure**](https://msdn.microsoft.com/library/windows/hardware/ff548407)します。 詳細については、[デバイス オブジェクトのセキュリティで保護する](https://msdn.microsoft.com/library/windows/hardware/ff563688)を参照してください。

### <a name="security-settings-for-driver-files"></a>ドライバー ファイルのセキュリティ設定

使用してファイルをコピーするときに、 [ **INF CopyFiles ディレクティブ**](inf-copyfiles-directive.md)を指定することは、*ファイルのセクション一覧*.**セキュリティ**セクション。 このセクションでは、コピーするすべてのファイルのセキュリティ記述子を指定します、 **CopyFiles**ディレクティブ。 ただし、ベンダーことはありませんが、ドライバー ファイルのセキュリティ記述子を指定するインストール先が、システムのサブディレクトリのいずれかである場合 *%systemroot%* します。 (これらのサブディレクトリの詳細については、次を参照してください[を使用して Dirids](using-dirids.md)。)。システムはこれらのサブディレクトリの既定のセキュリティ記述子を提供し、既定の記述子をオーバーライドしない必要があります。

### <a name="security-settings-for-driver-services"></a>ドライバー サービスのセキュリティ設定

ドライバーの INF ファイルの*サービスのインストール-セクション*(を参照してください[ **INF AddService ディレクティブ**](inf-addservice-directive.md)) を含めることができます、**セキュリティ**エントリ。 このエントリには、開始、停止、およびデバイスに関連付けられているドライバー サービスの構成などの操作を実行するために必要なアクセス許可を指定します。 ただし、システムでは、ドライバーのサービスの既定のセキュリティ記述子と、この既定の記述子通常がオーバーライドされます。

### <a name="security-settings-for-device-and-driver-registry-entries"></a>デバイスとドライバーのレジストリ エントリのセキュリティ設定

INF ファイルを使用してレジストリ エントリを指定するときに[ **INF AddReg ディレクティブ**](inf-addreg-directive.md)を含めることができます、*追加レジストリ セクション*.**セキュリティ**の各セクション*追加レジストリ セクション*します。 *追加レジストリ セクション*.**セキュリティ**セクションで作成された作成されたレジストリ エントリへのアクセス許可の指定、関連する*追加レジストリ セクション*セクション。 システムで作成されたすべてのレジストリ エントリの既定のセキュリティ記述子を提供する、 **HKR**相対ルート。 そのため、相対的なルートの下のレジストリ エントリを作成するときに、セキュリティ記述子を指定するはありません。

### <a name="security-settings-for-wmi-classes"></a>WMI クラスのセキュリティ設定

システムでは、WMI クラスを識別する Guid を既定のセキュリティ記述子を割り当てます。 Windows XP や以前のオペレーティング システム バージョンは、WMI の Guid の既定のセキュリティ記述子は、すべてのユーザーへのフル アクセスを許可します。 Windows Server 2003 以降では、既定のセキュリティ記述子は、管理者にのみへのアクセスを許可します。

使用してセキュリティ記述子を指定するには、ドライバーは、WMI クラスを定義しますこれらのクラスに、システムの既定のセキュリティ記述子を使用したくない場合は、、 [ **INF DDInstall.WMI セクション**](inf-ddinstall-wmi-section.md) 。デバイスの INF ファイル。

### <a name="using-setupapi-functions-correctly"></a>正しく SetupAPI 関数を使用します。

場合、[ドライバー パッケージ](driver-packages.md)インストーラー、共同インストーラーは、SetupAPI の関数を呼び出す他のインストール アプリケーションを含むに従う必要があります、 [SetupAPI の使用に関するガイドライン](guidelines-for-using-setupapi.md)します。

### <a href="" id="testing-installation-security-settings-"></a>インストールのセキュリティ設定のテスト

使用[SetupAPI ログ](setupapi-logging--windows-server-2003--windows-xp--and-windows-2000-.md)そのセキュリティを確認するデバイスのインストールに関連付けられている設定を正しく指定されています。 詳細 (0x0000FFFF) にログ記録レベルを設定し、さまざまなインストール シナリオを試行します。

このようなシナリオには、初期インストールとユーザー アカウントとシステム管理者アカウントの両方からの再インストールの両方を含める必要があります。 ソフトウェアをインストールする前に、デバイスに接続してみてください、またはその逆です。

インストールが成功すると、エラーが発生していないことを確認するログを表示します。 インストールに失敗した場合は、エラーの原因を特定するログを表示します。

さらに、インストールが完了したら、次のような操作をすることができます。

-   レジストリ エントリに割り当てられているセキュリティ設定を表示するのにには、レジストリ エディターを使用します。

-   使用**マイ コンピューター**ファイルに割り当てられているセキュリティ設定を表示します。

 

 





