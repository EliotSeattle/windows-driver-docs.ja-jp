---
title: ドライバーの読み込み順序の指定
description: ドライバーの読み込み順序の指定
ms.assetid: 2e06671a-5664-4042-bc7a-e8ab12938cea
keywords:
- INF ファイル WDK デバイスのインストール、ドライバーの読み込み順序
- ドライバーの読み込み順序 WDK INF ファイル
- 注文の WDK INF ファイルを読み込む
- サービスのインストール-セクション WDK INF ファイル
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: c8e58f4b8ecea3796ec3899fdcb0e88dadcaddb1
ms.sourcegitcommit: fb7d95c7a5d47860918cd3602efdd33b69dcf2da
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/25/2019
ms.locfileid: "67385887"
---
# <a name="specifying-driver-load-order"></a>ドライバーの読み込み順序の指定





ほとんどのデバイスの物理コンピューター上のデバイスの階層は、Windows および PnP マネージャーがドライバーを読み込む順序を決定します。 Windows と PnP マネージャー、システム ルート デバイスでは、以降のデバイスを構成し、ルート デバイス (たとえば、PCI アダプター)、それらのデバイスの子の子デバイスの構成にします。 PnP マネージャー ドライバーを読み込みますデバイスごとに、デバイスが構成されているため、ドライバーが以前別のデバイスに読み込まれていない場合。

INF ファイルの設定は、ドライバーの読み込み順序を制御できます。 このトピックでは、ベンダーがで指定する必要があります、関連する値を説明します、*サービス-インストール セクション*ドライバーのによって参照される[ **INF AddService ディレクティブ**](inf-addservice-directive.md)します。 具体的には、このトピックについて説明します、 **StartType**、 **BootFlags**、 **LoadOrderGroup**、および**依存関係**エントリ。

ドライバーがこれらの規則を指定するために従う必要があります**StartType**:

-   PnP ドライバー

    PnP ドライバー、PnP マネージャー読み込むことができます、ドライバー、PnP マネージャーの検索、デバイスとドライバー サービスを指定する SERVICE_DEMAND_START (0x3) の開始の種類があります。

-   コンピューターを起動するために必要なデバイスのドライバー

    デバイスは、コンピューターを起動するために必要なデバイスのドライバーが SERVICE_BOOT_START (0x0) の開始の種類に必要です。

-   非*ブート開始ドライバー* PnP 列挙型ではないデバイスを検出します。

    PnP 列挙型でないデバイスの場合、ドライバーを報告デバイス PnP マネージャーを呼び出すことによって[ **IoReportDetectedDevice**](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/ntddk/nf-ntddk-ioreportdetecteddevice)します。 このようなドライバーは、Windows はシステムの初期化中にドライバーを読み込むために、開始の種類 SERVICE_SYSTEM_START (0x01) にすることが必要です。

    ドライバーのみをレポートの非 PnP ハードウェアは、この開始の種類を設定する必要があります。 サービスと非 PnP PnP の両方のデバイスのドライバーをこの開始の種類を設定があります。

-   非 PnP ドライバー、サービス コントロール マネージャーによって開始する必要があります。

    このようなドライバー SERVICE_AUTO_START (0x02) のスタートアップの種類があります。 PnP ドライバーは、この開始の種類を設定しない必要があります。

Windows デバイスを構成するときに読み込むことができるように、PnP ドライバーを記述する必要がありますドライバー サービス。 逆に、ドライバーできる必要がありますが、PnP マネージャーが不要になったを判断する任意の時間をアンロードしてデバイスをドライバーにサービスに提供します。 PnP ドライバーに依存すべき唯一のドライバー ロード順序は次のとおりです。

1.  子デバイス用のドライバーは、親デバイス用のドライバーが読み込まれているという事実に依存できます。

2.  デバイス スタック内のドライバーは、下にあるすべてのドライバーが読み込まれているという事実に依存できます。

    たとえば、関数ドライバーを確信できます低いフィルター ドライバーが読み込まれています。

    ただし、デバイス スタック内のドライバーがデバイスの下位のドライバーの後に順番に読み込まれるに依存できない、ドライバーがあるために、以前に読み込ま別のデバイスの構成時に注意します。

フィルター グループのフィルター ドライバーは、その読み込み順序を予測できません。 たとえば、デバイスに登録されている 3 つの上位フィルター ドライバーがある場合は、これら 3 つのドライバーは、すべて読み込まれた関数のドライバーの後に、上位フィルター グループ内で任意の順序で読み込まれる可能性があります。

ドライバーは、明示的な読み込み順序の依存関係を別のドライバーでは場合、は、親/子リレーションシップによってその依存関係を実装する必要があります。 子デバイス用のドライバーは、子のドライバーが読み込まれる前に読み込まれている親デバイス用のドライバーに依存できます。

適切な設定の重要性を強化する**StartType**値、次の一覧は、Windows と PnP マネージャーの使用方法について説明します、 **StartType**の INF ファイルのエントリ。

1.  システムの起動時にカーネルに制御を転送する前に、オペレーティング システム ローダーは型 SERVICE_BOOT_START のドライバーを読み込みます。 カーネルは、コントロールが取得されるメモリ内でこれらのドライバー。

    ブート開始ドライバーは、INF を使用できる**LoadOrderGroup**の読み込みを注文するエントリ。 (ブート開始ドライバーが読み込まれてほとんどのデバイスを構成すると、前にデバイスの階層によって、読み込み順序を判断できないためです。)オペレーティング システムの無視 INF**依存関係**ブート開始ドライバーのエントリ。

2.  PnP マネージャー呼び出し、 **DriverEntry** SERVICE_BOOT_START ドライバー、ドライバーがブート デバイスをサービスするためのルーチンです。

    ブート デバイスに子デバイスがある場合は、これらのデバイスが列挙されます。 子デバイスでは、構成し、そのドライバーがブート開始ドライバーでは、ある場合を開始します。 デバイスのドライバーがすべてのブート開始ドライバーでない場合、PnP マネージャーは、デバイス ノードを作成します (*devnode*) デバイスのデバイスをまだ開始しません。

3.  すべてのブート ドライバーが読み込まれ、ブート デバイスを開始、PnP マネージャーは PnP デバイスの残りの部分を構成し、そのドライバーを読み込みます。

    PnP マネージャーではまだ開始されていないデバイス ツリーをについて説明します (つまり、すべて nonstarted devnode、前の手順から)。 各デバイスの起動、PnP マネージャーは、存在する場合、デバイスの子を列挙します。

    PnP マネージャーが、デバイスのドライバーを読み込むように構成するこれらのデバイスと、*かに関係なく*のドライバーの**StartType**値 (する場合を除く**StartType**入稿には無効になっている)、デバイスの起動を続行してください。 これらのドライバーの多くは、SERVICE_DEMAND_START ドライバーです。

    PnP マネージャー INF の結果として作成されたレジストリ エントリは無視**依存関係**エントリと**LoadOrderGroup**この手順で読み込まれるドライバーのエントリ。 ロード順序は、物理デバイスの階層に基づいています。

    この手順の最後に、PnP 列挙可能なとそれらのデバイスの子孫ではないデバイスを除く、すべてのデバイスは構成されます。 (子孫の可能性がありますまたはできない場合があります PnP 列挙可能な)。

4.  PnP マネージャーのドライバーをロードする**StartType** SERVICE_SYSTEM_START まだ読み込まれていません。

    これらのドライバーでは、検出し、非 PnP デバイスを報告します。 PnP マネージャー INF の結果であるレジストリ エントリを処理する**LoadOrderGroup**これらのドライバー エントリ。 INF により作成されたレジストリ エントリは無視されます**依存関係**これらのドライバー エントリ。

5.  サービス コントロール マネージャーのドライバーをロードする**StartType** SERVICE_AUTO_START まだ読み込まれていません。

    サービス コントロール マネージャーの処理に関して、サービスのサービスのデータベース情報**DependOnGroup**と**DependOnServices**します。 この情報から**依存関係**INF エントリ**AddService**エントリ。 注意してくださいを**依存関係**システムの起動の前の手順で必要な PnP ドライバーが読み込まれたため、非 PnP ドライバーの情報の処理のみです。 サービス コントロール マネージャーは、INF を無視**LoadOrderGroup**情報。

    サービス コントロール マネージャーの詳細については、Microsoft Windows SDK ドキュメントを参照してください。

### <a name="using-bootflags-to-promote-a-drivers-starttype-at-boot-depending-on-boot-scenario"></a>BootFlags を使用してブート シナリオによっては、ブート時のドライバーの開始の種類を昇格するには

ドライバーの昇格できます。 オペレーティング システム**StartType**に応じてブート開始ドライバーを使用する、 **BootFlags**ドライバーの INF で指定された値。 いずれかを指定することができますか、複数 (Or)、次の数値の 16 進数の値として表される、INF ファイルで。

-   指定の場合は、ドライバーは、ネットワーク ブートでのブート開始ドライバーに昇格する必要があります、 **0x1** (CM_SERVICE_NETWORK_BOOT_LOAD)。
-   VHD からのブート ドライバーを昇格する必要がある場合、は、指定**0x2** (CM_SERVICE_VIRTUAL_DISK_BOOT_LOAD)
-   場合は、ドライバーを USB ディスクから起動中に昇格させる必要があります指定**0x4** (CM_SERVICE_USB_DISK_BOOT_LOAD)。
-   SD ストレージからの起動中にドライバーを昇格させる必要があります場合、指定**0x8** (CM_SERVICE_SD_DISK_BOOT_LOAD)
-   場合は、ドライバーを USB 3.0 コント ローラー上のディスクから起動中に昇格させる必要があります指定**0x10** (CM_SERVICE_USB3_DISK_BOOT_LOAD)。
-   測定によるブート中にドライバーを昇格する場合は、ブートが有効になっている、指定**0x20** (CM_SERVICE_MEASURED_BOOT_LOAD)。
-   Verifier ブートが有効になっているによるブート中にドライバーを昇格する場合は、指定**0x40** (CM_SERVICE_VERIFIER_BOOT_LOAD)。
-   ドライバーを WinPE の起動時に昇格させる必要があります場合、指定**0x80** (CM_SERVICE_WINPE_BOOT_LOAD)。

ドライバーの昇格の詳細については**StartType**ブートのシナリオに応じて、起動時に、次を参照してください。 [ **INF AddService ディレクティブ**](inf-addservice-directive.md)します。

 

 





