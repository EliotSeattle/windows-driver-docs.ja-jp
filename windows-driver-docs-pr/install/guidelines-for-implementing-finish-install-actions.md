---
title: 完了-インストール アクションを実装するためのガイドライン
description: 完了-インストール アクションを実装するためのガイドライン
ms.assetid: 455d520a-ccd7-470b-ab5f-5786ee90b91d
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 968e752fa905d35eaf7c7479ff4cff59e8995807
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56559373"
---
# <a name="guidelines-for-implementing-finish-install-actions"></a>完了-インストール アクションを実装するためのガイドライン


完了-インストール アクションを実行できる、*インストーラー* (クラスのインストーラー、クラスの共同インストーラーまたはデバイスの共同インストーラー)。 完了-インストール アクションでは、インストーラーできます実行可能プログラムを実行、プロセスを作成、スレッドを作成またはデバイス ドライバーのインストールの完了-インストール プロセスでコードを実行します。

インストーラーに 完了-インストール アクションを実装する場合は、次のガイドラインを考慮してください。

-   デバイスが動作するために必要なすべての重要な設定を適用する 完了-インストール アクションを使用できません。

-   インストーラーが完了-インストール操作が完了-インストール操作が完了するまで実行する必要がある場合を終了するまで待ちます。

    たとえば、完了インストール アクションの実行中にシステムの再起動によって中断されるを避けるためには、インストーラーが待機インストーラーの処理から返される前に終了する終了インストール アクションの[ **DIF_FINISHINSTALL_ACTION** ](https://msdn.microsoft.com/library/windows/hardware/ff543684)要求。

-   完了-インストール アクションは、進行中のユーザーに知らせる必要があります。

    Windows では、完了-インストール操作が実行されていること、または完了インストール操作が成功または失敗すること、ユーザーは通知しません。 そのため、完了インストール アクションを完了インストール操作が進行中のユーザーに通知し、完了インストール アクションの成功または失敗したユーザーに通知されます。

-   インストーラーでは、システムの再起動が完了-インストール アクションを実行するために必要な場所の状況を処理する必要があります。

    処理から返す前に完了インストール アクションの設定をデバイスで有効にするために、システムの再起動を必要とする場合、インストーラーでは DI_NEEDREBOOT フラグを設定する必要があります、 [ **DIF_FINISHINSTALL_ACTION** ](https://msdn.microsoft.com/library/windows/hardware/ff543684)要求。 ただし、デバイスのインストールは強制的に再起動しないコンピューターのしない限り、どうしても必要です。

    詳細については、デバイスのインストールでシステムを必要な場合の再起動を参照してください[デバイスのインストールとシステムの再起動](device-installations-and-system-restarts.md)します。

-   インストーラーでは、完了インストール操作が失敗しますが、もう一度試行する必要がある状況を処理する必要があります。 たとえば、インストーラーでは、インストールされているデバイスがシステムから削除されている場合にこの方法で 完了-インストール操作が失敗することができます。

    Windows 8 では、前に完了インストール アクションに障害が発生する必要がありますが再試行、インストーラーの一時的な障害が、ユーザーに通知する必要があります、ために必要なクリーンアップを実行し、DIF_FINISHINSTALL_ACTION 要求の Win32 エラー コードに戻ります。 Windows では、デバイスとデバイス ノードの 完了 のインストール操作を実行するフラグが設定されていることは消去されませんインストーラー DIF_FINISHINSTALL_ACTION 要求の Win32 エラー コードが返された場合 (*devnode*)。

    ただし、Windows 8 以降では、エラー コードを返す妨げませんがクリアされるフラグ。 完了-インストール アクションにエラーがある場合は、後でもう一度実行する機能をユーザーに提供が必要です。

    このフラグは、デバイスの設定が、Windows には、新しい 完了-インストール プロセスが実行されます。

    詳細については、[- インストールが完了操作を実行している](running-finish-install-actions.md)を参照してください。

-   インストーラーでは、完了インストール アクションが失敗し、もう一度は試行しない必要がある状況を処理する必要があります。

    エラーでは、完了-インストール操作が正常にこれまで不可能な場合、インストーラーは、操作は、完了できないと、および、必要なクリーンアップを実行し、ユーザーに通知する必要があります。 このような状況で共同インストーラーは NO_ERROR とデバイスを返す必要があります。 またはクラスのインストーラーが ERROR_DI_DO_DEFAULT を返す必要があります。 Windows は devnode と呼び出しの完了インストール アクションを実行するフラグが設定されていることと、デバイスをクリアして、その後[ **SetupDiFinishInstallAction** ](https://msdn.microsoft.com/library/windows/hardware/ff551022)既定の [完了-インストールを実行するには操作です。

-   インストーラーを処理すると、 [ **DIF_NEWDEVICEWIZARD_FINISHINSTALL** ](https://msdn.microsoft.com/library/windows/hardware/ff543702) DIF コード、ことを確認完了インストール アクションが必要なかどうかを参照してください。 完了-インストール操作を実行する必要がありますがある場合、インストーラーは DI_FLAGSEX_FINISHINSTALL_ACTION フラグを設定のみ必要があります。 このフラグが不必要に設定されている場合は、ドライバーの再インストール時にユーザーがプロンプトにある、追加のデバイスのインストールを取得、DIF_FINISHINSTALL_ACTION 要求には、完了-インストール アクションを実行するはありません。

    たとえば、完了-インストール操作が正常に動作するデバイスに必要なアプリケーションをインストールするデバイスの共同インストーラーを検討してください。 たとえば、Microsoft キーボードの 完了-インストール アクションは IntelliType アプリケーションをインストールする場合があります。 このような共同インストーラーを処理すると、 [ **DIF_NEWDEVICEWIZARD_FINISHINSTALL** ](https://msdn.microsoft.com/library/windows/hardware/ff543702) DIF コード、ことを確認、アプリケーションが既にインストールされているかどうかを参照してください。 アプリケーションが既にインストールされている場合、完了インストール アクションを実行するにはなく、DI_FLAGSEX_FINISHINSTALL_ACTION フラグを設定しないでくださいこのためです。 このような状況で共同インストーラーが、DI_FLAGSEX_FINISHINSTALL_ACTION フラグを正しく設定されている場合、ユーザーは 完了-インストール アクションが実行するアクションを持たない場合でも続行するためのアクセス許可の不要なユーザー アカウント制御 (UAC) プロンプトを取得します。

    **注**  以降、Windows 7 では UAC が既定の設定 (「通知プログラムがコンピューターに変更を加えるとする場合にのみ」) またはそれ以下の設定に設定されている場合、オペレーティング システムは表示されませんでの管理者ユーザーの入力を求める完了-インストール アクションを処理するときの権限。

     

-   含めるし、で、完了-インストール アクションを実行するために必要なすべてのファイルをインストールする必要があります完了インストール アクションを実装するインストーラーを登録する前に、 [ **CopyFiles ディレクティブ**](inf-copyfiles-directive.md)の[INF ファイル](inf-files.md)デバイス。 ファイルがアクセスできる場所にインストール中に、インストーラーによって配置されるように必要です。

    デバイスまたはクラスの共同インストーラーの登録要件の詳細については、[クラス共同インストーラーを登録する](registering-a-class-co-installer.md)を参照してください。

 

 





