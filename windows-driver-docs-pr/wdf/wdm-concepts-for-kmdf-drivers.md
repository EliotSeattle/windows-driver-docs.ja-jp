---
title: WDF ドライバーでの WDM の概念
description: WDF ドライバーでの WDM の概念
ms.assetid: 164b4882-a5a3-45d3-a2f5-53367b396439
keywords:
- カーネル モード ドライバー WDK KMDF、WDM
- KMDF WDK、WDM
- カーネル モード ドライバー フレームワーク、WDK WDM
- フレームワークに基づいたドライバー WDK KMDF、WDM
- WDM ドライバー WDK KMDF
- バスの WDK KMDF 列挙型
- バス ドライバー WDK KMDF
- 機能ドライバー WDK KMDF
- フィルター ドライバー WDK KMDF
- ドライバーは、WDK KMDF をスタックします。
- WDK KMDF スタック
- デバイス スタックの WDK KMDF
- Irp WDK KMDF
- I/O 要求パケット WDK KMDF
- I/O 要求 WDK KMDF、Irp
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 70b117ebc4b00a809b0f2a12bce704410e4abdc8
ms.sourcegitcommit: 0cc5051945559a242d941a6f2799d161d8eba2a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "63385714"
---
# <a name="wdm-concepts-for-wdf-drivers"></a>WDF ドライバーでの WDM の概念


Windows Driver Frameworks (WDF) には、Microsoft Windows Driver Model (WDM) インターフェイスのラッパーです。 フレームワークは WDM の多くの概念を簡略化し、それらを使用する必要はありませんように完全に非他のユーザー、WDM ドライバーの基本的な概念の一部をまだ理解する必要があります。 具体的には、理解する必要があります[ドライバー型](#driver-types)、[ドライバー スタック](#driver-stacks)、[デバイス スタック](#device-stacks)、および[I/O 要求パケット](#io-request-packets)します。

### <a name="driver-types"></a>ドライバーの種類

Windows ベースのドライバーは次の 3 種類に分けられます:[バス ドライバー](https://msdn.microsoft.com/library/windows/hardware/ff540704)、[関数ドライバー](https://msdn.microsoft.com/library/windows/hardware/ff546516)と[フィルター ドライバー](https://msdn.microsoft.com/library/windows/hardware/ff545890)します。 バス ドライバーでは、親のバスに接続されている子デバイスを検出し、その特性を報告して I/O バスをサポートします。 (このアクティビティが呼び出される*列挙体のバス*)。関数のドライバーでは、デバイスとバスの I/O 操作を制御します。 フィルター ドライバーは、受信確認、およびユーザー アプリケーションとドライバー、または個々 のドライバー間を流れるデータを変更します。

バス ドライバーには、基本的の関数ドライバーも子の列挙ですが。 ドライバーは"bus driver"として機能するときに、バス上の子デバイスを列挙します。 それ以外の場合、バス アダプターのハードウェアにアクセスする I/O 操作を処理する場合は、バスの"関数 driver"として同じドライバーが機能します。

ユーザー モード ドライバー フレームワーク (UMDF) ドライバーは、バス ドライバーにすることはできません。

### <a name="driver-stacks"></a>ドライバー スタック

呼び出される垂直方向の呼び出しシーケンスで、Windows オペレーティング システムで WDM ドライバーが階層化されて、*ドライバー スタック*します。 スタックの最上位のドライバーは、後の要求は、オペレーティング システムの I/O マネージャーを通過している通常の I/O 要求とユーザーのアプリケーションから受信します。 ドライバーの下位の層は、通常、コンピューターのハードウェアと通信します。

単純なドライバー スタックには、バスに固有の I/O 操作を処理し、それに接続されている子デバイスを列挙すると、スタックの一番下にあるバス ドライバーが含まれています。 通常、1 つまたは複数のデバイスに固有の機能のドライバーは、バス ドライバーの上位。 これらの関数ドライバー、バスに接続されているデバイスへの I/O 操作を処理します。 バス ドライバーとドライバーの関数間であることができますか関数ドライバーでは、上記のフィルター ドライバーができます。 実行中のシステムでは、さまざまな種類のデバイスをサポートするいくつかのドライバー スタックがあります。

### <a name="device-stacks"></a>デバイス スタック

各ドライバー スタックは、1 つまたは複数サポートしています。*デバイス スタック*します。 デバイス スタックは、一連の*デバイス オブジェクト*WDM 定義から作成される[**デバイス\_オブジェクト**](https://msdn.microsoft.com/library/windows/hardware/ff543147)構造体。 各デバイス スタックは、1 つのデバイスを表します。 各ドライバーでは、各デバイスのデバイス オブジェクトを作成し、デバイス スタックを各デバイス オブジェクトをアタッチします。 デバイス スタックが作成しデバイスが接続されているために、削除され、電源が入っていないし、システムを再起動するたびにします。

バス ドライバーでは、子デバイスが接続されているまたは電源が入っていないことを検出すると、プラグ アンド プレイ (PnP) マネージャーに通知します。 応答として、PnP マネージャーは、親デバイス (つまり、バス) に接続されている子デバイスごとに物理デバイス オブジェクト (PDO) を作成するバス ドライバーを要求します。 PDO は、デバイス スタックの一番下になります。

次に、PnP マネージャーは、各デバイス (既に読み込まれていない) 場合をサポートする関数とフィルターのドライバーをロードし、各デバイス オブジェクトを作成して、デバイス スタックの一番上に追加できるように、PnP マネージャーがこれらのドライバーを呼び出すは。 ドライバーは、関数は、機能のデバイス オブジェクト (Fdo) を作成し、フィルター ドライバーが (DOs をフィルター処理) フィルター デバイス オブジェクトを作成します。

I/O マネージャーでは、デバイスのドライバーに、I/O 要求を送信するときに、デバイス スタックの最上位のデバイス オブジェクトを作成したドライバーに要求を渡します。 そのドライバー I/O マネージャーは、次の下位ドライバーに要求を渡す場合、I/O マネージャー、デバイス スタックを使用して、次の下位のドライバーを決定します。 (次の下位のドライバーとは、次の下位のデバイス オブジェクトを作成したドライバーのことです)。

WDF は、各 WDM デバイス オブジェクトの framework デバイス オブジェクトを作成します。 フレームワーク ベースのドライバーは、WDM デバイス オブジェクトではなくこれら framework デバイスのオブジェクトにアクセスします。

### <a name="io-request-packets"></a>I/O 要求パケット

I/O マネージャーは、I/O 要求パケット (Irp) を作成して、ドライバー、アプリケーションの I/O 要求を送信します。 IRP は、(読み取り/書き込み操作の場合) など、I/O 操作の実行を要求または (状態を返す) などの I/O 制御 (IOCTL) 操作を実行する要求に含めることができます。 さらに、PnP マネージャーが表す PnP Irp とドライバーを実行する必要があります、電源管理の操作を作成し、ドライバーに Irp をこれら送信します。

通常、I/O マネージャーを作成、読み取りまたはユーザーのアプリケーションが読み取りを要求したときに、IRP を記述または書き込み操作。 I/O マネージャーがドライバー スタックの上部にあるドライバーに IRP を渡すと、そのドライバーが要求を処理または、次の下位ドライバーに要求を渡します。 一部の要求は、スタックの一番下に移動しより高度なドライバーによって完全に処理されるいくつか。

ドライバーは、IRP を受信するたびに、ドライバーは、操作を扱う必要があるデバイスを表すデバイス オブジェクトへのポインターも受信します。 そのため、ドライバー スタックのドライバーに移動するのにことは想定されて、特定の要求が接続されているデバイスを判断するためにデバイス オブジェクトを使用します。

ドライバーを WDF 通常は直接アクセスしません Irp。 フレームワークでは、カーネル モード ドライバー フレームワーク (KMDF) および UMDF ドライバーを I/O キューで受信するフレームワークの要求オブジェクトを読み取り、書き込み、およびデバイスの I/O 制御操作を表す WDM Irp に変換します。 PnP ドライバー パッケージ電源管理 Irp を内部的との PnP ドライバーと電源イベントを通知するイベントのコールバック関数を使用して framework ハンドル。

 

 





