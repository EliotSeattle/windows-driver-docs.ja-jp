---
title: UMDF によるドライバー エラーの処理方法
description: このトピックでは、UMDF ドライバーが失敗した場合、ユーザー モード ドライバー フレームワーク (UMDF) とオペレーティング システムが実行できるアクションについて説明します。 両方の UMDF バージョン 1 と 2 に適用されます。
ms.assetid: 1811f131-6a51-4e53-bc8d-da511619f6fd
keywords:
- ユーザー モード ドライバー フレームワーク WDK、ドライバーの読み込み失敗
- UMDF WDK、ドライバーの読み込み失敗
- ユーザー モード ドライバー WDK UMDF、ドライバーの読み込み失敗
- 失敗したドライバー WDK UMDF
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 37a7ea0e4fcb927bdb8d1e77f1bcd5bdc638f9eb
ms.sourcegitcommit: fb7d95c7a5d47860918cd3602efdd33b69dcf2da
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/25/2019
ms.locfileid: "67382835"
---
# <a name="how-umdf-handles-driver-failures"></a>UMDF によるドライバー エラーの処理方法


このトピックでは、UMDF ドライバーが失敗した場合、ユーザー モード ドライバー フレームワーク (UMDF) とオペレーティング システムが実行できるアクションについて説明します。 両方の UMDF バージョン 1 と 2 に適用されます。

次のイベントは、記載された順序で発生します。

-   オペレーティング システム、reflector の通知 (*WUDFRd.sys*)。

-   Reflector は、ホスト プロセスで未処理の I/O を追跡します。
    -   ステータスが未処理の I/O の完了、reflector\_ドライバー\_プロセス\_終了エラー コード。
    -   Microsoft Win32 アプリケーションのエラー\_ドライバー\_プロセス\_未処理の I/O の終了エラー コード。

    **注**   reflector Microsoft Windows XP で実行されている状態で未処理の I/O が完了すると\_ドライバー\_内部\_エラーあり、Win32 アプリケーション、さらに、エラー\_IO\_未処理の i/o デバイス エラー コード。 したがって、Windows XP で実行されるアプリケーションがエラーを使用する必要があります\_IO\_一般的な I/O 要求 (たとえば、状態から返される状態の違いに影響することはできませんので、ドライバーの障害を検出するデバイスWin32 への呼び出しから返された[ **DeviceIoControl** ](https://docs.microsoft.com/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol)関数)。

     

-   リフレクター送信 GUID\_WUDF\_デバイス\_ホスト\_オペレーティング システム、オペレーティング システムは、ホスト プロセスに問題を報告後する問題のカスタムのプラグ アンド プレイ (PnP) イベント。

    アプリケーションが Win32 と呼ばれていた場合**RegisterDeviceNotification** GUID を登録する関数\_WUDF\_デバイス\_ホスト\_デバイス、そのアプリケーションの問題により、受け取ります\_CUSTOMEVENT 通知ホスト処理が失敗したときにします。 詳細については**RegisterDeviceNotification**とにより\_CUSTOMEVENT、Windows SDK のマニュアルを参照してください。

-   オペレーティング システムでは、ドライバーが失敗したことを示すシステム イベント ログにエントリを書き込みます。 また、オペレーティング システムの他にも数が再起動ドライバーを示します。 オペレーティング システムでは、指定された問題を示す、システム イベント ログに次のイベント番号を書き込みます。

    -   ホスト プロセスがエラーにあった場合 10110
    -   10111 場合は、デバイスがオフラインになったし、再起動されました
    -   10112 再起動の場合は、デバイスがオフラインになったし、でした。

    フレームワークは、障害が発生したドライバーを再開しようとすることができます。 UMDF コード検証機能を提供する[レジストリ値](using-umdf-verifier.md)再起動の試行回数を制御します。 ユーザーいずれかを無効にしますデバイス マネージャーでデバイスを有効またはから切り離しし、デバイスに接続されるため、オペレーティング システムは、デバイスの新しいインスタンスを作成し、フレームワークが再起動カウンターをリセットします。

-   オペレーティング システムでは、デバイス スタックでカーネル ドライバーをアンロードします。

    **注**  されませんが、オペレーティング システムの破棄し、以前のスタックにすべてのハンドルが閉じられるまで、デバイス スタックを再起動します。 アプリケーションを検出し、デバイスの突然削除の通知、デバイスの障害 (により\_REMOVEDEVICEPENDING)。 ただし、以前のスタックをいずれかのハンドルが開いたままでは、デバイスは再起動されません。

     

-   ドライバー マネージャーが再起動するか、デバイスを無効にします。 デバイスが無効になっている場合、オペレーティング システムが黄色の感嘆符にデバイス マネージャーが表示されます。

UMDF ドライバーが失敗した後次の操作を任意の順序で実行できることに注意してください。

-   オペレーティング システムを廃棄し、デバイスを再起動します。

-   リフレクター送信 GUID\_WUDF\_デバイス\_ホスト\_オペレーティング システムに問題の PnP イベント。

-   状態が未処理の I/O の完了、reflector\_ドライバー\_プロセス\_終了します。

そのため、アプリケーションがエラーを受け取る可能性があります\_ドライバー\_プロセス\_オペレーティング システムには、デバイスが再起動した後に、未処理の I/O の終了します。 エラーを受け取った後\_ドライバー\_プロセス\_終了すると、アプリケーションにも発生により、\_GUID から結果 CUSTOMEVENT 通知\_WUDF\_デバイス\_ホスト\_問題イベント。

 

 





