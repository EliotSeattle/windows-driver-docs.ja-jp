---
title: I/O キューの電源管理
description: I/O キューの電源管理
ms.assetid: 2e1bf9d2-615b-49b0-b677-f41b23c42eda
keywords:
- 電源管理 WDK KMDF、i/o キュー
- I/o キュー WDK KMDF、電源管理
- I/o 要求 WDK KMDF、電源管理
- 電源管理 i/o キュー WDK KMDF
- 作業状態 WDK KMDF
- PowerManaged settings WDK KMDF
- 低電力状態 WDK KMDF
- スリープ電源管理 WDK KMDF
- 電源状態 WDK KMDF
- デバイスの電源状態 WDK KMDF
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: cab39be50c460e72fbd1ce6fff9d6abbedd457ec
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72845207"
---
# <a name="power-management-for-io-queues"></a>I/O キューの電源管理


フレームワークは、ドライバーのいずれかのデバイスに送られる i/o 要求を受信すると、要求を i/o キューに配置します。 ドライバーは、要求ハンドラーを提供するか、またはキューをポーリングすることによって、i/o キューから i/o 要求を取得できます。 I/o キューの詳細については、「[フレームワークキューオブジェクト](framework-queue-objects.md)」を参照してください。

ドライバーを設計する際には、ドライバーが受け取る i/o 要求を次の2つのカテゴリにまとめる必要があります。

1.  デバイスが動作中 (D0) 状態になる必要がある要求 (次を含む)。
    -   デバイスのデータの読み取りまたは書き込みを行うためにデバイスの関数ドライバーを必要とする読み取り要求または書き込み要求。
    -   デバイス制御は、デバイスにアクセスせずに関数またはバスドライバーがサービスを実行できないことを要求します。

2.  次のように、デバイスを動作中 (D0) 状態にする必要がない要求。
    -   デバイス制御は、デバイスにアクセスすることなく、関数またはバスドライバーがサービスを実行できることを要求します。
    -   フィルタードライバーが受け取る可能性のあるすべての要求。
    -   スタックがハードウェアと通信しないソフトウェアのみのデバイスをサポートしている場合、ドライバースタック内のすべてのドライバーが受信するすべての要求。

フィルタードライバー、またはハードウェアと通信しないスタックのドライバーを記述する場合を除き、デバイスを動作状態にする必要がある要求がドライバーによって受信される可能性があります。

この2種類の要求をサポートするために、フレームワークには2種類の i/o キューが用意されています。これには、*電源管理*されているものと、そうでないものがあります。 ドライバーは、それぞれの i/o キューを作成するときに、キューの[**WDF\_IO\_queue\_CONFIG**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdfio/ns-wdfio-_wdf_io_queue_config)構造体の**Powermanaged**メンバーを**Wdftrue**または**WdfFalse**に設定して、次のいずれかを示すようにします。

-   ドライバーが**Powermanaged**を**wdftrue**に設定している場合、キューは電源管理されます。

    I/o 要求が電源管理キューで使用可能な場合、フレームワークは、デバイスが動作 (D0) 状態にある場合にのみ、ドライバーに要求を配信します。 そのため、ドライバーが電源管理キューから要求を受信するたびに、そのデバイスが使用可能であることがフレームワークによって保証されます。 デバイスが動作状態でない場合は、デバイスが使用可能になるまで、フレームワークによって要求がキューに格納されます。

    デバイスがアイドル状態であるために低電力状態になっていて、フレームワークがいずれかのドライバーの電源管理キューに i/o 要求を配置した場合、フレームワークはドライバースタックに対して、ドライバーに要求を送る前にデバイスを動作状態に戻すように要求します。

    システムが動作している (S0) 状態ではないためにデバイスの電力が低い状態になっている場合に、フレームワークがいずれかのドライバーの電源管理キューに i/o 要求を置くと、フレームワークはデバイスが動作 (D0) 状態に戻るまで待機し、次に要求を配信します。ドライバーを使用します。

    デバイスが動作状態でない場合、フレームワークは電源管理キューからドライバーに i/o 要求を配信しません。そのため、ドライバースタック内の[電源ポリシー所有者](power-policy-ownership.md)*の上にあるドライバー*では、*電源管理 i/o を使用することはできません。キュー*。 電源ポリシー所有者の上にあるドライバーが電源管理キューを使用していて、デバイスが低電力状態の場合、ドライバーは要求を受信せず、電源ポリシー所有者に渡すことができません。 そのため、デバイスの電源状態を制御する電源ポリシー所有者は、デバイスをスリープ解除しません。

-   ドライバーが**Powermanaged**を**WdfFalse**に設定している場合、キューは電源管理されません。

    I/o 要求が、電源管理されていないキューで利用できる場合、そのデバイスが動作中 (D0) 状態であるかどうかに関係なく、その要求はドライバーに配信されます。 デバイスへのアクセスを必要としない要求のみを受信するようにキューを設定した場合、デバイスが使用できない場合でも、ドライバーは各要求を処理できます。

電源管理の i/o キューの詳細については、「[電源管理](using-power-managed-i-o-queues.md)の i/o キューの使用」を参照してください。

一部のドライバーでは、プラグアンドプレイ (PnP) と電源管理操作を直接制御する必要があります。 これらのドライバーは *、自己管理型の*i/o を使用できます。 詳細については、「[自己管理型 i/o の使用](using-self-managed-i-o.md)」を参照してください。

 

 





