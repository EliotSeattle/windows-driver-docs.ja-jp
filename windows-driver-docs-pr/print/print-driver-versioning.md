---
title: 印刷ドライバーのバージョン管理
description: 印刷ドライバーのバージョン管理
ms.assetid: 8ce844a5-44f6-4967-8586-b302823fc862
keywords:
- ドライバー WDK プリンターのインストール、バージョン管理
- プリンター ドライバーのインストール WDK、バージョン管理
- バージョン番号の WDK プリンター
- プリンター ドライバーのバージョン管理 WDK
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 2766f0f4de62a036b03612b71df86780e3fdb4e5
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56528139"
---
# <a name="print-driver-versioning"></a>印刷ドライバーのバージョン管理





Unidrv および Pscript5 ベースのプリンター ミニドライバーとモノリシック プリンター ドライバー (ドライバーは IHV によって完全に開発された) では、Microsoft Windows XP 以降にプリンター ドライバーのバージョン管理を使用してください。 Windows XP およびそれ以降の印刷スプーラーは、バージョン管理情報を使用して、有効にすると、ポイント アンド プリントの新しい接続が確立されている場合または新しいオペレーティング システム バージョンまたは service pack のインストール時に適切なドライバー ファイルを選択します。

Windows 2000 または NT ベースのオペレーティング システムの以前のバージョンでは、プリンター ドライバーのバージョン管理はサポートされていません。 これらのオペレーティング システムのバージョンでは、印刷スプーラーは、ファイルのタイムスタンプだけに特定のドライバー ファイルを置換するかどうかにその意思決定を行います。 新しい日付のファイルが古い機能セットにいる場合でも、古いファイルより新しいファイルが常に選択します。 ファイルの日時を変更する簡単なのでこのスプーラーを防ぐためから選択したファイルで、適切な選択を行うことができます。

正しいバージョンのドライバー ファイルがインストールされていることを確認するには、単にそれらのファイルにバージョン番号を追加します。 Pdrvver.h に小さな変更を加えることによってこれを行う (Windows ドライバー キットに付属する\[WDK\])、し、プリンタ ドライバ DLL のリソース ファイルにそのファイルを含めます。 モノリシックのドライバーの設定、INF ベースのインストールを使用しての利点も活用ドライバーのバージョン管理は、古い DLL がより新しいタイムスタンプにいる場合でも、新しい DLL が、古い DLL によって上書きされないためです。

Pdrvver.h ヘッダーは、プリプロセッサのほぼ例外なく\#ディレクティブを定義します。 最初の 2 つ VER\_FILETYPE および VER\_FILESUBTYPE で、変更しないで、ファイルは、プリンター ドライバーでは具体的には、ドライバーのリソース ファイルであることを示します。 (定数 VFT\_DRV と VFT2\_DRV\_VERSIONED\_VER で表示されます、プリンター\_FILETYPE および VER\_FILESUBTYPE、Microsoft Windows SDK に記載されていますドキュメント、VS を\_FIXEDFILEINFO 構造です)。次の最後の 4 つを変更する必要があるものには。

<a href="" id="ver-fileversion"></a>VER\_FILEVERSION  
この定数は、コンマで区切られた 4 つの WORD 値のシーケンスに設定する必要があります。 3 番目と 4 番目の単語が高に設定し、VS のそれぞれの単語を低に使用される\_FIXEDFILEINFO 構造体の**dwFileVersionLS**メンバー。 4 つの単語の意味は次の表で説明します。

Value

意味

最初の単語

予約済み。 この値は 0 に設定する必要があります。

2 番目の WORD

ドライバーのメジャー バージョンを表します。 ユーザー モード ドライバーでは、これを設定する 0x0003 します。 カーネル モード ドライバーでは、これを設定する 0x0002 します。

3 番目の単語

機能セットの数を表します。

上位バイト

主要な機能セットのリリースを表します。 それ以降のリリースでは、以前のリリースの機能のスーパー セットがあると見なされます。 新しい各メジャー リリースでは、この値をインクリメントします。

Unidrv および Pscript5 ベース ミニドライバーが Windows 更新プログラムおよびサービス パックを含む、Windows xp 以降を実行しているは、これは 0x05 に設定する必要があります。

下位バイト

マイナー機能セットのリリース - 同じコード ベースまたはアーキテクチャから新しいリリースを表します。 新しいマイナー リリースごとにこの値をインクリメントします。

次のオペレーティング システムのリリースで実行されている Unidrv および Pscript5 ベースのミニドライバーのように、このバイトを設定する必要があります。

Windows XP:0x01 に設定します。

最初の Windows XP Service Pack です。0x01 に設定します。 (特定のバグの修正プログラムの数は、4 番目の WORD で表示されます)。

最初の Windows 更新プログラム:0x02 に設定します。

4 番目の単語

バグの修正プログラムまたは service pack のリリースを表します。 バグの修正プログラムや service pack のコレクションがある場合に、新しいバイナリでは、リリースには、この値をインクリメントします。

 

モノリシックなドライバーの使用例を次に示します。

```cpp
#define VER_FILEVERSION    0, 3, 0X0100, 0X0002
```

、左右からの順序では、最初の WORD 値は 0 で、する必要がありますが。 2 番目の単語の値は、ユーザー モード ドライバーであることを示す、3 つです。 3 番目の WORD では、上位バイトの値 (0X01) は、これは、最初のメジャー リリースを同じ単語 (0x00) の下位バイトを示しますが、これまでにないマイナー リリースを表します。 4 番目の単語 (0x0002) は、2 番目のバグを修正または service pack のリリースであることを示します。 (は区別されませんリリースのこれらの型。)

ここではいくつか Unidrv-/Pscript5 ベース ミニドライバーの例。

```cpp
#define VER_FILEVERSION    0, 3, 0X0501, 0X0001
```

、左右からの順序で単語の最初の値は 0 です、以前と同様。 2 番目の単語の値は、ユーザー モード ドライバーであることを示す、3 つです。 3 番目の WORD、上位バイトと下位バイト値 (0X05 と 0x01、それぞれ) これは Windows XP のリリースであることを示します。 4 番目の単語 (0x0001) は、最初のバグを修正または service pack のリリースであることを示します。

```cpp
#define VER_FILEVERSION    0, 3, 0X0502, 0X0000
```

前に、最初の単語には 0 と 2 番目の単語の場合、これがユーザー モード ミニドライバーであることを示します。 3 番目の単語 (の場合は 0x0502) は、Windows XP 以降後にリリースされた最初の Windows 更新プログラムのバージョンであることを示します。 4 番目の単語 (0x0000) は、バグ修正も service pack のリリースであることを示します。

<a href="" id="ver-filedescription-str"></a>VER\_FILEDESCRIPTION\_STR  
この定数は、次の例のように、ドライバーを識別する名前に設定する必要があります。

```cpp
#define VER_FILEDESCRIPTION_STR    "Sample Printer Driver Resource DLL"
```

<a href="" id="ver-internalname-str"></a>VER\_INTERNALNAME\_STR  
次の例のように (いないパスを含む)、ファイルの内部名を指定する名前には、この定数を設定します。 詳細については、Windows SDK のドキュメントを参照してください。

```cpp
#define VER_INTERNALNAME_STR    "SAMPLERES.DLL"
```

<a href="" id="ver-originalfilename-str"></a>VER\_[ORIGINALFILENAME]\_STR  
次の例のように (いないパスを含む)、ファイルの元の名前を指定する名前には、この定数を設定します。 詳細については、Windows SDK のドキュメントを参照してください。

```cpp
#define VER_ORIGINALFILENAME_STR    "SAMPLERES.DLL"
```

 

 




