---
title: V4 ドライバー セットアップ概念
description: V4 印刷ドライバー モデルでは、新しい設定モデルを使用して、ユーザー エクスペリエンスの向上し、サポート コストを削減します。
ms.assetid: C1DF5496-14CF-4BF4-B85C-AF1A691C7AF2
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 29bd4610f1957bf8fe27ceb848a07a22f4a1f2c2
ms.sourcegitcommit: 0cc5051945559a242d941a6f2799d161d8eba2a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "63324843"
---
# <a name="v4-driver-setup-concepts"></a>V4 ドライバー セットアップ概念


V4 印刷ドライバー モデルでは、新しい設定モデルを使用して、ユーザー エクスペリエンスの向上し、サポート コストを削減します。

V4 印刷ドライバーをドライバー ストアは、ファイルの競合の可能性を排除し、インストール パフォーマンスが向上するから直接実行するとします。 V4 セットアップ モデルでは、引き続き INF ファイルを使用するが、また、プリンターの特定のセットアップのディレクティブをキャプチャする場合は、新しいマニフェスト ファイルを使用しています。

## <a name="device-identifiers"></a>デバイスの Id


**CompatibleID**します。 CompatibleIDs は、ドライバーを更新することがなく、Windows の新しいバージョンがリリースされた後にリリースされているデバイスをサポートするドライバーを有効にするための印刷クラス ドライバーの重要な概念です。 CompatibleIDs、HardwareID はより低い特定の印刷ドライバーのサポートを提供するデバイスを有効にするため、可能です。

特定 CompatibleID は既に印刷クラス ドライバーによってサポートされている場合、v4 印刷ドライバーを指定しないでください、もう一度です。 印刷ドライバーの日付が印刷クラス ドライバーの日付よりも新しい場合は、印刷ドライバーが Windows Update サイトから自動的にダウンロードされます。

デバイスは、その 1284ID 文字列で CompatibleIDs を含める必要があります。 既存の印刷クラス ドライバーは、デバイスをサポートする場合、印刷ドライバーは、CompatibleID、それ以外の場合お勧め、次の形式を使用することで使用する必要があります。

1284\_CID\_&lt;製造元識別子&gt;\_&lt;PDL 識別子&gt;\_デバイス ファミリの識別子

次に、例を示します。1284\_CID\_FA\_PCL5e\_レーザー

CompatibleIDs は、既存のデバイスで既に実装されて、印刷ドライバーはこれら CompatibleIDs を使用して引き続き必要があります。

CompatibleIDs は、印刷デバイスの IP ベースのインストールでは使用されません。 その結果、ユーザーは、ドライバーの名前のみを使用して適切なドライバーを識別する必要があります。 印刷クラス ドライバーに関しては、製造元が、印刷クラス ドライバーでサポートされているすべてのデバイスの web サイトでの互換性リストを提供するをお勧めします。 規則と制限事項の完全な一覧を含む、ハードウェアで CompatibleIDs を実装する方法の詳細についてを参照してください。[印刷デバイスに互換性のある Id を実装する方法](https://msdn.microsoft.com/library/windows/hardware/gg463313.aspx)します。

Microsoft では、いくつかの製造元に依存しない (standard) の印刷クラス ドライバーをサポートするために、いくつかの標準 CompatibleIDs をサポートしています。 次の表は、これらの標準 CompatibleIDs と、関連付けられている PDL ファイルの種類を示します。

| PDL ファイルの種類      | 標準 CompatibleID |
|--------------------|-----------------------|
| XPS                | 1284\_CID\_MS\_XPS    |
| OpenXPS (ECMA 388) | 1284\_CID\_MS\_OXPS   |
| PCL6               | 1284\_CID\_MS\_PCL6   |
| PS                 | 1284\_CID\_MS\_PS     |

 

これらの標準の印刷クラス ドライバーは、これらのクラス ドライバーを利用する製造元は拡張ドライバーの構成を実装する必要があります Bidi を使用して、特定の用紙サイズと構成を追加するための機能、少数のセットのみをサポートします。 次の表は、機能と標準の印刷クラス ドライバーでサポートされている、関連するオプションを示します。

| 機能    | オプション           |
|------------|-------------------|
| 用紙サイズ | 文字、A4        |
| 解決方法 | 300dpi, 600dpi    |
| メディアの種類 | 普通紙       |
| N-up       | 1, 2, 4, 6, 9, 16 |

 

**PrinterDriverID**します。 PrinterDriverID は、ドライバーとプリンターの拡張機能間の互換性と、プリンターを共有するためのドライバーの間の互換性を判定するために使用する新しい識別子です。 たとえば、サーバー上のドライバーが、マニフェスト ファイルで、PrinterDriverID を指定し、ドライバーは、共有された場合、このプリンターに接続するクライアントは、ローカル ドライバー ストアと Windows Update ドライバーを検索で同じ PrinterDriverID を指定します。ドライバーの INF です。 一致が見つかった場合は接続そのドライバーを使用しています。 クライアント コンピューターは、ドライバー名を使用して照合結果をフィルター処理します。

次の方法ですべての互換ドライバーの PrinterDriverID を指定する必要があります。

-   V4 マニフェストで PrinterDriverID ディレクティブの使用。

-   V4 ドライバーの INF HardwareID として。

共有の互換性のある同じ PrinterDriverID を共有する 2 つの異なるドライバーがあります。 常に成功した接続の 2 つのドライバーは、以下を実行できる必要があります。

-   同じ PDL のサポート

-   同じ種類 (GPD または PPD) 構成ファイルの使用します。

-   その機能や、サーバーのドライバーの GPD、PPD や制約の JS ファイルで指定されたオプションを表示できます。

-   同じプリンター拡張をサポートします。

スプーラは、これらの制限は検証されませんを 2 つのドライバーは共有と互換性があるかどうかを示す PrinterDriverID のみに依存しています。 製造元は、上記の項目のいずれかの変更が加えられた場合は、ドライバーの PrinterDriverID を変更する必要があります。

プリンターの拡張機能を PrinterDriverIDs を使用してドライバーを関連付けることもできます。 その結果、PrinterDriverID を共有する 2 つのドライバーはする必要があります両方同じプリンター拡張機能で機能します。 最後のプリンター拡張機能がインストールされているすべてのデバイスを対象となる PrinterDriverIDs を同じアプリを使用して適切に動作する必要がありますを使用して、以前のプリンター拡張機能が上書きされます。

**Guid を使用するためのベスト プラクティス**します。 Guid は、PrinterDriverID の最も顕著なと、PrinterExtensionID、イベント Id、および、ModelID に v4 印刷ドライバー モデルを通じて広く使用されます。 システムでは、さまざまなアイテムを一意に識別する、またはそれらサービス、共有などのために同じものとして識別するために使用されますか。

新しい Guid を作成するときは常に Microsoft Visual Studio に含まれるものなど、SDK に含まれる 1 つの GUID ジェネレーターを使用します。 手動で作成された Guid と誤ってコピーおよび貼り付けされた Guid は、競合発生しやすくします。

## <a name="setup-behaviors"></a>セットアップの動作


**印刷キュー名は**します。 V3 ドライバーでは、印刷キュー名は、ドライバー名、ユーザーが最初に決まりますでした。 印刷クラス ドライバーの導入に伴い、ドライバー名は、デバイスのユーザーの認識の役に立ちません。 Windows は v4 印刷ドライバーを次のように実行するインストールされている任意のプラグ アンド プレイ デバイスを自動的にキューに名前を変更します。

1. 最初に、印刷キュー名は、ドライバー名に設定されます。

2. V4 印刷ドライバーをドライバーには、Windows は双方向を使用してデバイスを照会します。

a.  場合\\Printer.DeviceInfo:FriendlyName を指定すると、これは、新しいキュー名として使用します。

b.  それ以外の場合、Windows は、照会\\Printer.DeviceInfo:Manufacturer、 \\Printer.DeviceInfo:ModelName します。

i.  両方を指定すると、Windows が連結されますに"製造元 ModelName"にします。

ii.  これらの双方向のいずれか、クエリの失敗だけの場合 Windows はキューの名前として、他のクエリから正常に返されたを使用します。

3. すべての Bidi クエリが失敗した場合は、Windows が使用されます IEEE 1284ID 製造元とモデルの名前を決定します。

a.  説明または DES が指定されている場合は、新しいキュー名として使用されます。

b.  それ以外の場合、Windows は、製造元または製造およびモデルまたは MDL が検索されます。

i.  両方を指定すると、Windows が連結されますに「製造元モデル」にします。

ii.  次のいずれかが失敗した場合は、専用の場合 Windows はキューの名前として他のキーから値を使用します。

**プリンターの追加ウィザード**します。 内のドライバーを選択するユーザーが使用できる唯一の識別子である、ドライバー名は引き続き、**プリンターの追加ウィザード**します。 TCP ベースのデバイスを実装する必要があります、[ポート モニター MIB (PWG 5107.1 2005)](http://www.pwg.org/standards.html) TCP/IP の自動検出をサポートします。 ハードウェア ID (HWID) のマッピングを使用して印刷クラス ドライバーに追加されている既存のデバイスは、デバイスに固有のモデル名を使用してさらに可能性があります。

## <a name="changing-ports-and-dealing-with-printer-devnodes"></a>変化するポートおよびプリンター Devnode を扱う


すべての印刷キューでは、一貫した UI エクスペリエンスを提供するには、ソフトウェア デバイス ノード (devnode) が提供されます。 これは、UI では、プリンターを検出する方法と仮想プリンター、共有プリンターを列挙し、プラグ アンド プレイ (PnP) プリンターと同じ方法でアクセスするネットワーク プリンターへの接続を許可します。 PnP プリンターの物理的なソフトウェア devnode はキューの作成をトリガーした PnP devnode からプロパティを継承します。

UI が 2 つのオブジェクトが関連する場合は、デバイスのコンテナーに devnode をグループします。 このグループ化が、多機能プリンター (MFP) 1 つのアイコンとして表示することができます、**デバイスとプリンター**フォルダー。 同じアイコンの下に表示するすべての関数の順序で同じ、MFP のすべての関数のコンテナー ID がある必要があります。 これは、PnP デバイスの場合、自動的に実行されます。

キューに関連付けられているポートを変更すると、キューの devnode に関連付けられたコンテナー ID が変更されます。 これにより、物理デバイスの PnP オブジェクトの残りの部分と同じデバイス コンテナーで不要になったグループ化するキュー。 キューと PnP オブジェクトを区切りになる状況を適切にクリーンアップするオペレーティング システムに十分な情報がありません。 場合によっては、ユーザーの実際の意図しています。 ユーザーまたはポートの名前を変更するアプリケーションのみを目的の結果が知っているし、キューのポートが変更された後に残されたすべての混乱状態をクリーンアップするユーザー/アプリケーションの責任です。 適切にクリーンアップする方法を示す手順で、例の 2 つの状況を次に示します。

1. IT 管理者の設定 – プリンターを IT 管理者が WS 探索を使用して、ネットワーク上のプリンターを検索し、ので、TCP/IP 管理プロセスに TCP/IP ポートを変更します。

a.  期待 – そこでは、デバイスとプリンター フォルダーを 1 つだけの「デバイス」。

b.  ソリューション: IT 管理者は、デバイスとプリンター フォルダーから WSD PnP devnode を削除します。

2. セットアップ ソフトウェアの IHV-カスタム ポート モニターと共にドライバーをインストールする、IHV (v4 でカスタム ポート モニターは使用できませんが、同じ devnode 処理は v3 ドライバーに適用されます)。 IHV は、デバイスの製造元を作成します。 ポートに印刷キューの USB ポートを変更します。

a.  期待 – そこでは、デバイスとプリンター フォルダーを 1 つだけの「デバイス」。

b.  ソリューション\#1 – PnP devnode が必要です。セットアップ プログラムでは、PnP オブジェクトと一致するキュー devnode のコンテナー ID を変更します。

c. ソリューション\#2 – PnP devnode は余分な。セットアップ プログラムは、元の PnP デバイスを削除します。

**ドライバーのランク付け**します。 V4 印刷ドライバーの概要では、プラグ アンド プレイが順位付けの動作は変更されません。 デバイスが接続されている、最高スコアの使用可能なドライバーが選択されます。 選択したドライバーは、印刷クラス ドライバーより適切にランクがある場合は、照合し、ドライバー、Windows Update サイトで、選択したドライバーが自動的に置き換えられます、次回ユーザーが Windows の更新プログラムをダウンロードします。

ドライバーのランク付けの詳細については、次を参照してください。[ランク ドライバーをどのように Windows](https://msdn.microsoft.com/library/windows/hardware/ff546225.aspx)します。

## <a name="driver-setup-best-practices"></a>ドライバーの設定のベスト プラクティス


**パッケージ化**します。 V4 印刷ドライバーを使用していない、**必要がある**と**が含まれています**INF ファイルのディレクティブ、または共有ファイルを処理するために、ドライバー テクノロジをコアします。 その結果、v4 印刷ドライバーは、いくつかの例外の自己完結型である必要があります。

V4 印刷ドライバーがその Windows の一般的なファイル依存関係を実行する継続を提供します。 NTPrint.INF または NTPrint4.INF でファイルが含まれます。 ドライバーは、指定することによってこれらのファイルを含めることができます、 **RequiredFiles** v4 のマニフェスト ファイルでディレクティブ。

デバイスまたはの PDL の基本的なレンダリング機能を提供する印刷クラス ドライバーが存在する場合、クラス ドライバーを使用して、依存関係を取得するためのメカニズムもが、 **RequiredClass**ディレクティブ。 このディレクティブは、v4 印刷ドライバーと、必要な印刷クラス ドライバーの両方からファイルを使用してドライバーをビルドする Windows により、します。 GPD と PPD ファイルは、優先順位の低い特定のファイル引き継ぐ最も特定のファイルとマージされます。 次の図は、GPD/PPD ファイルをマージするために使用するロジックを示しています、Bidi から取得した拡張ドライバーの構成ファイルも含まれます。 JavaScript の制約などの他のドライバー ファイルは、ドライバー パッケージにはマージされません。

![gpd/ppd ファイルのマージ ロジック](images/gpd-ppdmergelogic.png)

**プリンター Model Lines**します。 プラグ アンド プレイ HardwareIDs と CompatibleIDs のすべてのモデルの線での暗黙的なランキングを保持します。 その結果、パートナーが順位付けに関して予期しない動作を回避するために次のベスト プラクティスを使用する必要があることをお勧めします。

v4 印刷ドライバー

1. V4 印刷ドライバーの Inf には、モデルの行の 2 つのさまざまな種類を定義する必要があります。

a.  HardwareID 行:"Driver name"= インストール\_セクション、busenumerator\\HardwareID

b.  PrinterDriverID 行:"Driver name"= インストール\_セクションでは、{GUID}

2. V4 印刷ドライバーの Inf では、個々 の行に bus 固有 HardwareIDs を定義する必要があります。

a.  "Driver name"= インストール\_セクションでは、WSDPRINT\\HardwareID

b.  "Driver name"= インストール\_セクションでは、USBPRINT\\HardwareID

c. "Driver name"= インストール\_セクションでは、LPTENUM\\HardwareID

印刷クラス ドライバー

1. 印刷クラス ドライバーの Inf には、モデルの行の 3 つのさまざまな種類を定義する必要があります。

a.  HardwareID 行:"Driver name"= インストール\_セクションでは、HardwareID

b.  PrinterDriverID 行:"Driver name"= インストール\_セクションでは、{GUID}

c. CompatibleID 行:"印刷クラス ドライバー name"= インストール\_セクション、および 1284\_CID\_CompatID

2. 印刷クラス ドライバーの Inf (たとえば、WSDPRINT bus 列挙子を定義する必要があります。\)

## <a name="related-topics"></a>関連トピック
[印刷デバイスに互換性のある Id を実装する方法](https://msdn.microsoft.com/library/windows/hardware/gg463313.aspx)  
[Windows ドライバーをランク付けする方法](https://msdn.microsoft.com/library/windows/hardware/ff546225.aspx)  
[ポート モニター MIB (PWG 5107.1 2005)](http://www.pwg.org/standards.html)  



