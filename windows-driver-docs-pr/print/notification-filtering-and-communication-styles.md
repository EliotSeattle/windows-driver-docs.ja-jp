---
title: 通知のフィルター処理と通信スタイル
description: 通知のフィルター処理と通信スタイル
ms.assetid: 66d019c2-0760-440d-acc4-85a7c073929a
keywords:
- スプーラ通知 WDK の印刷、フィルター処理
- 印刷スプーラ通知 WDK、フィルター処理
- 通知フィルター WDK の印刷スプーラー
- WDK スプーラーの通知をフィルター処理
- CreatePrintAsyncNotifyChannel
- RegisterForPrintAsyncNotifications
- 通知のデータ型の WDK 印刷スプーラー
- データ型の WDK スプーラーの通知
- WDK スプーラー通知の通信
- すべてのリスナー通知 WDK 印刷スプーラー
- ユーザーごとのリスナーの WDK スプーラーの通知をフィルター処理
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 400860734767a3aa137321575739e9204dd5743a
ms.sourcegitcommit: 0cc5051945559a242d941a6f2799d161d8eba2a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "63339974"
---
# <a name="notification-filtering-and-communication-styles"></a>通知のフィルター処理と通信スタイル





このセクションには、スプーラーのプロセスと印刷の間のインターフェイスがについて説明します、プリント プロセッサ、ドライバー、およびモニターなどのコンポーネント。

### <a name="notification-filtering"></a>通知にフィルター処理

PrintAsyncNotifyUserFilter 列挙型は、2 つの状況で使用されます。 これらの最初のスプーラー内で実行される印刷コンポーネントを呼び出して、 [CreatePrintAsyncNotifyChannel](https://go.microsoft.com/fwlink/p/?linkid=124750)通知チャネルを作成する関数。 呼び出し元は、リッスンしているクライアントは通知を受信する許可を指定する PrintAsyncNotifyUserFilter 列挙型の 1 つの列挙子を渡します。 2 番目の状況でリッスンしているクライアントが呼び出す、 [RegisterForPrintAsyncNotifications](https://go.microsoft.com/fwlink/p/?linkid=124752)通知に登録する関数。 呼び出し元は、いずれかを示す通知を受信する PrintAsyncNotifyUserFilter 列挙子を渡します。

```cpp
typedef enum 
{
  kPerUser,
  kAllUsers
} PrintAsyncNotifyUserFilter; 
```

次の図に、 **kPerUser**への呼び出しで列挙子が使用される、 **CreatePrintAsyncNotifyChannel**関数。 その結果、通知を受信しているリスナーのみ、ユーザーと同じユーザー アカウントで実行されている、登録を行ったユーザーが許可されます。

![図に示すユーザーごとのリスナーがフィルター処理](images/notifyfilt1.gif)

次の図に、 **kAllUsers**への呼び出しで列挙子が使用される、 **CreatePrintAsyncNotifyChannel**関数。 その結果、プリンターまたはサーバーに関心があるすべてのリスナーは、通知を受信することができます。 使用する管理者のみが許可されていることに注意してください、 **kAllUsers**この関数の呼び出しで設定します。

![すべてのリスナーに通知を示す図](images/notifyfilt2.gif)

次の図は、ユーザー 1 とユーザー 2 の両方が登録されている通知を呼び出すことによって、この状況を示しています、 **RegisterForPrintAsyncNotifications**関数を**kPerUser**で列挙子呼び出し。 3 つの通知を送信しては、リスナー ユーザー 1 は、ユーザー 1 から 0 のセッションまたはセッション 1 のいずれかで通知を受け取ります。 リスナー ユーザー 2 は、セッション 2 でユーザー 2 からの通知を受信します。

![ユーザーごとの通知のフィルター処理を示す図](images/notifyfilt3.gif)

上記の図に示すように、待機中のクライアントを呼び出したかどうか**RegisterForPrintAsyncNotifications**がこの時間の受け渡し、 **kAllUsers**列挙子の呼び出しで、すべてのセッション内のすべてのリスナー3 つの通知を受信しました。 使用する管理者のみが許可されていることに注意してください、 **kAllUsers**この関数の呼び出しで列挙子。

### <a href="" id="administrators-"></a>管理者

プリンターを持つユーザーは、管理者が\_アクセス\_管理権利を指定されたオブジェクトを印刷します。 管理者は、すべてのユーザーに通知を送信することができ、すべてのユーザーからの通知を受け取ることができます。 通知フィルターが適用されていることに注意してください。

次の図では、Joe がのチャネルで通知を送信する**kPerUser**します。 チャネルは、この列挙子に基づいてフィルター選択はとき、つまりセッション 1 ユーザーの 1 に属しているセッションにのみ、通知を送信する必要があります。 ただし、通知にも送信セッション 2 がリッスンしている管理者があるため、この種類の通知がリッスンしているとします。 通知の種類が同じでないため、セッション 3 で管理者が、通知を受信できませんに注意してください。

![ユーザーごとおよび通知の種類のフィルター処理を示す図](images/notifyfilt4.gif)

### <a name="specifying-the-type-of-communication"></a>通信の種類を指定します。

印刷のコンポーネントでは、通信の種類を指定すると、リスナー、クライアントからの応答が必要だかどうか方法と、スプーラー場合の処理通知が複数のクライアントから送信されることを示します。

```cpp
typedef enum 
{
  kBidirectional = 1, 
  kUnidirectional, 
} PrintAsyncNotifyConversationStyle
```

通信 - 単方向と双方向の 2 種類があります。 一方向の通信は、スプーラーの通知をリッスンしているクライアントは応答しません。 この場合は、リッスンしているクライアントが通知を受け取るためにのバックアップを送信することはできません、 **NULL**[IPrintAsyncNotifyChannel](https://go.microsoft.com/fwlink/p/?linkid=124758)インターフェイス ポインター。 双方向の通信では、クライアントは、通知を受信し、印刷コンポーネントを含むダイアログ ボックスで実行する場合に、応答を送信します。 これは、UI の通知の場合です。

複数のセッションが UI の通知を受信するような状況には、コメントが必要です。 このような状況で、スプーラーがチャネルを開くし、すべてに通知しますリスナーは、最初の通知を送信して、フィルターに一致します。 最初のリスナーが応答するときは、スプーラーは、他のチャネルを閉じ、ダイアログ ボックスが最初のクライアントに移ります。

管理者 (たとえば) ログオンしている場合、登録済みのリッスンしているクライアントが応答する前に、管理者は、リッスンしているクライアントと同じ UI の通知を受信します。

最初のユーザー (たとえば管理者) は、応答を送信するとき、スプーラー マークとその他のクライアントの接続を"closed" リッスンしている他のクライアントは最終的に応答すると「チャネルが閉じられた」メッセージを受信します。

### <a name="notification-types"></a>通知の種類

通知の種類には、スプーラーを受け取り、リスナー クライアントをフィルター処理を使用して GUID です。 (詳しくは、ヘッダー ファイル Prnasnot.h PrintAsyncNotificationType 型定義を参照してください)。スプーラの非同期の通知メカニズムのすべてのクライアントは、独自の通知の種類を定義できます。 スプーラが送信される通知の種類の意味に注意してくださいでない場合でも引き続き通知の種類に基づいてリスナー クライアントをフィルターします。

各通知は、関連付けられている通知データ型である必要があります。 この型では、通知のデータ スキーマを識別します。

通知のデータの種類だけでなく、チャネル、通知チャネルの種類に関連付けられた型があります。 通知の送信側とリッスンしているクライアントは、さまざまな目的の通知チャネルの種類を使用します。

チャネルの送信者側では、印刷コンポーネントは、チャネルを開くときに、そのチャネルを介して送信する通知の種類ことができますを指定します。 通知チャネルの種類と同じ型のすべての通知チャネルに渡される必要があります。

送信者がスプーラーは適切な待機中のクライアントに送信する方法を「認識」できるように、種類を通知と関連付け常にする必要があります。 リッスンしているクライアントは、独自のスキーマに合わせてデータを検証する必要があります。 通知の種類は、このスキーマを識別します。

チャネルのリスナーの側では、リッスンしているクライアントが通知の 1 つの種類を登録する際に、特定の通知データ型を指定することで受信を要求できます。

スプーラーは、待機中のクライアントにサービスまたはアプリケーションが終了したことを発表するのに使用される特別な通知の種類を定義します。

```cpp
const GUID NOTIFICATION_RELEASE;
```

リッスンしているクライアントは、この種類のメッセージを受信できる場合にのみその[IPrintAsyncNotifyCallback::ChannelClosed](https://go.microsoft.com/fwlink/p/?linkid=124756)メソッドが呼び出されます。

### <a href="" id="notification-registration-handle-"></a>通知登録ハンドル

クライアントは、通知を登録、サーバー側のスプーラーは、セキュリティ コンテキストなど、アプリケーションに関する情報を持つ内部テーブルを保持します。 通知の登録ハンドルは、クライアントが受信するための非透過構造体です。

このハンドルを使用してのみ通知を受信するため、クライアント登録を解除できます。

 

 




