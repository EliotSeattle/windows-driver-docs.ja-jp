---
title: チーミング プロバイダー拡張機能
description: チーミング プロバイダー拡張機能
ms.assetid: 94F73ECD-54D0-4218-B3C4-33DC3BD57ED0
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: d93328b8029926992574ab1d18f72d7a898c963d
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72841780"
---
# <a name="teaming-provider-extensions"></a>チーミング プロバイダー拡張機能


拡張可能スイッチの外部ネットワークアダプターは、NDIS マルチプレクサー (MUX) 中間ドライバーの仮想ミニポートエッジにバインドできます。 MUX 中間ドライバー自体は、ホスト上の1つまたは複数の物理ネットワークのチームにバインドできます。 この構成は、*拡張可能なスイッチチーム*と呼ばれています。 拡張可能なスイッチチームの詳細については、「[物理ネットワークアダプターの構成の種類](types-of-physical-network-adapter-configurations.md)」を参照してください。

この構成では、拡張可能なスイッチ拡張機能は、拡張可能なスイッチチームのすべてのネットワークアダプターに公開されます。 これにより、拡張可能なスイッチドライバースタックの転送拡張機能が、チーム内の個々のネットワークアダプターの構成と使用を管理できるようになります。 たとえば、拡張機能は、送信パケットを個々のアダプターに転送することによって、チームで負荷分散フェールオーバー (LBFO) ソリューションのサポートを提供できます。 このような拡張機能は、*チーミングプロバイダー*と呼ばれます。

次の図は、NDIS 6.40 (Windows Server 2012 R2) の外部ネットワークアダプターにバインドされている、基になる拡張可能なスイッチチームとの間で送受信されるパケットトラフィックのデータパスを示しています。

![ndis 6.40 の外部ネットワークアダプターにバインドされている vswitch チームとの間のパケットトラフィックのデータパス](images/vswitchteam-ndis640.png)

次の図は、NDIS 6.30 (Windows Server 2012) の外部ネットワークアダプターにバインドされている、基になる拡張可能なスイッチチームとの間のパケットトラフィックのデータパスを示しています。

![ndis 6.30 の外部ネットワークアダプターにバインドされている vswitch チームとの間のパケットトラフィックのデータパス](images/vswitchteam.png)

チーミングプロバイダーは、転送拡張機能によって可能なすべてのことを実行できます。 さらに、チーミングプロバイダーは次の操作を行うことができます。

-   拡張可能なスイッチチーム内の個々の物理アダプターに送信パケットを転送します。 この機能は、LBFO 機能に特に役立ちます。

-   標準の NDIS オブジェクト識別子 (OID) 要求を、拡張可能なスイッチチームの個々の物理アダプターに転送します。 この機能は、ハードウェアのオフロード用にチームのアダプターを構成する場合に特に便利です。

    たとえば、MUX ドライバーは、拡張可能なスイッチチーム全体の共通機能をアドバタイズします。 ただし、チーミングプロバイダーは OID 要求を発行して、チーム内のアダプターの個々の機能を照会することができます。 次に、チーミングプロバイダーは、拡張可能スイッチの外部ネットワークアダプターに OID 要求を発行して、チーム全体に適用される機能を設定できます。

-   拡張可能なスイッチチーム内の個々の物理アダプターにプライベート OID 要求を転送します。 これらのプライベート OID 要求は、物理ネットワークアダプター用の独立系ハードウェアベンダー (IHV) によって定義されます。 これにより、IHV によって開発されたチーミングプロバイダーが、チーム内の個々の物理アダプターで独自の属性を有効または無効にすることができます。

-   拡張可能なスイッチチームから NDIS 状態の情報を変更します。 この機能は、ハードウェアのオフロードのために拡張可能なスイッチチームを管理する場合に特に役立ちます。

    たとえば、MUX ドライバーは、拡張可能なスイッチチーム全体に共通の設定を使用して、NDIS ステータスの兆候を発行します。 拡張可能なスイッチチームで、チーミングプロバイダーがネットワークアダプターに対して有効にしたハードウェアオフロードの状態を示した場合、チーミングプロバイダーは最初に OID 要求を発行して、そのアダプターの現在の機能を照会できます。 次に、チーミングプロバイダーは、表示データを変更して、アダプターで変更された可能性がある属性を設定できます。

チーム化プロバイダーは、拡張可能なスイッチチームを管理するときに、次のガイドラインに従う必要があります。

-   チーミングプロバイダーは、拡張可能なスイッチネットワーク接続が確立されている物理ネットワークアダプターごとに状態を維持する必要があります。

    外部ネットワークアダプターにバインドされているすべての物理ネットワークアダプターについて、拡張可能スイッチのプロトコルエッジは、Oid\_の別の OID セット要求を発行し[\_NIC\_作成](https://docs.microsoft.com/windows-hardware/drivers/network/oid-switch-nic-create)します。 この OID 要求は、基になる物理アダプターへのネットワーク接続の作成について拡張機能に通知します。

-   物理ネットワークアダプターへのネットワーク接続が作成されると、外部ネットワークアダプターが接続されているポートに対して一意の0以外のインデックス値が割り当てられます。

    チーミングプロバイダーは、基になる物理ネットワークアダプターにパケットまたは OID 要求を送信または転送するときに、ネットワークアダプターのインデックス値を指定する必要があります。

    詳細については、「[ネットワークアダプターのインデックス値](network-adapter-index-values.md)」を参照してください。

-   チーミングプロバイダーがパケットを物理アダプターに発行または転送する場合は、物理アダプター接続の0以外のネットワークアダプターインデックス値を指定する必要があります。

    プロバイダーは、パケットを受信すると、 [**NET\_BUFFER\_LIST**](https://docs.microsoft.com/windows-hardware/drivers/ddi/ndis/ns-ndis-_net_buffer_list)構造のパケットの帯域外転送コンテキストから、発信元ネットワークアダプターのインデックス値を特定できます。 転送コンテキストの詳細については、「 [Hyper-v 拡張可能スイッチ転送コンテキスト](hyper-v-extensible-switch-forwarding-context.md)」を参照してください。

    詳細については、「 [Hyper-v 拡張可能スイッチのデータパス](hyper-v-extensible-switch-data-path.md)」を参照してください。

-   物理アダプターに対して OID 要求を転送するには、チーミングプロバイダーは、 [**NDIS\_スイッチ\_NIC\_oid\_要求**](https://docs.microsoft.com/windows-hardware/drivers/ddi/ntddndis/ns-ntddndis-_ndis_switch_nic_oid_request)構造内に oid 要求をカプセル化する必要があります。 プロバイダーは、物理アダプター接続の0以外のネットワークアダプターインデックス値に**DestinationNicIndex**メンバーを設定する必要があります。 プロバイダーは、カプセル化された oid 要求をターゲットの物理アダプターに配信するように、oid の oid セット要求[\_NIC\_要求\_](https://docs.microsoft.com/windows-hardware/drivers/network/oid-switch-nic-request)発行します。

    詳細については、「[物理ネットワークアダプターへの OID 要求の管理](managing-oid-requests-to-physical-network-adapters.md)」を参照してください。

-   チーミングプロバイダーは、基になる物理アダプターの代わりに NDIS 状態の情報を発行できます。 これを行うには、プロバイダーは、 [**NDIS\_スイッチ\_NIC\_状態\_示さ**](https://docs.microsoft.com/windows-hardware/drivers/ddi/ndis/ns-ndis-_ndis_switch_nic_status_indication)れる構造体に示されている情報をカプセル化する必要があります。 プロバイダーは、物理アダプター接続の0以外のネットワークアダプターインデックス値に**Sourcenicindex**メンバーを設定する必要があります。 次に、プロバイダーは、 [**ndis\_status\_スイッチ\_NIC\_の状態**](https://docs.microsoft.com/windows-hardware/drivers/network/ndis-status-switch-nic-status)を示す ndis ステータスを発行して、カプセル化された状態の表示を拡張可能なスイッチドライバースタック内の他のドライバーに配信します。

    詳細については、「[物理ネットワークアダプターからの NDIS ステータス](managing-ndis-status-indications-from-physical-network-adapters.md)表示の管理」を参照してください。

拡張機能の転送の詳細については、「[拡張機能の転送](forwarding-extensions.md)」を参照してください。

MUX ドライバーの詳細については、「 [NDIS MUX 中間ドライバー](ndis-mux-intermediate-drivers.md)」を参照してください。

 

 





