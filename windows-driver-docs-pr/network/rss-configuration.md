---
title: RSS の構成
description: RSS の構成
ms.assetid: 84a00163-6908-439a-a980-c13f0ec8e3c1
keywords:
- 受信側スケーリング WDK ネットワーク、ndirection テーブルの例
- RSS の WDK にネットワーク接続、間接指定テーブルの例
- 受信側のスケーリング WDK ネットワー キング、構成
- RSS の WDK ネットワーク、構成
- WDK RSS ndirection テーブルの例
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: bf8b8b30a3b5ffb52e5c274f61f636140091218e
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56529584"
---
# <a name="rss-configuration"></a>RSS の構成





RSS 構成情報を取得する上位のドライバーがの OID クエリを送信できます[OID\_GEN\_受信\_スケール\_機能](https://msdn.microsoft.com/library/windows/hardware/ff569636)ミニポート ドライバーにします。 NDIS はプロトコル ドライバーに関連する RSS 構成情報も提供します、 [ **NDIS\_バインド\_パラメーター** ](https://msdn.microsoft.com/library/windows/hardware/ff564832)初期化中に構造体。

上にあるドライバーは、ハッシュ関数、型、および間接指定テーブルを選択します。 ドライバーをこれらの構成オプションを設定するには、OID セット要求を送信します[OID\_GEN\_受信\_スケール\_パラメーター](https://msdn.microsoft.com/library/windows/hardware/ff569637)ミニポート ドライバーにします。 ドライバーに関連すると、現在の RSS の設定を取得するには、この OID をクエリもできます。 OID の情報バッファー\_GEN\_受信\_スケール\_パラメーター OID にはへのポインターが含まれています、 [ **NDIS\_受信\_スケール\_パラメーター** ](https://msdn.microsoft.com/library/windows/hardware/ff567228)構造体。

上にあるドライバーは、NIC で RSS を無効にできます。 この場合は、NDIS の設定、ドライバー\_RSS\_PARAM\_フラグ\_を無効にする\_RSS フラグ、**フラグ**NDIS のメンバー\_受信\_スケール\_パラメーター構造体。 ミニポート ドライバーがの他のフラグと設定すべて無視し、NIC で RSS を無効にするこのフラグが設定されている場合

NDIS 処理 OID\_GEN\_受信\_スケール\_ミニポート ドライバーに渡す前にパラメーター ミニポート アダプターの更新と\*RSS は、必要な場合にキーワードを標準化します。 詳細については、  **\*RSS**キーワードを参照してください[の RSS の標準化された INF キーワード](standardized-inf-keywords-for-rss.md)します。

受信した後、 [OID\_GEN\_受信\_スケール\_パラメーター](https://msdn.microsoft.com/library/windows/hardware/ff569637) NDIS とのセット要求\_RSS\_PARAM\_フラグ\_無効にする\_RSS フラグを設定、ミニポート ドライバーは初期化後に、NIC の初期状態に、NIC の RSS の状態を設定する必要があります。 そのため、ミニポート ドライバーは、後続の OID を受け取る場合\_GEN\_受信\_スケール\_パラメーターは、NDIS を使用して要求を設定\_RSS\_PARAM\_フラグ\_を無効にする\_RSS フラグがオフになって、ミニポート ドライバーには、OID が受信した後に設定された値と同じであるすべてのパラメーターが\_GEN\_受信\_スケール\_パラメーターは、ミニポート アダプターを初期化した後は、最初に要求を設定します。

上位のドライバーを使用して、 [OID\_GEN\_受信\_ハッシュ](https://msdn.microsoft.com/library/windows/hardware/ff569635)OID を有効にし、ハッシュ計算を構成するのには、RSS を有効にしなくてもフレームを受信します。 ドライバーに関連すると、現在の受信にハッシュの設定を取得するには、この OID クエリもできます。

OID の情報バッファー\_GEN\_受信\_ハッシュ OID にはへのポインターが含まれています、 [ **NDIS\_受信\_ハッシュ\_パラメーター**](https://msdn.microsoft.com/library/windows/hardware/ff567190)構造体。 セットの要求、OID ミニポート アダプターが使用するハッシュ パラメーターを指定します。 クエリ要求の場合は、OID はミニポート アダプターを使用しているハッシュ パラメーターを返します。 この OID では、RSS をサポートするドライバーに対して省略可能です。

**注**  場合受信ハッシュ計算が有効になっている、NDIS を無効にしますが RSS を有効にする前に、ハッシュの計算結果を受信します。 RSS が有効になっている場合、NDIS 無効にします。 これにより、前に、RSS の受信は、計算をハッシュします。

 

すべての後続のプロトコル バインドを構成の設定で、同じハッシュ ミニポート ドライバーがサポートするミニポート アダプターのすべて提供する必要があります。 この OID には、ミニポート ドライバーまたは NIC は、ハッシュ計算に使用する必要があります、秘密キーも含まれています。 キーは、320 ビット長 (40 バイト) と、上にあるドライバー選択すると、すべてのデータのバイトのランダムなストリームなどを含めることができます。

処理の負荷を再調整するには、上にあるドライバーは、RSS パラメーターを設定および間接指定テーブルを変更します。 通常、すべてのパラメーターでは、間接指定テーブル以外は変更されません。 ただし、RSS が初期化された後、上にあるドライバーはその他の RSS の初期化パラメーターを変更可能性があります。 必要に応じて、ミニポート ドライバーは、ハッシュ関数、ハッシュの秘密キー、ハッシュ型、基本の CPU 数または間接参照テーブルのインデックス作成に使用されるビット数を変更する NIC のハードウェアをリセットできます。

**注**  上にあるドライバーはいつでもでもこれらのパラメーターを設定することができます。 正しくない順序が生じる兆候を受信します。 TCP をサポートするミニポート ドライバーは、このインスタンスで、受信キューを削除する必要はありません。

 

次の図は、間接指定テーブルの 2 つのインスタンスの内容の例を提供します。

![rss の間接指定テーブルの 2 つのインスタンスの内容を示す図](images/rss-table.png)

上記の図に、4 つのプロセッサの構成を前提としていて、ハッシュ値から使用される最下位のビット数は 6 ビット。 そのため、間接指定テーブルには、64 個のエントリが含まれています。

図では、テーブルには、初期化後にすぐに間接指定テーブル内の値が一覧表示します。 後で、通常のトラフィックの負荷の変化に合わせて、プロセッサの負荷の不均衡拡大します。 上にあるドライバーでは、不安定な状態を検出した、新しい間接指定テーブルを定義することで、負荷を再調整しようとします。 テーブル B には、間接指定テーブルの新しい値が一覧表示します。 テーブル B では、CPU 2 からの負荷の一部は Cpu 1 および 3 に移動します。

**注**  (現在の受信キューが処理されている記述子) 中に短時間の間接指定テーブルが変更すると、間違った CPU 上でパケットを処理することができます。 これは、通常の一時的な状態です。

 

間接指定テーブルのサイズは、システムのプロセッサの数の 2 ~ 8 倍では通常です。

ミニポート ドライバーは、非常に多くの Cpu がある場合に、Cpu にパケットを配布するときに、負荷分散のための努力を桁違いになる可能性があります。 この場合、ドライバーの関連ネットワーク データの処理が発生する Cpu のサブセットを選択する必要があります。

場合によっては、使用可能なハードウェアの数の受信キュー システムの Cpu 数よりも小さい場合があります。 ミニポート ドライバーでは、ハードウェア キューに関連付ける CPU 数を決定する間接指定テーブルを調べる必要があります。 間接指定テーブルに表示される別の CPU 数の合計数が、NIC をサポートするハードウェア キュー数よりも多い場合は、ミニポート ドライバーは間接指定テーブルから CPU 番号のサブセットを選択する必要があります。 サブセットは、ハードウェア キューの数の数と同じです。 取得した、ミニポート ドライバー、 **IndirectionTableSize**パラメーターから[OID\_GEN\_受信\_スケール\_パラメーター](https://msdn.microsoft.com/library/windows/hardware/ff569637)します。 指定されたミニポート ドライバー、 **NumberOfReceiveQueues** OID への応答値\_GEN\_受信\_スケール\_機能します。

 

 





