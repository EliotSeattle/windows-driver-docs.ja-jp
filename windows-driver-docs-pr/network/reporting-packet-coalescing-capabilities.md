---
title: パケット結合機能のレポート
description: パケット結合機能のレポート
ms.assetid: 6118F648-87FE-4B9E-9535-1602F4FF79D2
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: b6cf6184fe6467341f9f2e99605b44cb685f8fa6
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72842043"
---
# <a name="reporting-packet-coalescing-capabilities"></a>パケット結合機能のレポート


ミニポートドライバーは、ネットワークアダプターの初期化中に、次の機能を NDIS に登録します。

-   ネットワークアダプターがサポートするパケット合体機能。

-   ネットワークアダプターで現在有効になっているパケット合体機能。

-   パケット合体は、ネットワークアダプターで現在有効になっているフィルター処理機能を提供します。

**メモ** ポートのパケット合体のサポートは、 **\*packetcoalescing** INF キーワード設定を使用して有効または無効にすることができます。 この設定は、ネットワークアダプターの **[詳細**設定] プロパティページに表示されます。 パケット合体 INF ファイル設定の詳細については、「[パケット合体用の標準化](standardized-inf-keywords-for-packet-coalescing.md)された inf キーワード」を参照してください。



ミニポートドライバーは、基盤となるネットワークアダプターのパケット合体機能とフィルター機能を、 [**NDIS\_受信\_フィルター\_機能**](https://docs.microsoft.com/windows-hardware/drivers/ddi/ntddndis/ns-ntddndis-_ndis_receive_filter_capabilities)の構造を通じて報告します。 レジストリの **\*PacketCoalescing**キーワード設定の値が1である場合、パケット合体が有効になり、ミニポートドライバーは、次の方法で、 **\_フィルター\_機能**の構造を受け取るために NDIS\_受信します。

1.  ミニポートドライバーは、**ヘッダー**メンバーを初期化します。 ドライバーは、**ヘッダー**の**type**メンバーを、既定\_\_型の NDIS\_OBJECT に設定します。

    ドライバーがパケット合体をサポートしている場合は、**ヘッダー**の**リビジョン**メンバーを NDIS\_受信\_フィルター\_機能\_リビジョン\_2 および**SIZE**メンバーを NDIS\_SIZEOF\_受信\_フィルター\_\_のリビジョン\_2 に設定します。

2.  このミニポートドライバーは、 **Supportedqueueproperties**メンバーの\_既定の\_QUEUE フラグで\_サポートされている\_、\_フィルター\_パケット\_合体するように NDIS\_受信するように設定します。

    このフラグが設定されている場合、ネットワークアダプターは、ハードウェアで受信したマルチキャストパケットのフィルター処理をサポートする必要があります。 このフィルター処理は、NDIS [\_802\_3\_マルチキャスト\_リスト](https://docs.microsoft.com/windows-hardware/drivers/network/oid-802-3-multicast-list)oid セット要求を送信することによって、NDIS がネットワークアダプターにオフロードするマルチキャストアドレスに基づいています。

    **メモ** また、プロトコルドライバーは、 [OID\_802\_3\_\_マルチキャスト\_アドレス](https://docs.microsoft.com/windows-hardware/drivers/network/oid-802-3-add-multicast-address)および[oid\_802\_3\_削除\_マルチキャスト\_アドレス](https://docs.microsoft.com/windows-hardware/drivers/network/oid-802-3-delete-multicast-address)要求を送信して、マルチキャストアドレス一覧の内容を変更することもできます。 NDIS は、これらの要求を[oid\_802\_3\_マルチキャスト\_LIST](https://docs.microsoft.com/windows-hardware/drivers/network/oid-802-3-multicast-list) oid set requests に結合します。




**メモ** アダプターは、宛先のメディアアクセス制御 (MAC) アドレスが、これらの OID セット要求で指定されたマルチキャストアドレスと一致しない着信マルチキャストパケットを拒否する必要があります。




3.  ミニポートドライバーは、 **Enabledfiltertypes**メンバーで\_フィルター\_enabled フラグを結合してフィルター\_パケット\_\_フィルターを受け取るように NDIS\_設定します。

    **メモ** ドライバーがこのフラグを設定する場合は、 **Supportedqueueproperties**メンバーの\_既定の\_QUEUE フラグで\_サポートされている\_に対して、NDIS\_RECEIVE\_FILTER\_パケット\_合体するように設定する必要もあります。 それ以外の場合、NDIS は NDIS\_STATUS\_無効な\_特性を返すことで、 [**NdisMSetMiniportAttributes**](https://docs.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndismsetminiportattributes)への呼び出しに失敗します。



4.  ミニポートドライバーによって\_受信\_フィルター\_パケット\_結合\_フィルター\_有効にするフラグが設定されている場合、ドライバーはすべての受信フィルターテスト条件をサポートする必要があります。 ドライバーは、 **Supportedfiltertests**メンバーで次のフラグを設定することによって、このサポートをアドバタイズします。

    -   NDIS\_\_フィルター\_テスト\_ヘッダー\_フィールド\_同等\_サポートされています

    -   NDIS\_受信\_フィルター\_テスト\_ヘッダー\_フィールド\_マスク\_等しい\_サポートされています

    -   NDIS\_受信\_フィルター\_テスト\_ヘッダー\_フィールド\_\_同等\_サポートされていません

    **メモ** ミニポートドライバーで NDIS\_受信\_フィルター\_パケット\_結合\_フィルター\_有効にするフラグが設定されていない場合、ドライバーは**Supportedfiltertests**メンバーを0に設定する必要があります。



5.  ミニポートドライバーによって\_受信\_フィルター\_パケット\_結合\_フィルター\_有効フラグが設定されている場合、ミニポートドライバーは、メディアアクセスコントロール (MAC)、IP version 4 (IPv4)、および IP version 6 (IPv6) の各ヘッダーのさまざまなフィールド内のデータのフィルター処理をサポートする必要があります。 ドライバーは、 **Supportedheaders**メンバーで次のフラグを設定することによって、このサポートをアドバタイズします。

    -   NDIS\_\_フィルター\_MAC\_ヘッダー\_サポートされています

    -   NDIS\_受信\_フィルター\_ARP\_ヘッダー\_サポートされています

    -   NDIS\_受信\_フィルター\_IPV4\_ヘッダー\_サポートされています

    -   NDIS\_\_フィルター\_IPV6\_ヘッダー\_サポートされています

    -   NDIS\_\_フィルター\_UDP\_ヘッダー\_サポートされています

    **メモ** ミニポートドライバーで NDIS\_受信\_フィルター\_パケット\_結合\_フィルター\_有効にするフラグが設定されていない場合、ドライバーは**Supportedheaders**メンバーを0に設定する必要があります。



6.  ミニポートドライバーによって\_受信\_フィルター\_パケット\_結合\_フィルター\_有効フラグが設定されている場合、ミニポートドライバーは、受信パケットのメディアアクセスコントロール (MAC) ヘッダー内のデータのフィルター処理をサポートする必要があります。 ドライバーは、 **SupportedMacHeaderFields**メンバーで次のフラグを設定することによって、このサポートをアドバタイズします。

    -   NDIS\_受信\_フィルター\_MAC\_ヘッダー\_DEST\_ADDR\_サポートされています

    -   NDIS\_\_フィルター\_MAC\_ヘッダー\_プロトコル\_サポートされています

    -   NDIS\_受信\_フィルター\_MAC\_ヘッダー\_パケット\_種類\_サポートされています

    **メモ** ミニポートドライバーで NDIS\_受信\_フィルター\_パケット\_結合\_フィルター\_有効にするフラグが設定されていない場合、ドライバーは**SupportedMacHeaderFields**メンバーを0に設定する必要があります。



7.  ミニポートドライバーによって\_受信\_フィルター\_パケット\_結合\_フィルター\_有効にするフラグが設定されている場合、ミニポートドライバーは、受信アドレス解決プロトコル (ARP) パケットのヘッダー内のデータのフィルター処理をサポートする必要があります。 ドライバーは、 **SupportedARPHeaderFields**メンバーで次のフラグを設定することによって、このサポートをアドバタイズします。

    -   NDIS\_受信\_フィルター\_ARP\_ヘッダー\_操作\_サポートされています

    -   NDIS\_受信\_フィルター\_ARP\_ヘッダー\_SPA\_サポートされています

    -   NDIS\_受信\_フィルター\_ARP\_ヘッダー\_TPA\_サポートされています

    **メモ** ミニポートドライバーで NDIS\_受信\_フィルター\_パケット\_結合\_フィルター\_有効にするフラグが設定されていない場合、ドライバーは**SupportedARPHeaderFields**メンバーを0に設定する必要があります。



8.  ミニポートドライバーによって\_受信\_フィルター\_パケット\_結合\_フィルター\_有効フラグが設定されている場合、ミニポートドライバーは、受信 IP version 4 (IPv4) パケットの Open Systems 相互接続 (OSI) レイヤー 3 (L3) ヘッダー内のデータのフィルター処理をサポートする必要があります。 ドライバーは、 **SupportedIPv4HeaderFields**メンバーで次のフラグを設定することによって、このサポートをアドバタイズします。

    -   NDIS\_受信\_フィルター\_IPV4\_ヘッダー\_プロトコル\_サポートされています

    **メモ** ミニポートドライバーで NDIS\_受信\_フィルター\_パケット\_結合\_フィルター\_有効にするフラグが設定されていない場合、ドライバーは**SupportedIPv4HeaderFields**メンバーを0に設定する必要があります。



9.  ミニポートドライバーによって\_受信\_フィルター\_パケット\_合体\_フィルター\_ENABLED フラグが設定されている場合、ミニポートドライバーは、受信 IP バージョン 6 (IPv6) パケットの L3 ヘッダー内のデータのフィルター処理をサポートする必要があります。 ドライバーは、 **SupportedIPv6HeaderFields**メンバーで次のフラグを設定することによって、このサポートをアドバタイズします。

    -   NDIS\_\_フィルター\_IPV6\_ヘッダー\_プロトコル\_サポートされています

    **メモ** ミニポートドライバーで NDIS\_受信\_フィルター\_パケット\_結合\_フィルター\_有効にするフラグが設定されていない場合、ドライバーは**SupportedIPv6HeaderFields**メンバーを0に設定する必要があります。



10. ミニポートドライバーによって\_受信\_フィルター\_パケット\_結合\_フィルター\_有効フラグが設定されている場合、ミニポートドライバーは、受信したユーザーデータグラムプロトコル (UDP) パケットの OSI レイヤー 4 (L4) ヘッダー内のデータのフィルター処理をサポートする必要があります。 ドライバーは、 **SupportedIUdpHeaderFields**メンバーで次のフラグを設定することによって、このサポートをアドバタイズします。

    -   NDIS\_受信\_フィルター\_UDP\_ヘッダー\_DEST\_ポート\_サポートされています

    **メモ** 受信 UDP パケットに IPv4 オプションまたは IPv6 拡張ヘッダーが含まれている場合、ネットワークアダプターは UDP フィルターテストに失敗したかのようにパケットを処理できます。 このようにして、アダプターは受信パケットを自動的に削除できます。




**メモ** ミニポートドライバーで NDIS\_受信\_フィルター\_パケット\_結合\_フィルター\_有効にするフラグが設定されていない場合、ドライバーは**SupportedIUdpHeaderFields**メンバーを0に設定する必要があります。




11. ミニポートドライバーは、1つのパケット合体フィルターに指定できるパケットヘッダーフィールドに対するテストの最大数を報告する必要があります。 ドライバーは、 **MaxFieldTestsPerPacketCoalescingFilter**メンバーにこの値を指定します。

    **メモ** パケット合体をサポートするネットワークアダプターでは、1つのパケット合体フィルターに指定できる5つ以上のパケットヘッダーフィールドがサポートされている必要があります。 アダプターがパケット合体をサポートしていない場合、ミニポートドライバーはこの値を0に設定する必要があります。



12. ミニポートドライバーは、ネットワークアダプターでサポートされているパケット合体フィルターの最大数を報告する必要があります。 ドライバーは、 **MaxPacketCoalescingFilters**メンバーにこの値を指定します。

    **メモ** パケット合体をサポートするネットワークアダプターは、10個以上のパケット合体フィルターをサポートする必要があります。 アダプターがパケット合体をサポートしていない場合、ミニポートドライバーはこの値を0に設定する必要があります。



NDIS がミニポートドライバーの[*MiniportInitializeEx*](https://docs.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_initialize)関数を呼び出すと、ドライバーは、次の手順に従って、基になるネットワークアダプターのパケット合体およびフィルター機能を報告します。

-   ミニポートドライバーは、 [**NDIS\_ミニポート\_アダプター\_ハードウェア\_サポート\_属性**](https://docs.microsoft.com/windows-hardware/drivers/ddi/ndis/ns-ndis-_ndis_miniport_adapter_hardware_assist_attributes)の構造を初期化します。

    レジストリの **\*PacketCoalescing**キーワード設定の値が1の場合、ミニポートドライバーは、以前に初期化された[**NDIS\_受信\_フィルター\_機能**](https://docs.microsoft.com/windows-hardware/drivers/ddi/ntddndis/ns-ntddndis-_ndis_receive_filter_capabilities)の構造を指すポインターに**HardwareReceiveFilterCapabilities**メンバーを設定します。

    レジストリの **\*PacketCoalescing**キーワード設定の値が0の場合、ミニポートドライバーはパケット合体のサポートをアドバタイズしません。 **HardwareReceiveFilterCapabilities**メンバーを NULL に設定する必要があります。

-   ドライバーは[**NdisMSetMiniportAttributes**](https://docs.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndismsetminiportattributes)を呼び出し、 *miniportattributes*パラメーターを[**NDIS\_ミニポート\_アダプター**](https://docs.microsoft.com/windows-hardware/drivers/ddi/ndis/ns-ndis-_ndis_miniport_adapter_hardware_assist_attributes)へのポインターに設定します。\_ハードウェア\_\_属性の構造をサポートします。

基になるネットワークアダプターのパケット合体およびフィルター機能を報告するために、ミニポートドライバーによって使用される方法は、電源管理機能を報告するための NDIS 6.20 の方法に基づいています。 この方法の詳細については、「[電源管理機能のレポート](reporting-power-management-capabilities.md)」を参照してください。

アダプター初期化プロセスの詳細については、「[ミニポートアダプターの初期化](initializing-a-miniport-adapter.md)」を参照してください。
