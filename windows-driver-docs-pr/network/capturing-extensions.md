---
title: キャプチャ拡張機能
description: キャプチャ拡張機能
ms.assetid: A8C2E550-4B1F-4DDB-B97F-1F7B6B74F5E7
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 514b2a2c016e3284a2803fca7b6feec87146643b
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72838207"
---
# <a name="capturing-extensions"></a>キャプチャ拡張機能


Hyper-v 拡張可能スイッチキャプチャ拡張機能は、パケットトラフィック、オブジェクト識別子 (OID) 要求、および NDIS ステータスの兆候を検査します。 この種類の拡張機能では、パケットの変更や削除、または拡張可能なスイッチポートへのパケットの配信を除外することはできません。 ただし、拡張機能のキャプチャでは、拡張機能がホストアプリケーションに送信するトラフィックの統計情報を含むパケットなど、パケットトラフィックが発生する可能性があります。

キャプチャ拡張機能は、受信データパスの先頭と、送信データパスの最後に呼び出されます。 これらのデータパスの詳細については、「 [Hyper-v 拡張可能スイッチのデータパス](hyper-v-extensible-switch-data-path.md)」を参照してください。

キャプチャ拡張機能には、次の要件と制限があります。

-   キャプチャ拡張機能は、拡張可能なスイッチインターフェイスをサポートする NDIS フィルタードライバーとして開発する必要があります。

    フィルタードライバーの詳細については、「 [NDIS フィルタードライバー](ndis-filter-drivers2.md)」を参照してください。

    キャプチャ拡張機能を記述する方法の詳細については、「 [Hyper-v 拡張可能スイッチ拡張機能の記述](writing-hyper-v-extensible-switch-extensions.md)」を参照してください。

-   キャプチャ拡張機能は、標準の NDIS 監視フィルタードライバーと同じ機能を提供します。 ただし、キャプチャ拡張機能の INF ファイルでは、変更フィルタードライバーとしてインストールする必要があります。

    フィルタードライバーの変更の詳細については、「[フィルタードライバーの種類](types-of-filter-drivers.md)」を参照してください。

    フィルタードライバーを変更するための INF の要件の詳細については、「[変更フィルタードライバーの Inf ファイルの構成](configuring-an-inf-file-for-a-modifying-filter-driver.md)」を参照してください。

-   キャプチャ拡張機能は、受信および送信拡張可能なスイッチデータパスでパケットを監視できます。 ただし、この種類の拡張機能では、パケットを拡張可能なスイッチドライバースタック内の基になるドライバーに転送するために、常に[**NdisFSendNetBufferLists**](https://docs.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndisfsendnetbufferlists)を呼び出す必要があります。

-   キャプチャ拡張機能は、パケット内のデータを変更したり、パケットの帯域外 (OOB) データにポートの宛先を追加したりすることはできません。 拡張機能は、拡張可能なスイッチポートへのパケットの配信を除外することはできません。

-   キャプチャ拡張機能は、パケットを発信元として使用できます。 たとえば、トラフィックの状態をリモート監視アプリケーションに報告するために、拡張機能はパケットを生成する場合があります。

    拡張機能による発信パケットの詳細については、「[発信元パケットトラフィック](originating-packet-traffic.md)」を参照してください。

    **注**  その他の拡張機能と同様に、キャプチャ拡張機能は、拡張可能スイッチの受信データパスでのみパケットトラフィックを発信できます。

     

-   キャプチャ拡張機能は、拡張可能なスイッチドライバースタックを介して発行されたパケット、OID 要求、および NDIS の状態を監視できます。 ただし、この種類の拡張機能では、拡張可能なスイッチドライバースタックを介してパケット、OID 要求、および NDIS ステータスの兆候を転送する必要があります。 拡張機能は、監視しているパケット、OID 要求、または NDIS ステータスのインジケーター内のデータを変更することはできません。

-   拡張機能の INF ファイルの**Filterclass**値は、 **ms\_スイッチ\_capture**に設定する必要があります。 詳細については、「 [Hyper-v 拡張可能スイッチ拡張機能の INF 要件](inf-requirements-for-hyper-v-extensions.md)」を参照してください。

-   拡張可能なスイッチインスタンスには、任意の数のキャプチャ拡張機能をバインドできます。 既定では、複数のキャプチャ拡張機能は、インストールされた日時に基づいて並べ替えられます。 たとえば、複数のキャプチャ拡張機能は、スタック内の他のキャプチャ拡張機能の上に、最近インストールされた拡張機能を持つ拡張可能なスイッチドライバースタックに階層化されます。

    拡張可能なスイッチインスタンスにバインドされると、拡張可能なスイッチドライバースタックのキャプチャ拡張機能のレイヤーを並べ替えることができます。 詳細については、「 [Hyper-v 拡張可能スイッチ拡張機能の順序変更](reordering-hyper-v-extensibility-switch-extensions.md)」を参照してください。

 

 





