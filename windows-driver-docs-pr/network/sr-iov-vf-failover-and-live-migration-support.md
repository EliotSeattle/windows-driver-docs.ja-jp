---
title: SR-IOV VF フェールオーバーおよびライブ マイグレーションのサポート
description: SR-IOV VF フェールオーバーおよびライブ マイグレーションのサポート
ms.assetid: 93D6EFC7-B701-4D10-8114-FA437E80096B
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 764a4c1297dda8282014042edcc75abcb9a3b011
ms.sourcegitcommit: 0cc5051945559a242d941a6f2799d161d8eba2a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "63346015"
---
# <a name="sr-iov-vf-failover-and-live-migration-support"></a>SR-IOV VF フェールオーバーおよびライブ マイグレーションのサポート


HYPER-V 子パーティションを開始すると、合成データ パス経由でネットワーク トラフィックが送られます。 物理ネットワーク アダプターでは、Single Root I/O Virtualization (SR-IOV) インターフェイスをサポートする場合、1 つまたは複数 PCI Express (PCIe) 仮想機能 (Vf) を有効にすることができます。 HYPER-V 子パーティションには、各 VF をアタッチすることができます。 ハードウェアに最適化された経由でのネットワーク トラフィック フローのこのような場合は、 [SR-IOV VF データ パス](sr-iov-vf-data-path.md)します。

VF のデータ パスが確立されると、ネットワーク トラフィックに戻すことができます、[合成データ パス](sr-iov-vf-data-path.md)次の条件のいずれかが true の場合。

-   VF は、HYPER-V 子パーティションに接続されていたがデタッチ済みになります。 たとえば、仮想化スタックは、VF 1 つの子パーティションからのデタッチし、もう 1 つの子パーティションにアタッチします。 基になる、SR-IOV ネットワーク アダプターの VF リソースがより多くを実行している HYPER-V 子パーティションがある場合があります。

    合成データ パスに VF のデータ パスからのフェイル オーバーのプロセスと呼びます*VF フェールオーバー*します。

-   HYPER-V 子パーティションは、別のホストに移行、ライブでことです。

次の図は、SR-IOV ネットワーク アダプター上でサポートされているさまざまなデータ パスを示します。

![スタックの図の下に、管理親パーティションとの通信と通信する子パーティション vm バスを使用して、sr-iov アダプター \#1 を含む vm を使用して通信するゲスト オペレーティング システム バス、さらに子パーティション\#2 は、sr-iov 対応のアダプターに vf ミニポートを使用して通信します。](images/sriovdatapaths.png)

NetVSC は VF のデータ パスをサポートするために、VF ミニポート ドライバーにバインドされている仮想マシン (VM) ネットワーク アダプターを公開します。 中に合成データ パスへの移行、VF のネットワーク アダプターが正常に削除可能であれば、ゲスト オペレーティング システムから。 VF を適切にタイムアウトに削除することはできません、突然の削除があります。 VF のミニポート ドライバーを停止し、あり、ネットワーク仮想サービス クライアント (NetVSC) は VF のミニポート ドライバーからバインドではありません。

VF と合成データ パスの間の遷移では、パケットの損失が最小で発生し、TCP 接続の損失を防止します。 合成データ パスへの移行が完了する前に、仮想化スタックは次の手順に従います。

1.  仮想化スタックでは、VM のネットワーク アダプターのメディア アクセス コントロール (MAC) および仮想 LAN (VLAN) のフィルターを PCIe 物理機能 (PF) に関連付けられている既定の仮想ポート (VPort) に移動します。 VM のネットワーク アダプターは、子パーティションのゲスト オペレーティング システムで公開されます。

    VPort の既定値にフィルターを移動後合成データ パスがネットワーク トラフィックとゲスト オペレーティング システムで実行されているネットワーク コンポーネントの間に完全に動作します。 PF のミニポート ドライバーでは、PF VPort をゲスト オペレーティング システムにパケットを示すために合成データ パスを使用する既定のパケットを受信したことを示します。 同様に、ゲスト オペレーティング システムから送信されたパケットはすべてが合成データ パス経由でルーティングし、既定の PF VPort を通じて送信します。

    拡張の詳細については、次を参照してください。[仮想ポート (拡張)](virtual-ports--vports-.md)します。

2.  仮想化スタックのオブジェクト識別子 (OID) セット要求を発行して、VF に関連付けられている VPort の削除[OID\_NIC\_スイッチ\_削除\_VPORT](https://msdn.microsoft.com/library/windows/hardware/hh451818) PF をミニポート ドライバー。 ミニポート ドライバーは、VPort に関連付けられているハードウェアとソフトウェアのリソースを解放し、OID 要求を完了します。

    詳細については、次を参照してください。[仮想ポートを削除する](deleting-a-virtual-port.md)します。

3.  仮想化スタックは、そのリソースの割り当てが解除される前に、PCIe 関数レベルのリセット (FLR)、VF を要求します。 スタックの OID セット要求を発行することによって[OID\_SRIOV\_リセット\_VF](https://msdn.microsoft.com/library/windows/hardware/hh451889)PF ミニポート ドライバーにします。 FLR では、VF をにより、SR-IOV ネットワーク アダプターで休止状態にし、VF の保留中の中断イベントをクリアします。

4.  仮想化スタックがの OID セット要求を発行して VF リソースの割り当て解除を要求、VF のリセット後[OID\_NIC\_スイッチ\_FREE\_VF](https://msdn.microsoft.com/library/windows/hardware/hh451822) PF をミニポート ドライバー。 これにより、ミニポート ドライバー、VF に関連付けられたハードウェア リソースを解放します。

このプロセスの詳細については、次を参照してください。[仮想関数の破棄順序](virtual-function-teardown-sequence.md)します。

 

 





