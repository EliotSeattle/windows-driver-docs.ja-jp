---
title: 結合を終了する例外条件
description: このセクションでは、受信セグメント合体 (RSC) 対応のミニポートドライバーが、セグメントを結合する前に、そのセグメントに対して実行する必要があるチェックを定義します。
ms.assetid: 6294541A-AF32-46CF-81AB-5855EA440053
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 006abbad12232e9e250b2cc7e09940272c4da925
ms.sourcegitcommit: d30691c8276f7dddd3f8333e84744ddeea1e1020
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/19/2019
ms.locfileid: "75210892"
---
# <a name="exception-conditions-that-terminate-coalescing"></a>結合を終了する例外条件


このセクションでは、受信セグメント合体 (RSC) 対応のミニポートドライバーが、セグメントを結合する前に、そのセグメントに対して実行する必要があるチェックを定義します。

セグメントを結合するには、次の両方の種類のチェックを渡す必要があります。

-   セグメント内に特定の条件が存在するかどうかを確認します。 たとえば、TCP ヘッダーに SYN フラグが存在すると、例外が発生し、セグメントは結合されません。 これらの種類のチェックは次のように定義されています。

-   は、以前に結合されたセグメントと現在調査されているセグメントの情報の検査と関連付けに依存しているかどうかをチェックします。 たとえば、受信したセグメントが重複する受信確認であるかどうかを確認すると、このカテゴリのチェックが行われます。 これらの種類のチェックは、 [Tcp/ip セグメントを結合するための規則](rules-for-coalescing-tcp-ip-packets.md)で定義されています。

チェックが失敗すると、例外がトリガーされ、ミニポートドライバーはその TCP 接続の合体を終了し、セグメントを次のように処理する必要があります。

-   例外が検出される前に結合された TCP セグメントは、1つの単位として示される必要があります。

-   例外が検出された後に結合された TCP セグメントは、個別の単位として示される必要があります。

**注**  例外7と8の場合、ミニポートドライバーは、例外をトリガーしたセグメントからの結合を再開する必要があります。

 

次の条件のいずれかを満たすセグメントを受け取ると、例外が発生します。

1.  NIC のハードウェアリソースの制約により、結合が防止されます。

2.  セグメントに無効な TCP または IP チェックサムが含まれています。

3.  このセグメントには、 [RFC 793](https://www.ietf.org/rfc/rfc793.txt)のセクション3.1 で定義されているように、TCP ヘッダー内の SYN、URG、RST、FIN のいずれかが含まれています。 さらに広い範囲で、セグメントに PSH または ACK 以外のフラグが含まれている場合は、例外をトリガーする必要があります。 ECN フラグについては、以下の例外8を参照してください。

4.  このセグメントには、TCP タイムスタンプオプション以外の TCP オプションが1つ以上含まれています。 TCP タイムスタンプオプションの詳細については、 [RFC 1323](https://www.ietf.org/rfc/rfc1323.txt)を参照してください。

5.  セグメントには、IPv4 オプションまたは IPv6 拡張ヘッダーが含まれています。

6.  セグメントは IPv4 フラグメントです。

7.  現在受信しているセグメントを結合すると、1つの結合された単位が、有効な IP データグラムの最大長を超えます。 この例外には特別な処理が必要です。 詳しくは、次のトピックをご覧ください。

    -   [Tcp/ip パケットを結合するルール](rules-for-coalescing-tcp-ip-packets.md)の最初のフローチャート

    -   「Rsc[ドライバーのプログラミングに関する考慮事項](programming-considerations-for-rsc-drivers.md)」の「rsc 統計に対するクエリへの応答」

8.  このセグメントには、 [RFC 3168](https://www.ietf.org/rfc/rfc3168.txt)で定義されている、次の条件のいずれかまたは両方を満たす ECN フラグが含まれています。

    1.  セグメントには、前のセグメントとは異なる IP ヘッダーの ECN フィールド (ECT、CE) の値が含まれています。

    2.  このセグメントには、前のセグメントとは異なる TCP ヘッダーの ECN フラグ (ECE および CWR) の値があります。

 

 





