---
title: 結合を終了する例外条件
description: このセクションでは、セグメントの結合 (RSC) を受信確認を定義します。-結合して、前に、対応のミニポート ドライバーがセグメントで実行する必要があります。
ms.assetid: 6294541A-AF32-46CF-81AB-5855EA440053
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 891a482918833a430df81481c3f097ac75261603
ms.sourcegitcommit: 0cc5051945559a242d941a6f2799d161d8eba2a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "63351304"
---
# <a name="exception-conditions-that-terminate-coalescing"></a>結合を終了する例外条件


このセクションでは、セグメントの結合 (RSC) を受信確認を定義します。-結合して、前に、対応のミニポート ドライバーがセグメントで実行する必要があります。

結合して、前に、セグメントは次の種類のチェックの両方で渡す必要があります。

-   セグメント内で特定の条件の有無を確認します。 たとえば、TCP ヘッダーで SYN フラグの存在は、例外をトリガーし、セグメントを結合していませんが。 これらの種類のチェックは、以下に定義されます。

-   以前にまとめられたセグメントと検証の現在のセグメントからの情報を関連付けることを検査およびに依存するを確認します。 たとえば、受信したセグメントが重複する受信確認の場合にチェックでは、チェックのこのカテゴリに分類します。 これらの種類のチェックがで定義されている[TCP/IP セグメントの結合規則](rules-for-coalescing-tcp-ip-packets.md)します。

チェックが失敗した場合、例外がトリガーされると、ミニポート ドライバーが TCP 接続の結合を終了し、セグメントを次のように扱う必要があります。

-   例外が検出される前に、結合された TCP セグメントは、1 つの単位として指定する必要があります。

-   例外が検出された後に 1 つにまとめ、TCP セグメントは、個別の単位として指定する必要があります。

**注**  ミニポート ドライバー、7 および 8 以下の例外の例外を発生させたセグメントを持つ結合の開始を再開する必要があります。

 

次の条件のいずれかを満たすセグメントを受信すると、例外が発生する必要があります。

1.  NIC のハードウェア リソースの制約は、結合を防止します。

2.  セグメントには、無効な TCP または IP チェックサムがあります。

3.  セグメントに SYN、URG、RST のいずれかのセクション 3.1 で定義されている TCP ヘッダーで FIN [RFC 793](http://www.ietf.org/rfc/rfc793.txt)します。 広い意味で、セグメントに PSH または ACK 以外のすべてのフラグが含まれている場合は、例外をトリガーする必要があります。 ECN のフラグは、8 以下の例外を参照してください。

4.  セグメントには、タイムスタンプの TCP オプション以外の 1 つまたは複数の TCP オプションが含まれています。 参照してください[RFC 1323](http://www.ietf.org/rfc/rfc1323.txt) TCP タイムスタンプ オプションの詳細についてはします。

5.  セグメントには、オプションの IPv4 または IPv6 拡張ヘッダーが含まれています。

6.  セグメントには、IPv4 フラグメントです。

7.  受信した現在のセグメントを結合すると、最大の有効な IP データグラム長を超えるにまとめられた 1 つの単位が発生します。 この例外には、特別な処理が必要です。 詳しくは、次のトピックをご覧ください。

    -   最初のフローチャート[TCP/IP パケットの結合規則](rules-for-coalescing-tcp-ip-packets.md)

    -   "で"RSC の統計情報のクエリに応答[RSC ドライバーのプログラミングに関する考慮事項](programming-considerations-for-rsc-drivers.md)します。

8.  定義されている、セグメントには、変更通知フラグ[RFC 3168](http://www.ietf.org/rfc/rfc3168.txt)、次の条件の一方または両方を満たします。

    1.  セグメントには、前のセグメントよりも IP ヘッダーに ECN フィールド (ECT、CE) に別の値が含まれています。

    2.  セグメントでは、前のセグメントよりも、TCP ヘッダーで ECN フラグ (ECE および CWR) の異なる値があります。

 

 





