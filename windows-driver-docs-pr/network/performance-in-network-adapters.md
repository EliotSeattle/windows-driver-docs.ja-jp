---
title: ネットワーク アダプターのパフォーマンス
description: ネットワーク アダプターで実装するためにハードウェアの機能を決定するのには常にトレードオフがあります。
ms.assetid: 7BE3FC13-DEE1-41A2-9B4A-D04CF5D0FC9B
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 9727e824c63acc9b0ecde67e2e739d1ef15100b7
ms.sourcegitcommit: 0cc5051945559a242d941a6f2799d161d8eba2a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "63366698"
---
# <a name="performance-in-network-adapters"></a>ネットワーク アダプターのパフォーマンス


ネットワーク アダプターで実装するためにハードウェアの機能を決定するのには常にトレードオフがあります。 割り込み節度をハードウェアでチューニングを動的に作成できるタスク オフロード機能の追加を検討するますます重要になって、PCI バスの使用を改善およびとしてのジャンボ フレームをサポートします。 これらは、最上位のパフォーマンスを必要とする構成で使用されるハイエンドのネットワーク アダプターの特に重要です。

-   [サポートの TCP および IP チェックサム オフロード](#supporting-tcp-and-ip-checksum-offload)
-   [大量送信オフロード (LSO) をサポートしています。](#supporting-large-send-offload-lso)
-   [IP セキュリティ (IPSec) オフロードをサポートしています。](#supporting-ip-security-ipsec-offload)
-   [割り込み節度を向上させる](#improving-interrupt-moderation)
-   [PCI バスの効率的な使用](#using-the-pci-bus-efficiently)
-   [ジャンボ フレームをサポートしています。](#supporting-jumbo-frames)

## <a name="supporting-tcp-and-ip-checksum-offload"></a>サポートの TCP および IP チェックサム オフロード


最も一般的なネットワーク トラフィックの場合は、チェックサムの計算、ネットワーク アダプターのハードウェアにオフロード バイトごとに必要な CPU サイクル数を減らすことでパフォーマンスに大きなメリットを提供します。 チェックサムの計算では、ネットワーク スタックで最も高価な関数を 2 つの理由。

-   これは、長いパスの長さに作用します。
-   (通常は、送信側) の効果を計算キャッシュが行われます。

チェックサムの計算の送信者にオフロード ホスト CPU の負荷を削減し、キャッシュの効果を増やすことによってシステム全体のパフォーマンスが向上します。

Windows パフォーマンス ラボ ネットワーク集中型ワークロード中にチェックサムがオフロードされたときに、19% の TCP スループットの向上を測定がしました。 この機能強化の分析は、11% の合計改善のパスの長さの削減、原因し、8% は、キャッシュの効果を高めることが原因のことを示します。

オフロード、送信側のチェックサムと同じ利点には、受信側のチェックサムをオフロードします。 クライアントとソケットのプロキシ サーバーなどのサーバーの両方として機能するシステムでは、増加の特典を確認できます。 CPU が必ずしもビジー状態で、クライアント システムなどないシステムでは優れたネットワークの応答時間、スループットの向上が顕著ではなく、チェックサム オフロードの特典を表示があります。

## <a name="supporting-large-send-offload-lso"></a>大量送信オフロード (LSO) をサポートしています。


Windows では、最大 64 K をより大きな最大セグメント サイズ (MSS) tcp MTU よりを提供するネットワーク アダプターまたはドライバーの機能を提供します。 これにより、TCP パケットが MTU、ネットワーク内に収まるに大きなバッファーを分割すると、ドライバーに最大 64 K のバッファーを割り当てることができます。

作業をセグメント化、TCP は、ホストの CPU ではなく、ネットワーク アダプターとドライバー ハードウェアによって実行されます。 これは、結果、ネットワーク アダプターの CPU が追加の作業を処理できない場合はパフォーマンスが大幅に向上します。

テスト ネットワーク アダプターの多くの場合、ホストの CPU が、ネットワーク アダプターのハードウェアよりも強力に見た純粋なネットワーク アクティビティのほとんどの向上がありましませんでした。 ただし、一般的なビジネスのワークロードでは、最大 9% のスループットの全体的なシステム パフォーマンスの向上が測定されている、ホストの CPU では、そのサイクルのほとんどを使用して、トランザクションを実行するためです。 このような場合は、ハードウェアに TCP セグメント化オフロードは、ホストの CPU 負荷からのセグメント化、複数のトランザクションを実行するサイクルに余分なことができますを解放します。

## <a name="supporting-ip-security-ipsec-offload"></a>IP セキュリティ (IPSec) オフロードをサポートしています。


Windows では、ネットワーク アダプターのハードウェアに IPSec の暗号化作業をオフロードする機能を提供します。 暗号化、特に 3 DES (とも呼ばれますトリプル DES) が非常に高いサイクル/バイトの比率。 そのため、IPSec をネットワーク アダプターのハードウェアにオフロード、セキュリティで保護されたインターネットと VPN のテストでは、30% のパフォーマンスを改善を測定驚くべきことはありません。

## <a name="improving-interrupt-moderation"></a>割り込み節度を向上させる


単純なネットワーク アダプターでは、パケットの到着したときに、ホスト上のハードウェア割り込みを生成またはパケットの完了を通知するには、要求を送信します。 割り込みの待機時間と結果として得られるキャッシュの効果を計算、ネットワークの全体的なパフォーマンスをオーバーヘッドが追加します。 多くのシナリオ (たとえば、負荷の高いシステムの使用状況または大量のネットワーク トラフィックなど)、各割り込みのいくつかのパケットを処理することによって、ハードウェア割り込みのコストを削減することをお勧めします。

負荷の高いネットワーク ワークロードでは、ネットワーク集中型ワークロードで最大のスループットでの 9% のパフォーマンス向上が測定されています。 ただし、スループット向上のためだけの割り込み節度パラメーターの調整が、応答時間のパフォーマンスに影響にあります。 最適な設定を維持し、さまざまなワークロードに合わせては、この記事の後半で自動チューニング」の説明に従って動的に調整されたパラメーターを許可することをお勧めします。

## <a name="using-the-pci-bus-efficiently"></a>PCI バスの効率的な使用


ネットワーク アダプターのハードウェアのパフォーマンスに最も重要な要因の 1 つは、PCI バスを使用して効率的にする方法です。 さらに、ネットワーク アダプターの DMA のパフォーマンスは同じ PCI バス上にあるすべての PCI カードのパフォーマンスに影響します。 PCI の使用を最適化する場合は、次のガイドラインを考慮する必要があります。

-   適切な場所に、ターゲット ページを集計して DMA の転送を効率化します。

-   (少なくとも 256 バイト) の大きなチャンクで DMA を実行することによってオーバーヘッドが PCI プロトコルを削減します。 パケット全体が単一の PCI トランザクションで転送されるように、データのフローを可能であれば、時間です。 ただし、転送を実行する方法を検討してください。 などの待機中待機時間が向上し、追加のバッファー領域を消費するために、転送を開始する前に到着するデータのすべての待機操作を行います。

-   最後の数バイトのパケットを転送することによって「クリーンアップ」する場合は、短い余分な転送を必要とするのではなく、追加のバイトで DMA パケットの転送を埋め込むことをお勧めします。

-   PCI の仕様によって推奨されるメモリの読み取り、行の読み取りメモリ、およびメモリ読み取りの複数のトランザクションを使用します。

-   ネットワーク アダプター バス インターフェイス ハードウェアは、ホスト コント ローラーがメモリ内の制限事項を検出し、動作を調整する必要があります。 例では、ネットワーク アダプター バス インターフェイス ハードウェアは DMA のメモリの読み取りでコント ローラーのメモリのプリフェッチの制限事項を検出し、トランザクションを再試行する前に、短時間待機する必要があります。 ハードウェアは、ネットワーク アダプターの方の過剰な再試行を検出し、ホストによって切り捨てられますとき以降のトランザクションで最初の再試行までの時間を増やす必要があります。 特定のデータの次の連続した一連のフェッチがビジーである場合は、メモリ コント ローラーにトランザクションを送信を続けてポイントはありません。

-   データ転送中には特に、待機状態の挿入を最小限に抑えます。 挿入しようとしている 2 つの待機状態またはバスを放棄して、1 つ以上の場合に行う処理には、バス get を使用して別の PCI アダプターを使用することをお勧めします。

-   I/O のようにプログラムではなく、メモリ マップ I/O を使用します。 またこれは、ドライバーに当てはまります。

## <a name="supporting-jumbo-frames"></a>ジャンボ フレームをサポートしています。


大きな最大転送単位 (Mtu) なり大きなフレーム サイズをサポートしている、としてのジャンボ フレーム具体的には、ネットワーク スタックのオーバーヘッドが発生する 1 バイトが減少します。 MTU は 9000 1514 から変更されたときに、TCP スループットの 20% 向上を測定されています。 また、CPU 使用率が大幅に短縮は、ネットワーク スタックからネットワーク ドライバーへの呼び出しの数が少ないほどにより取得されます。

 

 





