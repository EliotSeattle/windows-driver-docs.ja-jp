---
title: SerCx2 の I/O トランザクションの概要
description: SerCx2 は、1つ以上の i/o トランザクションをシリアルコントローラードライバーに発行することによって、クライアントからの読み取り要求または書き込み要求を処理します。
ms.assetid: 04DDFE53-4855-4029-BE1E-9D184B02A998
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: f7bc02271ce2dbf6caa578b5aba2549a67394926
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72843051"
---
# <a name="overview-of-sercx2-io-transactions"></a>SerCx2 の I/O トランザクションの概要


SerCx2 は、1つ以上の i/o トランザクションをシリアルコントローラードライバーに発行することによって、クライアントからの読み取り要求または書き込み要求を処理します。 このドライバーは、要求内のシリアルコントローラーとデータバッファーとの間でデータを転送する自己完結型の i/o 操作として各トランザクションを処理します。

チップ (SoC) 統合回路のシステムには、多くの場合、同じ印刷回路ボードにはんだを付けた他の統合回路との高速シリアル通信を可能にするシリアルコントローラー (または Uart) が含まれています。 これらのソケットのプロセッサは、プログラミングされた i/o (PIO) を使用して、これらのシリアルコントローラー内のメモリマップトデータレジスタとの間でデータを直接転送できます。 また、これらのソケットは通常、シリアルコントローラーとメモリの間でデータを移動するための高度な DMA ハードウェアを提供します。

PIO は短いデータ転送には十分な場合がありますが、大量のデータを転送するために PIO を使用すると、プロセッサの負担が大きくなりすぎます。 DMA は、プロセッサからの転送をオフロードするために必要です。

## <a name="types-of-io-transactions"></a>I/o トランザクションの種類


SerCx2 は、次の3種類の一般的な i/o トランザクションを定義します。

-   PIO
-   システム DMA
-   カスタム

すべてのシリアルコントローラードライバーは、PIO を使用してデータを転送する i/o トランザクションをサポートする必要があります。 シリアルコントローラードライバーは、シリアルコントローラーと関連付けられているハードウェアの機能に応じて、システム DMA またはカスタムデータ転送メカニズムを使用する i/o トランザクションをサポートする場合もあります。 ドライバーは、システム DMA トランザクションとカスタムトランザクションのいずれかをサポートしますが、両方をサポートすることはできません。

シリアルコントローラードライバーは、シリアルコントローラーハードウェアでサポートされている i/o トランザクションの種類ごとに、サポートパッケージを SerCx2 に登録します。 このパッケージは、関連するハードウェア機能について説明し、ドライバーによって実装されたイベントコールバック関数のセットを含み、この種類の i/o トランザクションを開始および制御するために SerCx2 を呼び出します。

シリアルコントローラーが、他のデバイスと共有される可能性のあるシステム DMA コントローラーを使用できる場合、シリアルコントローラードライバーがシステム DMA トランザクションをサポートしている可能性があります。 これらのトランザクションの場合、SerCx2 はシステム DMA コントローラーを設定し、DMA 転送を開始します。 シリアルコントローラードライバーは、システムの DMA トランザクション中に比較的少ない動作をします。

シリアルコントローラーにデータ転送用のカスタムハードウェアメカニズムがある場合、シリアルコントローラードライバーは、このメカニズムを使用するカスタムトランザクションをサポートする可能性があります。 たとえば、serial controller ハードウェアにビルトインバスマスタ DMA 機能が搭載されている場合、シリアルコントローラードライバーはカスタムトランザクションをサポートして、SerCx2 がこの機能を使用できるようにすることができます。

カスタムトランザクションは、サポートできるデータ転送メカニズムの種類に関して柔軟性があります。 ただし、これらのトランザクションは、PIO トランザクションやシステム DMA トランザクションよりも実装が困難です。 カスタムトランザクションをサポートするには、通常、データ転送に使用するハードウェアをシリアルコントローラードライバーがセットアップし、初期化する必要があります。 また、関連するカスタム受信トランザクションまたはカスタム送信トランザクションが終了する前に、保留中の読み取り要求または書き込み要求が取り消された場合、ドライバーはトランザクションを終了し、要求を完了する必要があります。

I/o トランザクションは、比較的単純な操作です。 I/o トランザクションでは、シリアルコントローラーからデータを読み取るか、コントローラーにデータを書き込むことができます。また、読み取りと書き込みを混在させることもありません。 I/o トランザクションでは、シングル転送モード (PIO、システム DMA、またはカスタム) が使用され、転送モードが混在することはありません。

SerCx2 は、読み取り要求または書き込み要求を満たすために PIO と DMA のどちらを使用するかを、インテリジェントに決定できます。 たとえば、SerCx2 は、シリアルコントローラードライバーに対して非常に短い読み取り要求または書き込み要求を PIO トランザクションとして提示することがあります。 または、SerCx2 によって、シリアルコントローラーに対する読み取りまたは書き込み要求が DMA トランザクションとして表示される場合があります。

## <a name="breaking-a-read-or-write-request-into-multiple-transactions"></a>読み取り要求または書き込み要求を複数のトランザクションに分割する


一部のシステム DMA コントローラーでは、より長い読み取り要求または書き込み要求を複数の i/o トランザクションに分割する SerCx2 を必要とする制限がある場合があります。 たとえば、システム DMA コントローラーで、メモリ内のバイト境界を開始および終了するために DMA 転送を開始および終了する必要があるが、読み取り要求のデータバッファーが奇数バイト境界で開始および終了する場合、SerCx2 は PIO を使用して最初と最後のバイトをバッファーに転送する可能性があります。、およびはシステム DMA を使用して、最初と最後のバイト間のすべてのデータを転送します。 この例では、SerCx2 は次の3つの i/o トランザクションをシリアルコントローラードライバーに対して、示されている順序で発行します。

1.  最初のバイトの PIO 受信トランザクション。
2.  範囲内のバイトのシステム DMA 受信トランザクション。
3.  最後のバイトの PIO 受信トランザクション。

同様に、カスタムデータ転送メカニズムで、メモリ内の任意のバイト境界に対してカスタムの送信トランザクションを開始および終了できるが、書き込み要求のバッファーサイズがカスタム送信トランザクションの最大転送長 (SerCx2 パーティション) を超えている場合も同様です。書き込み要求が2つ (またはそれ以上) のカスタム送信トランザクションで、それぞれが最大転送長さを超えていません。

SerCx2 が読み取り要求または書き込み要求を複数の i/o トランザクションに分割する必要がある場合、シリアルコントローラードライバーは、これらのトランザクションと要求との関係を無視しても安全です。 SerCx2 は、データが正しい順序で受信または送信されることを保証するために、トランザクションをシリアル化します。

シリアルコントローラードライバーがコールバック関数のセットを登録してシステム DMA トランザクションやカスタムトランザクションをサポートする場合、ドライバーは、これらのトランザクションを実行するハードウェアの機能を記述するパラメーター値を提供します。 たとえば、システム DMA トランザクションの場合、パラメーターにはアラインメント要件、およびシステム DMA コントローラーがサポートする最小転送長と最大転送長さが含まれます。 SerCx2 は、これらのパラメーターを使用して、読み取り要求または書き込み要求を PIO トランザクションまたはシステム DMA トランザクションとして処理するかどうか、および要求を2つ以上の i/o トランザクションに分割するかどうかを決定します。

ただし、シリアルコントローラーには、シリアルコントローラードライバーが SerCx2 に提供するパラメーターによって適切に記述できない特殊なハードウェア機能がある場合があります。 このため、ドライバーはハードウェアに依存する情報にアクセスして、読み取りまたは書き込みの要求を1つ以上の i/o トランザクションにパーティション分割する方法について SerCx2 よりも適切な決定を行うことができます。 オプションとして、このようなドライバーでは、 [*EvtSerCx2SelectNextReceiveTransactionType*](https://docs.microsoft.com/windows-hardware/drivers/ddi/sercx/nc-sercx-evt_sercx2_select_next_receive_transaction_type)および[*EvtSerCx2SelectNextTransmitTransactionType*](https://docs.microsoft.com/windows-hardware/drivers/ddi/sercx/nc-sercx-evt_sercx2_select_next_transmit_transaction_type)イベントコールバック関数を実装できます。 SerCx2 が実装されている場合は、これらの関数を呼び出して、読み取りまたは書き込みの要求を満たすために使用する i/o トランザクションをドライバーが決定できるようにします。

 

 




