---
title: ドライバー開発者向けの Windows セキュリティ モデル
description: Windows のセキュリティ モデルは、主に少数のシステム全体の特権でのオブジェクトごとの権限に基づきます。
ms.assetid: 3A7ECA7C-1FE6-4ADB-97A9-A61C6FCE9F04
ms.date: 02/01/2018
ms.localizationpriority: medium
ms.openlocfilehash: bf94f3917fe21917a4136cd5f4f7ffd40c18f820
ms.sourcegitcommit: fb7d95c7a5d47860918cd3602efdd33b69dcf2da
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/25/2019
ms.locfileid: "67371996"
---
# <a name="span-idintroductionspanspan-idintroductionspanspan-idintroductionspanwindows-security-model-for-driver-developers"></a><span id="Introduction"></span><span id="introduction"></span><span id="INTRODUCTION"></span>ドライバー開発者向けの Windows セキュリティ モデル

Windows のセキュリティ モデルは、セキュリティ保護可能なオブジェクトに基づきます。 オペレーティング システムの各コンポーネントには、担当がオブジェクトのセキュリティを確保する必要があります。 そのため、ドライバーは、デバイスとデバイス オブジェクトのセキュリティを保護する必要があります。

このトピックでは、Windows のセキュリティ モデルがカーネル モード ドライバーに適用する方法をまとめたものです。 


## <a name="windows-security-model"></a>Windows セキュリティ モデル

Windows のセキュリティ モデルは、主に少数のシステム全体の特権でのオブジェクトごとの権限に基づきます。 セキュリティ保護できるオブジェクトが含まれます: がこれらに限定することはできません: ファイル、ディレクトリ、およびデバイスと、プロセス、スレッド、イベント、およびその他の同期のオブジェクトします。

各種類のオブジェクトには、ジェネリックは読み取り、書き込み、および詳細なオブジェクト固有の権限を権限のマップを実行します。 たとえば、ファイルとディレクトリは、使用できる権利には読み取りまたは書き込み、ファイルまたはディレクトリ、読み取りまたは書き込み拡張ファイル属性を右、ディレクトリを走査する権限およびオブジェクトのセキュリティ記述子を書き込む権限を権限が含まれます。 

セキュリティ モデルには、次の概念が含まれます。

-   セキュリティ識別子 (Sid)
-   アクセス トークン
-   セキュリティ記述子
-   アクセス制御リスト (Acl)
-   権限

### <a name="span-idsecurityidentifierssidsspanspan-idsecurityidentifierssidsspanspan-idsecurityidentifierssidsspansecurity-identifiers-sids"></a><span id="Security_Identifiers__SIDs_"></span><span id="security_identifiers__sids_"></span><span id="SECURITY_IDENTIFIERS__SIDS_"></span>セキュリティ識別子 (Sid)


セキュリティ識別子 (SID とも呼ばれる、*プリンシパル*) ユーザー、グループ、またはログオン セッションを識別します。 各ユーザーは、ログオン時にオペレーティング システムで取得した一意の SID を持っています。

Sid は、オペレーティング システムやドメイン サーバーなど、機関によって発行されます。 一部の Sid は既知であり、名前と識別子を持っています。 たとえば、SID S-1-1-0 すべてのユーザー (または World) を識別します。


### <a name="access-tokens"></a>アクセス トークン

すべてのプロセスでは、アクセス トークンがあります。 アクセス トークンでは、プロセスの完全なセキュリティ コンテキストについて説明します。 ユーザーの SID が含まれている、ユーザーが所属するグループの SID と、SID、ログオン セッションのユーザーに与えられているシステム全体の特権の一覧。

既定では、プロセスのスレッドがセキュリティ保護可能なオブジェクトと対話するたびに、システムはプロセスのプライマリ アクセス トークンを使用します。 ただし、スレッドは、クライアントのアカウントを偽装できます。 スレッドが偽装するときだけでなく、独自のプライマリ トークン偽装トークンがあります。 権限借用トークンは、スレッドが偽装されるユーザー アカウントのセキュリティ コンテキストについて説明します。 権限借用は、リモート プロシージャ コール (RPC) の処理で特に一般的です。

スレッドまたはプロセスに対して制限付きのセキュリティ コンテキストを記述するアクセス トークンは、制限付きトークンと呼ばれます。 内の Sid を*制限付きトークン*セキュリティ保護可能なオブジェクトへのアクセスを拒否のアクセスを拒否する場合にのみ設定できます。 さらに、トークンは、システム全体の特権の制限のセットを記述できます。 ユーザーの SID と id は同じままですが、プロセスが制限付きトークンを使用して、ユーザーのアクセス権が制限されます。 [CreateRestrictedToken](https://docs.microsoft.com/windows/desktop/api/securitybaseapi/nf-securitybaseapi-createrestrictedtoken)関数は、制限付きトークンを作成します。


### <a name="security-descriptors"></a>セキュリティ記述子

各名前付きの Windows オブジェクトがセキュリティ記述子。一部の名前のないオブジェクトには、すぎます。 セキュリティ記述子には、所有者とその Acl とオブジェクトのグループの Sid がについて説明します。

通常、オブジェクトのセキュリティ記述子は、オブジェクトを作成する関数によって作成されます。 ドライバーを呼び出すと、 [IoCreateDevice](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/wdm/nf-wdm-iocreatedevice)または[IoCreateDeviceSecure](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/wdmsec/nf-wdmsec-wdmlibiocreatedevicesecure)デバイス オブジェクトを作成する日常的なシステム セキュリティ記述子を作成したデバイス オブジェクトに適用され、オブジェクトの Acl を設定します。 ほとんどのデバイスの Acl は、デバイスの情報 (INF) ファイルで指定されます。

詳細については[セキュリティ記述子](https://docs.microsoft.com/windows-hardware/drivers/kernel/security-descriptors)カーネル ドライバーのドキュメントにします。

### <a name="access-control-lists"></a>アクセス制御リスト

アクセス制御リスト (Acl) には、オブジェクトへのアクセスの詳細に制御が有効にします。 ACL は、各オブジェクトのセキュリティ記述子の一部です。

各 ACL には、0 個以上のアクセス制御エントリ (ACE) が含まれています。 各 ACE には、さらに、ユーザー、グループ、またはコンピューターおよび拒否またはその SID に対して許可される権限の一覧を識別する単一の SID が含まれています。

### <a name="acls-for-device-objects"></a>デバイス オブジェクトの Acl

デバイス オブジェクトの ACL は、3 つの方法のいずれかで設定できます。

-   そのデバイスの種類の既定のセキュリティ記述子を設定します。
-   によってプログラムで作成された、 **RtlCreateSecurityDescriptor**関数を設定、 **RtlSetDaclSecurityDescriptor**関数。
-   セキュリティ記述子定義言語 (SDDL) デバイスの INF ファイル、またはへの呼び出しで指定された、 **IoCreateDeviceSecure**ルーチン。

すべてのドライバーは、それらのデバイス オブジェクトの Acl を指定するのに、INF ファイルの SDDL を使用します。

SDDL は、文字列の形式で Acl を作成するコンポーネントをできるようにする拡張可能な説明の言語です。 SDDL は、ユーザー モードとカーネル モードの両方のコードによって使用されます。 次の図は、デバイス オブジェクトの SDDL 文字列の形式を示します。

![デバイス オブジェクトの sddl 文字列](images/wsm-sddlstrings.gif)

アクセス値は、アクセス権の種類を指定します。 SID 値は、アクセス値 (例、ユーザーまたはグループ) の適用先を決定するセキュリティ識別子を指定します。

たとえば、次の SDDL 文字列にすべてのシステム (SY) へのアクセス許可し、すべてのユーザーに他の (WD) のみの読み取りアクセスを許可します。

``` syntax
“D:P(A;;GA;;;SY)(A;;GR;;;WD)”
```

ヘッダー ファイルの wdmsec.h には、一連のデバイス オブジェクトによって適している定義済みの SDDL 文字列も含まれています。 たとえば、ヘッダー ファイルは SDDL を定義します。\_DEVOBJ\_SYS\_すべて\_ADM\_RWX\_WORLD\_RWX\_RES\_RWX として次のとおりです。

``` syntax
"D:P(A;;GA;;;SY)(A;;GRGWGX;;;BA)(A;;GRGWGX;;;WD)(A;;GRGWGX;;;RC)"
```

この文字列の最初のセグメントは、カーネルとオペレーティング システム (SY) デバイスを完全に制御できます。 2 番目のセグメントをすべてのユーザー、組み込みの Administrators グループ (BA) が、ACL を変更しないように、デバイス全体にアクセスできます。 3 番目のセグメントは、すべてのユーザーに、デバイスに対する読み取りまたは書き込み (WD) と 4 番目のセグメントには、信頼できないコード (RC) に同じ権限が付与されます。 ドライバーを使用できます、定義済みの文字列、またはモデルとしてデバイス固有オブジェクトの文字列。

スタック内のすべてのデバイス オブジェクトには、同じ Acl 必要があります。 スタックの変更、デバイス全体のスタック上の Acl で 1 つのデバイス オブジェクトの Acl を変更します。

ただし、新しいデバイス オブジェクトをスタックに追加することは変わりません (Acl がある) 場合は、新しいデバイス オブジェクトのものか、スタック内の既存のデバイス オブジェクトのいずれかの Acl。 ドライバーが、コピーして、スタックの Acl を新しいデバイス オブジェクトにコピーする必要がありますドライバーでは、新しいデバイス オブジェクトを作成し、スタックの一番上にアタッチします。、、 **DeviceObject.Characteristics**フィールド、[次へ] の下のドライバーをします。

**IoCreateDeviceSecure**ルーチンは、WD SY などの定義済みの Sid を使用する SDDL 文字列のサブセットをサポートします。 ユーザー モード Api と INF ファイルでは、完全な SDDL 構文をサポートします。

### <a name="security-checks-using-acls"></a>Acl を使用してセキュリティを確認します

プロセスがオブジェクトへのアクセスを要求すると、セキュリティ チェックは、呼び出し元のアクセス トークンに Sid に対してオブジェクトの Acl を比較します。

システムでは、上から下へ順に Ace を比較し、最初に関連する一致で停止します。 そのため、ACL を作成するときに、拒否、対応する上記の Ace の許可 Ace を常に配置する必要があります。 次の例は、比較を実行する方法を示します。

**例 1:アクセス トークンの ACL を比較します。**

例 1 では、システムが呼び出し元のプロセスのアクセス トークンの ACL を比較する方法を示します。 呼び出し元が次の表に表示されている ACL を持つファイルを開くことを想定しています。

**サンプル ファイルの ACL**

| Permission (アクセス許可) | SID        | アクセス権                |
|------------|------------|-----------------------|
| 許可      | アカウンティング | 書き込み、削除         |
| 許可      | 販売      | 追加                |
| 拒否       | 法務      | 追加、書き込み、削除 |
| 許可      | すべてのユーザー   | Read                  |

 

この ACL には、4 つの Ace には、会計、販売、Legal、およびすべてのユーザーに適用するグループが含まれています。

次に、要求元のプロセスのアクセス トークンには、1 人のユーザーと、次の順序で、3 つのグループの Sid が含まれてと仮定します。

ユーザーの Jim (S-1-5-21...)

アカウンティング (S-1-5-22...) をグループ化します。

Legal (S-1-5-23...)

グループのすべてのユーザー (S-1-1-0)

ファイルの ACL アクセス トークンを比較するときに、システム最初にユーザー ファイルの ACL で Jim の ACE。 [なし] が表示されたら、そのため経理グループの ACE の次に見えます。 "経理"グループの ACE がファイルの ACL は Jim の最初のエントリとして表示されます、前の表に示すように ' s のプロセスには、書き込み、または、ファイルと比較の停止を削除する権限が付与されます。 プロセスが拒否される可能性場合は、ACE、有効なグループの代わりに、ACL で"経理"グループの ACE の前に、書き込み、追加、およびファイルへのアクセスを削除します。

**例 2:制限付きトークンの ACL を比較します。**

システムでは、比較が制限付きトークンで同じ方法で制限付きトークンの ACL を比較します。 ただし、制限付きトークンで拒否 SID は、ACL で拒否 ACE のみを照合できます。

例 2 では、システムが制限付きトークンを使用して、ファイルの ACL を比較する方法を示します。 ファイルが同じ ACL は、前の表に示すように想定しています。 この例で、ただし、プロセスは次の Sid を含む、制限付きトークン。

ユーザーの Jim (S-1-5-21...)拒否します。

アカウンティング (S-1-5-22...) をグループ化します。拒否します。

Legal (S-1-5-23...)拒否します。

グループのすべてのユーザー (S-1-1-0)

ファイルの ACL は、Jim の一覧表示しません SID、ため、システムが経理グループの SID に進みます。 この ACE が; へのアクセスを許可、ファイルの ACL には、"経理"グループの ACE が、そのため、アクセスを拒否するプロセスの制限付きトークンの SID は一致しません。 その結果、システムは、有効なグループの SID に進みます。 ファイルの ACL には、ACE アクセスを拒否する有効なグループにはが含まれていますが、プロセスが書き込むことはできません、ため、追加、またはファイルを削除します。

### <a name="privileges"></a>権限


特権は、ユーザーが、ドライバーの読み込み、時刻の変更、システムのシャット ダウンなど、ローカル コンピューター上のシステムに関連する操作を実行する権限です。

権限は、オブジェクトではなく、システム関連のタスクとリソースに適用されるため、およびオペレーティング システムではなく、システム管理者は、ユーザーまたはグループに割り当てられているため、アクセス権と異なります。

各プロセスのアクセス トークンには、プロセスに与えられる権限の一覧が含まれています。 使用する前に、特権を具体的には有効にする必要があります。 特権の詳細については、次を参照してください。[特権](https://docs.microsoft.com/windows-hardware/drivers/kernel/privileges)カーネル ドライバーのドキュメントにします。

 

## <a name="span-idcreating-a-filespanspan-idcreating-a-filespanspan-idcreating-a-filespanwindows-security-model-scenario-creating-a-file"></a><span id="Creating-A-File"></span><span id="CREATING-A-FILE"></span><span id="creating-a-file"></span>Windows セキュリティ モデルのシナリオ:ファイルの作成

システムでは、プロセス、ファイルまたはオブジェクトを識別するハンドルを作成するたびに、Windows セキュリティ モデルで説明されているセキュリティの構成要素を使用します。

次の図は、ユーザー モード プロセスがファイルを作成しようとしたときにトリガーされるセキュリティ関連の操作を示します。

![次に示すファイルの例を作成します。](images/wsm-creatingafile.gif)

前の図は、システムでのユーザー モード アプリケーションを呼び出すときの応答方法を示しています、 **CreateFile**関数。 次のノートは、図の丸の数字を参照してください。

1.  ユーザー モード アプリケーションを呼び出す、 **CreateFile**関数は、有効な Microsoft Win32 ファイル名を渡します。
2.  ユーザー モード Kernel32.dll は、Win32 名を Microsoft Windows NT のファイル名に変換する、Ntdll.dll に要求を渡します。
3.  Ntdll.dll の呼び出し、 **NtCreateFile**関数を Windows ファイル名を指定します。 I/O マネージャーが処理 Ntoskrnl.exe 内**NtCreateFile**します。
4.  I/O マネージャーは、オブジェクト マネージャー呼び出しに要求を再パッケージします。
5.  オブジェクト マネージャーは、シンボリック リンクを解決し、ユーザーにファイルを作成するパスを走査権利があることを確認します。 詳細については、次を参照してください。[オブジェクト マネージャーでのセキュリティ チェックの](#omchecks)します。
6.  オブジェクト マネージャーは、要求に関連付けられている基になるオブジェクト型を所有するシステム コンポーネントを呼び出します。 ファイルの作成要求の場合は、このコンポーネントは、デバイス オブジェクトを所有する I/O マネージャーが。
7.  I/O マネージャーは、ユーザーがデバイスに必要なアクセス権を持つようにするため、ユーザーのプロセスのアクセス トークンに対してデバイス オブジェクトのセキュリティ記述子を確認します。 詳細については、次を参照してください。 [I/O マネージャーでのセキュリティ チェックの](#iomanchecks)します。
8.  I/O マネージャーがハンドルを作成し、IRP を送信します。 ユーザー プロセスに必要なアクセス権がある場合は、\_MJ\_デバイスまたはファイル システムのドライバーに要求を作成します。
9.  ドライバーは、必要に応じて、追加のセキュリティ チェックを実行します。 たとえば、要求は、デバイスの名前空間でオブジェクトを指定する場合、ドライバーによってする必要があります、呼び出し元が必要なアクセス権を持つことを確認します。 詳細については、次を参照してください。[ドライバーのセキュリティ チェックが](#driver)します。

### <a name="span-idomchecksspanspan-idomchecksspansecurity-checks-in-the-object-manager"></a><span id="omchecks"></span><span id="OMCHECKS"></span>オブジェクト マネージャーでのセキュリティ チェック

そのようなチェックを実行できる最上位レベルのコンポーネントにアクセス権をチェックする責任が属しています。 オブジェクト マネージャーでは、呼び出し元のアクセス権を検証する場合は。 それ以外の場合は、オブジェクト マネージャーに要求を渡しますコンポーネント オブジェクトの種類を基になる責任を負います。 可能な場合に、そのコンポーネントが、アクセスにさらに、確認しますできない場合は、ドライバーなど、まだ下位コンポーネントに要求を渡します。

オブジェクト マネージャーでは、イベント、ミュー テックス ロックなどの単純なオブジェクトの種類の Acl を確認します。 名前空間を持つオブジェクトの場合は、型の所有者は、セキュリティ チェックを実行します。 たとえば、I/O マネージャーは、デバイス オブジェクトとファイル オブジェクトの型の所有者と見なされます。 オブジェクト マネージャーには、名前を解析するときに、デバイス オブジェクトまたはファイル オブジェクトの名前が検出されると場合、I/O マネージャーする上で示したファイル作成のシナリオと同様を名前を渡します。 I/O マネージャーでは、可能な場合も、アクセス権を確認します。 名前は、デバイスの名前空間、I/O マネージャー内のオブジェクトをさらに指定されている場合は、そこから、デバイス (またはファイル システム) 名ドライバーとそのドライバーは、要求されたアクセスを検証する責任を負います。

### <a name="span-idiomanchecksspanspan-idiomanchecksspansecurity-checks-in-the-io-manager"></a><span id="iomanchecks"></span><span id="IOMANCHECKS"></span>セキュリティ チェックが I/O マネージャー

I/O マネージャーは、ハンドルを作成するとき、プロセスへのアクセス トークンに対してオブジェクトの権限をチェックし、ハンドルと共にユーザーに付与された権限に格納されます。 以降の I/O 要求が到着したときに I/O マネージャーは、プロセスが要求された I/O 操作を実行する権限を持つようにするために、ハンドルに関連付けられた権限を確認します。 たとえば、プロセスは、後で、書き込み操作を要求している場合、呼び出し元がオブジェクトへの書き込みアクセスを持つようにするために、ハンドルに関連付けられた権限 I/O マネージャーを確認します。 

ハンドルが重複している場合は、権限をコピーから削除しますが、それに追加されません。

I/O マネージャーは、オブジェクトを作成するときに、オブジェクト固有の権利に汎用的な Win32 アクセス モードを変換します。 たとえば、次の権限は、ファイルとディレクトリに適用されます。


| Win32 アクセス モード | オブジェクト固有の権限 |
|-------------------|------------------------|
|   ジェネリック\_読み取り   |        ReadData        |
|  ジェネリック\_書き込み   |       WriteData        |
| ジェネリック\_EXECUTE  |     ReadAttributes     |
|   ジェネリック\_すべて    |          すべての           |
 
ファイルを作成するには、プロセスは、ターゲット パスに親ディレクトリ走査権利が必要です。 たとえば、作成する\\デバイス\\CDROM0\\ディレクトリ\\File.txt、プロセスは走査する権利を持つ必要があります\\デバイス、\\デバイス\\CDROM0、および\\デバイス\\CDROM0\\ディレクトリ。 I/O マネージャーは、これらのディレクトリのトラバーサル権限のみを確認します。

I/O マネージャーは、ファイル名を解析するときに走査権利を確認します。 ファイル名がシンボリック リンクの場合は、I/O マネージャーは、完全なパスに問題が解決し、ルートから始まる、トラバーサルの権限をチェックします。 たとえば、シンボリック リンク\\\dosdevices\z\\D は、Windows NT のデバイス名にマップ\\デバイス\\CDROM0 します。 プロセスのトラバーサル権限が必要、\\デバイスのディレクトリ。

詳細については、次を参照してください。[オブジェクトは処理](https://docs.microsoft.com/windows-hardware/drivers/kernel/object-handles)と[オブジェクト セキュリティ](https://docs.microsoft.com/windows-hardware/drivers/kernel/object-security)します。

### <a name="span-iddriverspanspan-iddriverspansecurity-checks-in-the-driver"></a><span id="driver"></span><span id="DRIVER"></span>ドライバーのセキュリティを確認します

オペレーティング システムのカーネルは、すべてのドライバーを実際には、独自の名前空間とファイル システムとして扱います。 その結果、呼び出し元がデバイスの名前空間でオブジェクトを作成しようとすると、I/O マネージャー プロセスでは、パスにディレクトリ走査権利がありますをチェックします。 

WDM ドライバー、I/O マネージャーは、名前空間に対してセキュリティ チェックを実行しない FILE_DEVICE_SECURE_OPEN を指定する、デバイス オブジェクトが作成されている場合を除き、します。  FILE_DEVICE_SECURE_OPEN が設定されていない場合、ドライバーはその名前空間のセキュリティを確保する責任を負います。 詳細については、次を参照してください。[デバイス Namespace のアクセスを制御する](https://docs.microsoft.com/windows-hardware/drivers/kernel/controlling-device-namespace-access)と[デバイス オブジェクトのセキュリティで保護する](https://docs.microsoft.com/windows-hardware/drivers/kernel/securing-device-objects)します。

ドライバーは WDF、FILE_DEVICE_SECURE_OPEN フラグは常に、ように設定、デバイスの名前空間内で任意の名前にアクセスするアプリケーションを許可する前に、デバイスのセキュリティ記述子のチェックがあります。 詳細については、次を参照してください。 [KMDF ドライバーでのデバイス アクセスの制御](https://docs.microsoft.com/windows-hardware/drivers/wdf/controlling-device-access-in-kmdf-drivers)します。



## <a name="windows-security-boundaries"></a>Windows セキュリティの境界

ドライバーとの通信と別の特権レベルのユーザー モードの呼び出し元には、信頼境界を通過することを検討できます。 信頼境界は、その下位の特権を持つプロセスから高い特権を持つプロセスが交差するコードの実行パスです。

高いほど、面の相違点、特権レベルで詳細興味深い境界は、攻撃者が対象となるドライバーまたはプロセスに対して特権昇格攻撃などの攻撃を実行します。

脅威モデルを作成するプロセスの一部が、セキュリティ境界を調べ、予期しないパスを探します。 詳細については、次を参照してください。[ドライバーの脅威のモデル化](threat-modeling-for-drivers.md)します。 

信頼境界を越える任意のデータは、信頼されていないと、検証する必要があります。 

この図では、次の 3 つのカーネル ドライバー、2 つのアプリ、アプリ コンテナーおよび管理者権限で実行される 1 つのアプリで 1 つを示します。 赤色の線は、信頼境界の例を示します。

![ドライバー攻撃対象領域の 3 つのカーネル ドライバー、およびアプリケーション コンテナーで 1 つ、2 つのアプリの表示](images/driver-security-attack-surface.png)

アプリ コンテナーでは、追加の制約を指定でき、管理者レベルでが実行されていない、アプリ コンテナー (非常に低い特権のプロセス) とカーネル ドライバーの間の信頼境界があるため (1) のパス、エスカレーション攻撃の高いリスク パスです。 

アプリケーションが管理者権限で実行されていると、カーネル ドライバーに直接呼び出すことが (2) のパス、低いリスク パスです。 管理者は、システム上で非常に高い特権では既にカーネルに管理者からの攻撃対象領域は、攻撃者にとって興味深い操作対象がまだ注目に値する信頼の境界の小さい。

パス (3) は、脅威モデルが作成されていない場合が欠落する可能性があります複数の信頼境界を越える、コードの実行パスの例を示します。
この例ではドライバー 1 と 3、ドライバーの間の信頼境界ドライバー 1 は、ユーザー モードのアプリからの入力と 3 をドライバーに直接渡されます。

ユーザー モードからドライバーに送信されるすべての入力が信頼されていないと、検証する必要があります。 その他のドライバーから入力できない可能性がありますも、以前のドライバが単純なパススルーだけをしたかどうかによって信頼されている (アプリ 1 から 1 をドライバーでデータを受信した、ドライバー 1 は、データのいずれかの検証を行わないしに渡されるだけ前方にドライバー 3)。 必ずすべての攻撃対象領域を識別および信頼境界によって完全な脅威モデルを作成する何らかの関わり、それらのすべてのデータを検証してください。


## <a name="windows-security-model-recommendations"></a>Windows セキュリティ モデルに関する推奨事項 

-   呼び出しで強力な既定の Acl を設定、 **IoCreateDeviceSecure**ルーチン。
-   各デバイスの INF ファイルで Acl を指定します。 これらの Acl は、必要に応じて、緊密な既定の Acl を緩和できます。
-   ファイル設定\_デバイス\_SECURE\_デバイスの名前空間にデバイス オブジェクトのセキュリティ設定を適用する特性を開きます。
-   ファイルが使用できる Ioctl を定義しない\_ANY\_アクセスしない限り、このようなアクセスを故意に悪用されることはできません。
-   使用して、 **IoValidateDeviceIoControlAccess**ファイルを許可する既存の IOCTL でセキュリティを強化する目的でルーチン\_ANY\_アクセスします。
-   セキュリティ境界を確認し、予期しないパスを検索する脅威モデルを作成します。 詳細については、次を参照してください。[ドライバーの脅威のモデル化](threat-modeling-for-drivers.md)します。 
-   参照してください[ドライバーのセキュリティ チェックリスト](driver-security-checklist.md)の追加のドライバーのセキュリティに関する推奨事項。


### <a name="see-also"></a>参照

[デバイス オブジェクトのセキュリティ保護](https://docs.microsoft.com/windows-hardware/drivers/kernel/securing-device-objects)

[ドライバーのセキュリティ チェックリスト](driver-security-checklist.md)







