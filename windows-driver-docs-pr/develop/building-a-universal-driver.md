---
title: ユニバーサル Windows ドライバーのビルド
description: ユニバーサル ドライバーのビルド方法のガイド
ms.date: 10/03/2017
ms.localizationpriority: medium
ms.openlocfilehash: 555cdead7ae3e80fc5835e9c724ad0552825da86
ms.sourcegitcommit: 5598b4c767ab56461b976b49fd75e4e5fb6018d2
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2020
ms.locfileid: "67370371"
---
# <a name="building-a-universal-windows-driver"></a>ユニバーサル Windows ドライバーのビルド

Microsoft Visual Studio 2015 と Windows Driver Kit (WDK) 10 を使うと、デスクトップ、モバイル、またはユニバーサルのドライバーをビルドできます。 キットとツールは、[Windows ハードウェア デベロッパー センター](https://go.microsoft.com/fwlink/p/?LinkId=524487)からダウンロードできます。

多くの場合、レガシ カーネル モード ドライバーは、そのドライバーでユーザー モード コンポーネントを使っていない限り、ユニバーサル Windows ドライバーとして再コンパイルできます。 レガシ WDM ドライバーと KMDF ドライバーは、Windows 10 をターゲットとするユニバーサル Windows ドライバーとして再コンパイルでき、変換の必要はありません。

これに対し、既存のユーザー モード ドライバーをユニバーサル Windows ドライバーとしてコンパイルするには、変更が必要になることがあります。 つまり、ドライバー パッケージには UWP の外部の依存関係が存在しないようにする必要があります。 たとえば、Win32 API は、一部のみが UWP の内部に存在します。

## <a name="converting-an-existing-driver-project-to-a-universal-windows-driver-project"></a>既存のドライバー プロジェクトのユニバーサル Windows ドライバー プロジェクトへの変換

1.  Visual Studio 2015 で、既存のドライバー プロジェクトを開きます。
2.  [ソリューション エクスプローラー] ウィンドウで、ソリューションを右クリックし、 **[構成マネージャー]** をクリックします。 ターゲット オペレーティング システムを Windows 10 に設定します。
3.  ドライバー プロジェクトを右クリックし、 **[プロパティ]** をクリックします。 **[構成プロパティ] -&gt; [ドライバー]** で、 **[ターゲット プラットフォーム]** が **[ユニバーサル]** に設定されていることを確認します。 その他のオプションとして、デスクトップ エディションの Windows 10 でのみ動作するドライバーをビルドする **[デスクトップ]** や、Windows 10 Mobile でのみ動作するドライバーをビルドする **[モバイル]** があります。
4.  ドライバーをビルドします。 リンカーのエラーが発生する場合があります。
5.  エラー ログを調べてエラーを 1 つずつ修正します。 可能な代替 API については、マニュアルの個別のリファレンス ページを参照してください。 代替 API を使用できない場合は、ドライバーの設計を変更することが必要になる場合があります。

## <a name="creating-a-new-universal-windows-driver-project-in-microsoft-visual-studio"></a>Microsoft Visual Studio での新しいユニバーサル Windows ドライバー プロジェクトの作成

1.  テンプレートから新しいドライバーを作成し ( **[ファイル] -&gt; [新しいプロジェクト] -&gt;[テンプレート] -&gt; [Visual C++] -&gt; [Windows ドライバー] -&gt; [WDF]** )、 **[ユーザー モード ドライバー (UMDF V2)]** または **[カーネル モード ドライバー (KMDF)]** を選択します。
2.  プロジェクトの作成後、[ソリューション エクスプローラー] ウィンドウでソリューションを右クリックし、 **[構成マネージャー]** をクリックします。 **[アクティブ ソリューション構成]** を目的のターゲット Windows バージョンに設定し、 **[アクティブ ソリューション プラットフォーム]** を **[Win32]** または **[x64]** に設定します。 一覧に **[ARM]** が表示されない場合に ARM 用にビルドするには、 **[&lt;新規作成...&gt;]** を選択します。

    Windows 10 を選ぶと、ドライバー モデルの既定値は **[ユニバーサル]** になります。

    手動でドライバー モデルを変更するには、ドライバー プロジェクトを右クリックし、[プロパティ] をクリックします。 **[構成プロパティ] -&gt; [ドライバーの設定] -&gt; [全般]** の順にクリックし、 **[ターゲット プラットフォーム]** のエントリを検索します。 **[ユニバーサル]** 、 **[デスクトップ]** 、または **[モバイル]** をクリックします。 Microsoft Visual Studio はこの設定を使って、リンクするライブラリを決定します。

    **注**  Windows 10 より前のバージョンの Windows 用のユニバーサル Windows ドライバーをビルドすることはできません。
3.  必要に応じて .inf ファイルを変更して、INF ファイルの [**Strings**](https://docs.microsoft.com/windows-hardware/drivers/install/inf-strings-section) セクションにプロバイダーを指定します。%*ManufacturerName*% トークンとして指定されたプロバイダーは、後でこのセクションの定義に従って展開されます。 たとえば、次のように入力します。

    ```cpp
    Provider="Contoso"
    ```

4.  これで、ソリューションをビルドできるようになりました。 Visual Studio は、必要なライブラリに対してリンクし、.cat ファイル、.inf ファイル、およびドライバーのバイナリを生成します。

## <a name="creating-a-new-universal-application-or-dll-project-in-microsoft-visual-studio"></a>Microsoft Visual Studio での新しいユニバーサル アプリケーションまたは DLL プロジェクトの作成

1.  テンプレートから新しいドライバーを作成し ( **[ファイル] -> [新しいプロジェクト] -> [テンプレート]-> [Visual C++] -> [Windows ドライバー]** )、 **[Empty Desktop Application for Drivers (Universal)]** (ドライバー用の空のデスクトップ アプリケーション (ユニバーサル)) または **[Empty Dll for Drivers (Universal)]** (ドライバー用の空の DLL (ユニバーサル)) を選択します。
2.  プロジェクトの作成後、[ソリューション エクスプローラー] ウィンドウでソリューションを右クリックし、 **[構成マネージャー]** をクリックします。 **[アクティブ ソリューション構成]** を目的のターゲット Windows バージョンに設定し、 **[アクティブ ソリューション プラットフォーム]** を **[Win32]** または **[x64]** に設定します。 一覧に ARM が表示されない場合に ARM 用にビルドするには、 **[<新規作成...>]** を選択します。
Windows 10 を選ぶと、アプリケーション モデルの既定値は **[ユニバーサル]** になります。
ターゲット プラットフォームを手動で変更するには、ドライバー プロジェクトを右クリックして [プロパティ] を選択します。 **[構成プロパティ] -> [ドライバーの設定] -> [全般]** の順にクリックし、 **[ターゲット プラットフォーム]** のエントリを検索します。
3.  ソリューションをビルドします。

ドライバーのビルド時に Visual Studio で使える構成設定については、「[WDK を使ったドライバーのビルド](building-a-driver.md)」をご覧ください。
