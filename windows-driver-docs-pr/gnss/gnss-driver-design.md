---
title: グローバルナビゲーションサテライトシステム (GNSS) ドライバーの設計
description: データ構造、エラー報告、ドライバーのバージョン管理など、Windows 10 用のグローバルナビゲーションサテライトシステム (GNSS) ドライバーを開発する際に考慮する必要がある設計原則について説明します。
ms.assetid: E10B1149-CC8B-438D-B537-258F7FCFA0E7
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: ff6b1c2757f8920313c260a3be070b0fac316899
ms.sourcegitcommit: 96f94bffe426b7f92913fa0ffff1918c76e0e52c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/04/2020
ms.locfileid: "76980679"
---
# <a name="global-navigation-satellite-system-gnss-driver-design"></a>グローバルナビゲーションサテライトシステム (GNSS) ドライバーの設計

データ構造、エラー報告、ドライバーのバージョン管理など、Windows 10 用のグローバルナビゲーションサテライトシステム (GNSS) ドライバーを開発する際に考慮する必要がある設計原則について説明します。

## <a name="data-structures"></a>データ構造

旧バージョンとの互換性、および将来の拡張性のために、すべてのデータ構造は、将来の拡張と下位互換性の問題に対応するために、バージョン番号とサイズで始まります。 追加のセーフガードとして、各構造体には、新しいフィールドが追加された場合でも静的な構造体のサイズを維持するための埋め込みバッファーもあります。 これは、構造体の動的サイズではなく、構造体の静的なコンパイル時のサイズ ( **sizeof**を使用) を使用して、以前のバージョンの gnss ドライバーから保護するためのものです。

特に指定がない限り、すべてのパラメーターは、次のように国際対応の単位 (SI) に従います。

| パラメーター | 単位 |
| --- | --- |
| 距離、しきい値、またはレベル | 計器 |
| タイムアウトまたは間隔 | second |
| 速度 | メーター/秒 |

## <a name="error-reporting"></a>エラー報告

グローバルナビゲーションサテライトシステム (GNSS) DDI では、ドライバーからの戻り値として**NTSTATUS**が想定されています。 高レベルのオペレーティングシステム (HLOS) は、これらのエラーメッセージに基づいて成功および失敗した場合にのみ機能し、特定のエラーメッセージを表示しません。 それでも、対応する**NTSTATUS**エラーメッセージに厳密にマップされたエラーがドライバーによって返されることをお勧めします。 GNSS ドライバーは独自のカスタム**NTSTATUS**エラーメッセージを送信することができ、診断の目的で役立つ場合があります。

## <a name="driver-versioning"></a>ドライバーのバージョン管理

グローバルナビゲーションサテライトシステム (GNSS) DDI に指定されたすべての構造には、ドライバーバージョンフィールドが含まれており、多くの構造体にはパディングフィールドが含まれています。 これらのコンポーネントはどちらも、次のポリシーを使用して、新しいバージョンの GNSS DDI を軽減するために使用されます。

- フレームワークとドライバーは、機能交換プロセスを使用して、それぞれのバージョンを通信します。 これらの Ioctl は、バージョンフィールドを使用してバージョンを通信するという意味で特別と見なされます。 したがって、デバイスとプラットフォームの機能チェックを囲む実装では、最初に返されたバージョンを明示的に確認し、後で使用できるように保存する必要があります。 [**Gnss\_デバイス\_機能**](https://docs.microsoft.com/windows-hardware/drivers/ddi/gnssdriver/ns-gnssdriver-gnss_device_capability)構造のバージョンメンバーは、ドライバーのバージョン番号を通信します。 [**Gnss\_PLATFORM\_機能**](https://docs.microsoft.com/windows-hardware/drivers/ddi/gnssdriver/ns-gnssdriver-gnss_platform_capability)構造のバージョンメンバーは、gnss アダプターのバージョン番号を通信します。

- 新しいフィールドが追加されるたびに、構造に埋め込みフィールドがある場合は、構造体に追加するのではなく、バイナリの互換性を維持するために領域を埋め込む必要があります。

- 新しいフィールドが追加されるたびに、そのバージョンの GNSS DDI が増加したと見なされます。 これは、GNSS DDI ヘッダー自体のコメントに反映されますが、定数として公開されることはありません。 GNSS と GNSS の両方のドライバーは、プライベート定数値を使用して現在のバージョンを示します。 これにより、GNSS アダプターとドライバーの両方を特定のバージョンに対してコーディングできるようになります。

- GNSS アダプターは、以前のバージョンの GNSS ドライバーと下位互換性がある必要があります。 プロトコルの変更が新しいバージョンの DDI で導入された場合、新しい GNSS DDI に準拠している GNSS アダプターは、新しいバージョンのドライバーに対してのみ新しいプロトコルを実装する必要があり、古いバージョンのドライバーには古いプロトコルを使用する必要があります。

- GNSS ドライバーは、新しいバージョンの GNSS アダプターとの上位互換性がある必要があります。また、新しいバージョンの GNSS アダプターは、コードの対象となる現在のバージョンと同じ方法で扱う必要があります。

- 以前のバージョンの GNSS アダプターは、新しいバージョンの GNSS ドライバーで正常に機能するとは限りません。 新しいバージョンの DDI に対して GNSS アダプターと GNSS ドライバーの共同開発を容易にするために、新しいバージョンの GNSS ドライバーをブロックするために、GNSS アダプターに厳密なバージョンチェックは存在しません。 ただし、新しいバージョンの DDI に対して実装されている GNSS ドライバーは、以前のバージョンの GNSS DDI に対して実装されている GNSS アダプターを含む製品版のデバイスには付属していません。

- Windows 8.1 またはそれ以前の GNSS センサードライバーは、GNSS アダプターではサポートされません。 これらのドライバーは、従来のスタックを通じて Windows 10 で引き続き機能します。 別の Windows 10 の GNSS ドライバーが存在する場合、従来の GNSS センサードライバーの使用は未定義です。
