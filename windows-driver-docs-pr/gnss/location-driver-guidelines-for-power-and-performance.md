---
title: 能力とパフォーマンスの場所のドライバーのガイドライン
description: 次のセクションでは、場所は、ドライバーが電力を節約し、効率的にデータを提供することを確認するためのガイドラインについて説明します。
ms.assetid: 81B9A3A1-D273-48C8-A808-CDB1533A1B6A
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: cbf754176ec9cacb224eae7ccd8c883bda638cf9
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56538535"
---
# <a name="location-driver-guidelines-for-power-and-performance"></a>能力とパフォーマンスの場所のドライバーのガイドライン


次のセクションでは、場所は、ドライバーが電力を節約し、効率的にデータを提供することを確認するためのガイドラインについて説明します。

### <a name="tracking-the-number-of-connected-clients-and-radio-state"></a>接続されているクライアントとオプションの状態の数を追跡します。

場所のセンサーが、接続されているアプリケーションの数を追跡する必要があり、センサーの両方の値を追跡する必要があります\_プロパティ\_場所\_DESIRED\_精度とセンサー\_プロパティ\_現在\_レポート\_ごとの間隔のプロパティは、アプリケーションをサブスクライブします。

接続されているクライアントの数が 0 の場合位置情報センサーは D3 可能であれば、最下位の可能な電力状態を入力する必要があります。 イベントは、クライアントが接続されていることを示します、センサーを低電力状態を終了し、データの取得します。

場所のデバイスには、ラジオ、GPS の位置情報センサーなどが含まれている場合、ラジオの状態もに追跡しなければならないを使用して[無線管理](https://msdn.microsoft.com/library/windows/hardware/hh406615)します。 ドライバー開発者は、オプションの状態を設定するドライバーを使用した通信無線管理の実装を作成する必要があります。 ラジオの管理の実装と、ドライバーと通信する方法の例は、[センサー地理位置情報ドライバー サンプル](sensors-geolocation-driver-sample.md)します。

接続されているクライアントとオプションの状態を追跡する場合、位置情報センサーする必要がありますがない接続済みクライアント オプションが、いつでも最低の可能な電源状態、D3 可能であればを入力します。 次の図は、接続されているクライアント、ラジオの状態、および推奨される対応するデバイスの状態のステート マシンを示します。

![ステート マシン](images/state-diagram-with-radio.png)

次の表は、別のさまざまなビューの組み合わせと結果の出力 (電源の状態を含む) を入力します。

|               |             |                  |                   |            |               |             |
|---------------|-------------|------------------|-------------------|------------|---------------|-------------|
| 入力        |             |                  |                   | 出力    |               |             |
| クライアントが存在します | 無線状態 | CRI              | 報告される位置 | ASIC 状態 | センサーの状態  | 電源の状態 |
| X            | 任意         | 任意              | 任意               | オフ        | なし           | D3          |
| 〇           | オン          | &lt;= 120 秒 | X                | オン         | 初期化  | D0          |
| 〇           | オン          | &lt;= 120 秒 | 〇               | オン         | 準備完了         | D0          |
| 〇           | オフ         | 任意              | 任意               | オフ        | 使用できません | D3          |
| 〇           | オン          | &gt;120 秒  | 任意               | オフ        | 準備完了         | D3          |
| 〇           | オン          | &gt;120 秒  | 任意               | オン         | 準備完了         | D0          |

 

[センサー地理位置情報ドライバー サンプル](sensors-geolocation-driver-sample.md)WDK で接続されているクライアントとオプションの状態の数を追跡するドライバーの例を示します。

### <a name="tracking-report-intervals"></a>追跡レポート間隔

イベントをサブスクライブして、場所データを使用するアプリケーション、センサーを設定してデータ更新イベントの最大の頻度を要求する\_プロパティ\_現在\_レポート\_INTERVAL プロパティ。 電源を節約するために、ドライバーは、要求された最下位のレポート間隔よりもしないより頻繁にデータ レポートを送信する必要があります。

各アプリケーションの値を追跡する方法の詳細については、次を参照してください。[データのフィルター処理](https://msdn.microsoft.com/library/windows/hardware/hh706201)します。 レポート間隔での追跡の例を検索することもできます、[センサー地理位置情報ドライバー サンプル](sensors-geolocation-driver-sample.md)WDK に含まれています。

### <a name="tracking-desired-accuracy"></a>必要な正確性の追跡

レポート間隔は、クライアントごとに追跡と同様、各クライアントによって要求された精度レベルを追跡する必要があります。

[センサー地理位置情報ドライバー サンプル](sensors-geolocation-driver-sample.md)wdk には、クライアントから要求された必要な正確性を追跡するドライバーの例を示します。

センサー ドライバーの場所は、センサーをサポートする必要があります\_プロパティ\_場所\_DESIRED\_正確に設定可能なプロパティ。 ドライバーが目的 accuracy プロパティで接続されているクライアントを監視し、センサーを設定する必要があります\_プロパティ\_場所\_DESIRED\_精度が最高に要求された目的の精度に基づいています。

アプリによって要求された最高の精度が必要なかどうかは\_精度\_既定では、位置情報センサーは、電力、およびその他のコストに関する考慮事項を最適化する必要があります。 Location API は、GPS センサーを使用して、場所データは、システム上の他のプロバイダーとデータの精度が 500 m 場合または向上はできません。

すべてのアプリ要求の必要な場合\_精度\_高、センサーが可能な最高の精度レポートを配信する必要があります。 Location API は、考えられる最も正確な位置を取得するには常に (GPS を含む) すべての場所のセンサーに接続されます。

### <a name="detecting-idle-states"></a>アイドル状態の検出

ドライバーはする必要がありますがアイドル状態を検出し、低電力状態を入力します。 たとえば、GPS デバイスの場所に変化がない、保留中の I/O 要求がないかデータが使用できないときに、アイドル状態が発生します。 GPS または GNSS デバイスが USB 経由で実装されているオプションを選択される、サポートを中断します。 参照してください[をサポートしているアイドル状態の電源切断 UMDF ベースのドライバーで](https://msdn.microsoft.com/library/windows/hardware/ff561211.aspx)の詳細。

### <a name="position-injection-for-gps-and-gnss"></a>GPS と GNSS 位置の挿入

GPS または GNSS センサーは、最初の修正に時間を短縮するのに、システムの三角測量センサーからデータを使用できます。 これと呼ばれます*の挿入位置*します。

このセンサーのセンサーの通信の使用が買収フェーズ中にのみサポートされています。 GNSS ドライバーでは、センサー API を通じて、Windows の場所プロバイダーを含む、すべての三角測量センサーへの接続を開く場合があります。 位置データがある場合、ドライバーは粗い位置を取得し、できます。 ドライバーは、位置を取得した後すぐに接続を閉じる必要があります。

GNSS ドライバーは、位置を 15 秒以内センサー API から取得できませんが、そのタイムアウトになる必要があり、センサー API への接続を閉じます。 イベントのサブスクライブを続行しないでください。

**重要な**  永続的な Windows 位置情報の取得 (またはその他の任意のセンサー センサー API を使用) に接続する必要がありますいない開いた状態に保ちます。

 

**重要な**  をインスタンス化しないで[ **ILocation** ](https://msdn.microsoft.com/library/windows/desktop/dd317674)その他の場所のセンサーからデータを取得します。 センサー API を使用して、代わりに、([**ISensorManager**](https://msdn.microsoft.com/library/windows/desktop/dd318946))。

 

**注**  センサーでは、同じ種類の場所のセンサーからデータを取得する必要があります。 たとえば、三角測量センサーでは、その他の三角測量センサーからのデータは使用しないでください。

 

三角測量センサーにアクセスするには、呼び出す[ **ISensorManager::GetSensorByType** ](https://msdn.microsoft.com/library/windows/desktop/dd318866)型センサーと\_型\_場所\_三角測量します。 Windows 8 に組み込まれている Windows 場所プロバイダーを含む、すべての三角測量センサーが返されます。 GPS ドライバーは、複数のセンサーに返される 0 個のセンサーから任意の場所で処理できる必要があります。 参照してください[センサー オブジェクトを取得する](https://msdn.microsoft.com/library/windows/desktop/dd318960)の使用の詳細については**GetSensorsByType**します。

**注**  Windows の場所のプロバイダーが正確性や可用性の保証を提供していません。

 

Fusion (たとえば、物理的な場所を推定する加速度計、ジャイロまたは磁力計のデータの使用) の場所を有効にするセンサーのセンサーの通信のセンサー API の使用がサポートされていません。

## <a name="related-topics"></a>関連トピック
[場所のセンサー ドライバーの作成](writing-a-location-sensor-driver.md)  
[センサー地理位置情報ドライバー サンプル](sensors-geolocation-driver-sample.md)  



