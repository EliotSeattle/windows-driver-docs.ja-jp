---
title: 電力とパフォーマンスに関する位置情報ドライバーのガイドライン
description: 以下のセクションでは、場所ドライバーが電力を節約し、データを効率的に提供するためのガイドラインについて説明します。
ms.assetid: 81B9A3A1-D273-48C8-A808-CDB1533A1B6A
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 7df6a2de8280f37b16ae6b8be9786e2d728aadb8
ms.sourcegitcommit: 96f94bffe426b7f92913fa0ffff1918c76e0e52c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/04/2020
ms.locfileid: "76980689"
---
# <a name="location-driver-guidelines-for-power-and-performance"></a>電力とパフォーマンスに関する位置情報ドライバーのガイドライン

以下のセクションでは、場所ドライバーが電力を節約し、データを効率的に提供するためのガイドラインについて説明します。

## <a name="tracking-the-number-of-connected-clients-and-radio-state"></a>接続されているクライアントとラジオの状態の数を追跡する

場所センサーは、接続されたアプリケーションの数を追跡する必要があります。また、センサー\_プロパティ\_の場所\_必要な\_の精度とセンサーの\_プロパティ\_現在\_サブスクライブされている各アプリケーションのプロパティの値を追跡する必要があります。

接続されているクライアントの数が0の場合、場所センサーは、可能な限り低い電力状態 (できれば D3) を入力する必要があります。 クライアントが接続されていることを示すイベントが発生した場合、センサーは低電力状態を終了し、データを取得する必要があります。

また、GPS 位置センサーのようなラジオが位置デバイスに含まれている場合は、ラジオ[管理](https://docs.microsoft.com/previous-versions/windows/hardware/radio/hh406615(v=vs.85))を使用してもラジオの状態を追跡する必要があります。 ドライバーライターは、無線状態を設定するためにドライバーと通信するラジオ管理実装を作成する必要があります。 無線管理の実装の例と、ドライバーとの通信方法は、センサーの[地理位置情報ドライバーのサンプル](sensors-geolocation-driver-sample.md)にあります。

接続されているクライアントとラジオの状態を追跡する場合、無線がオンになっている間は、接続されているクライアントがいなくても、場所センサーは可能な限り低い電力状態 (できれば D3) を入力する必要があります。 次の図は、接続されているクライアントのステートマシン、ラジオの状態、および対応するデバイスの推奨状態を示しています。

![ステートマシン](images/state-diagram-with-radio.png)

次の表に、さまざまな入力の組み合わせと、結果として得られる出力 (電源状態を含む) の別のビューを示します。

|               |             |                  |                   |            |               |             |
|---------------|-------------|------------------|-------------------|------------|---------------|-------------|
| 入力        |             |                  |                   | 出力    |               |             |
| クライアントが存在します | 無線状態 | CRI              | 報告された位置 | ASIC の状態 | センサーの状態  | 電源の状態 |
| 必須ではない            | 任意         | 任意              | 任意               | [オフ]        | なし           | D3          |
| [はい]           | オン          | &lt;= 120 秒 | 必須ではない                | オン         | 初期化  | D0          |
| [はい]           | オン          | &lt;= 120 秒 | [はい]               | オン         | 準備完了         | D0          |
| [はい]           | [オフ]         | 任意              | 任意               | [オフ]        | 使用できません | D3          |
| [はい]           | オン          | &gt;120 秒  | 任意               | [オフ]        | 準備完了         | D3          |
| [はい]           | オン          | &gt;120 秒  | 任意               | オン         | 準備完了         | D0          |

WDK の[センサー位置情報ドライバーのサンプル](sensors-geolocation-driver-sample.md)では、接続されているクライアントの数とラジオの状態を追跡するドライバーの例が提供されています。

## <a name="tracking-report-intervals"></a>レポート間隔の追跡

イベントをサブスクライブすることによって場所データを使用するアプリケーションは、センサー\_プロパティ\_CURRENT\_REPORT\_INTERVAL プロパティを設定することによって、データ更新イベントの最大頻度を要求します。 電力を節約するために、ドライバーは、要求された最も低いレポート間隔よりも頻繁にデータレポートを送信する必要があります。

各アプリケーションの値を追跡する方法の詳細については、「[データのフィルター選択](https://docs.microsoft.com/windows-hardware/drivers/sensors/filtering-data)」を参照してください。 レポート間隔の追跡の例について[は、「」を](sensors-geolocation-driver-sample.md)参照してください。

## <a name="tracking-desired-accuracy"></a>必要な精度の追跡

レポートの間隔がクライアントごとに追跡されるのと同じように、各クライアントによって要求される精度レベルを追跡する必要があります。

WDK の[センサー位置情報ドライバーのサンプル](sensors-geolocation-driver-sample.md)では、クライアントによって要求された必要な精度を追跡するドライバーの例を示しています。

位置センサードライバーは、センサー\_プロパティ\_の場所\_設定可能なプロパティとして\_精度をサポートする必要があります。 ドライバーは、接続されているクライアントの必要な精度プロパティを監視し、センサー\_プロパティ\_の場所を、要求された最高の精度に基づいて適切な\_精度\_設定します。

アプリによって要求された最高の精度が\_の精度\_既定の場合、場所センサーは電力とその他のコストに関する考慮事項を最適化する必要があります。 Location API は、システム上の他のプロバイダーから場所データを利用できる場合に GPS センサーを使用しません。また、データの精度を500以上にすることもできます。

\_精度\_高いアプリ要求がある場合、センサーは可能な限り最高の精度レポートを提供する必要があります。 Location API は、可能な限り正確な位置を取得するために、常にすべての場所センサー (GPS を含む) に接続します。

## <a name="detecting-idle-states"></a>アイドル状態の検出

ドライバーは、アイドル状態を検出して低電力状態にする必要があります。 たとえば、GPS デバイスの場所が変更されていない場合、保留中の i/o 要求がない場合、またはデータが使用できない場合に、アイドル状態が発生する可能性があります。 GPS またはグローバルナビゲーションサテライトシステム (GNSS) デバイスが USB 経由で実装されている場合は、セレクティブサスペンドをサポートする必要があります。 詳細については、「 [UMDF ベースのドライバーでのアイドル状態の出力のサポート](https://docs.microsoft.com/windows-hardware/drivers/wdf/supporting-idle-power-down-in-umdf-drivers)」を参照してください。

## <a name="position-injection-for-gps-and-global-navigation-satellite-system-gnss"></a>GPS およびグローバルナビゲーションサテライトシステムの位置の挿入 (GNSS)

GPS またはグローバルナビゲーションサテライトシステム (GNSS) センサーは、システム上の三角測量センサーのデータを使用して、最初の修正までの時間を短縮できます。 これは、*位置の挿入*と呼ばれます。

このセンサーからセンサーへの通信の使用は、取得フェーズ中にのみサポートされます。 グローバルナビゲーションサテライトシステム (GNSS) ドライバーは、センサー API を介して、Windows 位置情報プロバイダーを含むすべての三通貨センサーへの接続を開くことができます。 位置データが使用可能な場合、ドライバーは粗い位置を取得できます。 ドライバーは、位置を取得した直後に接続を閉じます。

グローバルナビゲーションサテライトシステム (GNSS) ドライバーが、15秒以内にセンサー API からの位置を取得しない場合は、センサー API への接続をタイムアウトさせて終了する必要があります。 イベントのサブスクライブを続行しないでください。

> [!IMPORTANT]
> Windows ロケーションプロバイダー (またはセンサー API を介したその他のセンサー) への永続的な接続を開いたままにすることはできません。

> [!IMPORTANT]
> 他の場所センサーからデータを取得するために[**ILocation**](https://docs.microsoft.com/windows/desktop/api/locationapi/nn-locationapi-ilocation)をインスタンス化しないでください。 代わりに、センサー API ([**ISensorManager**](https://docs.microsoft.com/windows/desktop/api/sensorsapi/nn-sensorsapi-isensormanager)) を使用してください。

> [!NOTE]
> センサーは、同じ種類の場所センサーからデータを取得することはできません。 たとえば、三通貨センサーでは、他の三通貨センサーのデータを使用しないでください。

三通貨センサーにアクセスするには、型センサーで[**ISensorManager:: GetSensorByType**](https://docs.microsoft.com/windows/desktop/api/sensorsapi/nf-sensorsapi-isensormanager-getsensorsbytype)を呼び出し、\_の場所\_三通貨\_型を呼び出します。 これにより、Windows 8 に組み込まれている Windows 位置情報プロバイダーを含む、すべての三通貨センサーが返されます。 GPS ドライバーは、複数のセンサーに返されるセンサーのゼロからどこでも処理できる必要があります。 **GetSensorsByType**の使用方法の詳細については、「[センサーオブジェクトの取得](https://docs.microsoft.com/windows/desktop/SensorsAPI/retrieving-a-sensor)」を参照してください。

> [!NOTE]
> Windows ロケーションプロバイダーは、精度や可用性を保証するものではありません。

センサーからセンサーへの通信にセンサー API を使用して場所 fusion を有効にする (たとえば、加速度計またはジャイロ磁力計データを使用して物理的な場所を推定する) ことはサポートされていません。

## <a name="related-topics"></a>関連トピック

[位置センサードライバーの書き込み](writing-a-location-sensor-driver.md)  

[センサーの地理位置情報ドライバーのサンプル](sensors-geolocation-driver-sample.md)  
