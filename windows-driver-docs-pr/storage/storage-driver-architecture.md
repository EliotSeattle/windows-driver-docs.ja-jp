---
title: Windows 記憶装置ドライバーのアーキテクチャ
description: Windows 記憶装置ドライバーのアーキテクチャ
ms.assetid: 16636899-fab9-46e8-ab9d-b8d86519b08a
keywords:
- ストレージ ドライバー WDK、アーキテクチャ
- ストレージ ドライバー WDK、種類
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: d767497e10399eb1c7d375d961a92aace4d53056
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56574104"
---
# <a name="windows-storage-driver-architecture"></a>Windows 記憶装置ドライバーのアーキテクチャ


## <span id="ddk_storage_driver_architecture_kg"></span><span id="DDK_STORAGE_DRIVER_ARCHITECTURE_KG"></span>


いずれかの間のインターフェイスとして動作するための周辺機器の記憶域デバイスの Windows オペレーティング システム クラスとフィルター ドライバー中間証明書や最上位レベルのドライバーのクラスまたはフィルター ドライバーとシステムが指定したポート ドライバーの上に配置します。

ユーザーのアプリケーションまたはカーネルのコンポーネントからの I/O 要求が I/O システムのサービスと 1 つの記憶域クラス ドライバーに到達または中間証明書や最上位レベルの詳細は、ファイル システム ドライバーなどのドライバーです。 記憶域クラス ドライバーは、システム定義 SCSI 要求 (される Srb) を含むブロック SCSI コマンド記述子ブロック (Cdb)、次の下位ドライバーには、各 IRP を送信する前にで Irp に入手できる標準の Irp を変換します。 記憶域ポート ドライバーでは、I/O のバス ドライバー経由で記憶域の HBA に送信するバスに固有のコマンドにクラス ドライバーおよびフィルター ドライバーを可能性がある 1 つまたは複数からされる Srb を変換します。

次の図は、Windows ストレージ ドライバーの階層型アーキテクチャを示します。

![オペレーティング システムの nt ベースの記憶装置ドライバーの階層型アーキテクチャを示す図](images/kg201-1.png)

Windows 記憶装置ドライバーのアーキテクチャ

以降、図の下部では、次に示します記憶装置ドライバーの種類ごと。

1.  A*ストレージ ポート ドライバー*ドライバーを含む、システムが指定したディスク、テープ、cd-rom ドライブ、DVD、およびチェンジャー クラスすべて Windows 記憶域クラス ドライバーへのインターフェイスを定義します。 このポート/クラス インターフェイスでは、クラス ドライバーが、それぞれのデバイスが接続されているホスト バス アダプターのアダプターに固有の要件から切り離しています。 記憶域ポート ドライバーでは、対応する HBA のデバイスのすべてのドライバー、バスへのアクセスも同期します。 システムでは、SCSI、IDE、USB、IEEE 1394 のアダプターのポート ドライバーを記憶域を提供します。

    ストレージ ポート ドライバー (記憶域クラス ドライバーまたは介在するフィルター ドライバー) は、次のより高いドライバーからされる Srb を受け取る次のようにそれらを処理しています。

    -   SCSI、またはその他のバスの記憶域ポート ドライバーは、オペレーティング システムに依存せず、特定の HBA に Cdb でされる Srb を渡します*Storport ミニポート ドライバー*とその対応するドライバーがポートは動的にリンクを提供します特定の HBA のハードウェア固有のサポート。 SCSI ミニポート ドライバーを実装する方法の詳細については、次を参照してください。 [Storport ミニポート ドライバー](storport-miniport-drivers.md)します。
    -   従来の IDE/ATAPI または IEEE 1394 bus ストレージ ポート ドライバーには、される Srb アダプタで必要な基になる - たとえば、形式に記憶域クラス ドライバーから受信した、バスに固有のトランスポート プロトコルに従って Cdb を再パッケージ化が変換されるか、これにより、基になるバスの特性からレベル上のドライバーの保護、別の形式に変換します。

2.  大文字または下位*ストレージ フィルター ドライバー*システムが指定したストレージ クラス ドライバーが提供していないデバイスに固有の機能をサポートします。 低いフィルター記憶装置ドライバーは、される Srb や記憶域クラス ドライバーによって発行された Irp を監視し、(記憶域ポート ドライバーまたは別の記憶域フィルター ドライバー) は、次の下位ドライバーに渡される前に、必要に応じて変更します。

    ストレージのフィルター ドライバーを実装する方法の詳細については、次を参照してください。[ストレージ フィルター ドライバー](storage-filter-drivers.md)します。

3.  A*記憶域クラス ドライバー*システム ストレージ ポート ドライバーを提供する任意のバスにその型のデバイスの制御に SCSI ポート/クラス インターフェイスを使用します。 クラスのドライバーが特定 - デバイスの特定のクラスをたとえば、1 つのクラス ドライバーで実行できます CD-ROM のすべてのデバイスのサポート対象のバス他はすべてのディスク デバイスを制御できます。 記憶域クラス ドライバーと同様、Cdb を格納していると、次の下位ドライバー (、記憶域ポート ドライバーまたは介在するフィルター ドライバー) へのされる Srb の発行、される Srb を構築することによりユーザーのアプリケーションまたはドライバーの記憶域スタックの上位からの I/O 要求を処理する場合は、デバイスSCSI デバイスをでした。

    ストレージ クラス ドライバーの実装では、上位レベルのドライバーに対して透過的です。 メディア チェンジャー デバイスまたはテープのクラス ドライバーは、システム指定のクラス ドライバーにリンクされているデバイスに固有の miniclass ドライバーとして実装されます。 ディスクや CD や DVD などの他のストレージ デバイス用のシステム指定のクラス ドライバーは、1 つのモノリシック ドライバーとして実装されます。

    ストレージ クラス ドライバーを実装する方法の詳細については、次を参照してください。[ストレージ クラス ドライバー](storage-class-drivers.md)します。 テープまたはチェンジャー miniclass ドライバーを実装する方法の詳細については、次を参照してください。[テープ ドライバー](tape-drivers.md)と[チェンジャー ドライバー](changer-drivers.md)、それぞれします。

4.  上部のフィルターの記憶装置ドライバーは、ユーザーのアプリケーションとドライバーの記憶域スタックの上位から Irp をインターセプトし、可能性があります (ストレージ クラス ドライバーまたは別の記憶域フィルター ドライバー) は、次の下位ドライバーに渡す前に変更します。 フィルター ドライバーは、通常、基になるデバイスのパフォーマンスを監視します。

バスするデバイスを接続して、その記憶域の実装は、ドライバーをポートの種類は、上に透明なレベルのドライバーです。 SCSI ポート ドライバーなど、ポート/ミニポート ドライバーのアーキテクチャに応じてストレージ ポート ドライバーを実装する場合があります。モノリシック ドライバーとして IDE/ATAPI ポート ドライバーなどのハードウェアの単一の標準的な部分を制御します。または、される Srb IEEE 1394 ポート ドライバーなどの別のドライバー スタックで必要な形式に変換するフィルター ドライバーとして。

SCSI ポートのシステムによって提供されるドライバーは、ストレージ クラス ドライバーと同じ型の非 SCSI 記憶域デバイスを制御する SCSI ミニポート ドライバー間のインターフェイスとしても機能できます。 たとえば、新しいディスク アレイ コント ローラー用ドライバーの記述ではなくドライバー ライターかなりの設計、開発、および労力をシステムの SCSI ポート ドライバーにリンクする擬似 SCSI ミニポート ドライバーを記述してデバッグを保存できますインターフェイスを使用して、その提供します。 受信した SCSI コマンドをデバイスに固有のコマンドに変換するこのようなミニポート ドライバーが必要です。 システム指定のポートとクラス ドライバーが擬似 SCSI ミニポートの代わりの presizing が要求された初期化では、すべてのリソースとオブジェクトの割り当て、同期中にレジストリへのアクセスを含むはるかに必要な作業を処理する一方で、ミニポートのデバイス、および要求を再試行の機能に合わせてに転送します。

される Srb の詳細については、カーネル モード ドライバーのアーキテクチャのリファレンスを参照してください。 Cdb のデバイス固有の種類については、INCITS scsi-3 標準で適切なコマンド セットを参照してください。

 

 




