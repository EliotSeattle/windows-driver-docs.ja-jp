---
title: DMA バッファーの分割
description: DMA バッファーの分割
ms.assetid: 6b35d5e2-f8aa-478a-a5a0-9f519ff0ba6f
keywords:
- DMA バッファー WDK の表示、分割
- DMA バッファーの分割
- 分割ポイントの WDK 表示
- パッチ-場所リスト WDK 表示
- プリエンプト DMA バッファーの WDK ディスプレイ
- DMA バッファー WDK 表示、プリエンプション
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: a3c6b0694ddaa38a30c378f77c64405f07de98cc
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72829442"
---
# <a name="splitting-a-dma-buffer"></a>DMA バッファーの分割


## <span id="ddk_splitting_a_dma_buffer_gg"></span><span id="DDK_SPLITTING_A_DMA_BUFFER_GG"></span>


分割ポイントは、ビデオメモリマネージャーが、表示ミニポートドライバーによって送信された大きな作業項目を小さな作業項目に分割し、実行する GPU リソースを減らす必要がある場合に使用します。 たとえば、大きな DMA バッファーでは、ローカルビデオメモリまたは非ローカルメモリに収まりきらない可能性がある割り当てのセットを参照する場合があります。 このような作業項目を処理する唯一の方法は、GPU リソースを少なくする必要がある複数の小さな作業項目に分割することです。

   DMA バッファーの分割と DMA バッファーのプリエンプションは、独立した概念である**ことに注意**してください。 ディスプレイミニポートドライバーは、DMA バッファーのプリエンプションが不可能な GPU を搭載したシステムでも、常に DMA バッファーの分割をサポートする必要があります。 GPU があり、コンテキストの保存と復元ができないシステムでは、GPU スケジューラによって、DMA バッファーの部分が分割され、分割された部分が別の GPU コンテキストの別の DMA バッファーとインターリーブされないようにします。 ただし、DMA バッファーの分割部分でページング操作が必要になるため、分割された DMA バッファーの部分間でページングバッファーを送信する必要があります。
アプリケーションの DMA ストリームを構築するためにドライバーが使用する各分割ポイントは、video memory manager によって使用されます。 送信された DMA バッファーは、各分割ポイントの後に、その場所に挿入される可能性のあるページングバッファーを考慮して、十分な GPU 状態を再度実行する必要があります。

 

分割ポイントを指定するために、ディスプレイミニポートドライバーは、割り当てインデックスで参照されている各割り当ての**Splitoffset**および**SlotId** [ **\_** ](https://docs.microsoft.com/windows-hardware/drivers/ddi/d3dukmdt/ns-d3dukmdt-_d3dddi_patchlocationlist)メンバーの値を指定します。D3DDDI のメンバー\_のパッチの場所の一覧です。 特定の DMA バッファー内の割り当ての使用状況を追跡するために、ビデオメモリマネージャーは、ドライバーによって提供される[**DXGK\_DRIVERCAPS**](https://docs.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/ns-d3dkmddi-_dxgk_drivercaps)構造体の**MaxAllocationListSlotId**メンバーを使用して、配列に必要な次元を作成します。[**DxgkDdiQueryAdapterInfo**](https://docs.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_queryadapterinfo)関数の呼び出しを使用します。 この配列はゼロで初期化され、修正プログラムの場所の一覧の分割部分のエントリが処理されると入力されます。 パッチの場所の**D3DDDI\_PATCH LOCATIONLIST**の**SlotId**メンバーは、リソーステーブルのどの行を更新する必要があるかを示します。 **splitoffset**メンバーは、割り当てがある DMA バッファー内のオフセットを示します。必須。 DMA バッファーは、GPU がリソースにアクセスできなくても、 **Splitoffset**によって指定されたポイントまで実行できます。 同様に、新しいパッチの場所の分割部分のエントリが同じ**SlotId**を参照している場合、以前の割り当ては新しい割り当てに置き換えられ、以前の割り当ては不要になります (つまり、以前の割り当てはページアウトできます)。

DMA バッファーに必要なリソースでページングを行う場合、ビデオメモリマネージャーは、最初の要素から開始し、最後の要素に向かって下に移動して、修正プログラムの場所の一覧を処理します。 ドライバーによって入力される[**D3DDDI\_のパッチの一覧**](https://docs.microsoft.com/windows-hardware/drivers/ddi/d3dukmdt/ns-d3dukmdt-_d3dddi_patchlocationlist)の要素には、 **splitoffset**メンバーの値が含まれている必要があります。要素は厳密に増加しています (つまり、割り当てはストリームで使用される順序で記述する必要があります)。 修正プログラムの場所の一覧で参照されている割り当てのビデオメモリマネージャーページは、指定された順序で表示されます。 メモリ不足が原因でビデオメモリマネージャーが割り当てられなくなったポイントに到達すると、ビデオメモリマネージャーは、実行のために GPU スケジューラに準備されている DMA バッファーの現在の部分を送信します。 DMA バッファーは、前の分割ポイントの最初から、準備できなかった割り当てに指定されている**Splitoffset**値まで実行されます。 送信されると、リソーステーブルを使用して、DMA ストリームの現在の分割オフセットで必要な割り当ての一覧がビデオメモリマネージャーによって決定されます。 テーブル上のすべての割り当ては、現在の物理的な場所に保持されますが、使用されなくなった他の割り当ては削除される可能性があります。 その後、ビデオメモリマネージャーは、修正プログラムの場所の一覧を処理し続けます。複数回繰り返し分割される可能性があります。

ドライバーは、割り当てがバインドまたはバインド解除されるたびに分割ポイントを指定する必要があります。 割り当てがバインド解除されるように指定するには、ドライバーは[**DXGK\_ALLOCATION list**](https://docs.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/ns-d3dkmddi-_dxgk_allocationlist)構造体の**HDeviceSpecificAllocation**メンバーに**NULL**割り当てハンドルを指定し、 **SlotId**に適切な値を指定できます。関連付けられている[**D3DDDI\_** ](https://docs.microsoft.com/windows-hardware/drivers/ddi/d3dukmdt/ns-d3dukmdt-_d3dddi_patchlocationlist)の [] のメンバー。 ビデオメモリマネージャーが複雑なメモリ配置の問題を解決できる可能性を高めるために、ドライバーは大きなリソースのバインドを解除する必要があります。

同様に、ドライバーは、すべての分割ポイントで大きなリソースを再度プログラミングする必要があります。 分割ポイントを取得すると、ビデオメモリマネージャーは、以前の割り当てに割り当てられた割り当てを強制的に残します。 これにより、以前にバインドされた割り当て制限に達していない場合に解決された可能性がある複雑なメモリ配置の問題を解決できなくなる可能性があるメモリの断片化が発生します。 スプリットポイントで状態を計算するとき、ビデオメモリマネージャーは、その分割ポイントで再プログラミングされているスロット識別子 (**SlotId**) を特定します (つまり、同じ**splitoffset**値を共有する各パッチの場所のリスト要素は、その他の要素) とは、この分割ポイントの配置制限を無視します。 たとえば、ドライバーで 64 MB のテクスチャが使用されている場合、reprogramming は、すべての分割ポイントでそのテクスチャを使用することによって、必要に応じて、分割ポイント間でそのテクスチャをメモリ内で移動する柔軟性をビデオメモリマネージャーに与えます。

 

 





