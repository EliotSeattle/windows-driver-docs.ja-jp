---
title: キューブ環境マップのサポート
description: キューブ環境マップのサポート
ms.assetid: 41666b17-39b0-4022-925f-538455e41f3a
keywords:
- キューブ環境のマッピング
- WDK Direct3D の環境マッピング
- キューブ環境マップ WDK Direct3D
- 照明 WDK Direct3D
- 反射 WDK Direct3D
- 360度の環境 WDK Direct3D
- WDK Direct3D のリアルタイム環境マッピング
- 円形マップ WDK Direct3D
- 球形マップ WDK Direct3D
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: b7b880f4595f1c06e8bf330660d5f2bf3295fbf0
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72839771"
---
# <a name="cube-environment-map-support"></a>キューブ環境マップのサポート


## <span id="ddk_cube_environment_map_support_gg"></span><span id="DDK_CUBE_ENVIRONMENT_MAP_SUPPORT_GG"></span>


Direct3D で複数のテクスチャをサポートすることで、照明と反射に環境マップを使用できるようになります。 ただし、円形または球のマップのような1つのマップの360程度のソリューションは、リアルタイムで広く使用できるほど堅牢ではありません。 360度の環境のリアルタイムの生成とアドレス指定に最適なソリューションは、6つのテクスチャ (顔) で構成される cubical マップです。 各顔は、適切な方向に90度のビューを使用してカメラをポイントすることによって生成できます。 頂点ごとのベクター (通常、反射、または屈折) は、ラスタライズハードウェアに提供されます。この場合、多角形全体で反復処理を行い、補間ベクトルとキューブマップの面との交差を計算します。 アプリケーションまたは API によってキューブ環境マップが生成された場合、ドライバーは、変換行列に関する情報や、頂点ごとのベクトルが定義されている座標空間に関する情報を必要としません。 これは、ベクターが、論理的には同じ座標空間にある環境マップのアドレス指定にのみ使用されるためです。

循環マップのアドレス指定にはベクター正規化が必要です。球面マップをアドレス指定するには、三角関数を使用する必要があります。 すべての種類の単一マップ環境は非線形であり、円形のマップは周囲近くの異方が非常に歪んでいます。一方、球マップの場合は、その電柱付近に大きなゆがみがあります。 これにより、中央のビュー領域が変形するように視点が変化するたびに、環境マップを再作成する必要があります。

Cubical 環境マップは、6つの異なる方向に90度のビューを持つ実際のカメラまたはシミュレートされたカメラをポイントすることで形成され、これらの欠点はありません。 これらはより高速に生成できますが、頻繁に更新する必要はありません。また、ゆがみが少なくて済みます。また、パースペクティブの正しいテクスチャマッピングに既に使用されているような式を使用して対処できます。

一般に、キューブマップは、複雑な照明や反射のためにリアルタイムの環境マッピングを提供するために最適な選択肢です。

キューブマップは、 [**D3dDrawPrimitives2**](https://docs.microsoft.com/windows-hardware/drivers/ddi/d3dhal/nc-d3dhal-lpd3dhal_drawprimitives2cb) render state 機構を使用してドライバーに渡されます。 [Fvf](fvf--flexible-vertex-format-.md)テクスチャ座標は、そのテクスチャ座標セットの fvf コード01で渡されます。

キューブマップは、ワールド座標で定義されます。つまり、そのワールド変換行列は id 行列です。 テクスチャの変換が対応するテクスチャ座標のインデックスで使用されている場合、キューブマップが別の領域に表示されることがあります。 これらのテクスチャ座標のインデックスは、4、+ z の面で直接見られます。 Y は既定では稼働しています。 (U, v) テクセルグリッドの原点は、各面の左上隅にあります。これは、キューブの中心からカメラをポイントすることによって、追加の変換を行わずに顔を作成できるようにするためです。

**DirectDrawCreateEx**には、キューブマップが作成されることを示すフラグが設定されています。 ドライバーは必要に応じて埋め込まれる場合がありますが、一部の顔は API レベルでは割り当てられません。 Surface 記述子には、アプリケーションが使用することを想定している顔を示す6ビットのビットフィールドが含まれています。 **IDirectDrawSurface7:: GetAttachedSurface**メソッドで顔が達成されると、 **NULL**面はスキップされます。 各面の大きさは、その表面記述子から使用できます。また、face bitcode フィールドには、どの顔があるかが示されます。 **DirectDrawCreateEx**と**IDirectDrawSurface7:: GetAttachedSurface**の詳細については、DirectDraw SDK のドキュメントを参照してください。

**Directdrawcreate**から返されたポインターは、実際にはキューブ内の**NULL**以外の最初の顔へのポインターです。 顔のビットコードを取得することで、顔識別子を取得できます。 これは、 **IDirect3DDevice7:: SetTexture**メソッド (Direct3D SDK ドキュメントで説明されています) に渡されるポインターで、このマップをマルチテクスチャパイプラインで使用できるようにします。

いずれかのサーフェスをにレンダリングする場合は、D3DPTEXTURECAPS\_キューブマップキャップフラグを設定してキューブマップを作成する必要があります。

呼び出しによって作成されていないすべての顔は、表面記述子の**dwEmptyFaceColor**メンバーに指定された色で塗りつぶされていると見なされます。 ( [**DDSURFACEDESC2**](https://docs.microsoft.com/previous-versions/windows/hardware/drivers/ff550340(v=vs.85))構造体を参照してください)。

**注**   現在の制限: すべてのキューブ面は同じサイズである必要があり、正方形である必要があります。 キューブの面は MIP にマップできます。 キューブマップテクスチャでは、カラーキーはサポートされていません。 他のテクスチャと同様に、アルファチャネルとアルファパレットがサポートされています。

 

 

 





