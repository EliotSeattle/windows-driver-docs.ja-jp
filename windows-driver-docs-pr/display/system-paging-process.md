---
title: システム ページング プロセス
description: ほとんどのページング操作は、システムのページングプロセスのコンテキストで発生します。 唯一の例外は、Updat・ Pupuvirtualaddress コールバックからのページテーブルの更新です。これは特殊なコンパニオンコンテキストで発生し、レンダリングの同期を実行します。
ms.assetid: B010C7E5-6B67-43D2-92A6-5258B132FB5D
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 73f65ab98d279e760b50c6d7d60ef02c74746477
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72829338"
---
# <a name="system-paging-process"></a>システム ページング プロセス


ほとんどのページング操作は、システムのページングプロセスのコンテキストで発生します。 唯一の例外は、 [*Updat・ Pupuvirtualaddress コールバック*](https://docs.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_updategpuvirtualaddresscb)からのページテーブルの更新です。これは特殊なコンパニオンコンテキストで発生し、レンダリングの同期を実行します。

Microsoft DirectX グラフィックスカーネルは、システムのページングプロセスを使用して、次のようなページング操作を実行します。

-   システムとローカルのグラフィックス処理装置 (GPU) メモリ間の転送割り当て
-   パターンを使用した割り当ての塗りつぶし
-   ページテーブルの更新
-   割り当てを絞りセグメントにマップする
-   翻訳のルックアサイドバッファーをフラッシュします

ページングプロセスには、独自の GPU 仮想アドレス空間、GPU コンテキスト、およびダイレクトメモリアクセス (DMA) バッファー (ページングバッファーと呼ばれます) があります。 これには、物理メモリに固定され、電源遷移中にのみ削除される独自のページテーブルがあります。

ページングプロセス用の仮想アドレス空間には、事前に定義されたレイアウトがあり、アダプターの初期化中に初期化され、電源遷移によってメモリの内容が失われた後に毎回初期化されます。

![仮想および物理アドレス空間](images/system-paging-process.1.png)

DirectX グラフィックスカーネルは、1 GB の仮想アドレス空間に対応するために、ルートページテーブルに十分なページテーブルとページテーブルエントリを初期化します。 スクラッチ領域は、ページングプロセス仮想アドレス空間への転送操作と入力操作中に一時的なマップ割り当てに使用されます。 割り当てが仮想アドレススクラッチ領域に合わない場合、転送操作はチャンク単位で実行されます。

ページングプロセス用にシステムルートページテーブルの割り当てが作成されます。 そのコンテンツは初期化中に設定され、変更されることはありません (電源遷移後を除く)。

システムプロセスのページテーブルは、次の2つの部分に分かれています。

システムプロセスのアドレス空間に*スクラッチ領域ページテーブル*を反映する*システムページテーブル*が作成されます。 これにより、システムプロセスは、スクラッチ領域のページテーブルを変更し、必要に応じてスクラッチ領域からメモリの割り当て/アンマップを行うことができます。 ページテーブルの内容は、アダプターの初期化中に設定され、変更されることはありません。
*スクラッチ領域ページテーブル*のテーブルエントリは、ページングプロセスの仮想アドレス空間に割り当てをマップするために使用されます。 これらは初期化中に*無効*として初期化され、後でページング操作に使用されます。
ページングプロセスのページテーブルは、アダプターの初期化時および電源オン時のイベント時に、 [*Updatepagetable*](https://docs.microsoft.com/windows-hardware/drivers/display/dxgkddiupdatepagetable)ページング操作によって初期化されます。 これらの操作の場合、 **Pagetableupdatemode**は**cpu\_仮想**に強制的に適用され、cpu を使用してすぐに完了する必要があります (ページングバッファーは使用しないでください)。

他のすべてのプロセスのページテーブルエントリの更新は、ドライバーによって指定された**Pagetableupdatemode**を使用して行われます。 これらの更新は、ページングプロセスのコンテキストで行われます。

セットアップの実行方法を次に示します。

1.  1 GB のアドレス空間に対応するために、ルートページテーブル割り当てと下位レベルのページテーブル割り当てが作成されます。
2.  割り当てはメモリセグメントにコミットされます。
3.  複数の[*Updatepagetable*](https://docs.microsoft.com/windows-hardware/drivers/display/dxgkddiupdatepagetable)ページング操作がドライバーに発行され、ページテーブルエントリが初期化されます。

ページングプロセス仮想アドレス空間の初期化の例として、次のパラメーターを使用する場合を考えてみましょう。

-   ページサイズは4096バイト
-   ページングプロセス仮想アドレス空間は 1 GB です
-   ページテーブルエントリのサイズは4バイトです

この場合、次のように構成された2レベルの翻訳スキームが必要です。

-   1つのシステムルートページテーブル
-   1つのシステムページテーブル
-   255スクラッチ領域ページテーブル

次の図は、ルートページテーブルの場所と物理メモリ内のページテーブルに基づいて、ページテーブルがどのように初期化されるかを示しています。 物理アドレスは、図としてのみ指定されていることに注意してください。
ページテーブルでは、4 MB のアドレス空間がカバーされます。 システムページテーブルには、すべてのスクラッチ領域のページテーブルが含まれています。 スクラッチ領域は、4 MB の仮想アドレスから開始されます。

ご覧のように、仮想アドレスの範囲は 0 ~ 4095 であり、無効になります。

![ページテーブルの初期化](images/system-paging-process.2.png)

 

 





