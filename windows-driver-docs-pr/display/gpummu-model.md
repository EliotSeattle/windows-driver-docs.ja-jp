---
title: GpuMmu モデル
description: GpuMmu モデルの GPU (graphics processing unit) には、プロセスごとの GPU 仮想アドレスを物理アドレスに変換する独自のメモリ管理装置 (MMU) があります。
ms.assetid: FFDFD647-2F00-4AC3-A41A-4224562A51ED
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 7728b81dbf965b0274cdadeeceaaa533411a15cb
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72838925"
---
# <a name="gpummu-model"></a>GpuMmu モデル


*Gpummu*モデルの gpu (graphics processing unit) には、プロセスごとの gpu 仮想アドレスを物理アドレスに変換する独自のメモリ管理装置 (MMU) があります。

各プロセスには、個別のページテーブルを使用する個別の CPU および GPU 仮想アドレス空間があります。 ビデオメモリマネージャーは、すべてのプロセスの GPU 仮想アドレス空間を管理し、割り当て、拡大、更新、常駐とページテーブルの解放を担当します。 GPU MMU によって使用されるページテーブルのハードウェア形式は、ビデオメモリマネージャーでは不明であり、デバイスドライバーインターフェイス (DDIs) によって抽象化されています。 抽象化は、固定サイズのページテーブルおよびサイズ変更可能なルートページテーブルを含む、複数レベルのレベル変換をサポートしています。

ビデオメモリマネージャーは、GPU 仮想アドレス空間とその基になるページテーブルの管理を担当しますが、ビデオメモリマネージャーは、GPU 仮想アドレスを自動的に割り当てに割り当てません。 この責任は、ユーザーモードドライバーに当てはまります。

ビデオメモリマネージャーは、ユーザーモードドライバーに2セットのサービスを提供します。 まず、ユーザーモードドライバーは、既存の[*割り当て*](https://docs.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_allocatecb)コールバックを介してビデオメモリを割り当て、既存の割り当て[*解除*](https://docs.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_deallocatecb)コールバックを介してそのメモリを解放することができます。 現在と同じように、これにより、ユーザーモードドライバーは、GPU エンジンによって操作できるビデオメモリマネージャー割り当てへのハンドルとして返されます。 このような割り当ては、割り当ての物理的な部分のみを表し、エンジンが物理的に操作するために割り当てリストの参照を通じて参照できます。

仮想モードで実行されているエンジンの場合、GPU 仮想アドレスは、実質的にアクセスされる前に割り当てに明示的に割り当てる必要があります。 このため、ビデオメモリマネージャーは、GPU 仮想アドレスを予約または解放し、特定の割り当て範囲をプロセスの GPU 仮想アドレス空間にマップするためのユーザーモードドライバーサービスを提供します。 これらのサービスは非常に柔軟であり、ユーザーモードドライバーはプロセス GPU 仮想アドレス空間を細かく制御できます。 ユーザーモードドライバーは、特定の GPU 仮想アドレスを割り当てに割り当てるか、またはビデオメモリマネージャーが使用可能な仮想アドレスを自動的に選択するように決定することがあります。これは、場合によっては、最小および最大 GPU 仮想アドレスの制約を指定します。 1つの割り当てに複数の GPU 仮想アドレスマッピングが関連付けられていて、*タイルリソースコントラクト*を実装するためにユーザーモードドライバーにサービスが提供されている場合があります。

同様に、リンクされたディスプレイアダプター構成では、ユーザーモードドライバーは、GPU 仮想アドレスを特定の割り当てインスタンスに明示的にマップし、マッピングを自己または特定のピア GPU のどちらにするかにかかわらず、各マッピングを選択します。 このモデルでは、割り当てに割り当てられた CPU と GPU の仮想アドレスは独立しています。 ユーザーモードドライバーでは、両方のアドレス空間で同じものを保持するか、または独立したままにすることができます。

GPU 仮想アドレスは、DDI インターフェイスを介して、4 KB の固定のページ単位で論理的に管理されます。 GPU 仮想アドレスは、メモリセグメントまたはシステムメモリに常駐している割り当てを参照する場合があります。 システムメモリは 4 KB の物理的な粒度で管理されますが、メモリセグメントは、ドライバーの選択時に 4 KB または 64 KB で管理されます。 すべてのビデオメモリマネージャーの割り当ては、ドライバーによって選択されたページサイズの倍数になるように調整されます。

GPU 仮想アドレスの無効な範囲にアクセスすると、アクセス違反が発生し、アクセス違反の原因となったコンテキストやデバイスが終了します。 このような障害から復旧するために、ビデオメモリマネージャーはエンジンリセットを開始します。このリセットは、アダプター全体のタイムアウト検出回復 (TDR) に失敗した場合に昇格されます。

*Gpummu*モデルを次に示します。

![gpummu モデル](images/gpummu-model.1.png)

 

 





