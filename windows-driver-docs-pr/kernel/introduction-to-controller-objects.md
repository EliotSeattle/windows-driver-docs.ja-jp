---
title: コントローラー オブジェクトの概要
description: コントローラー オブジェクトの概要
ms.assetid: a46732a7-1e60-41d5-96e9-d5284c000af1
keywords:
- コントローラーオブジェクト WDK カーネル、コントローラーオブジェクトについて
- コントローラー制御ルーチン、コントローラー制御ルーチンについて
- 重複 i/o WDK カーネル
- I/o WDK カーネル、重複
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 858f839fa49801d1990a76da984205894a4f7f1f
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72838632"
---
# <a name="introduction-to-controller-objects"></a>コントローラー オブジェクトの概要





その名前が示すように、コントローラーオブジェクトは通常、デバイスが接続されている物理デバイスコントローラーを表します。 物理コントローラーによって調整される類似デバイスのセットに対する、非 WDM の下位ドライバーは、コントローラーオブジェクトを作成し、それを使用して接続されたデバイス間の i/o 操作を同期できます。 このドライバーは、コントローラー[*制御*](https://msdn.microsoft.com/library/windows/hardware/ff542049)ルーチンを実装し、i/o マネージャーのコントローラーオブジェクトサポートルーチンを呼び出します。

**注**   コントローラーオブジェクトの使用は、WDM ドライバーではサポートされていません。

 

一般に、次の条件に当てはまる場合、ドライバーはコントローラーオブジェクトを使用して、接続されているデバイスに操作を同期します。

-   コントローラーは、中断することなく長時間の操作を実行しないため、ドライバーはデバイス専用のスレッドを作成したり、システムワーカースレッドを使用したりする必要はありません。

-   コントローラーに接続されているデバイスも似ています。 つまり、これらは、キーボードと補助デバイスコントローラーに接続できるキーボードおよびマウスデバイスなど、まったく異なる物理的なプロパティまたは操作機能を持つデバイスではありません。

-   このドライバーはモノリシックになるように設計されています。デバイスコントローラーと接続されている物理デバイスに関連して、1つまたは複数のクラスドライバー (接続されているデバイスの場合) をポート上に配置するのではなく、1つのポートドライバーとして設計されています。driver.

I/o チャネルがあるデバイスのドライバーと一連の論理デバイスオブジェクトも、コントローラーオブジェクトを使用して、そのようなデバイスのチャネル間で i/o 操作を同期させることができます。

コントローラーオブジェクトには名前がないため、i/o 要求の対象ではありません。 これは、デバイスオブジェクトのセットから i/o をシリアル化する同期機構にすぎません。 コントローラーオブジェクトには名前がないため、ユーザーモードで保護されたサブシステムからは見えません。これにより、ターゲットデバイスオブジェクトを表すファイルオブジェクトのハンドルを取得しなくても、デバイスの i/o 要求を行うことができません。 また、コントローラーオブジェクトは上位レベルのドライバーにも不可視であり、独自のデバイスオブジェクトをコントローラーオブジェクトにアタッチすることはできません。 つまり、i/o マネージャーも上位レベルのドライバーも、コントローラーオブジェクトによって表されるデバイス上の i/o を要求する IRP を設定することはできません。 I/o 要求は、デバイスオブジェクトに対して常に発行されます。 ドライバーのみがコントローラーオブジェクトを使用できます。

### <a name="synchronization-and-overlapped-io"></a>同期と重複 i/o

デバイスの i/o 操作を同期するためにコントローラーオブジェクトを使用する場合、"AT" ディスクコントローラーのような機能を備えた、物理デバイスのモノリシックドライバーは必要ありません。 たとえば、ドライバーライターは、コントローラーオブジェクトを使用する代わりに、次のような同期手法を試すことができます。

-   I/o 要求の対象となるデバイスを表す名前付きデバイスオブジェクトを設定します。

-   現在の i/o 操作の対象となるデバイスオブジェクトを示す状態情報 (たとえば、各デバイス拡張機能または1つのデバイス拡張機能の一連のデバイスビジーフラグ) を保持します。

-   現在のビジー状態のデバイスオブジェクトに対して i/o 操作を実行し、現在の IRP が完了するまで他のデバイスオブジェクトの受信 Irp をキューへします。

上記の同期手法では、すべてのドライバーのターゲットデバイスオブジェクトの IRP 処理をシリアル化します。 また、 [*StartIo*](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-driver_startio)ルーチンが次の irp の処理を開始する前に、ドライバーが現在の irp を完了するように強制することにも注意してください。これにより、ドライバーのパフォーマンスが低下します。

特定のデバイス操作が重複する可能性がある場合、コントローラーオブジェクトを使用すると、ドライバーの i/o スループットが向上する可能性があります。これは、ドライバーが物理デバイスを設定する直前に操作を重複させることができるかどうかをドライバーが判断できるためです。 たとえば、ディスクコントローラーを使用すると、ドライバーが別のディスクでの読み取り/書き込み操作を使用して、1つのディスク上でシークをオーバーラップさせることができます。

さらに、コントローラーオブジェクトを使用すると、1つの物理デバイス ("AT" ディスクコントローラーなど) を介して複数のターゲットデバイスオブジェクトの i/o 操作を簡単に同期することができます。 コントローラーオブジェクトを使用すると、モノリシックドライバーは、一連の名前付きデバイスオブジェクト間で i/o 操作を同期させることができます。その際、1つまたは複数のデバイス拡張機能で、すべてのデバイスとデバイスコントローラーの状態を維持する必要がなく、Irp をキューへする必要もありません。

ただし、完全な二重シリアルコントローラーやバスマスタアダプターなど、i/o 操作と重複するように設計された一部のデバイスには、通常、Irp の内部キューを設定するドライバーがあります。

 

 




