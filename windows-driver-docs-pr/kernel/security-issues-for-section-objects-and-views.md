---
title: セクション オブジェクトとビューに関するセキュリティの問題
description: セクション オブジェクトとビューに関するセキュリティの問題
ms.assetid: a2044ea1-c90c-4487-850b-d07ac55aea6d
keywords:
- メモリのセクションでは WDK カーネル
- セクション オブジェクト WDK カーネル
- ビューの WDK メモリ セクション
- WDK のメモリのセクションのセキュリティ
- プロトコルの WDK メモリ セクション
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 7b2c602a858054e49ce58dd43c79097514465d7d
ms.sourcegitcommit: fb7d95c7a5d47860918cd3602efdd33b69dcf2da
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/25/2019
ms.locfileid: "67373362"
---
# <a name="security-issues-for-section-objects-and-views"></a>セクション オブジェクトとビューに関するセキュリティの問題





セクションとビューを操作するときに、セクションやユーザー モードで共有されない、ビューを作成するドライバーは、次のプロトコルを使用する必要があります。

-   セクション オブジェクトへのハンドルを開くときに、ドライバーはカーネル ハンドルを使用する必要があります。 ドライバーを確認できますカーネル ハンドルのハンドルは、システム プロセスで作成するか、または、OBJ を指定して、\_カーネル\_ハンドルのハンドルの属性。 詳細については、次を参照してください。[オブジェクトは処理](object-handles.md)します。

-   システム スレッドからのみ、ビューをマップする必要があります。 (それ以外の場合、ビューは、プロセス内に作成されますがコンテキストからアクセスできます) です。ドライバーでは、マッピング操作を実行するシステム ワーカー スレッドを使用して、システムのプロセスからビューがマップされていることを確認します。 詳細については、次を参照してください。[システム ワーカー スレッド](system-worker-threads.md)と[ドライバー スレッド コンテキスト](driver-thread-context.md)します。

セクションとビューを操作するときに、ユーザー モード プロセスを使用して、ビューを共有するドライバーは、次のプロトコルを使用する必要があります。

-   ドライバーでは、ユーザー モード プロセスではなくは、セクション オブジェクトを作成し、ビューをマップする必要があります。

-   前述のように、ドライバーは、セクション オブジェクトへのハンドルを開くときにカーネル ハンドルを使用する必要があります。 ドライバーを確認できますカーネル ハンドルのハンドルは、システム プロセスで作成するか、または、OBJ を指定して、\_カーネル\_ハンドルのハンドルの属性。 詳細については、次を参照してください。[オブジェクトは処理](object-handles.md)します。

-   ビューを共有するプロセスのスレッド コンテキストで、ビューがマップされます。 ディスパッチ ルーチンで、マッピング処理を実行することによって、現在のプロセスのコンテキストで、ビューがマップされている最上位レベルのドライバーを保証できるこのような[ *DispatchDeviceControl*](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/wdm/nc-wdm-driver_dispatch)します。 下位レベルのドライバーのディスパッチ ルーチンは、任意のスレッド コンテキストで実行し、したがってディスパッチ ルーチン内のビューがマップに安全にことはできません。 詳細については、次を参照してください。[ドライバー スレッド コンテキスト](driver-thread-context.md)します。

-   ドライバー内のビューへのすべてのメモリ アクセスを保護する必要があります**お試しください**-**を除く**ブロックします。 悪意のあるユーザー モード アプリケーション ビューをマップ解除したり、ビューの保護状態を変更します。 いずれかがクラッシュが発生するシステムによって保護されている場合を除き、**お試しください**-**を除く**ブロックします。 詳細については、次を参照してください。[例外処理](handling-exceptions.md)します。

ドライバーは、必要に応じて、ビューの内容を検証もする必要があります。 ドライバーの作成者は、信頼されたユーザー モード コンポーネントのみが、ビューにアクセスできるように限りません。

ドライバーを (独自のビューを作成できる必要があります) をユーザー モード アプリケーションとセクション オブジェクトを共有する必要がありますのでは、次のプロトコルを使用する必要があります。

-   ユーザー モード プロセスではなく、ドライバーは、セクション オブジェクトを作成する必要があります。 ドライバーでは、ユーザー モードから渡されたハンドルは使用しないでください必要があります。

-   ユーザー モードにハンドルを渡す前に、ドライバーを呼び出す必要があります[ **ObReferenceObjectByHandle** ](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/wdm/nf-wdm-obreferenceobjectbyhandle)セクション オブジェクトへの参照を取得します。 こうと、悪意のあるアプリケーションからのハンドルを閉じることで、セクション オブジェクトを削除します。 ドライバーのデバイスの拡張機能には、オブジェクト参照を格納する必要があります。

-   呼び出す必要がありますが、ドライバーがセクション オブジェクトを使用して不要になった後[ **ObDereferenceObject** ](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/wdm/nf-wdm-obdereferenceobject)オブジェクト参照を解放します。

Service Pack 1 (SP1) 以降のバージョンと Microsoft Windows Server 2003 を実行するシステムで、カーネル モード ドライバーのみが開くことができます\\**デバイス**\\**PhysicalMemory**します。 ただし、ユーザーのアプリケーションへのハンドルを付与するドライバーを決定できます。 セキュリティの問題を防ぐためには、ドライバーの信頼関係を指定する必要がありますユーザー アプリケーションのみにアクセスする\\**デバイス**\\**PhysicalMemory**します。

 

 




