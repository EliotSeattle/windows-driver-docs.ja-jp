---
title: セクション オブジェクトとビューに関するセキュリティの問題
description: セクション オブジェクトとビューに関するセキュリティの問題
ms.assetid: a2044ea1-c90c-4487-850b-d07ac55aea6d
keywords:
- メモリセクション WDK カーネル
- セクションオブジェクト WDK カーネル
- ビュー WDK メモリセクション
- security WDK memory セクション
- プロトコル WDK メモリセクション
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 7cf8e145bd97bf94c452d602bcbcdc669f2c3660
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72838441"
---
# <a name="security-issues-for-section-objects-and-views"></a>セクション オブジェクトとビューに関するセキュリティの問題





ユーザーモードと共有しないセクションやビューを作成するドライバーは、セクションとビューを操作するときに次のプロトコルを使用する必要があります。

-   ドライバーは、セクションオブジェクトへのハンドルを開くときに、カーネルハンドルを使用する必要があります。 ドライバーでは、ハンドルがカーネルハンドルであることを確認できます。そのためには、システムプロセスでそのハンドルを作成するか、OBJ\_KERNEL\_handle 属性を指定します。 詳細については、「[オブジェクトハンドル](object-handles.md)」を参照してください。

-   ビューは、システムスレッドからのみマップする必要があります。 (それ以外の場合、ビューには、そのコンテキストが作成されたプロセスからアクセスできます)。ドライバーは、システムワーカースレッドを使用してマッピング操作を実行することで、ビューがシステムプロセスからマップされていることを確認できます。 詳細については、「[システムワーカースレッド](system-worker-threads.md)と[ドライバースレッドコンテキスト](driver-thread-context.md)」を参照してください。

ユーザーモードのプロセスでビューを共有するドライバーは、セクションとビューを操作するときに、次のプロトコルを使用する必要があります。

-   ユーザーモードプロセスではなくドライバーがセクションオブジェクトを作成し、ビューをマップする必要があります。

-   前述のように、ドライバーは、セクションオブジェクトへのハンドルを開くときにカーネルハンドルを使用する必要があります。 ドライバーでは、ハンドルがカーネルハンドルであることを確認できます。そのためには、システムプロセスでそのハンドルを作成するか、OBJ\_KERNEL\_handle 属性を指定します。 詳細については、「[オブジェクトハンドル](object-handles.md)」を参照してください。

-   ビューは、ビューを共有するプロセスのスレッドコンテキストでマップされます。 最上位レベルのドライバーでは、 [*DispatchDeviceControl*](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-driver_dispatch)のようなディスパッチルーチンでマッピング操作を実行することで、現在のプロセスコンテキストでビューがマップされることを保証できます。 下位レベルのドライバーのディスパッチルーチンは任意のスレッドコンテキストで実行されるため、ディスパッチルーチンでビューを安全にマップすることはできません。 詳細については、「[ドライバースレッドコンテキスト](driver-thread-context.md)」を参照してください。

-   ドライバー内のビューへのすべてのメモリアクセスは、 **try**-**以外**のブロックで保護されている必要があります。 悪意のあるユーザーモードアプリケーションによって、ビューのマッピングが解除されたり、ビューの保護状態が変更されたりする可能性があります。 Try-によって保護されている場合を**除い** **て**、block を除き、システムのクラッシュが発生します。 詳細については、「[例外の処理](handling-exceptions.md)」を参照してください。

また、必要に応じて、ドライバーがビューの内容を検証する必要があります。 ドライバーライターは、信頼されたユーザーモードコンポーネントだけがビューにアクセスできると想定することはできません。

(独自のビューを作成できる必要がある) ユーザーモードアプリケーションとセクションオブジェクトを共有する必要があるドライバーは、次のプロトコルを使用する必要があります。

-   ユーザーモードプロセスではなく、ドライバーが section オブジェクトを作成する必要があります。 ドライバーは、ユーザーモードから渡されたハンドルを使用することはできません。

-   ハンドルをユーザーモードに渡す前に、ドライバーは[**Obreferenceobjectbyhandle**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-obreferenceobjectbyhandle)を呼び出して section オブジェクトへの参照を取得する必要があります。 これにより、悪意のあるアプリケーションがハンドルを閉じてセクションオブジェクトを削除するのを防ぐことができます。 オブジェクト参照は、ドライバーのデバイス拡張機能に格納されている必要があります。

-   ドライバーが section オブジェクトを使用しなくなった後は、 [**ObDereferenceObject**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-obdereferenceobject)を呼び出してオブジェクト参照を解放する必要があります。

Microsoft Windows Server 2003 Service Pack 1 (SP1) 以降のバージョンを実行しているシステムでは、カーネルモードのドライバーだけが \\**デバイス**\\**physicalmemory**を開くことができます。 ただし、ドライバーはユーザーアプリケーションにハンドルを与えることができます。 セキュリティの問題を回避するには、ドライバーで信頼されているユーザーアプリケーションのみが \\**デバイス**\\**physicalmemory**にアクセスできるようにする必要があります。

 

 




