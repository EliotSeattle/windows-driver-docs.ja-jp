---
title: ウェイクなしタイマー
description: Windows 8.1 以降では、ドライバーは非スリープタイマーを使用して、プロセッサが低電力状態から不必要にウェイクアップされるのを防ぐことができます。
ms.assetid: 04CD107B-F196-4FF8-A423-C43CAA9A7EBD
keywords:
- No wake タイマー
- Exxxx タイマールーチン
- EX_TIMER_NO_WAKE
- EX_TIMER_UNLIMITED_TOLERANCE
- ウォッチャータイマー
- タイマー合体
- KeSetCoalescableTimer
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: d1e1b35ef1f3303e81cf6c5c2feb909d440216a3
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72827810"
---
# <a name="no-wake-timers"></a>ウェイクなしタイマー


Windows 8.1 以降では、ドライバーは非スリープタイマーを使用して、プロセッサが低電力状態から不必要にウェイクアップされるのを防ぐことができます。 プロセッサを低電力の状態に保つことで、ウェイクアップなしのタイマーによって電力消費が軽減され、タブレットやその他のモバイルコンピューターをバッテリ充電で実行できる時間が長くなります。

タイマーは、プロセッサがアクティブな状態にある場合にのみ有効期限が切れます。 プロセッサが低電力状態のときにタイマーが有効期限に達した場合、タイマーがすぐに期限切れになるようにするには、タイマーがプロセッサをウェイクアップする必要があります。 ただし、非ウェイクタイマーが有効期限に達すると、プロセッサが低電力状態になると、タイマー以外の何らかの理由でプロセッサがスリープ解除されるまで、このタイマーは期限切れになります。 オプションとして、ドライバーは、スリープ解除タイマーの最大遅延許容値を指定することができます。これにより、タイマーの有効期限が切れた後、プロセッサが遅延の最大許容範囲内でスリープ解除されない場合 (他の理由で)、プロセッサがウェイクアップされます。

ドライバーは、非ウェイクタイマーを使用して、プロセッサがアクティブな状態のときにのみ実行する必要がある、重要でない操作を開始できます。 たとえば、ドライバーは、非ウェイクタイマーを使用して、累積状態情報をメモリバッファーからファイルに定期的にフラッシュする場合があります。 このステータス情報は、プロセッサがアクティブである場合にのみドライバーが実行する処理作業について説明します。 プロセッサが低電力状態のときは、状態情報は生成されず、プロセッサをウェイクアップする必要もありません。

非ウェイクタイマーを作成するには、WDM ドライバーが[**Exallocatetimer**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-exallocatetimer)ルーチンを呼び出します。 この呼び出しでは、ドライバーは EX\_タイマー\_*Attributes*パラメーターに\_WAKE フラグビットを設定しません。

期限切れのタイマーが期限切れになるように設定するには、ドライバーは[**ExSetTimer**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-exsettimer)ルーチンを呼び出します。 この呼び出しでは、ドライバーは、タイマーがプロセッサをウェイクアップする前に、有効期限が切れたときにウェイクアップタイマーが待機する時間を指定できます。 ドライバーは、ドライバーが**ExSetTimer**ルーチンに入力パラメーターとして渡す[**パラメーター構造を EXT\_SET**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/ns-wdm-_ext_set_parameters_v0)の**NoWakeTolerance**メンバーに\_設定します。 ドライバーが**NoWakeTolerance**メンバーを特殊な値\_タイマー\_無制限\_トレランスに設定した場合、タイマーはプロセッサをスリープ解除しないため、その他の理由でプロセッサがスリープ解除されるまで有効期限が切れません。

カーネルモードドライバーフレームワーク (KMDF) ドライバーまたはユーザーモードドライバーフレームワーク (UMDF) ドライバーは、 [**Wdftimercreate**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdftimer/nf-wdftimer-wdftimercreate)メソッドを呼び出して、ウェイクアップタイマーを作成しないようにします。 この呼び出しでは、ドライバーは[**WDF\_TIMER\_CONFIG**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdftimer/ns-wdftimer-_wdf_timer_config)構造体へのポインターをパラメーターとして渡します。 プロセッサをウェイクアップしないウェイクアップタイマーを作成するために、ドライバーは、この構造体の**TolerableDelay**メンバーを**TolerableDelayUnlimited**定数に設定します。 この定数は Windows 8.1 と KMDF バージョン1.13 または UMDF 2.0 以降でサポートされています。

## <a name="comparison-to-coalescable-timers"></a>ウォッチャータイマーとの比較


[**KeSetCoalescableTimer**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-kesetcoalescabletimer)ルーチンは、Windows 7 で導入されました。 このルーチンにより、ドライバーはタイマーの有効期限に許容される許容量を指定できます。 多くの場合、オペレーティングシステムはこの情報を使用して、2つ以上のタイマー割り込みを1つの割り込みに結合できます。 複数のタイマーの有効期限が、許容範囲内のウィンドウと重複しないように近い場合は、重複領域の1つのタイマー割り込みが、これらすべてのタイマーのタイミング要件を満たすことができます。

タイマー合体の最高の利点は、タイマーの有効期限が切れたときにプロセッサが低電力の状態を維持できる時間を延長できることです。 そのため、ドライバーは、同様の目的で、タイマー合体とウェイクアップなしのタイマーを使用します。

ただし、coalesceable タイマーはスリープ解除タイマーとは動作が異なります。 特に、非ウェイクタイマーに指定された許容遅延は、プロセッサが低電力状態のときにのみ適用されます。一方、ウォッチャータイマーの有効期限に指定された許容範囲は、プロセッサが低電力状態であるかどうかに関係なく適用されます。 ウォッチャータイマーの場合、ドライバーは有効期限の許容範囲を増やして、タイマーがプロセッサをウェイクアップする確率を減らしますが、許容範囲を増やすことで、プロセッサが使用されている場合のタイマーの精度が低下します。能動的. これに対して、非ウェイクアップタイマーに指定された許容遅延は、プロセッサがアクティブな場合のタイマーの精度には影響しません。 多くのドライバーでは、電力消費を削減するために wake タイマーを使用しない方がよい場合があります。

 

 




