---
title: カスタムの WMI のブロックを実装します。
description: カスタムの WMI のブロックを実装します。
ms.assetid: c596924f-9f82-4ca7-b0f0-afc596d7bf99
keywords:
- WMI の WDK カーネルでは、イベント ブロック
- イベントは、WDK の WMI をブロックします。
- WDK の WMI のデータ ブロックします。
- WMI の WDK カーネルでは、データのブロック
- WDK の WMI をブロックします。
- カスタム ブロック WDK WMI
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 808fe8aeb00c8b711885285ee2f7c1b3f021ae78
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56535463"
---
# <a name="implementing-custom-wmi-blocks"></a>カスタムの WMI のブロックを実装します。





ドライバーを実装できます*カスタム ブロック*デバイスに固有のインストルメンテーションを公開します。 たとえば、温度を報告するディスク ドライブ用のドライバーでは、ドライブの温度が安全なしきい値を超えたときに WMI クライアントに通知するカスタム イベント ブロックを実装します。

カスタムのブロック、ドライバーを実装するには。

-   MOF ファイルにクラスを定義、MOF ファイルのリソースにコンパイルされますおよび」の説明に従って、ドライバーでリソースを含む[WMI スキーマを公開](publishing-a-wmi-schema.md)します。

-   」の説明に従って、他のドライバーでサポートされている任意の標準とカスタム要素と共に WMI でブロックを登録[WMI データ プロバイダーとして登録する](registering-as-a-wmi-data-provider.md)します。

-   ドライバーのデバイス オブジェクトのポインターを指定するすべての WMI 要求を処理**Parameters.WMI.ProviderId**とでは、標準的なブロックの GUID **Parameters.WMI.DataPath** 」の説明に従って、[WMI 要求を処理して](handling-wmi-requests.md)します。

ドライバーは、バイナリの MOF ファイルが読み込まれる順序を制御できません。 唯一の保証では、ドライバー固有のすべての MOF ファイルの前にその wmicore.mof が読み込まれるです。 そのため、カスタムの WMI クラスは wmicore.mof または同じの MOF ファイルのいずれかのクラスからのみ継承する必要があります。

パフォーマンスとカスタムの WMI データ ブロックの使いやすさを向上させるのには、次のガイドラインを考慮してください。

-   同じデータ ブロックに物理的にグループ化されたデータ項目をまとめました。

    たとえば、i8042 ポートのコント ローラーは、キーボードとマウスの両方のポートに関する状態情報を保持する場合もあります。 はなくマウスとキーボードのすべての情報を含む 1 つの大きなデータ ブロック、ドライバーは、マウス ポートのブロックを 1 つのデータとキーボードのポートの別のデータ ブロックを定義可能性があります。

-   Put は、使用頻度の低い項目を含むグループ化するそれ以外の場合は場合は特に、個別のデータ ブロック内のデータ項目を頻繁に使用します。

    など、ドライバーは、WMI クライアントは、ブロック内の他のデータ項目を取得するオーバーヘッドを発生させずに CPU 使用率を追跡する可能性がありますので、項目が 1 つのデータ ブロック内の CPU 使用率を公開可能性があります。 WMI クライアントは、1 つの項目を取得するデータ ブロックのインスタンス全体に対してクエリする必要がありますので、1 つのデータ項目を照会できません。

-   エラーのログ記録の代替としてではなく、例外的なイベントの WMI クライアントに通知するのにには、イベント ブロックを使用します。

    イベントが失われる場合は、キューがいっぱいと同時に、キューにことができますのみイベント数に制限されています。 また、WMI クライアントへのイベントの配信のタイミングは保証できません。

-   イベント ブロックを 1 KB のサイズの最大サイズを制限します。

    全体のレジストリで定義されているサイズの上限 (最初に、1 K) があるため、小さなデータ型として定義するイベント項目[**れた WNODE\_イベント\_項目**](https://msdn.microsoft.com/library/windows/hardware/ff566373)構造体生成されたイベントが含まれています。 ドライバーが大量の通知を送信する、 [**れた WNODE\_イベント\_参照**](https://msdn.microsoft.com/library/windows/hardware/ff566374)構造体を取得する WMI を照会し、データ ブロックの 1 つのインスタンスを指定する、実際のイベント。 ただし、これは、イベントの発生と、通知の間のタイム ラグを増加します。

-   可変サイズのデータ項目の後に、データ ブロックの先頭には、固定サイズのデータ項目を配置します。

    たとえば、データ ブロックを持つ 3 つの DWORD データ項目とそのいずれかの可変長文字列入れる 3 つの Dword 最初に、後に文字列。 ブロックの先頭に固定サイズのデータ項目を配置することをより簡単に抽出する WMI クライアントを許可します。

-   ドライバーのデータ ブロックにアクセスするには、システムのユーザーの種類を検討してください。 システムでは、WMI クラスの Guid をすべての既定のセキュリティ記述子を提供します。 必要に応じて、デバイスの INF ファイル内の代替のセキュリティ記述子を行うことができます。 詳細については、[セキュリティで保護されたデバイスのインストールを作成する](https://msdn.microsoft.com/library/windows/hardware/ff540212)を参照してください。

WMI は、バージョン管理をサポートしていないため、ドライバーのライターが新しい MOF クラスを定義し、既存のカスタム ブロックの変更には、新しい GUID を生成する必要があります。

 

 




