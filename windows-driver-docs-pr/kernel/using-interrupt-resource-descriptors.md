---
title: 割り込みリソース記述子の使用
description: 割り込みリソース記述子の使用
ms.assetid: 0e9aa9a1-c1aa-42e1-9c0b-a91a2424ad1a
ms.localizationpriority: medium
ms.date: 10/17/2018
ms.openlocfilehash: a891b60dd85aedf83f19577a226e30d929ffbc7b
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72835992"
---
# <a name="using-interrupt-resource-descriptors"></a>割り込みリソース記述子の使用


プラグアンドプレイ (PnP) マネージャーは、2つのパスを使用して、デバイスに割り込みメッセージを割り当てます。 まず、PnP マネージャーは、デバイスに割り当てようとしているハードウェアリソース (割り込みメッセージを含む) の一覧を使用して、 [ **\_リソース\_要件要求\_フィルター処理**](https://docs.microsoft.com/windows-hardware/drivers/kernel/irp-mn-filter-resource-requirements)して、IRP\_を、ドライバーに送信します。 ドライバーはこの一覧を変更して、割り込みメッセージの数やメッセージごとの設定を変更できます。 これにより、PnP マネージャーがリソースを実際に割り当てると、IRP\_が送信され、 [ **\_デバイス要求\_開始**](https://docs.microsoft.com/windows-hardware/drivers/kernel/irp-mn-start-device)され、ドライバーのデバイスに割り当てられた割り込みメッセージを含むハードウェアリソースの完全な一覧が提供されます。

**IRP\_\_フィルター\_リソース\_要件**の要求は、 [**IO\_リソース\_記述子**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/ns-wdm-_io_resource_descriptor)の構造の一覧を提供します。 PCI 2.2 仕様で定義されている MSI (メッセージシグナル割り込み) 機能構造をデバイスが持っている場合、PnP マネージャーは1つの割り込みメッセージ記述子を提供します。 PCI 3.0 仕様で定義されているように、デバイスに MSI-X の機能構造がある場合、PnP マネージャーは割り込みメッセージごとに1つの構造を提供します。 割り込みメッセージ記述子には = **Cmresourcetypeinterrupt**と**Flags** = CM\_リソース\_割り込み\_ラッチされた**型**があります。CM\_リソース\_割り込み\_メッセージ。 ドライバーは、構造体の " **u. interrupt** " メンバーを変更することによって、割り込み関係などの設定を変更することもできます。 MSI を使用する場合、すべての割り込みは同じアフィニティを持ちますが、MSI-X を使用すると、異なるアフィニティを持つことができます。 詳細については、「[割り込みアフィニティと優先順位](interrupt-affinity-and-priority.md)」を参照してください。

MSI の場合、PCI 2.2 で定義されているように **、 - 。** . **interrupt** vector + 1 は、デバイスに割り当てられている割り込みメッセージの数を示します。 ドライバーは、interrupt. **MinimumVector**を変更することで、割り込みメッセージの数を変更できます。 MSI 割り込みメッセージの場合 **、\_** は常に CM\_リソース\_割り込み\_メッセージトークンになります。 *Messagecount*の割り込みメッセージを割り当てるには、\_メッセージ\_トークン- *messagecount* + 1 を\_と等しい CM\_リソース**に設定します。**

PCI 3.0 で定義されているように、MSI-X では、ドライバーは、一覧のエントリを追加または削除することによって割り当てられる割り込みメッセージの数を変更できます。 この方法で追加された割り込みメッセージのリソースは、 [**IRP\_が\_\_デバイス**](https://docs.microsoft.com/windows-hardware/drivers/kernel/irp-mn-start-device)の要求を開始した場合には削除されないことに注意してください。 MSI-X の場合、PnP マネージャーはメッセージ割り込みごとに1つの記述子を提供し、この記述子の w.x.y.z および w.x.y.z**ベクターメンバーは** **両方とも**CM\_リソース\_割り込みに設定され\_メッセージ\_トークンです。

プラグアンドプレイマネージャーによってデバイスのすべてのハードウェアリソース (割り込みメッセージを含む) が割り当てられると、 **IRP\_\_\_デバイス**要求をドライバーに送信します。 この要求には、[**リソース\_記述子構造の一部\_\_CM**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/ns-wdm-_cm_partial_resource_descriptor)の2つのリストが用意されています。これらはそれぞれ、生のリソースと変換されたリソース用です。 割り込みメッセージの場合、PnP マネージャーは、割り当てられたメモリアドレスごとに1つの構造**体を提供 = ** **Cmresourcetypeinterrupt**と**Flags** = CM\_リソース\_割り込み\_ラッチされます。CM\_リソース\_割り込み\_メッセージ。

MSI を使用する場合、ドライバーは、すべてのメッセージが同じアドレスを共有するため、1つの割り込みリソース記述子だけを受信します。 割り当てられたメッセージの数を判断する**には、** の**messagecount**のメンバーを使用できます。 MSI-X を使用すると、ドライバーは各割り込みメッセージに対して個別のリソース記述子を受け取ります。

Windows 8 では、オペレーティングシステムは、デバイスごとの割り込みメッセージ数が2048を超えるリソース要求をサポートしていません。 Windows 7 と Windows Vista では、オペレーティングシステムは、デバイスごとの割り込みメッセージ数が910を超えるリソース要求をサポートしていません。 デバイスドライバーがこの制限を超えると、デバイスの起動に失敗する可能性があります。 多数の論理プロセッサが含まれているコンピューターでドライバーが動作できるようにするには、ドライバーがプロセッサごとに複数の割り込みを要求しないようにする必要があります。

割り込みリソースのシステム再バランシング中に、PnP マネージャーは、リソース要件の一覧から代替割り込みリソースの優先セットを選択するようにドライバーに要求する場合があります。 ただし、PnP マネージャーは、ドライバーが推奨するリソースを常にドライバーに割り当てることはできません。 このため、ドライバーは、リソース要件リストからの代替割り込みリソースセットの割り当てを失敗として許容する必要があります。 たとえば、デバイスには、要求されたドライバーよりも少ない数のメッセージ割り込みが割り当てられる場合があります。 最悪の場合、ドライバーは、1行ベースの割り込みだけでデバイスを操作できるように準備する必要があります。

 

 




