---
title: コンポーネント レベルの電源管理
description: Windows 8 以降では、電源管理フレームワーク (PoFx) によって、デバイス内の個々のコンポーネントの電源状態をドライバーで管理できるようになります。 コンポーネントレベルの電源管理は、デバイスレベルの電源管理と並行して存在します。
ms.assetid: 77866143-FB10-4623-9923-368B23808715
ms.localizationpriority: medium
ms.date: 10/17/2018
ms.openlocfilehash: b4912cc47399751fa3d0e9a4a330baefd65dc018
ms.sourcegitcommit: d5f54510b9500413dd3084b59cb8869f2f6b13cf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/09/2019
ms.locfileid: "68866772"
---
# <a name="component-level-power-management"></a>コンポーネント レベルの電源管理


Windows 8 以降では、電源管理フレームワーク (PoFx) によって、デバイス内の個々のコンポーネントの電源状態をドライバーで管理できるようになります。 コンポーネントレベルの電源管理は、デバイスレベルの電源管理と並行して存在します。

## <a name="overview-of-component-level-power-management"></a>コンポーネントレベルの電源管理の概要


Windows 7 以前のバージョンのオペレーティングシステムでは、デバイスレベルの電源管理がサポートされています。これにより、ドライバーはデバイスの D 状態をサポートできるようになります。 Advanced Configuration and Power Interface (ACPI) 仕様では、[デバイスの電源](device-power-states.md)状態 (完全に点灯) から D3 (完全にオフ) までを定義し、システムの[電源状態](system-power-states.md)S0 (完全にオフ) を定義します。 これらのバージョンの Windows には、デバイス内の個々のコンポーネントに対して提供される電力を個別に管理するメカニズムが用意されていません。 これらのバージョンの Windows では、一部のドライバーはコンポーネント用のカスタム電源コントロールを実装できますが、これらのコントロールは通常、ドライバーの複雑さを追加します。デバイス内でコンポーネントの電源設定が制御されている場合にのみ実行可能です。

Windows 8 以降では、PoFx によってコンポーネントレベルの電源管理のサポートが追加されます。 これにより、ドライバーがいくつかのコンポーネントの電源状態 (F0、F1 など) をサポートできるようになります。この場合、F0 は完全な状態です。 すべてのコンポーネントが F0 状態をサポートします。 デバイスのコンポーネントの電源ポリシー所有者 (PPO) であるドライバーは、コンポーネントが持つ可能性のある追加の低電力の Fx 電源の状態を定義する役割を担います。 (通常、デバイスの関数ドライバーは PPO です)。このドライバーは、コンポーネントごとの低電力の Fx 状態の数と各 Fx 状態の属性を決定します。 このドライバーが定義する Fx の状態は、コンポーネントによって同じデバイス内のコンポーネントによって異なる場合があります。

PoFx はデバイスドライバーインターフェイス (DDI) を提供します。これにより、ドライバーはデバイスのコンポーネントに関する状態と機能の情報を提供できます。 この情報には、各コンポーネントの現在の利用状況、コンポーネントがある電源状態から別の状態に変更するために必要な時間、およびコンポーネントが低電力状態から復帰したときにデバイスのクライアントが許容できる待機時間の量が含まれます. さらに、PoFx は、コンポーネントが属する電源とクロックのドメインに関するシステム全体の情報を取得します。 (特定の電源ドメイン内のデバイスは、共通の電源レールを共有します。特定のクロックドメイン内のデバイスは、一般的なクロック信号を共有します)。

PoFx は、この情報に基づいて、コンポーネントが低電力状態になるタイミングと入力する低電力状態について、インテリジェントな意思決定を行います。 この判断プロセスでは、他のコンポーネントや他のデバイスからの情報が含まれており、さまざまな電源および時計ドメインのデバイスとコンポーネントの間の依存関係が考慮されます。

## <a name="introduction-to-the-pofx-api-for-component-level-power-management"></a>コンポーネントレベルの電源管理用の PoFx API の概要


PoFx によって管理されるようにデバイスを登録するために、ドライバーは[**Pofxregisterdevice**](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/wdm/nf-wdm-pofxregisterdevice)ルーチンを呼び出します。 ドライバーは、このルーチンを、他のデータと共に[ **\_po fx\_コンポーネント**](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/wdm/ns-wdm-_po_fx_component_v1)構造体の配列を含む[ **\_po fx\_デバイス**](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/wdm/ns-wdm-_po_fx_device_v1)構造体に渡します。 この配列の各要素は、デバイス内のコンポーネントの Fx 電源状態と各 Fx 状態の属性を表します。 (少なくとも、コンポーネントレベルの電源管理をサポートしていないコンポーネントは、F0 状態のみを実装します)。特定のコンポーネントの特定の Fx 電源状態の属性は、次の値[**を\_含む PO\_Fx\_\_コンポーネントのアイドル状態**](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/wdm/ns-wdm-_po_fx_component_idle_state)構造によって記述されます。

-   遷移待機時間。これは、この Fx 状態から F0 (完全にオン) 状態への遷移を行うために必要な時間です。
-   常駐の要件。これは、コンポーネントがこの Fx 状態を使用して、状態への遷移を行う必要がある時間です。
-   公称電力。これは、この Fx 状態のコンポーネントによって消費される電力です。

PoFx は、この情報 (他のシステム全体の入力と依存関係に加えて) を使用して、特定の時点でのコンポーネントのどの Fx 電源状態についてのインテリジェントな決定を行います。 PoFx は、2つの競合した目標のバランスを取る必要があります。 まず、アイドル状態のコンポーネントは、できるだけ少ない電力を使用するように構成する必要があります。 2つ目の方法として、常にオンで常時接続されているデバイスの外観を維持するために、低電力の Fx 状態から F0 に迅速に切り替えるようにコンポーネントを準備する必要があります。

コンポーネントレベルの電源管理を実行できるのは、デバイスが D0 (完全電源) 状態のときだけです。 デバイスが D1 (ほぼオン)、D2 (ほぼオフ)、または D3 の電源状態にある場合、デバイスにアクセスすることはできません。 デバイスが D0 状態にある場合、ドライバーがアクティブに使用しているコンポーネントのみが、F0 状態のままである必要があります。 アイドル状態のコンポーネントは、電力消費を減らすために、低電力の Fx 状態に切り替える可能性があります。

デバイスが D0 の電源状態にある間、ドライバーはシンプルなプロトコルに従ってコンポーネントレベルの電源管理を有効にします。 ドライバーがコンポーネントにアクセスする必要がある場合、ドライバーは[**PoFxActivateComponent**](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/wdm/nf-wdm-pofxactivatecomponent)ルーチンを呼び出して、コンポーネントへのアクセスを要求します。 この呼び出しが行われたときにコンポーネントが低電力の Fx 状態にある場合、PoFx は F0 状態への遷移を開始し、この移行が完了するとドライバーに通知します。 その後、ドライバーはコンポーネントにアクセスできます。 ドライバーがコンポーネントにアクセスする必要がなくなった場合、ドライバーは[**PoFxIdleComponent**](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/wdm/nf-wdm-pofxidlecomponent)ルーチンを呼び出して pofx に通知します。 この呼び出しに応答して、PoFx はコンポーネントを低電力の Fx 状態に切り替える可能性があります。

アクセス可能なコンポーネントが*アクティブ条件*に含まれています。 アクセスできないコンポーネントは、*アイドル状態*にあります。 デバイス内のコンポーネントのアクセシビリティを追跡するために、PoFx は各コンポーネントにアクティベーション参照カウントを保持します。 **PoFxActivateComponent**呼び出しは、指定されたコンポーネントのカウントを1だけインクリメントし、 **PoFxIdleComponent**呼び出しはカウントを1だけデクリメントします。

**PoFxActivateComponent**呼び出しによってカウントが0から1にインクリメントされた場合、pofx はアイドル状態からアクティブな状態への遷移を開始し、この遷移が完了するとドライバーに通知します。 コンポーネントが既にアクティブな状態にあるときに**PoFxActivateComponent**が発生した場合、コンポーネントはアクティブ状態のままになり、ドライバーは通知を受信しません。

**PoFxIdleComponent**呼び出しによってカウントが1から0にデクリメントされると、pofx は、アクティブな状態からアイドル状態への遷移を開始し、この移行が完了するとドライバーに通知します。 **PoFxIdleComponent**呼び出しによってカウントがデクリメントされるが、カウントが0以外のままである場合、コンポーネントはアクティブ状態のままになり、ドライバーは通知を受信しません。

アクティブ化参照カウントは、同じドライバー内の2つ以上のコードパスが、デバイス内の同じコンポーネントに同時にアクセスする必要がある状況を容易に処理します。 この数を維持することにより、ドライバーのさまざまな部分が、コンポーネントへのアクセスを一元的に管理することなく、コンポーネントへのアクセスを個別に維持することができます。

コンポーネントのアクティブ/アイドル状態は、コンポーネントがアクセス可能かどうかをドライバーが確認する唯一の信頼できる手段です。 F0 電源状態にあるがアイドル状態のコンポーネントは、低電力の Fx 状態に切り替えようとしている可能性があります。

アクティブ条件に含まれるコンポーネントは、常に F0 状態です。 コンポーネントは、アイドル状態になるまで、F0 を離れることができません。 アイドル状態のコンポーネントは、F0 または低電力の Fx 状態である可能性があります。 **PoFxActivateComponent**呼び出しによってアイドル状態からアクティブ条件への遷移が開始されるときに、コンポーネントが低電力の Fx 状態になっている場合、pofx は最初にコンポーネントを F0 に切り替えてから、コンポーネントがアクティブ条件に入るようにする必要があります。

## <a name="related-topics"></a>関連トピック

[デバイスの電源管理のリファレンス](device-power-management-reference.md)  
