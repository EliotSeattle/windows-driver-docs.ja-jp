---
title: 常に割り込み可能で常に中断可能
description: 常に割り込み可能で常に中断可能
ms.assetid: 3da667b4-50f3-4536-9049-65719fa003ce
keywords:
- preemptible 設計 WDK カーネル
- 割り込み可能な設計の WDK カーネル
- 割り込み要求レベルの WDK カーネル
- IRQL レベル WDK カーネル
- 変数の優先順位属性 WDK カーネル
- 優先順位を付ける条件 WDK カーネル
- ハードウェアの優先順位の WDK カーネル
- 高い IRQL レベル WDK カーネル
- 下の IRQL レベル WDK カーネル
- PASSIVE_LEVEL WDK
- APC_LEVEL WDK
- DISPATCH_LEVEL WDK
- WAKE_LEVEL WDK
- 遅延プロシージャ呼び出しの WDK カーネル
- Dpc WDK カーネル
- 任意のスレッド コンテキストの WDK カーネル
- スレッドの優先 WDK カーネル
- スレッドの優先順位の WDK カーネル
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: a513660a95cac611b1258e1ab4a898eb9a135c45
ms.sourcegitcommit: 78bbc162dcf6eb5816afbfa8ac546722bb98c6c8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/14/2019
ms.locfileid: "56582886"
---
# <a name="always-preemptible-and-always-interruptible"></a>常に割り込み可能で常に中断可能





Preemptible 割り込み可能なオペレーティング システムの設計の目標は、システムのパフォーマンスを最大化すること。 任意のスレッドを優先度の高いスレッドによって割り込まれることができ、任意のドライバーの割り込みサービス ルーチン (ISR) が高い割り込み要求レベル (IRQL) で実行されるルーチンによって中断されることができます。

条件の優先順位付けのいずれかに従って、コード シーケンスを実行すると、カーネル コンポーネントを決定します。

-   スレッドの実行時の優先度のカーネルに定義されているスキーム。

    システム内のすべてのスレッドには、関連付けられている優先度属性があります。 ほとんどのスレッドが一般的に、*変数*優先順位属性: preemptible は常に、ラウンド ロビンを実行するスケジュールの現在同じ優先度レベルにある他のすべてのスレッドとします。 一部のスレッドが*リアルタイム*優先順位属性: 高い優先度のリアルタイム属性を持つスレッドが優先しない限り、これらのタイム クリティカルなスレッドが完了するまで実行します。 Microsoft Windows アーキテクチャでは、本質的にリアルタイムのシステムは提供されません。

    任意の優先順位属性、ハードウェア割り込みの場合、割り込まれるでは、システムは、任意のスレッドおよび発生する特定の種類のソフトウェア割り込みです。

-   カーネル定義*割り込み要求レベル*(IRQL) に、特定のプラットフォームで特定の割り込みのベクトルが割り当てられます。

    カーネルは、ハードウェアを優先し、それによって、システムで他のスレッドよりも高いスケジューリング優先順位があること、上位の Irql でほとんどのドライバーなど、いくつかのカーネル モード コードが実行されるようにソフトウェアが中断します。 カーネル モード ドライバーのコードの一部が実行される特定の IRQL が続く、*ハードウェアの優先順位*その基になるデバイスの。

    カーネル モード コードは、常に中断可能: IRQL の値を大きく割り込みは、いつでも行うことができます、原因となり、別のカーネル モード コードをより高いシステムによって割り当てられたの IRQL したプロセッサですぐに実行します。 ただし、特定の IRQL でのコードを実行すると、カーネルは、小さいまたは等しい IRQL の値、プロセッサのすべてのベクトルの割り込みをマスクします。

最下位の IRQL レベルはパッシブと呼ばれる\_レベル。 このレベルでは、ベクトルの割り込みはマスクなし。 スレッドは、IRQL で通常実行 = パッシブ\_レベル。 ソフトウェア割り込みは、次のより高い IRQL レベルです。 これらのレベルでは、APC\_レベル、ディスパッチ\_レベルか、カーネルのデバッグを再開\_レベル。 デバイスの割り込みも高い IRQL の値があります。 カーネルは、システム クロックまたはバス エラーなどのシステムに不可欠な割り込みの最高の IRQL の値を予約します。

IRQL でいくつかのシステム サポート ルーチンが実行 = パッシブ\_レベル、ページング可能なコードやページング可能なデータにアクセスとして実装されるため、または一部のカーネル モード コンポーネントは、独自のスレッドを設定するためです。

同様に、いくつか[標準ドライバー ルーチン](https://docs.microsoft.com/windows-hardware/drivers/kernel/introduction-to-standard-driver-routines)IRQL で通常実行 = パッシブ\_レベル。 ただし、いくつかの標準のドライバーのルーチンを実行 IRQL でいずれかのディスパッチを =\_レベル、または、IRQL のデバイスの最下位レベルのドライバーの場合 (とも呼ばれる*DIRQL*)。 Irql の詳細については、[を管理するハードウェアの優先順位](managing-hardware-priorities.md)を参照してください。

ドライバーのすべてのルーチンは、中断可能です。 これにより、パッシブよりも高い IRQL でを実行している任意のルーチンが含まれます。\_レベル。 特定の IRQL でを実行している任意のルーチンでは、そのルーチンの実行中に高い IRQL の割り込みが発生しない場合にのみ、プロセッサの制御が保持されます。

前のパーソナル コンピューター オペレーティング システムのドライバーとは異なり、Microsoft Windows ドライバーの ISR は、ドライバーの I/O 処理のほとんどを行う大規模で複雑なルーチンではありません。 これは、ドライバーの*割り込みサービス ルーチン*(ISR) より高い IRQL で実行される (たとえば、別のドライバーの ISR) を他のルーチンによって中断されることができます。 そのため、ドライバーの ISR は CPU、中断されないように、末尾には、その実行パスの先頭からのコントロールを必ずしも保持しません。

Windows のドライバーで ISR 通常ハードウェア状態情報を保存、キュー、*遅延プロシージャ呼び出し*(DPC) し、迅速に終了します。 システムが、ドライバーの DPC をデキューするドライバーが低い IRQL で I/O 操作を完了できるように、後で (ディスパッチ\_レベル)。 優れた全体的なシステム パフォーマンスの高い Irql で実行されるすべてのルーチンはすばやく CPU の制御を放棄する必要があります。

、Windows では、すべてのスレッドはスレッド コンテキストを持っています。 このコンテキストは、スレッドとスレッドのアクセス権などの他の特性を所有するプロセスを識別する情報で構成されます。

一般に、最上位レベルのドライバーのみ、ドライバーの現在の I/O 操作を要求しているスレッドのコンテキストで呼び出されます。 中級レベルまたは最下位レベルのドライバーでは、その現在の I/O 操作を要求したスレッドのコンテキストで実行されていることを想定できることはありません。

その結果、ドライバーのルーチンは、通常の実行、*任意のスレッド コンテキスト*— どのスレッドが標準のドライバーのルーチンが呼び出されたときに、現在のコンテキスト。 (コンテキストの切り替えを避けるため) にパフォーマンス上の理由から、ごく少数のドライバーが、独自のスレッドを設定します。

 

 




