---
title: デバイスのポーリングの回避
description: デバイスのポーリングの回避
ms.assetid: c50c9c6f-c8eb-4e52-854a-3ebc4fdc874c
keywords:
- I/o WDK カーネル、デバイスのポーリング
- デバイスポーリング WDK i/o
- デバイスのポーリング (WDK i/o)
- ループカウンター WDK i/o
- カウンター WDK i/o
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: e91fb6e7bbdc2944fc7c1f3f222b3ba6d6778ccd
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72837201"
---
# <a name="avoid-polling-devices"></a>デバイスのポーリングの回避





デバイスドライバーは、絶対に必要な場合を除き、デバイスのポーリングを避ける必要があります。また、ポーリングにタイムスライス全体を使用することは避けてください。 デバイスのポーリングは、ポーリングドライバー内で任意のオペレーティングシステムのコンピューティングバインドを行う高価な操作です。 多くのポーリングを行うデバイスドライバーは、他のデバイスでの i/o 操作に干渉するため、システムの処理速度が低下し、ユーザーに応答しなくなる可能性があります。

最近開発されたデバイスは、Windows が実行するように設計されているプロセッサと同じように、デバイスをポーリングするためにドライバーを必要としません。そのため、デバイスが i/o 操作を開始する準備ができているか、操作が完了していることを確認します。

ただし、まだ使用されているデバイスの中には、古いプロセッサを使用するように設計されているものがあります。これには、データバス、低速のクロック速度、および同期 i/o を行ったシングルユーザーのシングルタスクオペレーティングシステムが含まれていました。 このようなデバイスでは、ポーリングや、デバイスがレジスタを更新するのを待機するその他の方法が必要になる場合があります。

カウンターをインクリメントする単純なループをコーディングすることによって、デバイスの低速な問題を解決することは論理的に思えるかもしれませんが、デバイスの更新によってデバイスの更新が登録されている間に最小間隔を "無駄にする" ため、Windows プラットフォーム間で移植性が低下する可能性があります。 ループカウンターの最大値は、プラットフォームごとにカスタマイズする必要があります。 さらに、適切な最適化コンパイラを使用してドライバーをコンパイルした場合、コンパイラは、ドライバーのカウンター変数と、それがインクリメントされるループを削除する可能性があります。

デバイスのハードウェアが更新されている間にドライバーが停止する必要がある場合は、この実装ガイドラインに従う  **注意**してください。ドライバーは、デバイスレジスタを読み取る前に[**Kestallexecutionprocessor**](https://docs.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-kestallexecutionprocessor)を呼び出すことができます。 ドライバーは停止する間隔を最小限にする必要があります。また、一般に、失速間隔を50マイクロ秒以内に指定する必要があります。

**Kestallexecutionprocessor** interval の粒度は1マイクロ秒です。

デバイスで状態の更新に50マイクロ秒以上かかることが頻繁に必要な場合は、ドライバーに[デバイス専用のスレッド](device-dedicated-threads.md)を設定することを検討してください。

 

 

 




