---
title: ドライバー全体のページング
description: ドライバー全体のページング
ms.assetid: d861160f-e429-4ff3-9ca6-4fce4d5d6c1b
keywords:
- ページング可能ドライバー WDK カーネル、ドライバー全体のページング
- ドライバー全体のページング (WDK)
- 参照カウント WDK のページング可能ドライバー
- ページングまたは非ページング属性の上書き WDK
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: c8055ab798c473c4d82b9dfe8fd4a37ea690e9bf
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72838519"
---
# <a name="paging-an-entire-driver"></a>ドライバー全体のページング





**Mmlockpagable * Xxx*** サポートルーチンを使用し、ページ分割および破棄可能なセクションを指定するドライバーは、ページ分割されていないセクション、ページングされたセクション、およびドライバーの初期化後に破棄される INIT セクションで構成されます。

デバイスドライバーが管理しているデバイスの割り込みに接続した後、ドライバーの割り込み処理パスはシステム領域に常駐している必要があります。 割り込み処理コードは、割り込みが発生した場合にページアウトできないドライバーセクションの一部である必要があります。

2つの追加のメモリマネージャールーチン ( [**Mmpageentiredriver**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-mmpageentiredriver)および[**Mmresetdriverpaging**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-mmresetdriverpaging)) を使用して、ドライバーイメージを構成するすべてのセクションのページングまたは非ページング属性を上書きできます。 これらのルーチンにより、管理対象のデバイスが使用されておらず、割り込みを生成できないときに、ドライバーが完全にページアウトされます。

完全にページング可能なシステムドライバーの例として、win32k ドライバー、シリアルドライバー、メールスロットドライバー、ビープ音ドライバー、および null ドライバーがあります。

通常、シリアルドライバーは断続的に使用されます。 管理しているポートが開かれるまで、シリアルドライバを完全にページアウトできます。 ポートが開かれるとすぐに、メモリ常駐型のシリアルドライバーの部分を、非ページシステム領域に取り込む必要があります。 ドライバーのその他の部分は、ページング可能なままにすることができます。

完全にページアウトできるドライバーは、ドライバーの初期化中に、割り込みが接続される前に**Mmpageentiredriver**を呼び出す必要があります。

ページアウトされたドライバーによって管理されているデバイスが開いている要求を受信すると、そのドライバーはページングされます。 次に、ドライバーは、割り込みに接続する前に[**Mmresetdriverpaging**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-mmresetdriverpaging)を呼び出す必要があります。 **Mmresetdriverpaging**を呼び出すと、コンパイルおよびリンケージ中に取得された属性に従って、メモリマネージャーがドライバーのセクションを処理します。 テキストセクションなど、非ページ化されているセクションは、非ページシステムメモリにページングされます。ページ分割されたセクションは参照時にページングされます。

このようなドライバーは、デバイスに対して開いているハンドルの参照カウントを保持する必要があります。 ドライバーは、デバイスに対して開いている要求ごとにカウントをインクリメントし、終了要求のたびにカウントをデクリメントします。 カウントがゼロになると、ドライバーは割り込みを切断し、 **Mmpageentiredriver**を呼び出します。 ドライバーが複数のデバイスを管理している場合、ドライバーが**Mmpageentiredriver**を呼び出すことができるようにするには、そのデバイスの数が0である必要があります。

参照カウントを変更するときに必要なすべての同期を実行し、ドライバーのページング可能な状態が変更されている間に参照カウントが変化しないようにするには、ドライバーの役割が必要です。 つまり、SMP コンピューターでは、ドライバーは**Mmpageentiredriver**が1つのプロセッサで実行されていないことを確認する必要があります。別のプロセッサでは、開いている呼び出しによって割り込みが接続され、参照カウントがインクリメントされます。

 

 




