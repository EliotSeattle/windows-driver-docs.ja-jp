---
title: デバイスのパフォーマンス状態の管理
description: デバイスのパフォーマンス状態の管理
ms.assetid: 5a4cc09a-e86e-4e5a-98b2-0351b253b5b6
keywords:
- 電源管理 WDK カーネル、デバイスパフォーマンス状態
- デバイスパフォーマンス状態 WDK 電源管理
- パフォーマンス状態 WDK 電源管理
- カスタム電源設定 WDK の電源管理
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 3e776372d8fbf3ad1b16f1ca7fab37c39f186e27
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72827888"
---
# <a name="managing-device-performance-states"></a>デバイスのパフォーマンス状態の管理


Windows Vista は、ドライバースタックがデバイスの電源ポリシーをより適切に管理できるようにする、強化された電源管理インフラストラクチャを備えています。 システム定義の電源設定が変更されたとき、またはシステム電源イベントが発生したときに、ドライバーが通知を受け取るように登録できます。 デバイスの電源ポリシー所有者は、これらの通知を使用して、デバイスの電力使用状況を適切に調整できます。 さらに、デバイス固有の電源とパフォーマンスの機能へのアクセスを提供するカスタム電源設定を作成して、システムの電源ポリシーに緊密に統合することもできます。 次に、デバイスのパフォーマンス状態と省電力動作をシステム電源ポリシーと統合する2つの主な方法を示します。

[デバイスのカスタム電源設定を作成する](#creating-custom-power-settings-for-a-device)

[アクティブな電源設定、電源設定のパーソナリティ、または電源に対する変更が通知されるように登録する](#registering-to-be-notified-of-a-change-to-the-active-power-scheme)

### <a href="" id="creating-custom-power-settings-for-a-device"></a>デバイスのカスタム電源設定を作成する

デバイスのパフォーマンス状態や省電力動作を構成するために使用できるカスタム電源設定を定義できます。 カスタム電源設定に関する情報は、電源マネージャーによって保存および管理されます。 デバイスドライバー、サービス、アプリケーションなど、システム内の他のコンポーネントは、カスタム電源設定の値が変更されたときに通知を受け取るように登録できます。 一般に、電力消費によってパフォーマンスをトレードオフできるデバイスには、対応するカスタム電源設定が必要です。 カスタム電源設定の作成は、電力消費をシステム電源ポリシーと緊密に統合するための最も柔軟な方法であり、次のような利点があります。

-   カスタムの電源設定をユーザーがアクセスできるようにするために、カスタムユーザーインターフェイスは必要ありません。 カスタム電源設定を含むすべての電源設定は、コントロールパネルの **[電源オプション]** の **[詳細設定]** ページでユーザーに表示されます。

-   ユーザーおよびシステム管理者は、カスタム電源設定の構成を簡単にスクリプト化できます。そのためには、電源管理コマンドラインツールの Powercfg を使用します。

-   システム管理者は必要に応じて、管理用テンプレート () を作成できます。ADM) を使用して、グループポリシーベースで新しい電源設定を構成できるようにします。

個々の電源設定には、電源設定の値を一意に識別、名前、説明、および提供するために必要なすべての情報が含まれています。 各電源設定は、GUID、設定名、説明、および AC および DC 電源設定の既定の設定を使用して定義されます。 カスタム電源設定は、デバイスに対して静的に作成することも、 [**INF AddPowerSetting ディレクティブ**](https://docs.microsoft.com/windows-hardware/drivers/install/inf-addpowersetting-directive)を使用することもできます。また、Microsoft Windows SDK ドキュメントで提供されている電源管理のリファレンスに含まれる Win32 電源管理機能を呼び出すことによって動的に作成することもできます。

ドライバーは、電源設定の変更をドライバーに通知するために、電源マネージャーが呼び出すコールバックルーチンを登録するために、 [**PoRegisterPowerSettingCallback**](https://docs.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-poregisterpowersettingcallback)を呼び出します。 設定が変更されると、電源マネージャーはコールバックルーチンを呼び出し、新しい設定値を渡します。 ドライバーは、電源設定に適したアクションを実行できます。 各設定は、電源設定の GUID によって識別されます。 電源設定のシステム定義 Guid は、Wdm と Ntpoapi .h で定義されています。

たとえば、モニターの電源をオンまたはオフにしたときに通知されるようにするには、ドライバーは**PoRegisterPowerSettingCallback**を呼び出します。これは、モニターの電源設定 (GUID\_モニター\_電源\_on) を識別する guid と、モニターの電源設定の値が変更されたときに電源マネージャーが呼び出したコールバックルーチンへのポインターです。

### <a href="" id="registering-to-be-notified-of-a-change-to-the-active-power-scheme"></a>アクティブな電源設定、電源設定のパーソナリティ、または電源に対する変更が通知されるように登録する

アクティブな電源設定の性格は、システム全体の省電力動作をユーザーが意図したものになります。 カスタムスキームを含むすべての電源設定には、スキームの全体的な目的を示すパーソナリティがあります。 これにより、スキームの意図を理解するという利点をすべて提供しながら、追加のカスタム電源設定を作成できます。 Windows Vista には、次の3つのシステム定義の電源設定とそれに対応する個性が含まれています。

<a href="" id="maximum-power-savings"></a>**最大電力節約**  
電力消費を最小限に抑えるために、パフォーマンスを低下させます。

<a href="" id="automatic--balanced-"></a>**自動 (均衡)**  
システムが電力消費全体に基づいて最適な電源状態レベルを選択できるようにします。

<a href="" id="maximum-performance-------"></a>**最大パフォーマンス**   
電力消費に関係なく最大のパフォーマンスを提供します。

電源は AC または DC 電源のいずれかです。

デバイスの電源ポリシー所有者は、アクティブな電源設定、電源設定パーソナリティ、および電源に関する情報を使用して、デバイスの電源ポリシーを調整できます。 たとえば、電源設定の内容が**最大省電力**に変更された場合、デバイスの電源ポリシー所有者はデバイスの電源を積極的に切ることができます。 ただし、電源設定のパーソナリティが最大の**パフォーマンス**に変更された場合、デバイスの電源ポリシー所有者は電力消費を減らすのではなく、デバイスのパフォーマンスレベルを維持することができます。また、デバイスの電源を常にオンにして、最高レベルのパフォーマンスを確保することもできます。

ドライバーは、アクティブな電源設定、電源設定のパーソナリティ、または電源に変更が発生したときに通知を受け取るように登録できます。 ドライバーは、 **PoRegisterPowerSettingCallback**を呼び出して、次のように、このような変更をドライバーに通知するために、電源マネージャーが呼び出すコールバックルーチンを登録します。

-   アクティブな電源設定に対する変更の通知を登録するには、電源設定 (GUID\_ACTIVE\_POWERSCHEME) の設定を表す GUID を指定します。 新しい電源設定のパーソナリティが前の電源設定と同じであっても、電源マネージャーは、アクティブな電源設定が変更されるたびにコールバックルーチンを呼び出します。

-   電源設定の変更通知を登録するには、電源設定の設定を表す GUID を指定します (GUID\_POWERSCHEME\_パーソナリティ)。 電源マネージャーは、アクティブな電源設定が変更されたときにコールバックルーチンを呼び出し、新しい電源設定のパーソナリティが前の電源設定のパーソナリティとは異なる場合に呼び出します。

-   電源に対する変更の通知を登録するには、電源 (GUID\_ACDC\_電源\_ソース) の設定を表す GUID を指定します。 電源マネージャーは、電源設定が変更されるたびにコールバックルーチンを呼び出します。

アクティブな電源設定が変更されるか、電源設定のパーソナリティが変更されると、電源マネージャーはコールバックルーチンを呼び出し、新しい電源設定または電源設定のパーソナリティを表す GUID を渡します。 ドライバーは、変更に適したアクションを実行できます。

[アクティブな電源設定] と [電源設定] の設定では、次の Guid を使用してそれぞれの値を識別します。

-   GUID\_最大\_電力\_節約されます。これは、**最大省**電力電源設定とそれに対応するパーソナリティに対応します。

-   GUID\_最小\_電力\_節約されます。これは、**最大パフォーマンス**電源設定とそれに対応するパーソナリティに対応します。

-   GUID\_通常\_電力\_節約されます。これは、**自動 (均衡)** 電源設定とそれに対応するパーソナリティに対応します。

電源ソースが変更されると、電源マネージャーはコールバックルーチンを呼び出し、電源設定を表す GUID と、コンピューターが AC 電源、DC 電源のどちらで電源が入っているかを示す電源設定の値を渡します。ソースまたは短期的な DC 電源。

 

 




