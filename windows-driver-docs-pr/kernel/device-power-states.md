---
title: デバイスの電源状態
description: デバイスの電源状態
ms.assetid: 2229f34c-9b88-4e3e-802e-f7be2c7ef168
keywords:
- デバイスの電源状態 WDK カーネル
- 電源状態 WDK カーネル
- 状態 WDK 電源管理
- Dx 名 WDK の電源管理
- 低電力モード WDK カーネル
- 省電力モード WDK カーネル
- 継続的なパワー WDK カーネル
- WDK 電源管理の遅延
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 05b5a144811285afc91cc99844c7daa738fb6926
ms.sourcegitcommit: 2bf68f6c08c02ddcfccaf5fa485ff1ca92a08749
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/23/2019
ms.locfileid: "69985805"
---
# <a name="device-power-states"></a>デバイスの電源状態


## <a href="" id="ddk-device-power-states-kg"></a>


デバイスの電源状態は、コンピューター内の他のデバイスとは独立して、コンピューター内のデバイスの電源状態を表します。 デバイスの電源状態には、D0、D1、D2、および D3 という名前が付けられます。 D0 は完全な状態で、D1、D2、および D3 は低電力状態です。 状態番号は、電力消費に反比例しています。番号が大きいほど、使用する電力が少なくなります。 Windows 8 以降では、D3 の状態は2つの下位 D3hot と D3cold に分割されています。

デバイスの電源状態は、次の属性によって特徴付けられます。

-   電力消費:デバイスはどれだけの電力を消費しますか。

-   デバイスコンテキスト:デバイスがこの状態で保持する操作コンテキストの量を確認できます。

-   デバイスドライバーの動作:デバイスのドライバーで、デバイスを完全に動作可能な状態に復元するにはどうすればよいですか。

-   復元時間:デバイスを完全に動作可能な状態に復元するには、どのくらいの時間がかかりますか。 ほとんどの種類のデバイスでは、1つのデバイスクラスから次のようにわずかな復元時間が若干異なります。 Gpu など、いくつかの種類のデバイスにのみ、非常に大きなハードウェアコンテキストがあり、復元にかかる時間が大幅に長くなります。

-   ウェイクアップ機能:デバイスはこの状態からウェイクアップを要求できますか。 一般に、デバイスが特定の電源状態 (D2 など) からウェイクアップを要求できる場合は、より高い電力状態 (D1) からウェイクアップを要求することもできます。

電源の状態の正確な定義は、デバイスによって異なります。 すべてのデバイスがすべての状態を定義するわけではありません。多くのデバイスでは、D0 と D3 の状態のみが定義されています。 特定のデバイスに対して定義されているデバイスの電源状態と、各状態の運用要件を確認するには、デバイスクラスの電源管理のリファレンス仕様を参照してください。 (参照仕様は、 [ACPI/電源管理](https://go.microsoft.com/fwlink/p/?linkid=57185)の web サイトから入手できます)。

デバイスの電源状態が[システム電源の状態](system-power-states.md)と一致していない必要があります。 たとえば、システムが[システム動作状態 (S0)](system-working-state-s0.md)にある場合でも、一部のデバイスはオフ (D3) 状態になることがあります。

デバイスの電源状態は、デバイスの親バスの電源状態とは無関係であるように見えることがあります。 たとえば、親ホストコントローラーが D3 状態にある場合、USB デバイスは D2 (セレクティブサスペンド) 状態になることがあります。 この2つの状態は、usb ホストコントローラーが接続されている USB とバス (通常は PCI または PCI Express) で、Dx の状態の定義が異なるため、整合性が失われているように見えます。

一部のデバイスは、1つのデバイスの電源状態内でいくつかの低電力モードに対応していることに注意してください。 このようなデバイスでは、デバイスの電源状態を変更せずに、ドライバーがデバイスをあるモードから別のモードに自動的に切り替えることができる場合に、これらのモードを使用できます。 ただし、一般的な規則として、モードの間にユーザー出ることの違いがない場合、デバイスは最も低い電源モードのみを使用する必要があります。 低速度モードなどの低電力モードがパフォーマンスに悪影響を与えるか、デバイスドライバ以外のソフトウェアに対して透過的でない場合、ハードウェアは自動的にそれを使用しないようにする必要があります。 詳細については、デバイスクラスの電源管理のリファレンス仕様を参照してください。

ドライバーまたは電源マネージャーは、デバイスの電源状態遷移を要求できます。また、このような遷移を要求する Irp を処理するには、すべてのドライバーを準備する必要があります。 詳しくは、次のトピックをご覧ください。

[Irp\_\_\_の全\_機能を備えた\_クエリパワーまたは irp の電力状態を送信しています\_](sending-irp-mn-query-power-or-irp-mn-set-power-for-device-power-states.md)

[デバイスの\_電源\_状態\_に対する IRP のクエリ力の処理](handling-irp-mn-query-power-for-device-power-states.md)

[デバイスの\_電源\_状態\_に対する IRP を使用した電源設定の処理](handling-irp-mn-set-power-for-device-power-states.md)

## <a href="" id="power-state-diagram"></a>


システムと同様に、デバイスは動作状態 (D0) から低電力状態 (D1、D2、または D3) に、低電力状態から動作状態に遷移できます。 次の図は、有効なデバイスの電源状態遷移を示す状態グラフです。

![有効なデバイスの電源状態遷移を示す図](images/dxpostates.png)

このグラフは、D3hot と D3cold における D3 の部分を示しています。 D3hot と D3cold は、Windows 8 以降で定義されています。 すべてのデバイスは、D0 状態と D3hot の下位状態をサポートする必要があります。 図に示されている他の状態はオプションです。

前のグラフでは、D3hot から D3cold への移行は、デバイスの低電力状態間の唯一の直接遷移です。 低電力状態間のその他すべての遷移には、D0 への中間遷移が必要です。これにより、デバイスドライバーは必要に応じて、次の低電力状態を入力するか、または D0 に維持するために、デバイスハードウェアを構成できます。 ただし、デバイスは D3hot を終了し、デバイスの電源がオフになったときに D3cold に入ります。デバイスドライバーからの介入は必要ありません。 このドライバーは、デバイスが D3hot に入る前に、デバイスハードウェアの必要な構成を行います。D3hot から D3cold への移行のためにデバイスを準備するために、追加の構成は必要ありません。 詳細については、「 [D3cold でのドライバーのサポート](supporting-d3cold-in-a-driver.md)」を参照してください。


## <a name="pci-root-port-to-endpoint-d-state-mapping"></a>PCI ルートポートからエンドポイント D 状態へのマッピング 
 
Windows 10 システムでは、プラットフォームの全体的な電源状態は、(PCI ルートポートを含む) SoC (System on チップ) 統合デバイスの電源状態 (D 状態) によって異なります。 開発中のプラットフォームによっては、PCI ルートポートの D 状態の要件がプラットフォームの電源の状態ごとに異なる場合があります。 Oem は、プラットフォームとデバイスの電力状態の要件について、IHV プラットフォーム固有のドキュメントを参照することをお勧めします。  
 
次の表は、PCI ルートポートとそれに接続されているエンドポイントの電源状態マッピングを列挙したものです。 ルートポートでターゲットの D 状態に入るには、次に示すエンドポイントの D 状態を達成する必要があります。 
 
<table>
<thead>
<tr class="header">
<th>ルートポートターゲット D-状態</th>
<th>エンドポイント D-状態 </th>
</tr>
</thead>
<tbody valign="top">
<tr class="odd">
<td><p>D0</p></td>
<td><p>D0、D0: F1</p></td>
</tr>
<tr class="even">
<td><p>D0: F1</p></td>
<td><p>D3hot</p></td>
</tr>
<tr class="odd">
<td><p>D3hot</p></td>
<td><p>D3cold*</p></td>
</tr>
</tbody>
</table>

\* PCI D3cold の電源状態には BIOS およびデバイスドライバのサポートが必要です。 サポートがない場合、PCI エンドポイントは D3Hot を実現できません。 詳細については、「 [D3Cold でのドライバーのサポート](https://docs.microsoft.com/windows-hardware/drivers/kernel/supporting-d3cold-in-a-driver)」を参照してください。
