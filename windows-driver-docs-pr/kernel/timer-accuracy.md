---
title: タイマー精度
description: システムタイマールーチンは、通常、呼び出し元がタイマーの絶対有効期間または相対有効期限を指定できるようにします。
ms.assetid: CA29DC02-1AEA-4A13-B2D6-8C8052E21EDB
ms.localizationpriority: medium
ms.date: 10/17/2018
ms.openlocfilehash: 3c8c3e7de374778b3e896fbfec0ea31ad7b21914
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72836115"
---
# <a name="timer-accuracy"></a>タイマー精度


システムタイマールーチンは、通常、呼び出し元がタイマーの絶対有効期間または相対有効期限を指定できるようにします。 例については、「 [**KeWaitForSingleObject**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-kewaitforsingleobject)、 [**KeSetTimer**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-kesettimer)、または[**kedelayexecutionthread**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-kedelayexecutionthread)」を参照してください。 オペレーティングシステムが有効期限を測定できる精度は、システムクロックの粒度によって制限されます。

システム時刻は、システムクロックのすべてのティックで更新され、最新のティックのみに正確になります。 呼び出し元が絶対有効期限を指定した場合、タイマーの有効期限は、指定された時間の経過後に発生する最初のシステムクロックティックの処理中に検出されます。 したがって、タイマーの有効期限は、指定された絶対有効期限よりも後のシステムクロック期間と同じになります。 タイマー間隔 (相対有効期限) を指定した場合は、この期間の開始時刻と終了時刻がシステムクロックティック間で正確に一致しているかどうかに応じて、指定した時間よりも前または後の期間までの有効期限が設定されます。 絶対時刻または相対時刻が指定されているかどうかにかかわらず、他のデバイスの割り込み処理によってシステムクロックの割り込み処理が遅延した場合でも、タイマーの有効期限が検出されない可能性があります。

呼び出し元が相対有効期限を指定すると、タイマールーチンは、タイマーに使用する絶対有効期間を計算するために、指定された相対有効期限に現在のシステムクロック時間を追加します。 システム時刻は、システムクロックの最新のティックに対してのみ正確であるため、計算された有効期限は、呼び出し元が想定している有効期限よりも前のシステムクロック期間になることがあります。 指定された相対有効期限がシステムクロック期間以下である場合、タイマーは遅延なしですぐに期限切れになる可能性があります。

有効期限の短い時間をより正確にサポートするには、システムクロックティック間の時間を短くする方法がありますが、その場合は電力消費量が増加する可能性があります。 さらに、プラットフォーム内の他のデバイスの割り込み処理がシステムクロック割り込みの処理を遅らせないことが保証される場合を除き、システムクロック期間を短くすると、システムクロックの粒度が高くならない可能性があります。

Windows 8 以降では、 [**Kedelayexecutionthread**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-kedelayexecutionthread)はより正確な手法を使用して、呼び出し元が指定した相対有効期限から絶対有効期限を計算します。 最初に、現在のシステム時刻のより正確な推定値を取得するには、システムパフォーマンスカウンターを使用して、最後のシステムクロックティックからの経過時間を計測します。 次に、このルーチンは、おおよその有効期限を計算するために、相対的な有効期限に対してより正確なシステム時刻を追加します。 この手法によって計算された絶対有効期間は、マイクロ秒以内に正確になります。 その結果、指定された相対有効期限が経過する前にタイマーが期限切れになることはありません。 タイマーは、指定された時間より後もシステムクロック期間にわたって期限切れになることがあります。また、他のデバイスの割り込み処理によってシステムクロック割り込みの処理が遅延する場合は、後で有効期限が切れることがあります。

タイマーが期限切れになる前にシステム時刻が変化した場合、相対タイマーは影響を受けませんが、システムは各絶対タイマーを調整します。 相対タイマーは、絶対システム時刻に関係なく、指定された時間単位数の経過後、常に期限切れになります。 絶対タイマーは特定のシステム時刻に期限切れになるため、システム時刻の変更によって絶対タイマーの待機時間が変更されます。

 

 




