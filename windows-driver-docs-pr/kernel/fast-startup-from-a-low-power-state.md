---
title: 低電力状態からの高速スタートアップ
description: 低電力状態からの高速スタートアップ
ms.assetid: 1091571c-2e30-4ad5-b4b9-0f8633e68288
ms.localizationpriority: medium
ms.date: 10/17/2018
ms.openlocfilehash: d6c6db45818adf93e6daf7c45992f65e6735860f
ms.sourcegitcommit: fb7d95c7a5d47860918cd3602efdd33b69dcf2da
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/25/2019
ms.locfileid: "67386602"
---
# <a name="fast-startup-from-a-low-power-state"></a>低電力状態からの高速スタートアップ


低電力状態から高速スタートアップを実現するためにリーフ ノードのデバイスのドライバーが S0 power IRP を処理する必要があります (つまり、 [ **IRP\_MN\_設定\_POWER** ](https://docs.microsoft.com/windows-hardware/drivers/kernel/irp-mn-set-power)の IRPS0 システム電源の状態)。 子のデバイスを所有しているデバイスの階層のリーフ ノードであるデバイスはありません。 リーフ ノードのデバイスには、子デバイス上の依存関係があるない、ため、デバイスの機能のドライバーは、オペレーティング システムまたはその他のドライバーの不必要な遅延を回避するためにバック グラウンド タスクとして、デバイスを再初期化できます。 これに対し、バス ドライバーには、子デバイスの電源投入シーケンスを調整する追加の同期ロジックを必要とする依存関係があります。

低電力状態からリーフ ノードのデバイスの高速スタートアップを実現するために、次の手順を使用します。

1.  S0 power IRP の完了ルーチンを設定します。

2.  デバイス スタック S0 power IRP を送信します。

3.  D0 電源 IRP の完了まで待機する代わりに S0 power IRP を直ちに完了します。 S0 power IRP の完了ルーチンの実行時に、次の操作を行います。

    1.  D0 power IRP の要求 (つまり、 **IRP\_MN\_設定\_POWER** D0 デバイスの電源状態の IRP)。

    2.  状態を返す\_S0 power IRP の完了ルーチンに成功します。

4.  ドライバーは、受信したすべての I/O 要求をキューが、D0 power IRP の処理が完了するまで、これらの要求の処理を延期する必要があります。

5.  D0 power IRP の完了ルーチンを実行すると、デバイスの初期化が制限を加えて、デバイスを使用する準備が必要なものには、このルーチン。

6.  前の手順を完了した後、ドライバーは既にキューに登録がすべての I/O 要求をなど、I/O 要求を処理するために開始できます。

**注**   PowerSystemWorking (S0) 以外のすべての電源状態の電源 Irp の処理に、上記の手順は適用されません。 次の手順は、具体的には、電源オン (S0) 状態に低電力状態から遷移 power Irp の処理に適用されます。

 

すべてのデバイスは、S0 power Irp を完了した後、システムの起動が完了しました。 これらのデバイスが必須で、D0 power Irp を完了しているかが完全に機能しているシステムの起動の完了時ではありません。 カーネルの電源マネージャは、限られた IRP ディスパッチ キューを備え、S0 の状態に戻り値のシステム内のすべてのデバイスに通知するこれらのキューを使用する必要があります。 S0 power Irp を迅速に完了していないドライバーでは、その他のデバイス ドライバーが、S0 power Irp を受信できなくなります。 そのため、不適切に設計されたドライバー低下直列に実行する同時に実行されるドライバー操作の原因によって全体的なシステム起動時のパフォーマンスがあります。

ドライバーには、その S0 power IRP が完了すると、デバイスへのハンドルを開いているアプリケーションからの I/O 要求を受信、可能性があります。 ドライバーには、応答を停止してタイムアウト エラー メッセージを生成するためにアプリケーションが発生する可能性がありますので、これらの I/O 要求が失敗することはありません必要があります。 代わりに、ドライバーは、デバイスが処理できるようになるまで、I/O 要求をキューする必要があります。

バス ドライバーでは、リーフ ノードのデバイスのドライバーの上記で説明したのと同様のテクニックを使用して、低電力状態から高速スタートアップを実現できます。 バス ドライバーには、D0 の状態に子デバイスからの要求が保留中としてマークされて bus デバイスが D0 状態を入力するまで、バス ドライバーによってが完了しないことを確認するには追加の要件を満たす必要があります。

たとえば、USB ハブに対するバス ドライバーでは、S0 power IRP を受信すると、ドライバーは D0 power IRP を要求し、要求された D0 power IRP を受信した後 S0 power IRP を完了します。 ただし、S0 電源 IRP の完了後に、ハブの子デバイスは、S0 power Irp を受信して、D0 power Irp の要求を開始する可能性があります。 バス ドライバーは、子デバイスを防ぐため、ハブ デバイス D0 に入るまで、D0 を入力する必要があります。 したがって、バス ドライバーは保留中として子デバイスからのすべての D0 power Irp をマークし、バス ドライバーでは、ハブの D0 power IRP の処理が完了し、ハブのデバイスが完全に初期化されるまで、これらの Irp を完了するまで待機する必要があります。

電源 Irp の詳細については、次のトピックを参照してください。

[IRP の処理\_MN\_設定\_システム電源の状態の電源](handling-irp-mn-set-power-for-system-power-states.md)

[IRP の処理\_MN\_設定\_電源状態のデバイスの電源](handling-irp-mn-set-power-for-device-power-states.md)

 

 




