---
title: プロセッサ数の変更
description: プロセッサ数の変更
ms.assetid: 9ced4b42-c83d-49da-8405-b95b0c0144fa
keywords:
- 動的なハードウェア WDK をパーティション分割、プロセッサの数を変更します。
- ハードウェアの WDK 動的で、プロセッサの数を変更するパーティション分割
- プロセッサの数を変更するパーティション WDK 動的なハードウェア
- WDK の動的なハードウェア パーティショニングのアクティブなプロセッサ
- プロセッサ数の WDK の動的なハードウェア パーティショニング
- プロセッサ アフィニティ WDK ハードウェアの動的パーティション
- プロセッサごとのデータは、WDK の動的なハードウェア パーティショニング構造体します。
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 3b0b7129de668eabdfd2e7d711d1ed8dfb26c907
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56570336"
---
# <a name="changes-to-the-number-of-processors"></a>プロセッサ数の変更


動的にパーティション分割可能サーバーの場合は、いつでもハードウェア パーティションにプロセッサを追加することができます。 そのため、ことは避けてください active プロセッサの数に関するどのような想定ハードウェア パーティション、プロセッサのアフィニティ値、またはアクティブな各プロセッサに割り当てられているプロセッサの数。 プロセッサのアフィニティ値に設定されているビットは、各ハードウェア パーティションで現在アクティブなプロセッサを表します。 ハードウェア パーティションにプロセッサを追加する場合、設定されている特定のビットが変更されます。

次のステートメントのいずれかにデバイス ドライバーの該当する場合は、正しく機能するように動的にパーティション分割できるサーバーのプロセッサがハードウェアのパーティションに動的に追加されたときにできるようにドライバーを更新する必要があります。

-   デバイス ドライバーでは、ハードウェア パーティションで active プロセッサの数を使用して、メモリを割り当てたメモリの量、作成したスレッドの数または使用するその他のリソースの量など、使用されるリソースの量を決定します。 このような状況で、デバイス ドライバーのリソースの割り当ては正しいの場合は、プロセッサがハードウェアのパーティションに動的に追加できません。 ドライバーの動作、パフォーマンスが低下でした。

-   デバイス ドライバーには、プロセッサのアフィニティ値のビットがについて説明します。 このような状況で、デバイス ドライバー正常に機能しないプロセッサ アフィニティ値に動的な変更を処理できないか設定されているビットのシーケンスのギャップを処理することはできません。

-   デバイス ドライバーでは、プロセッサ アフィニティ値のビットを使用して、特定のプロセッサをドライバーに割り当てられたリソースを割り当てます。 このような状況で、デバイス ドライバーのリソースの割り当ては正しいの場合は、プロセッサがハードウェアのパーティションに動的に追加できません。 ドライバーの動作、パフォーマンスが低下でした。

-   データ構造は、デバイス ドライバーは、ハードウェア パーティション内のアクティブな各プロセッサを割り当てます。 この場合、有害な動作、データの破損、またはハードウェア パーティションに動的に追加されたプロセッサのこれらのデータ構造のアクセスを試行する場合に発生するバグ チェックが、デバイス ドライバー可能性があります。

-   デバイス ドライバーのディスパッチ ルーチンでは、それらが実行されているデータ構造のアクセスやその特定のプロセッサに割り当てられている他のリソースに、プロセッサのプロセッサ数を使用します。 このような状況では有害な動作、データの破損、またはプロセッサがハードウェアのパーティションに動的に追加されているため、これらのリソースにアクセスしようとする場合に発生するバグ チェックが、デバイス ドライバーのディスパッチ ルーチン可能性があります。

-   デバイス ドライバーは、その割り込みサービス ルーチン (Isr)、遅延プロシージャ呼び出し (Dpc)、または特定のプロセッサの他のスレッドをスケジュールします。 このような状況で、デバイス ドライバーはハードウェアのパーティションにプロセッサを追加して、デバイス ドライバーを完全に任意の新しいプロセッサを使用することはできませんがある場合、正しく機能しているを停止する可能性があります。

-   デバイス ドライバーは、リソースの再調整をサポートしていません。 このような状況で、デバイス ドライバーは割り込みを処理するためのハードウェアのパーティションに追加されるすべての新しいプロセッサを使用することができません。

-   デバイス ドライバーは、I/O 要求の処理を複数のプロセッサに分散するのに負荷の分散アルゴリズムを使用します。 このような状況で、デバイス ドライバーはハードウェアのパーティションにプロセッサを追加して、デバイス ドライバーを完全に任意の新しいプロセッサを使用することはできませんがある場合、正しく機能しているを停止する可能性があります。

デバイス ドライバーがアクティブなプロセッサの数の変更によって影響を受ける場合自体、ハードウェアのパーティションにプロセッサを追加するときに通知するオペレーティング システムが登録する必要があります。 デバイス ドライバーが通知されたときに、安全で最適な操作に必要な応答できます。 デバイス ドライバーを登録する方法自体、オペレーティング システムの詳細については、次を参照してください。[ドライバー通知](driver-notification.md)します。

現在のアクティブなプロセッサがハードウェア パーティションの数を取得するデバイス ドライバーを呼び出す必要があります、 [ **KeQueryActiveProcessorCount** ](https://msdn.microsoft.com/library/windows/hardware/ff552985)関数。 現在のプロセッサ アフィニティ値を取得するデバイス ドライバー呼び出すことができます、 [ **KeQueryActiveProcessors** ](https://msdn.microsoft.com/library/windows/hardware/ff553001)関数または**KeQueryActiveProcessorCount**関数。

**注**  デバイス ドライバーは、ハードウェア パーティション内のアクティブな各プロセッサのデータ構造体を割り当て、デバイス ドライバーは、データのメモリ割り当ての構造体の場合は失敗、新しいプロセッサが失敗した場合、デバイスのドライバーをオペレーティング システムをサポートするプロセッサの最大数を処理するために、ドライバーの初期化中には、これらのデータ構造の十分なを割り当てます。 このような状況で、デバイス ドライバーがハードウェア パーティションに新しいプロセッサを追加すると、新しいデータ構造を割り当てる必要はありません。 ただし、これらのデータ構造のサイズが非常に小さくしない限り、これに、メモリ リソースを効率的に使用があります。 デバイス ドライバーが呼び出すことによって、オペレーティング システムをサポートするプロセッサの最大数を照会、 [ **KeQueryMaximumProcessorCount** ](https://msdn.microsoft.com/library/windows/hardware/ff553042)関数。

 

**重要な**  ハードウェア パーティションには、プロセッサを追加することが通知されたとき、デバイス ドライバーは、アクティブなプロセッサ数とプロセッサのアフィニティの保存された値を更新常にする必要があります。

 

**重要な**  デバイス ドライバーは、ハードウェア パーティション内のアクティブなプロセッサの数を決定するプロセッサのアフィニティ値のセットのビット数をカウントしない必要があります。 デバイス ドライバーを呼び出すことをお勧め、 **KeQueryActiveProcessorCount**この目的のための関数。 この関数は、アクティブなプロセッサの数と関連付けられているプロセッサのアフィニティ値の両方を返します。

 

**重要な**  Windows Vista、Windows Server 2008 および Windows の以降のバージョンが使用する必要がありますに組み込まれているデバイス ドライバー、 [ **KeNumberProcessors** ](https://msdn.microsoft.com/library/windows/hardware/ff552975)カーネル変数ハードウェア パーティション内のアクティブなプロセッサの数を確認します。 **KeNumberProcessors**カーネル変数は Windows Vista Service Pack 1 (SP1)、Windows Server 2008、および以降のバージョンの Windows で廃止されています。

 

 

 




