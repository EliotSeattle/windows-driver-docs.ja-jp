---
title: キャンセル ルーチンの概要
description: キャンセル ルーチンの概要
ms.assetid: 99f7f045-2b2f-4fb3-ac1c-99ab76fa46ad
keywords:
- Irp のキャンセルについて、Irp のキャンセル
- キャンセル ルーチンについてのキャンセル ルーチン
- 関連付けられている IRP
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 61d7998252a5806166a61ded20e1ee2e32f0497e
ms.sourcegitcommit: fb7d95c7a5d47860918cd3602efdd33b69dcf2da
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/25/2019
ms.locfileid: "67369766"
---
# <a name="introduction-to-cancel-routines"></a>キャンセル ルーチンの概要





すべてのドライバーを Irp に保持できる保留中の状態は不定値の間隔が 1 つまたは複数がある必要[*キャンセル*](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/wdm/nc-wdm-driver_cancel)ルーチン。 たとえば、キーボード ドライバーは、キーを押すユーザーの無期限に待機可能性があります。 逆に場合、ドライバーには、5 分で完了できるよりも多くの Irp キューことはありませんが、おそらく必要はありません、*キャンセル*ルーチン。

ユーザー モード スレッドは、最上位レベルのデバイス ドライバーのディスパッチ ルーチンによってキューには、I/O 要求を IRP がキューに置かれたときに、要求元のスレッドが終了したとします。 Irp が終了したに代わってキューに置かれたスレッドをキャンセルする必要があります。 その結果、ドライバーがドライバーによって提供されるを設定する必要があります*キャンセル*キューに登録する各の IRP で日常的な。

マスターの IRP が取り消されたときに、関連付けられている Irp を作成するドライバーでそれらを取り消す必要があります。 関連付けられている Irp が要求に関連付けられていないため、スレッド、マスターの IRP*キャンセル*ルーチンは、マスターの IRP がキャンセルされた場合に、Irp を関連付けられているキャンセルの責任です。

数*キャンセル*ルーチンの任意のドライバーがドライバーの設計によって異なります。 一般に、ドライバーが必要、*キャンセル*位置 IRP 保持されている保留中の状態で、無限の間隔の I/O 処理の各ステージのルーチンです。 保留中の Irp などがあると言われます*取り消しできる状態に保持されている*します。

次のデザイン ガイドラインを考慮してください。

-   複数層のドライバーのチェーンの最上位レベルのドライバーが少なくとも 1 つあります*キャンセル*ルーチン Irp のキューまたはそれ以外の場合、キャンセル可能な状態で Irp を保持している場合。 1 つ以上のことができます*キャンセル*ルーチンで必要な場合。

-   下位レベルのドライバーを Irp 保持できる取り消しできる状態に比較的長い間隔も指定することは 1 つまたは複数*キャンセル*ルーチン。

-   ドライバーは Irp の独自の内部キューを管理している場合、個別になります*キャンセル*キューの各ルーチン。

一部のキーボード、マウス、サウンド、parallel クラスなど、対話形式のデバイスの最上位レベルのドライバーとシリアル ドライバーは、必要があります*キャンセル*ルーチン。 一部の下位レベルのドライバーなど、比較的長い間隔は、いくつかの上位レベルのクラス ドライバーの Irp を保持するパラレル ポート ドライバーのキューにもする必要がありますが*キャンセル*ルーチン。

上層にある、中間のドライバーと大容量記憶装置デバイス ドライバーはされている可能性が*キャンセル*ルーチン。 Irp の入力中に下位レベルの大容量記憶装置ドライバーは通常、処理を完了してが早すぎるキャンセル可能にする、ファイル I/O 要求のキャンセルを処理するために、ファイル システム ドライバーの責任です。

 

 




