---
title: マルチプロセッサ セーフ
description: マルチプロセッサ セーフ
ms.assetid: 58c51f3e-98c4-4aa0-ad4d-cd9225f78141
keywords:
- マルチプロセッサの安全な WDK カーネル
- 対称マルチプロセッサ プラットフォーム WDK カーネル
- SMP の WDK カーネル
- スピン ロック WDK カーネル
- 同期の WDK カーネル、マルチプロセッサ セーフ
- 対称プラットフォーム WDK カーネル
- ロックの WDK カーネル
- デッドロック WDK カーネル
- クリティカル セクション ルーチン WDK カーネル
- 共有データの保護の WDK カーネル
- ディスパッチャー オブジェクト WDK カーネル、マルチプロセッサ セーフ
- カーネルのディスパッチャー オブジェクト WDK、マルチプロセッサ セーフ
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 8985ac00d69fcadda8a7b2fb05e57068d9061494
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56531764"
---
# <a name="multiprocessor-safe"></a>マルチプロセッサ セーフ





Microsoft Windows NT ベースのオペレーティング システムがユニプロセッサと対称マルチプロセッサ (SMP) プラットフォームで一様に分布を実行するように設計し、同様に実行するカーネル モード ドライバーを設計する必要があります。

Windows マルチプロセッサ プラットフォームで、次の条件が存在します。

-   すべての Cpu が同じであり、いずれかまたはすべてのプロセッサが同一のコプロセッサにいる必要があります。

-   すべての Cpu はメモリを共有し、メモリにアクセスを統一します。

-   *対称*プラットフォーム、すべての CPU は、メモリへのアクセス、割り込みを実行、および I/O 制御レジスタにアクセスします。 (これに対し、*非対称*マルチプロセッサのコンピューターでは、一連の下位の Cpu の割り込み CPU はすべて 1 つです)。

SMP のプラットフォームで安全に実行できるオペレーティング システムは 1 つのプロセッサで実行されるコードのアクセスし、別のプロセッサがアクセスと変更されるデータの変更は同時にではなくを保証する必要があります。 たとえば、最下位レベル ドライバーの ISR が 1 つのプロセッサ上のデバイスの割り込みを処理する場合は、場合に、そのデバイスが別のプロセッサで同時に割り込み、デバイスの登録または重要なドライバーの定義済みのデータへの排他アクセスが必要です。

さらに、ドライバーの I/O 操作は単一プロセッサのコンピューターでシリアル化には、SMP マシン重ねることができます。 受信の I/O 要求を処理するドライバーのルーチンは、デバイスと通信する他のルーチンを別のプロセッサで同時に実行しながら、1 つのプロセッサで実行できます。 カーネル モード ドライバーは、ユニプロセッサまたは対称マルチプロセッサ コンピューターで実行されて、かどうかは、ドライバーの定義済みのデータやドライバーのルーチンの間で共有され、物理的なアクセスを同期するシステム指定のリソースへのアクセスを同期する必要があります。存在する場合は、デバイス。

Windows NT カーネル コンポーネントと呼ばれる、同期メカニズムのエクスポート、[スピン ロック](spin-locks.md)ドライバーを使用して保護する共有データ (またはデバイスの登録) を実行している 1 つまたは複数のルーチンで同時にアクセス対称マルチプロセッサ プラットフォームで同時にです。 カーネルは、スピン ロックの使用に関する 2 つのポリシーを適用します。

-   1 つだけのルーチンは、特定の時点で特定のスピン ロックを保持できます。 共有データにアクセスする前にルーチンは、データを参照する必要があります、それぞれ最初のデータのスピン ロックの取得を試みる必要があります。 同じデータにアクセスする他のルーチンが、スピン ロックを取得する必要がありますが、現在の所有者は、それを解放するまで、スピン ロックを取得できません。

-   カーネルは、システムで、各スピン ロックを IRQL の値を割り当てます。 カーネル モードのルーチンは、スピン ロックの割り当てられた IRQL でルーチンを実行時にのみ、特定のスピン ロックを取得できます。

これらのポリシーは、下の IRQL で通常は実行されますが、現在から同じスピン ロックを取得しようとした優先順位の高いドライバー ルーチンによって割り込まれるスピン ロックを保持するドライバー ルーチンを禁止します。 そのため、デッドロックを回避できます。

スピン ロックに割り当てられている IRQL は、通常、スピン ロックを取得できる最も高い IRQL ルーチンのです。

たとえば、最下位レベル ドライバーの ISR がドライバーの DPC ルーチンと状態領域を共有する頻繁に。 DPC ルーチンを呼び出すドライバーによって提供される*クリティカル セクション*共有の領域にアクセスするルーチン。 スピン ロックで、共有の領域を保護するには、デバイスの割り込みを DIRQL と等しく、IRQL があります。 クリティカル セクションのルーチンでは、スピン ロックを保持しており、DIRQL にある共有の領域にアクセスする、ユニプロセッサまたは SMP マシンで ISR は実行できません。

-   デバイスの割り込みがマスクされるため、ISR を単一プロセッサのコンピューターで実行することはできません」の説明に従って[Preemptible 常に、常に中断](always-preemptible-and-always-interruptible.md)します。

-   SMP のマシンでは、ISR はクリティカル セクション ルーチンは、スピン ロックを保持し、DIRQL で共有データにアクセス中に、共有データを保護するスピン ロックを取得できません。

カーネル モードのスレッドのセットは、カーネルのディスパッチャー オブジェクトの 1 つを待機して共有データまたはリソースへのアクセスを同期することができます: イベント、ミュー テックス、セマフォ、タイマー、または別のスレッド。 ただし、ほとんどのドライバー設定しないでください、独自のスレッドをスレッド コンテキストの切り替えを回避するときにパフォーマンスが向上しているためです。 タイム クリティカルなカーネル モードのサポート ルーチンとドライバーが IRQL でどのように実行するたびにディスパッチを =\_共有のデータやリソースへのアクセスを同期する、カーネルのスピン ロックを使用する必要がありますレベル、または DIRQL、します。

詳細については、[スピン ロック](spin-locks.md)、[を管理するハードウェアの優先順位](managing-hardware-priorities.md)、および[カーネルのディスパッチャー オブジェクト](kernel-dispatcher-objects.md)を参照してください。

 

 




