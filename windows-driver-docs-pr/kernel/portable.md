---
title: 可能
description: 可能
ms.assetid: 3ce16503-e375-44c1-82a7-796286c1a253
keywords:
- ポータブルドライバー WDK カーネル
- プラットフォーム依存の定義 (WDK カーネル)
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 6a00b2d226a90845aa5e472f243e92f577048432
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72838503"
---
# <a name="portable"></a>可能





すべてのドライバーは、Windows でサポートされているすべてのハードウェアプラットフォームで移植可能である必要があります。 クロスプラットフォームの移植性を実現するために、ドライバーライターは次のことを行う必要があります。

-   C のコード (アセンブリ言語なし)。

-   WDK で提供されるプログラミングインターフェイスとヘッダーを使用するだけで、ウィンドウを操作できます。

### <a name="coding-drivers-in-c"></a>C でのドライバーのコーディング

すべてのカーネルモードドライバーは C で記述する必要があります。これにより、システムと互換性のある C コンパイラを使用して再コンパイルし、再リンクして、コードを書き直したり置き換えたりすることなく、さまざまな Microsoft Windows プラットフォームで実行できます。 ほとんどのオペレーティングシステムコンポーネントは、アセンブリ言語で記述されたわずかな HAL およびカーネルコンポーネントのみを使用して C で完全にコード化されているため、オペレーティングシステムはハードウェアプラットフォーム間で簡単に移植できます。 カーネルモードドライバーでC++は、多くの言語構成要素を使用できないため、このような構成体を使用して慎重に評価する必要があります。 ドライバーに機能が含まC++れている場合に発生する問題の詳細については、「 [ C++カーネルモードドライバー: 長所と短所](https://go.microsoft.com/fwlink/p/?linkid=56294)」ホワイトペーパーを参照してください。

ドライバーは、システムと互換性のある他のコンパイラでサポートされていると保証されていない場合に、特定のシステム互換の C コンパイラまたは C サポートライブラリの機能に依存しないようにする必要があります。 一般に、ドライバーコードは ANSI C 規格に準拠している必要があり、この標準が "実装定義" として記述している内容に依存しません。

ポータブルドライバーを作成するには、次のことを避けることをお勧めします。

-   1つのプラットフォームから別のプラットフォームへのサイズやレイアウトが異なる可能性があるデータ型の依存関係。

-   状態を維持する標準の C ランタイムライブラリ関数を呼び出します。

-   オペレーティングシステムが代替のサポートルーチンを提供する標準 C ランタイムライブラリ関数を呼び出します。

### <a name="using-wdk-supplied-interfaces"></a>WDK 提供のインターフェイスの使用

各 Windows NT executive コンポーネントは、ドライバーおよびその他のすべてのカーネルモードコンポーネントが呼び出すカーネルモード[ドライバーサポートルーチン](https://docs.microsoft.com/windows-hardware/drivers/ddi/index)のセットをエクスポートします。 サポートルーチンの基になる実装が時間の経過と共に変化する場合、その呼び出し元は、定義コンポーネントへのインターフェイスが変更されないため、移植可能な状態を維持します。

WDK は、ドライバー (および他のすべてのカーネルモードコンポーネント) がプラットフォーム間の移植性を維持するために使用する、システム固有のデータ型および定数を定義するヘッダーファイルのセットを提供します。 すべてのカーネルモードドライバーには、master WDK カーネルモードヘッダーファイル (Wdm または Ntddk) のいずれかが含まれています。 マスターヘッダーファイルは、基本的なカーネルモード型を定義するシステム提供のヘッダーだけでなく、対応するコンパイラディレクティブを使用してドライバーがコンパイルされるときにプロセッサアーキテクチャ固有のヘッダーからも適切に選択できるようにします。

[SCSI ミニポートドライバー](https://docs.microsoft.com/windows-hardware/drivers/storage/scsi-miniport-drivers)、 [NDIS ドライバー](https://docs.microsoft.com/previous-versions/windows/hardware/network/ff556938(v=vs.85))、[ビデオミニポートドライバー](https://docs.microsoft.com/windows-hardware/drivers/display/video-miniport-drivers-in-the-windows-2000-display-driver-model)など、一部のドライバーには、システムが提供する他のヘッダーファイルが含まれています。

ドライバーにプラットフォーム依存の定義が必要な場合は、各ドライバーが適切なハードウェアプラットフォーム用にコンパイルおよびリンクできるように、 **\#ifdef**ステートメント内でこれらの定義を分離することをお勧めします。 ただし、WDK マスターヘッダーファイルに用意されているサポートルーチン、マクロ、定数、および型を使用して、ドライバー内でプラットフォーム固有の条件付きコンパイルコードを実装することはほとんど常に避けることができます。

カーネルモードドライバーでは、WDK に記載されているカーネルモードの**Rtl * Xxx*** ルーチンを使用できます。 カーネルモードドライバーは、ユーザーモードの**Rtl * Xxx*** ルーチンを呼び出すことはできません。

 

 




