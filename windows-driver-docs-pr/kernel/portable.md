---
title: 移植性があります。
description: 移植性があります。
ms.assetid: 3ce16503-e375-44c1-82a7-796286c1a253
keywords:
- 移植可能なドライバー WDK カーネル
- プラットフォーム依存定義 WDK カーネル
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 6f7c351fbb84fd7d343666f502a63a6a3d2fd3d5
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56573269"
---
# <a name="portable"></a>移植性があります。





すべてのドライバーは、すべての Windows でサポートされているハードウェア プラットフォームでポータブルである必要があります。 クロス プラットフォームの移植性を実現するには、ドライバー作成者が必要です。

-   C (アセンブリ言語はありません) でコードします。

-   Windows プログラミング インターフェイスと WDK で提供されるヘッダーをのみを使用して操作します。

### <a name="coding-drivers-in-c"></a>C でのドライバーのコーディング

すべてのカーネル モード ドライバーは、システムと互換性のある C コンパイラで再コンパイル、再リンク、およびできますの書き換えや任意のコードを置換しなくてもさまざまな Microsoft Windows プラットフォームで実行されるように C で記述する必要があります。 ほとんどのオペレーティング システム コンポーネントは、少量のハードウェア プラットフォーム、オペレーティング システムが簡単に移植できるように、アセンブリ言語で記述された HAL およびカーネルのコンポーネントのみを C では、完全にコード化されました。 このようなコンストラクトを使用して慎重に評価する必要がありますので、カーネル モード ドライバーには、多くの C++ 言語構成要素を使用できません。 ドライバーは、C++ の機能を含めるときに発生する問題の詳細については、次を参照してください、[カーネル モード ドライバー用の C++:。長所と短所](https://go.microsoft.com/fwlink/p/?linkid=56294)ホワイト ペーパー。

これらの機能は、他のシステムと互換性のあるコンパイラでサポートされなければならないは保証されません場合、ドライバーは、特定のシステムと互換性のある C コンパイラまたは C++ サポート ライブラリの機能に依存しない必要があります。 一般に、ドライバーのコードを ANSI C 標準に準拠しているし、この標準は、「実装で定義されます」として説明するものに依存しない必要があります。

移植可能なドライバーを作成するには、回避することをお勧めします。

-   サイズまたは 1 つのプラットフォームから別のレイアウトによって異なることがデータ型に依存します。

-   関数を呼び出す任意標準 C ランタイム ライブラリ状態を保持します。

-   標準 C ランタイム ライブラリ関数、代替のサポート ルーチンを提供するオペレーティング システムを呼び出しています。

### <a name="using-wdk-supplied-interfaces"></a>WDK が指定したインターフェイスを使用します。

各 Windows NT executive コンポーネントは、カーネル モードのセットをエクスポート[ドライバー サポート ルーチン](https://msdn.microsoft.com/library/windows/hardware/ff544200)ドライバーおよびその他のすべてのカーネル モード コンポーネントを呼び出すことです。 時間の経過と共にサポート ルーチンの基になる実装が変更された場合、呼び出し元は、定義のコンポーネントへのインターフェイスは変更されないのでポータブルのままです。

WDK には、システムに固有のデータ型およびドライバー (およびその他のすべてのカーネル モード コンポーネント) を 1 つのプラットフォームから別の移植性を維持するために使用する定数を定義するヘッダー ファイルのセットが用意されています。 すべてのカーネル モード ドライバーには、マスター WDK カーネル モードのヘッダー ファイル、Wdm.h または Ntddk.h のいずれかが含まれます。 マスター ヘッダー ファイルは、基本的なカーネル モードの種類を定義するが、ドライバーが対応するコンパイラ ディレクティブを使用してコンパイルされるときにも、プロセッサ アーキテクチャ固有のヘッダーから選択を適切ないないのみシステム提供のヘッダーにプルします。

一部のドライバーなど[SCSI ミニポート ドライバー](https://msdn.microsoft.com/library/windows/hardware/ff565309)、 [NDIS ドライバー](https://msdn.microsoft.com/library/windows/hardware/ff556938)、および[ビデオのミニポート ドライバー](https://msdn.microsoft.com/library/windows/hardware/ff570509)、その他のシステム提供のヘッダー ファイルが含まれます。

ドライバーは、プラットフォームに依存する定義を必要とする場合は、内でそれらの定義を分離することをお **\#ifdef**ステートメントでは、各ドライバーをコンパイルして、適切なハードウェア プラットフォーム用にリンクできるようにします。 ただし、ほぼ常に回避できますサポート ルーチン、マクロ、定数、および WDK のマスター ヘッダー ファイルを提供する型を使用して、ドライバーでは、プラットフォーム固有の条件付きでコンパイルされたコードを実装します。

カーネル モード ドライバーはカーネル モードを使用して**Rtl * Xxx*** WDK で説明されているルーチン。 カーネル モード ドライバーは、ユーザー モードを呼び出すことはできません**Rtl * Xxx*** ルーチン。

 

 




