---
title: デバイスの名前空間アクセスの制御
description: デバイスの名前空間アクセスの制御
ms.assetid: e5312297-849f-4b4e-835d-0ce5295c7ce2
keywords:
- デバイスオブジェクト WDK カーネル、セキュリティ
- セキュリティ WDK デバイスオブジェクト
- デバイス名前空間へのアクセス WDK カーネル
- 名前空間 WDK デバイスオブジェクト
- ファイルオープン要求の WDK デバイスオブジェクト
- オープン要求 WDK デバイスオブジェクト
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 853039c1268c4456b2ef1eac6ce914651534276f
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72837047"
---
# <a name="controlling-device-namespace-access"></a>デバイスの名前空間アクセスの制御





Windows Driver Model (WDM) では、すべてのデバイスオブジェクトには、関連付けられた*名前空間*があります。 デバイスの名前空間の名前は、デバイス名で始まるパスです。 "\\*device*\\*devicename*" という名前のデバイスの名前空間は、"\\*デバイス*\\*DeviceName*\\*FileName*" という形式の名前で構成されます。 (ファイルシステムの場合、 *FileName*はファイルシステム上のファイルの実際の名前です)。

WDM ドライバーは、デバイスの名前空間にあるすべての名前に対して開いている要求を受け取ります。 ドライバーは、"\\*device*\\*DeviceName*" に対して開いている要求を、デバイスオブジェクト自体のオープンとして扱います。 ドライバーがデバイスの名前空間へのオープン要求のサポートを実装している場合、デバイスオブジェクトの名前空間内で "\\*デバイス*\\*DeviceName*\\*FileName*" のオープン要求を "ファイル" として扱います。(デバイスの "file" の概念がドライバーによって決定されます)。

ほとんどのドライバーは、デバイスの名前空間へのオープン操作のサポートを実装していませんが、デバイスの名前空間への不正アクセスを防ぐために、すべてのドライバーがセキュリティチェックを提供する必要があります。 既定では、デバイスの名前空間内のファイルオープン要求のセキュリティチェック (たとえば、"\\*device*\\*DeviceName*\\*FileName*") は完全にドライバーに残されます。デバイスオブジェクト ACL は、によってチェックされません。オペレーティングシステム。

デバイスオブジェクトのファイル\_デバイス\_セキュリティで保護された\_オープン特性が設定されている場合、デバイスの名前空間にあるすべてのファイルオープン要求にデバイスオブジェクトのセキュリティ記述子が適用されます。 ドライバーは、IoCreateDevice または[**Iocreate Ec**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdmsec/nf-wdmsec-wdmlibiocreatedevicesecure)を使用してデバイスオブジェクト[](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-iocreatedevice)を作成するときに、ファイル\_デバイス\_安全\_開くように設定できます。 WDM ドライバーの場合は、ファイル\_デバイス\_セキュリティで保護された\_をレジストリに設定することもできます。 また、 **Iocreateデバイス**で作成される非 WDM ドライバーのデバイスオブジェクトのレジストリに設定することもできます。 デバイスの特性などのデバイスオブジェクトのプロパティをレジストリに設定する方法の詳細については、「[レジストリでデバイスオブジェクトのプロパティを設定](setting-device-object-properties-in-the-registry.md)する」を参照してください。 デバイスの特性の詳細については、「[デバイスの特性の指定](specifying-device-characteristics.md)」を参照してください。

名前空間をサポートしていないデバイスのドライバーは、次の2つの方法のいずれかを使用して、デバイスの名前空間内のファイルを開く要求が正しく処理されるようにする必要があります。

-   ドライバーのデバイスオブジェクトには、ファイル\_デバイス\_安全\_開いているデバイスの特性セットがあります。 ドライバーは、デバイスオブジェクトのオープン要求として、開いている要求をデバイスの名前空間に処理できます。

-   ドライバーは、任意の[**IRP\_MJ**](https://docs.microsoft.com/windows-hardware/drivers/kernel/irp-mj-create)を失敗させることができます。これは、\_の長さが0以外である、 **Irpsp&gt;の FileObject-&gt;FileName**パラメーターを指定する要求を作成します。 この場合、デバイスのオープン要求はシステムの ACL チェックの対象になりますが、デバイスの名前空間内のすべてのファイルオープン要求はドライバーによって失敗します。 (排他的なオープンをサポートするドライバーは、このオプションを使用する必要があります)。

名前空間をサポートするデバイスのドライバーでは、次の2つの方法を使用して、ファイルオープン要求をデバイスの名前空間にセキュリティで保護することもできます。

-   ドライバーのデバイスオブジェクトには、ファイル\_デバイス\_安全\_開いているデバイスの特性セットがあります。 これにより、デバイスのセキュリティ設定がデバイスの名前空間に一様に適用されるようになります。 (ドライバーは、 [*DRIVER_DISPATCH*](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-driver_dispatch)コールバック関数に名前空間のサポートを実装する必要があります)。

-   ドライバーは、 *DispatchCreate*ルーチンでファイル名の acl をチェックします。 (この場合でも、ドライバーはデバイスの名前空間のセキュリティ設定がデバイスオブジェクトよりも弱い場合を除き、ファイル\_デバイス\_セキュリティで保護された\_オープン特性を設定する必要があります。

ファイル\_デバイス\_セキュリティで保護された\_オープン特性がスタックの一番上に表示されます。そのため、フィルタデバイスオブジェクトは、アタッチ後、次に小さいデバイスオブジェクトの**特性**メンバーをコピーする必要があります。

 

 




