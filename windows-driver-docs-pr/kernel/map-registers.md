---
title: レジスターのマッピング
description: レジスターのマッピング
ms.assetid: 0404f487-7a4f-43be-bbe0-b7da2087b8aa
keywords:
- メモリ管理の WDK カーネル、レジスタのマップ
- マップは、WDK のカーネルを登録します。
- 仮想アドレス空間のマッピングの WDK カーネル
- 論理アドレス空間のマッピングの WDK カーネル
- 物理アドレス空間のマッピングの WDK カーネル
- マッピングのメモリ
- アドレス空間のマッピングの WDK カーネル
- スキャッター/ギャザー機能 WDK カーネル
- アドレス空間の WDK カーネルを翻訳します。
- メモリ管理 WDK カーネルは、アドレスのマッピング
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 3a1495e62568731b0ea889775431531942ba1fc0
ms.sourcegitcommit: d17b4c61af620694ffa1c70a2dc9d308fd7e5b2e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/22/2019
ms.locfileid: "59903442"
---
# <a name="map-registers"></a>レジスターのマッピング





DMA を実行するドライバーは、次の図に示すように、次の 3 つの異なるアドレス空間を使用します。

![物理、論理、および仮想のアドレスへのマッピング](images/3addrspc.png)

任意の Windows プラットフォームでは、ドライバーは、アクセスをプロセッサでサポートされている完全な仮想アドレス空間を持ちます。 32 ビット プロセッサでは、仮想アドレス空間は、4 ギガバイトを表します。 CPU では、ページのテーブルを使用して、システムの物理アドレス空間のアドレスを仮想アドレス空間のアドレスを変換します。 各ページ テーブル エントリ (PTE) は、必要な場合に、ページング操作の結果として、物理メモリのページに仮想メモリの 1 つのページをマップします。 MDL (メモリ記述子のリスト) は、ドライバーの DMA 操作に関連付けられているバッファーのようなマッピングを提供します。

デバイスは、システムの完全な仮想アドレス空間にアクセスする機能によって異なります。 デバイスは、論理 (デバイス) のアドレス空間のアドレスを使用します。 各 HAL を使用して*レジスタにマップ*デバイスまたは論理アドレスから物理アドレス (物理 RAM 内の位置) を変換します。 マップ レジスタでは、デバイスのハードウェアの実行、同じ関数 MDL (およびページ テーブル) のソフトウェア (ドライバー) を実行します。 物理メモリをアドレスに変換します。

ドライバーが物理メモリ内の場所のアドレスを仮想アドレス空間でポインターを使用できませんので、これらのアドレス空間は個別にアドレス指定、またはその逆です。 ドライバー最初に仮想のアドレスを物理アドレスを平行移動する必要があります。 同様に、デバイスは論理アドレスを使用して、物理メモリに直接アクセスすることはできません。 デバイスでは、アドレスを変換する必要があります最初。

HAL は、DMA デバイスと異なるコンピューター上の I/O バスさまざまな DMA をサポートするアダプター オブジェクトを設定する必要があります。 たとえば、ISA DMA のほとんどのコント ローラー、下位のデバイス、およびバス マスター デバイス 4 ギガバイトの完全なシステムの物理アドレス空間の 32 ビット プロセッサ (または x86 の 64 ギガバイト システムの物理アドレスにアクセスするアドレスが不足している回線があります。プロセッサの 36 ビット PAE モードで実行されている)。 これに対し、PCI DMA デバイスでは、一般に 32 ビット プロセッサで完全なシステムの物理アドレス空間にアクセスするための十分な複数の住所があります。 そのため、すべての HAL はの間のマッピングを提供します。、*論理アドレス*DMA デバイスにアクセスできる範囲と*物理アドレス*の各コンピューターの範囲。

各アダプター オブジェクトは、転送されるデータの量と使用可能なメモリの量に応じて、1 つまたは複数のマップ レジスタに関連付けられます。 DMA の転送中には、HAL は、CPU でデバイスからアクセス可能な物理メモリのページを論理ページ エイリアスには、各マップ レジスタを使用します。 実際には、マップのレジスタは、スキャッター/ギャザーの機能を自分のデバイスがあるかどうかに関係なく、DMA を使用するドライバーのスキャッター/ギャザーのサポートを提供します。

### <a href="" id="address-mapping-for-a-sample-isa-dma-device"></a>

次の図は、スキャッター/ギャザー機能がない ISA DMA デバイスのドライバーのような物理-論理アドレスのマッピングを示します。

![サンプルの isa dma デバイスのアドレスのマッピング](images/3dmapreg.png)

前の図は、次の種類のマッピングを示しています。

1.  各マップ レジスタは、ISA DMA デバイスの論理アドレス (点線) 下位 (実線によって示される) の物理アドレスの範囲をマップします。

    ここでは、次の 3 つのマップのレジスタは、デバイスの ISA DMA エイリアスの論理アドレスの下位の 3 つのページ サイズの範囲を物理メモリをシステム内のデータの 3 つのページ範囲に使用されます。

2.  ISA デバイスは、DMA 操作中にシステム メモリへのアクセスにマップされている論理アドレスを使用します。

    比較可能な PCI DMA デバイスの場合は 3 つのマップのレジスタはデータの 3 つのページ サイズの範囲にも使用されます。 ただし、割り当て済みの論理アドレスの範囲は必ずしも対応の物理アドレス範囲と同じだため PCI デバイスでは論理アドレスをシステム メモリへのアクセスにも使用が。

3.  MDL 内の各エントリでは、仮想アドレス空間内の場所を物理アドレスにマッピングされます。

マップの登録と MDL 内の仮想物理エントリ間の通信に注意してください。

-   各マップ レジスタと各仮想 MDL エントリ DMA の転送操作のデータの完全な物理ページがマップ多くて。

-   各マップ レジスタと MDL の各仮想エントリは、データの完全なページよりも小さいマップ可能性があります。 たとえば、MDL の初期仮想エントリにマップできます、オフセット、物理的なページ境界からで前述したように、[物理、論理、および仮想のアドレス マッピング](#physical-logical-and-virtual-address-mappings)図。

-   各マップ レジスタと各仮想 MDL エントリは、最小値、1 バイトにマップします。

IRP の要求を読み取りまたは書き込み操作でのドライバーを不透明な MDL の各仮想エントリ**Irp -&gt;MdlAddress**ユーザー バッファーのシステムの物理メモリ内でページの境界を表します。 同様に、1 つの DMA 転送に必要な各追加のマップのレジスタは、システムの物理メモリにデバイスからアクセス可能な論理アドレスの範囲のエイリアスでページの境界を表します。

すべての Windows プラットフォームでは、各アダプター オブジェクトは、プラットフォーム固有 (および不透明な-ドライバーに) のベース アドレスにある 1 つまたは複数のマップ レジスタの関連付けのセットを持ちます。 ドライバーの観点から、マップに登録図の説明に示すようにベース[サンプル ISA DMA のデバイスのアドレスのマッピング](#address-mapping-for-a-sample-isa-dma-device)は一連のシステム DMA コント ローラーで、チップでのハードウェア レジスタ可能性があるマップ レジスタのハンドルですまたは、バス マスター アダプターまたは仮想のレジスタをシステム メモリ内で HAL 作成がある場合もあります。

さまざまなデバイスと Windows プラットフォーム、アダプター オブジェクトで使用可能なマップ レジスタの数は異なります。 HAL の詳細ことなど、さまざまな Windows プラットフォーム上の DMA コント ローラーがある機能が異なるために、他のプラットフォームでよりも一部のプラットフォームでシステム DMA を使用するドライバーを使用可能なレジスタにマップします。

 

 




