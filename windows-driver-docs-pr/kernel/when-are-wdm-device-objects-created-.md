---
title: WDM デバイスオブジェクトが作成された日時
description: WDM デバイスオブジェクトが作成された日時
ms.assetid: aeb8039d-2e5d-4700-a9e5-e5ee97c6b0b1
keywords:
- デバイスオブジェクト WDK カーネル (作成時)
- 階層化デバイスオブジェクト WDK カーネル
- 機能デバイスオブジェクト WDK カーネル
- FDO WDK カーネル
- 物理デバイスオブジェクト WDK カーネル
- PDOs WDK カーネル
- DOs WDK カーネルをフィルター処理する
- デバイススタック WDK カーネル、デバイスオブジェクトレイヤー可能
- デバイスオブジェクトのアタッチ
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 8da33503923d0bde09dcb220b128b0a0cdd2e903
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72835752"
---
# <a name="when-are-wdm-device-objects-created"></a>WDM デバイス オブジェクトが作成される場合





このセクションでは、各デバイスオブジェクトの種類と、各オブジェクトが作成されるタイミングについて説明します。

デバイススタックにアタッチできるデバイスオブジェクトの種類を次の図に示します。デバイスの i/o 要求を処理するドライバーを表します。

![デバイスで使用可能なデバイスオブジェクトレイヤーを示す図](images/objlyr.png)

次の図の下部から開始します。

-   バスドライバーは、バス上で列挙される各デバイス用に PDO を作成します。

    バスドライバーは、デバイスを列挙するときに、子デバイス用の PDO を作成します。 バスドライバーは、IRP\_に応答してデバイスを列挙し、PnP マネージャーからの**Busrelations**に対する[ **\_クエリ\_デバイス\_関係**](https://docs.microsoft.com/windows-hardware/drivers/kernel/irp-mn-query-device-relations)要求を実行します。 バスドライバーは、 **Busrelations**に対するクエリ関係要求に最後に応答した時点以降にデバイスがバスに追加されている場合、子デバイス用の PDO を作成します (または、これがコンピューターの起動後の最初のクエリの関係要求である場合)。

    PDO は、バスドライバーへのデバイス、およびその他のカーネルモードシステムコンポーネント (電源マネージャー、PnP マネージャー、i/o マネージャーなど) を表します。

    デバイスのその他のドライバーは、PDO 上にデバイスオブジェクトを接続しますが、PDO は常にデバイススタックの一番下にあります。

-   オプションのバスフィルタードライバーは、フィルター処理する各デバイスのフィルター DOs を作成します。

    PnP マネージャーは、 **Busrelations**リストで新しいデバイスを検出すると、そのデバイスのバスフィルタードライバーがあるかどうかを判断します。 その場合、このようなドライバーごとに、PnP マネージャーによってドライバーが読み込まれることが保証され (必要に応じて[**Driverentry**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-driver_initialize)を呼び出し)、ドライバーの[*AddDevice*](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-driver_add_device)ルーチンを呼び出します。 バスフィルタードライバーがこのデバイスの操作をフィルター処理する場合、フィルタードライバーはデバイスオブジェクトを作成し、そのオブジェクトを*AddDevice*ルーチンのデバイススタックにアタッチします。 複数のバスフィルタードライバーが存在し、このデバイスに関連する場合、各フィルタードライバーは独自のデバイスオブジェクトを作成し、接続します。

-   省略可能で、下位レベルのフィルタードライバーは、フィルター処理する各デバイスに対してフィルター DOs を作成します。

    このデバイス用にオプションの下位レベルのフィルタードライバーが存在する場合、PnP マネージャーによって、バスドライバーおよびバスフィルタードライバーの後に、このようなドライバーが確実に読み込まれます。 PnP マネージャーは、フィルタードライバーの*AddDevice*ルーチンを呼び出します。 *AddDevice*ルーチンでは、下位レベルのフィルタードライバーによってデバイス用のフィルターが作成され、デバイススタックにアタッチされます。 下位レベルのフィルタードライバーが複数存在する場合、各ドライバーは独自のフィルターを作成してアタッチします。

-   関数ドライバーは、デバイスの FDO を作成します。

    PnP マネージャーによって、デバイスの関数ドライバーが読み込まれ、関数ドライバーの*AddDevice*ルーチンが呼び出されます。 関数ドライバーによって FDO が作成され、デバイススタックにアタッチされます。

-   (省略可能) 上位レベルのフィルタードライバーは、フィルター処理するデバイスごとにフィルターを作成します。

    デバイス用にオプションの上位レベルのフィルタードライバーが存在する場合は、PnP マネージャーによって、それらのドライバーが関数ドライバーの後に読み込まれ、 *AddDevice*ルーチンが呼び出されます。 このようなフィルタードライバーはそれぞれ、デバイスオブジェクトをデバイススタックに接続します。

要約すると、デバイススタックには、特定のデバイスへの i/o 処理に関連する各ドライバーのデバイスオブジェクトが含まれます。 親バスドライバーには PDO があり、関数ドライバーには FDO があり、オプションのフィルタードライバーにはフィルターがあります。

すべてのデバイス、バスアダプター/コントローラーデバイス、および非バスデバイスには、PDO と FDO がデバイススタックにあることに注意してください。 バスアダプター/コントローラー用の PDO は、親バスのバスドライバーによって作成されます。 たとえば、SCSI アダプターが PCI バスに接続されている場合、PCI バスドライバーは SCSI アダプター用の PDO を作成します。

デバイスが raw モードで使用されている場合は、関数またはフィルタードライバーがありません (FDO またはフィルター DOs なし)。 親バスドライバー用の PDO だけでなく、0個以上のバスフィルター DOs もあります。

デバイスオブジェクトの作成とアタッチを行うドライバールーチンの詳細については[、「デバイスオブジェクトの作成](creating-a-device-object.md)」を参照してください。

デバイススタックといくつかの追加情報は、デバイスの*devnode*を構成します。 PnP マネージャーは、デバイスが起動されているかどうか、デバイスの変更を通知するために登録されているドライバーなど、デバイスの devnode に情報を保持します。 カーネルデバッガーのコマンド **! devnode**には、devnode に関する情報が表示されます。

 

 




