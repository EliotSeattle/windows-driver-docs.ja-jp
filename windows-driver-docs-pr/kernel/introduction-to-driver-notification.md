---
title: ドライバー通知の概要
description: ドライバー通知の概要
ms.assetid: c0c09480-628a-4f12-b6a3-881cc3e12fd5
keywords:
- ドライバー WDK 動的ハードウェア パーティション分割、同期の通知
- ドライバー WDK 動的ハードウェア パーティション分割、非同期の通知
- ドライバー通知 WDK の動的なハードウェアがパーティション分割、メモリ通知
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 55f0bd81829a2bf2d5fdc2f3f131a50aa7015fad
ms.sourcegitcommit: 0cc5051945559a242d941a6f2799d161d8eba2a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "63341028"
---
# <a name="introduction-to-driver-notification"></a>ドライバー通知の概要

プロセッサやメモリ モジュールは、デバイス ドライバーがハードウェアのパーティションに動的に追加以降 Windows Server 2008 では、オペレーティング システムに通知できます。 ホットのプロセスのさまざまな段階で発生するいくつかの異なる通知の追加操作があります。 これらの通知のそれぞれは、異なる通知メソッドを使用して、イベントに関するデバイス ドライバーに通知します。 1 つを使用することができます。 または複数のオペレーティング システムがホット追加操作と、ドライバーに通知する通知方法に発生します。 ドライバーは、安全で最適な操作に必要な応答できます。

次の表は、さまざまな通知方法およびプロセッサ、メモリ、両方のプロセッサおよびメモリに適用されるかどうかを識別します。

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th>通知方法</th>
<th>プロセッサの場合</th>
<th>メモリ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>ドライバーの同期の通知</p></td>
<td><p>x</p></td>
<td></td>
</tr>
<tr class="even">
<td><p>ドライバーの非同期通知</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
</tr>
<tr class="odd">
<td><p>Notification イベントのメモリ</p></td>
<td></td>
<td><p>x</p></td>
</tr>
<tr class="even">
<td><p>リソースの再調整</p></td>
<td><p>x</p></td>
<td></td>
</tr>
</tbody>
</table>

## <a name="synchronous-driver-notification"></a>同期ドライバー通知

[ドライバーの同期の通知](synchronous-driver-notification.md)、オペレーティング システムに同期的に通知デバイス ドライバー、新しいプロセッサがハードウェアのパーティションに追加されたことです。 これは、最初のデバイス ドライバーを受け取るプロセッサの数の変更に関する通知です。

新しいプロセッサがハードウェアのパーティションに追加されると、オペレーティング システムは、オペレーティング システムには、新しいプロセッサが開始した後は、オペレーティング システムは、プロセッサのスレッドのスケジューリングを開始する前に、デバイス ドライバーをこの通知を送信します。 デバイス ドライバーは、この通知を受信すると、プロセッサごとのデータ構造体を割り当てるおよびプロセッサ リソースごとの他の新しいプロセッサを割り当てることがことができます。 これがそのディスパッチ ルーチンの実行、割り込みサービス ルーチン (Isr) にデバイス ドライバーを準備、遅延プロシージャ呼び出し (Dpc) およびその他のすべてのドライバーが、新しいプロセッサにスレッドします。

デバイス ドライバーは、ドライバーの同期の通知を受信するオペレーティング システムを自体を登録する必要があります。 詳細については、次を参照してください。[ドライバーの同期の通知を登録する](registering-for-synchronous-driver-notification.md)します。

この通知方法は、プロセッサに該当するのみです。 メモリの同期の通知メカニズムはありません。

## <a name="asynchronous-driver-notification"></a>非同期ドライバー通知

[非同期ドライバー通知](asynchronous-driver-notification.md)、オペレーティング システムに非同期に通知デバイス ドライバー、ハードウェアのパーティションに新しいプロセッサやメモリのモジュールが追加されたことです。 Windows Server 2008 以降では、プロセッサおよびメモリ モジュールは、プラグ アンド プレイ (PnP) デバイスが考慮されます。 そのため、オペレーティング システムでは、ドライバーが非同期通知の PnP 通知メカニズムを使用します。

ハードウェア パーティションに、新しいプロセッサやメモリのモジュールが追加されると、オペレーティング システムは、オペレーティング システムは、新しいプロセッサやメモリ デバイスが開始した後、デバイス ドライバーをこの通知を送信します。 、、の新しいプロセッサの場合、オペレーティング システムはこの通知を送信までのデバイス ドライバーを新しいプロセッサのスレッドのスケジュールが開始後します。

> [!NOTE]
> すべての PnP 通知は非同期です。 そのため、これらの通知可能性がありますで受信されないまでデバイス ドライバー、オペレーティング システムには、プロセッサやメモリのモジュールが開始した後にいずれかの時点。

デバイス ドライバーは、この通知を受信すると、次の項目の一部またはすべて必要に応じて調整できます。

- メモリ バッファーとその他のリソースの割り当て

- 特定のプロセッサ リソースの割り当て

- Dpc と特定のプロセッサの他のスレッドのスケジュール設定

- 負荷分散アルゴリズム

> [!IMPORTANT]
> ハードウェア パーティションに新しいプロセッサを追加すると、オペレーティング システム メッセージが送信される、PnP まで新しいプロセッサが起動し、オペレーティング システムのスレッド上のスケジュールが開始された後にします。 場合は、オペレーティング システムが割り当てるなど、新しいプロセッサのスレッドのスケジューリングを開始する前に、デバイス ドライバーが特定のタスクを実行する必要があります、プロセッサのデータ構造体ごと、ドライバーの同期の通知方法を使用する必要があります。

デバイス ドライバーは、ドライバーが非同期通知を受信するオペレーティング システムを自体を登録する必要があります。 詳細については、次を参照してください。[ドライバーの非同期の通知を登録する](registering-for-asynchronous-driver-notification.md)します。

## <a name="memory-notification-event"></a>Notification イベントのメモリ

メモリ通知のイベント メソッドを使用して、オペレーティング システムを設定するを待機するスレッドのスケジュールを設定するには、デバイス ドライバーを設定することが、  **\\KernelObjects\\HighMemoryCondition**イベント オブジェクト。 オペレーティング システムは、空き物理メモリの量が特定の値を超えたときに、このイベント オブジェクトを設定します。 このイベントは、すべてのスレッドが、イベントを待機しているオブジェクトが大量の物理メモリがシステムで現在使用できることを通知します。 このイベントは、システムに動的に新しいメモリ モジュールを追加したことを示す可能性があります。 オペレーティング システムでは、このイベント オブジェクトを設定、デバイス ドライバーは、追加のメモリ バッファーを割り当てることによって、イベントに応答できます。

詳細については、  **\\KernelObjects\\HighMemoryCondition**イベント オブジェクトを参照してください[標準イベント オブジェクト](standard-event-objects.md)します。

> [!IMPORTANT]
> オペレーティング システムが設定されている場合、  **\\KernelObjects\\HighMemoryCondition**イベント オブジェクトを提供する可能性がありますに動的に追加した新しいメモリ モジュール ハードウェアを示す値だけで、イベントパーティション。 このイベント オブジェクトを設定するオペレーティング システムを引き起こす可能性のあるその他の状況があります。 そのため、以降 Windows Server 2008 では、お勧めしませんデバイス ドライバーは、この通知方法を使用します。 代わりに、デバイス ドライバーは、非同期のドライバーの通知方法を使用する必要があります。

このメソッドは、メモリに適用されるだけです。 プロセッサの対応する通知メカニズムはありません。

## <a name="resource-rebalance"></a>リソースのバランス調整

以降、Windows Server 2008 では、ハードウェアのパーティションに新しいプロセッサを追加すると、オペレーティング システムは、システム全体のリソースのバランス調整を開始します。 設定によって決まりますが、デバイスはこのようなリソースのバランス調整に参加するかどうか、 [ **DEVPKEY\_デバイス\_DHP\_を再調整\_ポリシー** ](https://msdn.microsoft.com/library/windows/hardware/ff542423)デバイスのデバイス プロパティ。 ネットワーク アダプターでのデバイスの既定の動作 (クラス = Net)[デバイス セットアップ クラス](https://msdn.microsoft.com/library/windows/hardware/ff541509)システムに追加リソースの新しいプロセッサが動的に再調整は参加しません。 その他のすべてのデバイス セットアップ クラス内のデバイスの既定の動作は、リソースの新しいプロセッサがシステムに動的に追加されたときに再調整に参加することです。

オペレーティング システムが送信する場合は、デバイスは、プラグ アンド プレイ (PnP) デバイスと、このようなリソースのバランス調整に含まれている、 [ **IRP\_MN\_クエリ\_停止\_デバイス**](https://msdn.microsoft.com/library/windows/hardware/ff551725)、 [ **IRP\_MN\_停止\_デバイス**](https://msdn.microsoft.com/library/windows/hardware/ff551755)、および[ **IRP\_MN\_開始\_デバイス**](https://msdn.microsoft.com/library/windows/hardware/ff551749) PnP Irp のリソースの操作を再調整中にデバイス ドライバーにします。 これらの PnP 要求は、ドライバー、ハードウェアのパーティションでハードウェアの変更が発生したことを通知します。 デバイス ドライバーは、リソースを適切に処理を再調整をサポートする必要があります、 **IRP\_MN\_クエリ\_停止\_デバイス**と**IRP\_MN\_停止\_デバイス**PnP 要求。 デバイス ドライバーを拒否すべきことはありません、 **IRP\_MN\_クエリ\_停止\_デバイス**PnP 要求。

これらの PnP 要求は、新しいプロセッサを追加した後は、ハードウェア パーティションでアクティブなプロセッサの新しいセットを完全に使用するためのデバイス ドライバーを有効にします。 具体的には、リソースの再調整をサポートしているデバイス ドライバーは、割り込みサービス ルーチン (Isr) を切断し、更新されたプロセッサのアフィニティ値に再接続してリソースのバランス調整中に受信する PnP の要求を使用します。 これにより、割り込み要求を処理するため、すべての新しいプロセッサを含むハードウェア パーティションで現在アクティブなすべてのプロセッサを使用するデバイス ドライバーができます。

リソースの再調整中にすべての I/O 要求のキューにデバイス ドライバーをする必要があります。

リソースの再調整の詳細については、次を参照してください。[再調整するリソースへのデバイスを停止する](stopping-a-device-to-rebalance-resources.md)します。

このメソッドは、プロセッサに該当するだけです。 オペレーティング システムでは、ハードウェアのパーティションを新しいメモリ モジュールを追加すると、システム全体のリソースの再調整は開始しません。
