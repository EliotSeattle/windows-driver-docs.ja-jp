---
title: コードとデータをページング可能にする必要がある場合
description: コードとデータをページング可能にする必要がある場合
ms.assetid: 2804f558-8c8c-43f4-b14e-8deaac9da286
keywords:
- メモリ管理 WDK カーネル、ページング可能ドライバー
- ページング可能ドライバー WDK カーネル、ページング可能にする必要がある場合
- ロックされたオンデマンドコード WDK カーネル
- スピンロック WDK メモリ
- 常駐コード WDK のページング可能ドライバー
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: fa8110999947455f4a2c6e2967cec4c9330eb3e3
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72838319"
---
# <a name="when-should-code-and-data-be-pageable"></a>コードとデータをページング可能にすべき場合





ドライバーのすべてまたは一部をページング可能にすることができます。 ドライバーコードのページングによって、ドライバーの読み込みイメージのサイズが縮小され、他の用途のためにシステム領域が解放されます。 これは、モデムや CD-ROM などの散発的に使用されるデバイスのドライバーや、ほとんど呼び出されないドライバーの一部で最も実用的です。

次のいずれかを行うドライバーコードは、メモリ常駐型である必要があります。 つまり、このコードは、ページ分割されていないセクション、またはコードの実行時にメモリ内でロックされているページ分割されたセクションのいずれかである必要があります。

-   IRQL = ディスパッチ\_レベル以上で実行されます。

-   スピンロックを取得します。

-   *Wait*パラメーターが**TRUE**に設定されている、カーネルのオブジェクトサポートルーチン ( [**KeReleaseMutex**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-kereleasemutex)や[**KeReleaseSemaphore**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-kereleasesemaphore)など) のいずれかを呼び出します。 *Wait*を**TRUE**に設定してカーネルが呼び出された場合、呼び出しはディスパッチ\_レベルで IRQL を返します。

コードがページフォールトの原因となる可能性のあるものを実行する場合は、ドライバーコードが IRQL &lt; ディスパッチ\_レベルで実行されている必要があります。 次のいずれかを実行すると、コードによってページフォールトが発生する可能性があります。

-   メモリ内でロックされていないページプールにアクセスします。

-   ページング可能なルーチンを呼び出します。

-   ユーザースレッドのコンテキストでロック解除されたユーザーバッファーにアクセスします。

通常は、ページング可能なすべてのコード (またはデータ) の合計量が 4 kb 以上である場合は、セクションをページ分割する必要があります。 可能な限り、純粋にページング可能なコード (またはデータ) をコード (またはデータ) から独立したセクションに分離する必要があります。このセクションは、ページングが可能であっても、ロックされることが必要になる場合があります。 たとえば、純粋にページング可能なコードと、ロックされたオンデマンドコードを組み合わせると、必要以上に多くのシステム領域が組み合わされます。 ただし、ドライバーがページング可能なコード (またはデータ) が 4 KB 未満の場合は、そのコード (またはデータ) を1つのセクションにまとめて、システム領域を節約することができます。

 

 




