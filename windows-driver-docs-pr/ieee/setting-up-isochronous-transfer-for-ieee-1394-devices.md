---
title: IEEE 1394 デバイスの等時性転送の設定
description: IEEE 1394 デバイスの等時性転送の設定
ms.assetid: 5161da54-0f20-496c-bf64-dc756b987de2
keywords:
- アイソクロナス i/o WDK IEEE 1394 bus、セットアップ
- バスサイクル WDK IEEE 1394 バス
- アイソクロナスチャネル WDK IEEE 1394 バス
- リソースが WDK IEEE 1394 バスを処理する
- バッファー WDK IEEE 1394 バス
- WDK IEEE 1394 バスの高速化
- 帯域幅の割り当て
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: a41644e5f7c124b459100f2995461e36b701ed74
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72841522"
---
# <a name="setting-up-isochronous-transfer-for-ieee-1394-devices"></a>IEEE 1394 デバイスの等時性転送の設定


ドライバーがデバイスを起動する前に、次の手順に従う必要があります。

### <a href="" id="step-1---choose-the-transfer-speed-"></a>手順 1. 転送速度を選択します。

IEEE 1394 バスでは、ハードウェアの機能によって制限された複数の異なる速度をサポートできます。 特定のデバイスが特定の速度をサポートしている場合でも、低速であることのみをサポートする別のデバイスに接続されている可能性があります。 ドライバーは、デバイスとコンピューターの間の転送速度を実行時に決定する必要があります。 これらは、バスドライバーに要求を使用してクエリを実行し、バス上の2つのデバイス、またはデバイスとホストコンピューターの間で可能な最大速度を決定するために、 [ **\_デバイス間の\_速度\_\_** ](https://msdn.microsoft.com/library/windows/hardware/ff537645)します。

### <a href="" id="step-2---allocate-bandwidth-"></a>手順 2. 帯域幅を割り当てます。

アイソクロナスデータ転送を実行する前に、ドライバーがバス上の帯域幅を予約する必要があります。 バスは、固定量に達するまで割り当てられた帯域幅の量を追跡します (IEEEE 1394-1995 仕様によれば、送信できる最大帯域幅は、1つの*バスサイクル*の80% です。これは125ナノ秒)。その後、現在割り当てられている帯域幅の一部が解放されるまで、他のデバイスが帯域幅を取得することは許可されません。 ドライバーは、帯域幅を予約するためにバスドライバーに[ **\_帯域幅の要求を割り当てる\_、要求を ISOCH\_** ](https://msdn.microsoft.com/library/windows/hardware/ff537647)送信します。

要求が成功した場合、バスドライバーは帯域幅ハンドルを返します。 ドライバーは、バスドライバーへの今後の帯域幅関連の要求でこのハンドルを使用します。 たとえば、ドライバーは、要求\_ISOCH を使用して、ハンドルに[ **\_チャネル\_帯域幅を設定**](https://msdn.microsoft.com/library/windows/hardware/ff537658)し、割り当てられる帯域幅の量を調整\_ことができます。 割り当てられた帯域幅でドライバーが終了したら、バス上の他のデバイスで使用できるように、帯域幅を解放するために、[**要求\_ISOCH\_free\_帯域**](https://msdn.microsoft.com/library/windows/hardware/ff537652)幅を使用する必要があります。

要求が失敗した場合、ドライバーはデータ転送を行わないようにする必要があります。 帯域幅の割り当てに失敗したドライバーは、後続の試行で割り当てられる可能性があるため、必要に応じて後で帯域幅の割り当てを試みることができる状態にする必要があります。 バスのリセット後に帯域幅の割り当てが成功する可能性が高いのは、以前に割り当てられたすべての帯域幅とチャネルがバスリセット後に自動的に解放されるためです。

帯域幅の割り当てに成功したドライバーは、前述の理由により、バスのリセット後に帯域幅とチャネルを再割り当てする必要があります。 さらに、リセット後、帯域幅ハンドルが古くなり、帯域幅が IRB\_フラグを使用して割り当てられている場合を除き、帯域幅が\_解放されて[ **\_\_ISOCH を要求**](https://msdn.microsoft.com/library/windows/hardware/ff537652)する呼び出しによって解放する必要があり\_8_ 無料フラグを設定します。

### <a href="" id="step-3---allocate-a-channel-"></a>手順 3. チャネルを割り当てます。

帯域幅割り当て要求が成功すると、ドライバーはデータの書き込みに使用する*アイソクロナスチャネル*を要求します。 複数のデバイスが1つのアイソクロナスチャネルでパケットを読み取ることはできますが、チャネルに書き込むことができるのは1つのデバイスだけです。 アイソクロナスパケットを受信するデバイスは、返される受信確認パケットを送信しません。

ドライバーは、要求を送信することによってチャネルを要求[ **\_ISOCH\_** ](https://msdn.microsoft.com/library/windows/hardware/ff537648)バスドライバーに\_チャネル要求を割り当てます。 ドライバーは、特定のチャネルまたは ISOCH\_任意の\_チャネルに要求して、任意の無料チャネルを割り当てることができます。 成功した場合、バスドライバーは割り当てられたチャネルを返します。 バスドライバーがエラーコードを返す場合、ドライバーはデータ転送を試行せず、手順 2. で割り当てた帯域幅の割り当てを解除する必要があります。

チャネルは現在使用できないため、使用できなくなるため、ドライバーでは想定しないでください。 チャネルはいつでも解放される可能性があるため、必要に応じて後でチャネルの割り当てを試みることができる状態になることがあります。

### <a href="" id="step-4---allocate-a-resource-handle-"></a>手順 4. リソースハンドルを割り当てます。

ドライバーは、チャネルを割り当てると、そのチャネルのリソースハンドルを割り当てます。 後続のすべての手順で、ドライバーはリソースハンドルを使用してチャネルを指定します。

ドライバーは、要求を送信することによってチャネルのリソースハンドルを割り当て[ **\_ISOCH\_** ](https://msdn.microsoft.com/library/windows/hardware/ff537649)バスドライバーに\_リソース要求を割り当てます。

ドライバーは、リソースハンドルを割り当てるときに、ハンドルにアタッチされたバッファーの使用方法を示すフラグも指定します。

-   ドライバーがチャネルを使用してデバイスからデータを読み取る場合 ([**要求\_ISOCH\_リッスン**](https://msdn.microsoft.com/library/windows/hardware/ff537655)操作)、\_リスニングフラグで\_使用されるリソース\_設定します。 ドライバーがチャネルを使用してデバイスにデータを書き込む場合 ([**要求\_ISOCH\_TALK**](https://msdn.microsoft.com/library/windows/hardware/ff537660)操作)、\_使用されるリソース\_を\_トーキングフラグで設定します。

-   ドライバーは、ハンドルを使用してトランザクションのデータバッファーを提供します。 (詳細については、手順 5. を参照してください。)バスドライバーは、実行されるまでバッファーを順番に使用し、デバイスドライバーがより多くのバッファーをアタッチするまで操作を一時停止します。 詳細については、「 [IEEE 1394 デバイスのアイソクロナス DMA 転送のバッファリング](https://docs.microsoft.com/windows-hardware/drivers/ieee/buffering-isochronous-dma-transfers-for-ieee-1394-devices)」を参照してください。

-   ドライバーは、この操作をアイソクロナスサイクルクロックの特定の値に同期するように指定できます。 詳細については、「 [IEEE 1394 デバイスのアイソクロナス同期オプション](https://docs.microsoft.com/windows-hardware/drivers/ieee/isochronous-synchronization-options-for-ieee-1394-devices)」を参照してください。

-   ドライバーは、アイソクロナスリッスンのオプションを設定できます。 ドライバーは、アイソクロナスパケットヘッダーがデータパケットから削除されるかどうかを示すことができます。 ドライバーは、到着したデータを待機中のデータバッファーにコピーするか、バッファーごとに1パケット、または各バッファーにデータを格納する必要があるかを示すこともできます。 詳細については、「 [IEEE 1394 デバイスのアイソクロナスリッスンオプション](https://docs.microsoft.com/windows-hardware/drivers/ieee/isochronous-listen-options-for-ieee-1394-devices)」を参照してください。

この要求が失敗した場合、ドライバーは、前の手順で割り当てたすべてのアイソクロナスリソースの割り当てを解除する必要があります。

### <a href="" id="step-5---attach-buffers-to-the-resource-handle-"></a>手順 5. バッファーをリソースハンドルにアタッチします。

ドライバーがリソースハンドルを割り当てると、バッファーがハンドルにアタッチされます。 ホストの DMA コントローラーは、接続されているバッファーに対してデータの読み取りまたは書き込みを行います。

各バッファーでは、ドライバーは、バッファーの使用方法を記述する[**ISOCH\_記述子**](https://docs.microsoft.com/windows-hardware/drivers/ddi/1394/ns-1394-_isoch_descriptor)構造体を渡します。 バッファーの ISOCH\_記述子の構造体では、ドライバーは次の情報を指定できます。

-   フレームあたりの最大バイト数。 データの送信時に、ホストコントローラーはデータバッファーをこのサイズのパケットに分割します。

-   省略可能なコールバックルーチン。 バスドライバーは、処理が完了するとこのルーチンを呼び出します。

-   同期オプション。 同期オプションの詳細については、「 [IEEE 1394 デバイスのアイソクロナス同期オプション](https://docs.microsoft.com/windows-hardware/drivers/ieee/isochronous-synchronization-options-for-ieee-1394-devices)」を参照してください。

-   アイソクロナス通信操作では、ドライバーは、次のいくつかのデータパケットの前に付加されるヘッダーの一覧として、このバッファーを指定できます。 詳細については、「 [IEEE 1394 デバイスのアイソクロナストークオプション](https://docs.microsoft.com/windows-hardware/drivers/ieee/isochronous-talk-options-for-ieee-1394-devices)」を参照してください。

操作が開始されると、ドライバーは不要になったバッファーをデタッチし、追加のバッファーをアタッチできます。 ドライバーは、 [**ISOCH\_記述子**](https://docs.microsoft.com/windows-hardware/drivers/ddi/1394/ns-1394-_isoch_descriptor)で識別されたコールバックルーチンを使用して、バスドライバーが最後にアタッチされたバッファーの処理を完了したときに自身にシグナルを通知することができます。 IEEE 1394 デバイスの DMA バッファリングの説明については、「 [ieee 1394 デバイスのアイソクロナス Dma 転送のバッファリング](https://docs.microsoft.com/windows-hardware/drivers/ieee/buffering-isochronous-dma-transfers-for-ieee-1394-devices)」を参照してください。

### <a href="" id="step-6---begin-the-data-transfer"></a>手順 6. データ転送を開始します

デバイスから読み取るために、ドライバーは[**ISOCH\_LISTEN 要求\_要求**](https://msdn.microsoft.com/library/windows/hardware/ff537655)を発行します。 デバイスに書き込むには、ドライバーは[**ISOCH\_TALK 要求\_要求**](https://msdn.microsoft.com/library/windows/hardware/ff537660)を発行します。 ドライバーは、適切なデバイス固有の方法で、デバイスを読み取りまたは書き込み用にアクティブ化できます。

 

 




