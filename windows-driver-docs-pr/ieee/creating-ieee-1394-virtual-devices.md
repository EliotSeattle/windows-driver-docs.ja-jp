---
title: IEEE 1394 仮想デバイスの作成
description: IEEE 1394 仮想デバイスの作成
ms.assetid: 5b6a4d7a-e116-4a68-a1f8-fd561fbc0495
keywords:
- エミュレーションドライバー WDK IEEE 1394 バス
- ハードウェアエミュレーションドライバー WDK IEEE 1394 バス
- 仮想デバイス WDK IEEE 1394 バス
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 98aa737dfb68b46dafb4f3c081d905447ab2f5fc
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72841542"
---
# <a name="creating-ieee-1394-virtual-devices"></a>IEEE 1394 仮想デバイスの作成





上位レベルのドライバーとユーザーモードサービスは、 [**IOCTL\_IEEE1394\_API\_要求**](https://msdn.microsoft.com/library/windows/hardware/ff537241)制御コードを持つデバイス制御要求を使用して、仮想1394デバイスを追加または削除できます。 要求には、バスドライバーによって実行 (追加または削除) されるアクションを指定する**Requestnumber**メンバーを持つ[**IEEE1394\_API\_要求**](https://docs.microsoft.com/previous-versions/ff537204(v=vs.85))構造が含まれています。 仮想デバイスにはデバイス ID もインスタンス ID もないため、仮想デバイスの作成を要求するドライバーまたはユーザープログラムは、 [**IEEE1394\_VDEV\_PNP\_要求**](https://msdn.microsoft.com/library/windows/hardware/ff537206)構造にデバイス id とインスタンス id を指定する必要があります。

IOCTL\_IEEE1394\_API\_REQUEST を使用して IEEE1394\_REQUEST\_FLAG\_PERSISTENT が指定されている場合、1394バスドライバーは、仮想デバイスに関する不揮発性コンテキスト情報をレジストリに格納します。 これにより、バスドライバーは、上位レベルのドライバーを操作せずに、次回の起動時に仮想 PDO を自動的に再作成できます。

バスドライバーは、このレジストリエントリを使用して、システム内の1394デバイススタックごとに仮想デバイスを "列挙" します。 仮想デバイス用の仮想 PDO を作成した後、1394バスドライバーは、実際のデバイス用に PDO を作成した場合と同様に、 [**IoInvalidateDeviceRelations**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-ioinvalidatedevicerelations)を呼び出します。 この呼び出しにより、新しいデバイスが到着したことがプラグアンドプレイ (PnP) マネージャーに通知され、PnP マネージャーによって仮想デバイスのドライバーが読み込まれます。

システムに 1 1394 以上のホストコントローラーが存在する場合は、レジストリで定義されている仮想デバイスが複数回列挙されます。 各仮想デバイスに一意のインスタンス ID があることを確認するには、仮想デバイスを作成する上位レベルのドライバーまたはユーザーサービスで、1 1394 以上のホストコントローラーを持つシステム上の仮想デバイスに対して、特定の "ハードコードされた" インスタンス ID を指定しないようにする必要があります。 代わりに、上位レベルのソフトウェアでは、IEEE1394\_API\_要求で\_ローカル\_ホスト\_EUI フラグを使用\_には、IEEE1394\_REQUEST\_フラグを設定する必要があります。 このフラグが設定されている場合、次にバスドライバーがデバイスを列挙するときに、仮想デバイスのインスタンス ID としてホストコントローラーのインスタンス ID が使用されます。 各1394デバイススタックには一意のインスタンス ID を持つホストコントローラーがあるため、インスタンス ID がホストコントローラーのインスタンス ID と同じである仮想デバイスにも、一意のインスタンス ID が割り当てられます。

1394バス上の仮想デバイスを公開するには、次の手順に従って、エミュレーションドライバーが仮想デバイスのユニットディレクトリを追加する必要があります。

1.  \_要求を送信し[ **\_ローカル\_ホストの\_プロパティ**](https://msdn.microsoft.com/library/windows/hardware/ff537663)の要求を、IRB に設定して、バスドライバーに設定し**ます**。これにより、ローカル\_ホストの\_のプロパティが設定さ\_システムの IEEE 1394 構成 ROM にユニットディレクトリを追加するために\_CROM を変更します。 この要求は、エミュレートされたデバイスの機能を公開するために、構成情報を構成 ROM に追加します。 要求は、エミュレーションドライバーが関連付けられている仮想 PDO を使用して送信する必要があります。

2.  バスのリセットを実行して、システム構成 ROM によって変更されたバス上に1394ノードがあることを通知します。

 

 




