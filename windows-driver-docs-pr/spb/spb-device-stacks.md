---
title: SPB デバイス スタック
description: Acpi.sys、SPB の周辺機器の PDO を作成します。
ms.assetid: 21AB67A2-AA3C-4998-A532-78D6F6F76244
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: bcced48edf8902aef1a80eac3ece2d27f7a4674c
ms.sourcegitcommit: fb7d95c7a5d47860918cd3602efdd33b69dcf2da
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/25/2019
ms.locfileid: "67376924"
---
# <a name="spb-device-stacks"></a>SPB デバイス スタック


Windows ドライバー モデル明確に区分ドライバー コンポーネント (たとえば、温度センサーなど) の周辺機器を制御するバスのバスのコント ローラーとの間のデータとコントロールの情報を転送を管理するドライバー コンポーネントから、周辺機器です。 この分離により、周辺機器に接続するデバイスのハードウェア ベンダー、[シンプルな周辺機器のバス](https://docs.microsoft.com/previous-versions/hh450903(v=vs.85))バス コント ローラー、バスの種類、およびハードウェア プラットフォームのさまざまなデバイスを制御するドライバーを記述する (sp B)。 同様に、SPB コント ローラーのハードウェア ベンダーは、さまざまな周辺機器への接続を可能にするこのコント ローラーのドライバーを記述できます。

、Windows でプラグ アンド プレイ (PnP) バスに接続されている周辺機器が 2、および詳細は、場合によってによって表される*デバイス オブジェクト*します。 A*機能*デバイス オブジェクト (FDO) を作成および、周辺機器の内部機能を制御する関数のドライバーによって所有されているし、デバイスの内部状態を表します。 スタックの FDO 以下に示します、*物理*バスへのデバイスの接続を表すデバイス オブジェクト (PDO)。 PDO は作成され、バス コント ローラーのドライバーを検出し、PnP マネージャーのデバイスを列挙によって所有されています。 この PDO には、バス コント ローラーは、バス経由でデバイスにアクセスする必要がある情報 (たとえば、バス アドレス) が含まれています。 関数ドライバーには、デバイスの I/O 操作を実行するバス コント ローラーからの支援が必要とする場合、関数ドライバーは、pdo、デバイス スタックを I/O 要求パケット (IRP) を送信し、バス コント ローラー ドライバーが IRP を受信します。 詳細については、次を参照してください。[デバイス オブジェクトとデバイス スタック](https://docs.microsoft.com/windows-hardware/drivers/kernel/device-objects-and-device-stacks)します。

これに対し、PnP、サポートせず、SPB (たとえば、I²C または SPI バス)、SPB コント ローラーのドライバーが検出して SPB の周辺機器を列挙していません。 代わりに、ハードウェア プラットフォームの ACPI ファームウェアは、これらのデバイスと、バス接続について説明し、Acpi.sys、ACPI ドライバー、PnP マネージャーのこれらのデバイスを列挙します。

さらに、Acpi.sys は、SPB の周辺機器の PDO を作成します。 このデバイスで、I/O 操作を実行するには、デバイスの機能のドライバーに送信しません下位のスタック IRP PDO PDO は I/O 操作を実行することはできませんが、Acpi.sys によって所有されているためです。 代わりに、関数のドライバーは IRP を SPB コント ローラーのドライバーに送信しなければなりません。 SPB コント ローラーのドライバーには、周辺機器の FDO として同じデバイス スタック内にない SPB コント ローラーの FDO が所有しています。 この IRP を送信するには、デバイスの関数のドライバーがまず SPB コント ローラーへの論理接続を開くし、WDFFILEOBJECT オブジェクトのハンドルをこの接続を受信する必要があります。 ドライバーはし、デバイスに送信する Irp のターゲットとしてこのハンドルを指定します。 SPB コント ローラー ドライバーがこれらの Irp を受信し、(と組み合わせて、 [SPB フレームワーク拡張](https://docs.microsoft.com/windows-hardware/drivers/spb/spb-framework-extension)SpbCx) デバイスで要求された I/O 操作を実行します。 SPB コント ローラーへの論理接続を開く方法の詳細については、次を参照してください。 [SPB の周辺機器の接続 Id](https://docs.microsoft.com/windows-hardware/drivers/spb/connection-ids-for-spb-connected-peripheral-devices)します。

一部の Irp を周辺機器の関数のドライバーを含む、O 要求チェーン内で SPB コント ローラーのドライバーより上位にあるドライバーによって完全処理できます。 しかし、Irp を要求するデータまたはコントロールの情報の転送、バス経由での周辺機器から SPB コント ローラーのドライバーで処理する必要があります。

関数のドライバーの FDO 上 SPB の周辺機器の関数のドライバーで動作するように設計されたフィルター ドライバーを挿入できます。 ただし、FDO と PDO 間のようなフィルターを挿入する影響を与えません関数ドライバーと SPB コント ローラー ドライバーの間で交換される Irp をインターセプトできないためです。

必要に応じて、上 SPB コント ローラーのドライバー (および、SpbCx SPB コント ローラーのドライバーに送信される Irp のキューを管理する) フィルター ドライバーを挿入できます。 ただし、 [SPB の I/O 要求インターフェイス](https://docs.microsoft.com/windows-hardware/drivers/spb/using-the-spb-i-o-request-interface)最上位レベルのドライバー インターフェイスは、O 要求チェーン内のドライバーでは、呼び出し元のコンテキストでの I/O 要求が配信されたことを確認する必要があります、スレッドを SpbCx と SPB コント ローラー ドライバーI/O の転送時にユーザー モードのバッファーにアクセスできます。

 

 




