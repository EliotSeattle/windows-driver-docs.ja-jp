---
title: WIA-TWAIN 互換性
description: WIA-TWAIN 互換性
ms.assetid: f4fe85cc-a201-4cf7-a0f9-74d7514f1447
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: c08b1dea7fd119fdfd6133a7a4bbb233724d7b36
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2019
ms.locfileid: "56574917"
---
# <a name="wia-twain-compatibility"></a>WIA-TWAIN 互換性





デバイスには 2 つまたは複数のドライバーを設定できる場合は、他との互換性について徹底的にこれらのドライバーをテストします。 たとえば、1 つのドライバー (など、ドライバーでは、いくつかのプロトコルでセッションを閉じるメッセージを送信しない) を使用できない状態、デバイスを離れると場合、デバイスと通信するときの他のドライバーで可能性があります失敗します。 このような状況は、シリアル デバイスで頻繁に発生します。

### <a name="wia-and-twain-in-the-same-dll"></a>WIA と同じ DLL の TWAIN

WIA ドライバーと TWAIN ドライバーを同時に 1 つの DLL から実行する場合、WIA サービスと TWAIN アプリケーションがどちらも、この DLL のインスタンスで読み込まれます。 DLL の WIA インスタンスでは、WIA 項目のツリーを作成します。 このツリーは、フォルダーと、カメラの画像を表します。 WIA (マイ コンピューターまたはスキャナーとカメラ ウィザード) などを使用するアプリケーションは、ドライバー、項目のツリーのコピーになります。

イメージを削除したり、TWAIN ドライバーを使用して追加、ときに、WIA ドライバーはこの変更の通知されません。 その結果、その WIA 項目のツリーが削除されているイメージを含むか、またはが追加されているイメージが含まれていません。 どちらの場合、ドライバーは、その項目のツリーを更新する必要があります。 これを行うには、TWAIN ドライバーはイメージが追加または削除されたときに、その項目のツリーを更新する、WIA ドライバーを注文する必要があります。

呼び出しは 1 つの方法**CoCreateInstance**(CLSID\_**IWiaDevMgr**,...)、TWAIN ドライバーからすべてのデバイスを列挙し、デバイスを検索します。 ドライバーは、この列挙体を識別するために 1 つの方法では、TWAIN ドライバーのクエリでは、このプロパティが存在する場合は、WIA ドライバーであるを知ることができるように、WIA ドライバー カスタム プロパティを作成します。 作成したら、 **IWiaItem** 、ドライバーの場合、そのツリーを再構築するには、ドライバーにコマンドを送信します (たとえば、送信、 [WIA CMD\_同期](wia-driver-command-support.md)コマンドへの呼び出しを**IWiaItem::DeviceCommand**メソッド)。 **CoCreateInstance**、 **IWiaDevMgr**、および**IWiaItem** Microsoft Windows SDK ドキュメントに記載されています。

WIA 項目のツリーを更新する別の方法は、名前付きで作成する[イベント](wia-driver-event-support.md)WIA ドライバー。 このイベントがシグナル状態には、WIA ドライバーのスレッドを待機できます。 TWAIN ドライバーに通知を削除または TWAIN ドライバーを使用してイメージを追加するたびに (呼び出して**SetEvent** (Windows SDK のドキュメントで説明)) この名前付きイベント。 WIA ドライバーでスレッドが解放されます、および WIA ドライバーには、ツリーが再構築されます。

どちらの方法では、カメラまたはスキャナーの実際のイメージに加えられた変更が反映されるように、ツリーをリビルドする必要があります。 確認して追加または項目のツリーから項目を削除してツリーを更新するたびに、イベント キューに追加する (たとえば、WIA\_イベント\_項目\_の削除または WIA\_イベント\_ツリー\_UPDATED (これらおよび他の WIA イベント識別子については、Windows SDK のドキュメントを参照してください))。 ツリーが変更されたときにイベントを正常に送信する場合このマイ コンピューターや他の WIA アプリケーションを自動的に更新されない問題は解決されます。

**注**   TWAIN の中で同じ DLL、WIA WIA ドライバーが存在し、TWAIN ドライバーは、同じ UI を共有できません。 各ドライバーでは、独自の UI をいる必要があります。

 

 

 




