---
title: PCI 電源の管理とデバイス ドライバー
description: PCI 電源管理 (PCI PM) に準拠しているハードウェアがデバイス ドライバーと対話する方法について説明します。
ms.assetid: BA6792EE-CAD8-4C9E-AAA6-D1D8799F50C3
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: dba043ac0e4b9df2d7ebbe2cb836ce14d0d7bfc6
ms.sourcegitcommit: 0cc5051945559a242d941a6f2799d161d8eba2a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "63354521"
---
# <a name="pci-power-management-and-device-drivers"></a>PCI 電源の管理とデバイス ドライバー


**更新**

-   2001 年 12 月 4 日

この記事では、PCI 電源管理 (PCI PM) に準拠しているハードウェアがオペレーティング システム内のデバイス ドライバーと対話する方法および PCI PM が ACPI と統合する方法について、ベンダーが発生したいくつかの混乱を明確化します。 詳細については、「<https://www.uefi.org/specifications>」を参照してください。

## <a name="device-drivers-and-pci-power-management"></a>デバイス ドライバー、および PCI 電源管理


ここでは、について理解している Windows Driver Model (WDM) ドライバーが電源管理イベントを処理する方法と、現在の Windows DDK」の説明に従って前提としています。 一般に、デバイス ドライバーの責任は次のとおりです。

-   **バス ドライバー**:バス ドライバーは、列挙、構成、およびデバイスを制御する責任を負います。 PCI PM、PCI ドライバは、ハードウェアの機能を決定する PCI PM レジスタの読み取りを行う。 電源の Irp では、電源の状態の変更を要求、PCI ドライバは、Dx のさまざまな状態にハードウェアを設定するには、PCI power management レジスタに書き込まれます。

    PCI ドライバが書き込む PCI PM レジスタ PME を起動するデバイスを有効にするウェイク アップのデバイスが有効な場合 (ACPI は、アクションを実行しても、次のセクションを参照してください)。 最後に、ACPI PCI バスがシステムをスリープ解除すると判断した場合、PCI ドライバはどのデバイスが PME のアサートでそのデバイスが、PME を無効にし、そのデバイスのドライバーに通知を探して PCI 構成領域をスキャンします。

-   **デバイス ドライバー**:デバイスの特定のドライバーは、保存して、デバイス コンテキストを復元ポリシー所有者は、デバイスの電源の状態の変更を要求する責任を負います。 デバイス ドライバーは、低いデバイスの電源状態変更を要求する電源 IRP を受信すると、デバイス ドライバがデバイスを後で有効にするために必要な任意の独自のデバイス コンテキストを保存する責任を負います。 場合によってである可能性があります何も保存しません。

PCI PM のレジスタは、ドメインでは厳密に PCI ドライバ--は、IHV のデバイス ドライバーはこれらのレジスタのいずれかへのアクセスに必要ありません。 これによって、システムを確実に動作しません。 デバイス ドライバーの責任では、独自のアクションを実行します。

## <a name="integrating-acpi-and-pci-pm"></a>ACPI および PCI PM の統合


デバイスによっては、ノートブックでのビデオ デバイスはマザーボード特には、両方の電源管理の PCI だけでなく ACPI ソース言語アセンブラー (ASL) の電源を完全にデバイスを管理する必要があります。 PCI の電源管理のレジスタは内部クロックと電源平面などのデバイスの内部状態を制御は。 ASL は外部のクロックと電源の平面など、外部の状態を制御または ASL をビデオ バックライト付き制御のビデオ コント ローラーの場合。 ASL および PCI PM にのみ結合できますマザーボード デバイス上に注意してください。

OnNow アーキテクチャは、階層型アーキテクチャは、当然ながらとの統合、デバイス ドライバー、PCI ドライバ、および ACPI ドライバー (ASL) を処理します。 次のシナリオでは、ドライバーがこれらのデバイスを処理するために呼び出される順序を表示します。

**注**  説明どおりに動作する上記のシナリオの WDM ドライバーする必要があります転送 POWER Irp 現在のバージョンの Microsoft Windows DDK」に記載されているようです。

 

## <a name="scenario-1-turning-off-a-device"></a>シナリオ 1:デバイスをオフにします。


1.  **デバイス ドライバー**:独自のデバイスの状態を保存します。
2.  **PCI ドライバ**:プラグ アンド プレイの構成を保存します (割り込みとバー) のデバイスを無効に D3 の PCI PM レジスタを使用してデバイスに配置します。
3.  **ACPI ドライバー**:ASL コードが実行されます (\_PS3 と\_使用されていないリソースを電源オフ)、チップの外部の状態を制御します。

## <a name="scenario-2-pci-power-management-and-device-drivers"></a>例 2:PCI の電源管理とデバイスのドライバー


1.  **ACPI ドライバー**:ASL コードが実行されます (\_PS0 と\_ON に、OnNow 電源リソースが必要)、チップの外部の状態を制御します。
2.  **PCI ドライバ**:PCI PM レジスタを使用して D0 でデバイスし、プラグ アンド プレイの構成を復元 (割り込みとバー--これら異なる可能性があります、デバイス上の内容以前から)。
3.  **デバイス ドライバー**:デバイスで専用のコンテキストを復元します。

## <a name="scenario-3-enabling-wake-up"></a>例 3:ウェイク アップを有効にします。


1.  **デバイス ドライバー**:ウェイク アップを有効にするチップでは、独自のレジスタを設定します。 たとえば、パターン一致するネットワーク ウェイク アップでこれは場合パターンように、アダプターにプログラムです。
2.  **PCI ドライバ**:ウェイク アップのセットには、PME をアサートするデバイスを許可する PCI PM レジスタに bits が有効にします。
3.  **ACPI ドライバー**:により、PME に関連付けられているチップ セットで GPE (に従って、 \_PRW オブジェクトは、PCI バスのルートの下に表示)。

## <a name="scenario-4-wake-up"></a>シナリオ 4:ウェイク アップ


1.  **ACPI ドライバー**:スリープ状態を解除し、ウェイク アップのイベントのセット GPE ステータス ビット、Gpe を無効にして、いずれかの操作を実行している GPE ステータス ビットをスキャン\_Lxx または\_GPE ビットのセットに関連付けられた Exx メソッド。 PCI バスでウェイク アップ通知への応答、ACPI ドライバーは、PCI ドライバの待機を完了\_システムをスリープ解除は、PCI ドライバーに通知する IRP のスリープを解除します。
2.  **PCI ドライバ**:セット PME 状態のビットがあるデバイスを探して構成領域をスキャンします。 デバイスごとの PME を無効にし、待機が完了すると、\_WAKE IRP をそのデバイスのウェイク アップをアサートしているドライバーに通知します。 PCI ドライバが見つかると、アサート PME しないすべての PCI デバイスを通じてとアサートされる PME が停止した場合は、完全なパスが行われたときに、ウェイク アップのデバイスのスキャンを停止します。
3.  **デバイス ドライバー**:デバイスは、D0 に配置する要求 (シナリオ 2 を参照してください) およびウェイク アップ イベントを処理するために必要なチップで、独自のレジスタを設定します。

## <a name="call-to-action-on-pci-power-management-and-device-drivers"></a>PCI の電源管理とデバイス ドライバーに対してアクションを呼び出します。


-   この記事で説明したように ACPI および PCI PM の機能をデバイスに統合するには。
-   PCI の電源管理の仕様は<http://www.pcisig.com>します。 このリンクは、Microsoft.com サイトを残します。
-   ACPI 仕様<https://www.uefi.org/specifications>します。 このリンクは、Microsoft.com サイトを残します。
-   ACPI コンポーネント アーキテクチャ (ACPICA) コンパイラをご覧<https://acpica.org/downloads/binary-tools>します。 このリンクは、Microsoft.com サイトを残します。

 

 




